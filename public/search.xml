<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Browser</title>
    <url>/2021/05/30/browser/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><h4 id="读完本文您将了解以下几点"><a href="#读完本文您将了解以下几点" class="headerlink" title="读完本文您将了解以下几点"></a>读完本文您将了解以下几点</h4><p>1，浏览器内有哪些进程，这些进程都有些什么作用。</p>
<p>2，浏览器地址输入 URL 后，内部的进程、线程都做了哪些事，以及我们与浏览器交互时，内部进程是怎么处理这些交互事件的。</p>
<h3 id="浏览器架构"><a href="#浏览器架构" class="headerlink" title="浏览器架构"></a>浏览器架构</h3><h4 id="进程和线程"><a href="#进程和线程" class="headerlink" title="进程和线程"></a>进程和线程</h4><p>1，进程（process）是程序的一次执行过程，是一个动态概念，是程序在执行过程中分配和管理资源的基本单位。</p>
<p>2，线程（thread）是 CPU 调度和分派的基本单位，它可与同属一个进程的其他的线程共享进程所拥有的全部资源。</p>
<a id="more"></a>

<ul>
<li><p>简单的说，进程可以理解成正在执行的应用程序，而线程呢，可以理解成我们应用程序中的代码的执行器。而他们的关系可想而知，<strong>线程是跑在进程里面的</strong>，一个进程里面可能有一个或者多个线程，而一个线程，只能隶属于一个进程。</p>
</li>
<li><p>浏览器属于一个应用程序，而应用程序的一次执行，可以理解为计算机启动了一个进程，进程启动后，CPU 会给该进程分配相应的内存空间，当进程得到了内存之后，就可以使用线程进行资源调度，进而完成应用程序的功能。</p>
</li>
<li><p>在应用程序中，为了满足功能的需要，启动的进程会创建另外的新的进程来处理其他任务，这些创建出来的新的进程拥有全新的独立的内存空间，不能与原来的进程共享内存，如果这些进程之间需要通信，可以通过 IPC 机制（Inter Process Communication）来进行。</p>
</li>
</ul>
<p><img src="/2021/05/30/browser/process.png" alt="进程与线程"></p>
<blockquote>
<p>很多应用程序都会采取这种多进程的方式来工作，因为进程和进程之间是互相独立的它们互不影响，也就是说，当其中一个进程挂掉了之后，不会影响到其他进程的执行，只需要重启挂掉的进程就可以恢复运行。</p>
</blockquote>
<h4 id="浏览器的多进程架构"><a href="#浏览器的多进程架构" class="headerlink" title="浏览器的多进程架构"></a>浏览器的多进程架构</h4><p>1，开发一个浏览器，它的架构可以是一个单进程多线程的应用程序，也可以是一个使用 IPC 通信的多进程应用程序。不同的浏览器使用不同的架构，下面主要以 Chrome 为例，介绍浏览器的多进程架构。在 Chrome 中，主要的进程有 4 个：</p>
<ul>
<li><p><code>浏览器进程 (Browser Process)</code>：负责浏览器的 Tab 的前进、后退、地址栏、书签栏的工作和处理浏览器的一些不可见的底层操作，比如网络请求和文件访问。</p>
</li>
<li><p><code>渲染进程 (Renderer Process)</code>：负责一个 Tab 内的显示相关的工作，也称渲染引擎。</p>
</li>
<li><p><code>插件进程 (Plugin Process)</code>：负责控制网页使用到的插件。</p>
</li>
<li><p><code>GPU（图形处理器）进程 (GPU Process)</code>：负责处理整个应用程序的 GPU 任务。</p>
</li>
</ul>
<p><img src="/2021/05/30/browser/browserProcess.png" alt="浏览器进程"></p>
<blockquote>
<p><strong>GPU</strong>：显卡的处理器称为图形处理器（GPU），它是显卡的”心脏”，与 CPU 类似，只不过 GPU 是专为执行复杂的数学和几何计算而设计的。<br><strong>CPU</strong>：CPU 一般是指中央处理器，它是一块超大规模的集成电路，是一台计算机的运算核心和控制核心。它的功能主要是解释计算机指令以及处理计算机软件中的数据。<br><strong>CPU 与 GPU 的区别</strong>：当你操作电脑的时候，为了完成某项工作，需要电脑帮你工作，就像计算某个题目那样。计算题目，理解题目并且整理出解题的步骤以及解法，那是 CPU 的事情。但是解题的过程需要用到的众多计算，则需要一帮不需要很高逻辑理解力的计算者完成，他们只需要负责其中很简单但是数量又很大的简单运算就行了，最后他们把各自运算的结果交出来给 CPU 整理，而这群计算者就是 GPU。<br><img src="/2021/05/30/browser/GPUandCPU.png" alt="CPU与GPU硬件逻辑结构对比"><br>上图中对 CPU 与 GPU 中的逻辑架构进行了对比。其中 Control 是控制器、ALU 算术逻辑单元、Cache 是 cpu 内部缓存、DRAM 就是内存。可以看到 GPU 设计者将更多的晶体管用作执行单元，而不是像 CPU 那样用作复杂的控制单元和缓存。从实际来看，CPU 芯片空间的 5%是 ALU，而 GPU 空间的 40%是 ALU。这也是导致 GPU 计算能力超强的原因。</p>
</blockquote>
<p>2，以上 4 个进程之间的关系：</p>
<ul>
<li>当我们浏览一个网页，我们会在浏览器的地址栏里输入 URL，这个时候 Browser Process 会向这个 URL 发送请求，获取这个 URL 的 HTML 内容，然后将 HTML 交给 Renderer Process，Renderer Process 解析 HTML 内容，解析遇到需要请求网络的资源又返回来交给 Browser Process 进行加载，同时通知 Browser Process，需要 Plugin Process 加载插件资源，执行插件代码。解析完成后，Renderer Process 计算得到图像帧，并将这些图像帧交给 GPU Process，GPU Process 将其转化为图像显示屏幕。</li>
</ul>
<p><img src="/2021/05/30/browser/4process.png" alt="浏览器四个进程的关系"></p>
<h4 id="多进程架构的好处"><a href="#多进程架构的好处" class="headerlink" title="多进程架构的好处"></a>多进程架构的好处</h4><p>1，更高的容错性。当今 WEB 应用中，HTML，JavaScript 和 CSS 日益复杂，这些跑在渲染引擎的代码，频繁的出现 BUG，而有些 BUG 会直接导致渲染引擎崩溃，多进程架构使得每一个渲染引擎运行在各自的进程中，相互之间不受影响，也就是说，当其中一个页面崩溃挂掉之后，其他页面还可以正常的运行不收影响。</p>
<p><img src="/2021/05/30/browser/haochu.png" alt="多进程的好处"></p>
<p>2，更高的安全性和沙盒性（sanboxing）。渲染引擎会经常性的在网络上遇到不可信、甚至是恶意的代码，它们会利用这些漏洞在你的电脑上安装恶意的软件，针对这一问题，浏览器对不同进程限制了不同的权限，并为其提供沙盒运行环境，使其更安全更可靠。</p>
<p>3，更高的响应速度。在单进程的架构中，各个任务相互竞争抢夺 CPU 资源，使得浏览器响应速度变慢，而多进程架构正好规避了这一缺点。</p>
<h4 id="多进程架构优化"><a href="#多进程架构优化" class="headerlink" title="多进程架构优化"></a>多进程架构优化</h4><p>1，前面说到，Renderer Process 的作用是负责一个 Tab 内的显示相关的工作，这就意味着，一个 Tab，就会有一个 Renderer Process，这些进程之间的内存无法进行共享，而不同进程的内存常常需要包含相同的内容。</p>
<h4 id="浏览器的进程模式"><a href="#浏览器的进程模式" class="headerlink" title="浏览器的进程模式"></a>浏览器的进程模式</h4><p>1，为了节省内存，Chrome 提供了四种进程模式（Process Models），不同的进程模式会对 Tab 进程做不同的处理。</p>
<ul>
<li><p>Process-per-site-instance（default）：同一个 site-instance 使用一个进程。</p>
</li>
<li><p>Process-per-site：同一个 site 使用一个进程。</p>
</li>
<li><p>Process-per-tab：每个 tab 使用一个进程。</p>
</li>
<li><p>Single process：所有 tab 共用一个进程。</p>
</li>
</ul>
<p>2，site 和 site-instance 的定义：</p>
<ul>
<li><p>site 指的是相同的 registered domain name(如：google.com ，bbc.co.uk)和 scheme (如：https://)。比如 a.baidu.com 和 b.baidu.com，即只有主机不同，就可以理解为同一个 site（注意这里要和 Same-origin policy（同源策略）区分开来，因为同源策略还涉及到子域名和端口）。</p>
</li>
<li><p>site-instance 指的是一组 connected pages from the same site（来自同一站点的已连接页面），这里 connected 的定义是 can obtain references to each other in script code（可以在脚本代码中获取彼此的引用）怎么理解这段话呢，满足下面两中情况并且打开的新页面和旧页面属于上面定义的同一个 site，就属于同一个 site-instance（网站实例）。</p>
<ul>
<li><p>用户通过<code>_&lt;a target=&quot;\_blank&quot;&gt;</code>这种方式点击打开的新页面。</p>
</li>
<li><p>JS 代码打开的新页面（比如 window.open)。</p>
</li>
</ul>
</li>
</ul>
<h4 id="浏览器四个进程模式说明"><a href="#浏览器四个进程模式说明" class="headerlink" title="浏览器四个进程模式说明"></a>浏览器四个进程模式说明</h4><p>1，<strong>Single process</strong>：指单进程模式，所有 tab 都会使用同一个进程。</p>
<p>2，<strong>Process-per-tab</strong>：每打开一个 tab，会新建一个进程。</p>
<p>3，<strong>Process-per-site</strong>：当你打开 a.baidu.com 页面，在打开 b.baidu.com 的页面，这两个页面的 tab 使用的是同一个进程，因为这两个页面的 site 相同，而如此一来，如果其中一个 tab 崩溃了，而另一个 tab 也会崩溃。</p>
<p>4，<strong>Process-per-site-instance</strong>：这种模式是最重要的，因为这个是 Chrome 默认使用的模式，也就是几乎所有的用户都在用的模式。当你打开一个 tab 访问 a.baidu.com ，然后再打开一个 tab 访问 b.baidu.com，这两个 tab 会使用两个进程。而如果你在 a.baidu.com 中，通过 JS 代码打开了 b.baidu.com 页面，这两个 tab 会使用同一个进程。</p>
<h4 id="默认模式选择"><a href="#默认模式选择" class="headerlink" title="默认模式选择"></a>默认模式选择</h4><p>1，那么为什么浏览器使用 Process-per-site-instance 作为默认的进程模式呢？</p>
<ul>
<li>Process-per-site-instance 兼容了性能与易用性，是一个比较中庸通用的模式。相较于 Process-per-tab，能够少开很多进程，就意味着更少的内存占用；相较于 Process-per-site，能够更好的隔离相同域名下毫无关联的 tab，更加安全。</li>
</ul>
<h3 id="导航过程都发生了什么"><a href="#导航过程都发生了什么" class="headerlink" title="导航过程都发生了什么"></a>导航过程都发生了什么</h3><h4 id="网页加载过程"><a href="#网页加载过程" class="headerlink" title="网页加载过程"></a>网页加载过程</h4><h5 id="工作线程"><a href="#工作线程" class="headerlink" title="工作线程"></a>工作线程</h5><p>1，上面提到，tab 以外的大部分工作由浏览器进程 Browser Process（浏览器进程）负责，针对工作的不同，Browser Process 划分出不同的工作线程：</p>
<ul>
<li><p>UI thread：控制浏览器上的按钮及输入框。</p>
</li>
<li><p>network thread：处理网络请求，从网上获取数据。</p>
</li>
<li><p>storage thread：控制文件等的访问。</p>
</li>
</ul>
<p><img src="/2021/05/30/browser/thread.png" alt="浏览器进程划分的不同线程"></p>
<h5 id="网页加载步骤"><a href="#网页加载步骤" class="headerlink" title="网页加载步骤"></a>网页加载步骤</h5><p>1，<strong>处理输入</strong>：当我们在浏览器的地址栏输入内容按下回车时，UI thread 会判断输入的内容是搜索关键词（search query）还是 URL，如果是搜索关键词，跳转至默认搜索引擎对应都搜索 URL，如果输入的内容是 URL，则开始请求 URL。</p>
<p>2，<strong>开始导航</strong>：回车按下后，UI thread 将关键词搜索对应的 URL 或输入的 URL 交给网络线程 Network thread，此时 UI 线程使 Tab 前的图标展示为加载中状态，然后网络进程进行一系列诸如 DNS 寻址，建立 TLS 连接等操作进行资源请求，如果收到服务器的 301 重定向响应，它就会告知 UI 线程进行重定向然后它会再次发起一个新的网络请求。</p>
<p><img src="/2021/05/30/browser/uithread.png" alt="导航过程"></p>
<p>3，<strong>读取响应</strong>：network thread 接收到服务器的响应后，开始解析 HTTP 响应报文，然后根据响应头中的 Content-Type 字段来确定响应主体的媒体类型（MIME Type），如果媒体类型是一个 HTML 文件，则将响应数据交给渲染进程（renderer process）来进行下一步的工作，如果是 zip 文件或者其它文件，会把相关数据传输给下载管理器。与此同时，浏览器会进行 Safe Browsing 安全检查，如果域名或者请求内容匹配到已知的恶意站点，network thread 会展示一个警告页。除此之外，网络线程还会做 CORB（Cross Origin Read Blocking）检查来确定那些敏感的跨站数据不会被发送至渲染进程。</p>
<blockquote>
<p>CORB：chromium 文档中对它的定义是：浏览器在加载可以跨域资源时，在资源载入页面之前，对其进行识别和拦截的算法。</p>
<ul>
<li><p>具体说明：Chrome 浏览器在处理不同 tab 和不同页面时，会将为它们划分不同的进程，而且受制于同源策略的影响，这些页面之间本应该互不干扰。但是我们知道，同源策略虽然牛逼，但浏览器中仍然存在一些不受制于它约束的 api、标签，比如常见的 img、iframe 和 script 等等。诸如以下代码，不知道看文章的诸位有没有写过，或者说遇见过：<code>&lt;img src=&quot;https://foo/bar/baz/&quot;&gt;</code>。</p>
</li>
<li><p>有人可能会问，一个 img 标签你 src 属性不填图片的 uri，你是不是傻。其实不是这样的，有时候对网站做一些跟踪和分析时，确实会这么写，因为浏览器会往 <code>https://foo/bar/baz/</code> 这个地址发送一个 GET 资源的请求，在服务端我们可以利用这个请求做一些追踪的逻辑，同理 script 也可以完成需求。但是这么做的后果就是，虽然 img 帮我们发送了这个请求，但是它却没有得到所期望格式的资源，所以这里实际可以算作一种错误或者异常。而一些攻击者可以利用这一点，比如，在页面嵌入下面的代码：<code>&lt;img src=&quot;https://example.com/secret.json&quot;&gt;</code>来加载跨域私密文件，因为 img 不受同源策略的制约，这个请求是可以发出去的，服务器响应返回后，显然 secret.json 不是一个图片格式的资源，img 不会显示它，但是并不代表负责渲染当前页面的进程的内存中没有保留关于 secret.json 的数据。因此攻击者可以利用上文中提及的漏洞，编写一些代码来“偷”这些数据，从而造成安全隐患。</p>
</li>
</ul>
<p>CORB 的作用：就是当浏览器尝试以上面代码的方式加载跨域资源时，在资源未被加载之前进行拦截，从而提升攻击者进行幽灵攻击的成本，这里之所以是说提升成本还非彻底解决是因为这个漏洞是基于硬件层面的，所以软件层面只能做有限的修复，有的人可能马上会说，那 CPU 直接去掉或者用户放弃使用预处理功能不就好了吗？理论上是这样的，但是这将导致预处理带来的性能红利瞬间消失，而且 CPU 的架构设计也不是一天两天就能改的，而且就算改了也没办法一下普及。</p>
<ul>
<li>受 CORB 保护的内容类型：分别是 json、html 和 xml。关于如何针对每种内容类型 CORB 如何对其进行保护，文档中有详细的章节进行介绍，这里就做过多的赘述了。大体的规则均是对内容格式进行一些有针对性的校验，以确认它确实是某个内容类型。这个校验结果最终影响 CORB 的运作方式。</li>
</ul>
</blockquote>
<p>4，<strong>查找渲染进程</strong>：各种检查完毕以后，network thread 确信浏览器可以导航到请求网页，network thread 会通知 UI thread 数据已经准备好，UI thread 会查找到一个 renderer process 进行网页的渲染。</p>
<p><img src="/2021/05/30/browser/ui.png" alt="查找渲染进程"></p>
<ul>
<li>浏览器为了对查找渲染进程这一步骤进行优化，考虑到网络请求获取响应需要时间，所以在第二步开始，浏览器已经预先查找和启动了一个渲染进程，如果中间步骤一切顺利，当 network thread 接收到数据时，渲染进程已经准备好了，但是如果遇到重定向，这个准备好的渲染进程也许就不可用了，这个时候会重新启动一个渲染进程。</li>
</ul>
<p>5，<strong>提交导航</strong>：到了这一步，数据和渲染进程都准备好了，Browser Process 会向 Renderer Process 发送 IPC 消息来确认导航，此时，浏览器进程将准备好的数据发送给渲染进程，渲染进程接收到数据之后，又发送 IPC 消息给浏览器进程，告诉浏览器进程导航已经提交了，页面开始加载。</p>
<p><img src="/2021/05/30/browser/render.png" alt="提交导航过程"></p>
<ul>
<li>这个时候导航栏会更新，安全指示符更新（地址前面的小锁），访问历史列表（history tab）更新，即可以通过前进后退来切换该页面。</li>
</ul>
<blockquote>
<p>IPC：IPC（Inter-Process Communication，进程间通信）。进程间通信是指在不同进程之间传播或交换信息。</p>
<ul>
<li>IPC 的方式通常有管道（包括无名管道和命名管道）、消息队列、信号量、共享存储、Socket、Streams 等。其中 Socket 和 Streams 支持不同主机上的两个进程 IPC。</li>
</ul>
</blockquote>
<p>6，<strong>初始化加载完成</strong>：当导航提交完成后，渲染进程开始加载资源及渲染页面（详细内容下文介绍），当页面渲染完成后（页面及内部的 iframe 都触发了 onload 事件），会向浏览器进程发送 IPC 消息，告知浏览器进程，这个时候 UI thread 会停止展示 tab 中的加载中图标。</p>
<h3 id="网页渲染原理"><a href="#网页渲染原理" class="headerlink" title="网页渲染原理"></a>网页渲染原理</h3><h4 id="具体原理说明"><a href="#具体原理说明" class="headerlink" title="具体原理说明"></a>具体原理说明</h4><p>1，导航过程完成之后，浏览器进程把数据交给了渲染进程，渲染进程负责 tab 内的所有事情，核心目的就是将 HTML/CSS/JS 代码，转化为用户可进行交互的 web 页面。那么渲染进程是如何工作的呢？</p>
<p>2，渲染进程中，包含线程分别是：</p>
<ul>
<li><p>一个主线程（main thread）。</p>
</li>
<li><p>多个工作线程（work thread）。</p>
</li>
<li><p>一个合成器线程（compositor thread）。</p>
</li>
<li><p>多个光栅化线程（raster thread）。</p>
</li>
</ul>
<p><img src="/2021/05/30/browser/rendererProcess.png" alt="网页渲染原理"></p>
<ul>
<li>以上不同的线程，有着不同的工作职责。</li>
</ul>
<h4 id="构建-DOM"><a href="#构建-DOM" class="headerlink" title="构建 DOM"></a>构建 DOM</h4><p>1，当渲染进程接受到导航的确认信息后，开始接受来自浏览器进程的数据，这个时候，主线程会解析数据转化为 DOM（Document Object Model）对象。</p>
<h4 id="子资源加载"><a href="#子资源加载" class="headerlink" title="子资源加载"></a>子资源加载</h4><p>1，在构建 DOM 的过程中，会解析到图片、CSS、JavaScript 脚本等资源，这些资源是需要从网络或者缓存中获取的，主线程在构建 DOM 过程中如果遇到了这些资源，逐一发起请求去获取，而为了提升效率，浏览器也会运行预加载扫描（preload scanner）程序，如果 HTML 中存在 img、link 等标签，预加载扫描程序会把这些请求传递给 Browser Process 的 network thread 进行资源下载。</p>
<p><img src="/2021/05/30/browser/loadChild.png" alt="子资源加载"></p>
<h4 id="JavaScript-的下载与执行"><a href="#JavaScript-的下载与执行" class="headerlink" title="JavaScript 的下载与执行"></a>JavaScript 的下载与执行</h4><p>1，构建 DOM 过程中，如果遇到 script 标签，渲染引擎会停止对 HTML 的解析，而去加载执行 JS 代码，原因在于 JS 代码可能会改变 DOM 的结构（比如执行 document.write()等 API）。</p>
<p>2，开发者其实也有多种方式来告知浏览器应对如何应对某个资源，比如说如果在 script 标签上添加了 async 或 defer 等属性，浏览器会异步的加载和执行 JS 代码，而不会阻塞渲染。</p>
<h4 id="样式计算-Style-calculation"><a href="#样式计算-Style-calculation" class="headerlink" title="样式计算(Style calculation)"></a>样式计算(Style calculation)</h4><p>1，DOM 树只是我们页面的结构，我们要知道页面长什么样子，我们还需要知道 DOM 的每一个节点的样式。主线程在解析页面时，遇到 style 标签或者 link 标签的 CSS 资源，会加载 CSS 代码，根据 CSS 代码确定每个 DOM 节点的计算样式（computed style）。</p>
<p>2，计算样式是主线程根据 CSS 样式选择器（CSS selectors）计算出的每个 DOM 元素应该具备的具体样式，即使你的页面没有设置任何自定义的样式，浏览器也会提供其默认的样式。</p>
<p><img src="/2021/05/30/browser/renderStyle.png" alt="样式计算"></p>
<h4 id="布局-Layout"><a href="#布局-Layout" class="headerlink" title="布局(Layout)"></a>布局(Layout)</h4><p>1，DOM 树和计算样式完成后，我们还需要知道每一个节点在页面上的位置，布局（Layout）其实就是找到所有元素的几何关系的过程。</p>
<p>2，主线程会遍历 DOM 及相关元素的计算样式，构建出包含每个元素的页面坐标信息及盒子模型大小的布局树（Render Tree），遍历过程中，会跳过隐藏的元素（display: none），另外，伪元素虽然在 DOM 上不可见，但是在布局树上是可见的。</p>
<p><img src="/2021/05/30/browser/layout.png" alt="布局"></p>
<h4 id="绘制-Paint"><a href="#绘制-Paint" class="headerlink" title="绘制(Paint)"></a>绘制(Paint)</h4><p>1，有了 DOM、样式和布局，仍然不足以渲染页面。还要解决先画什么后画什么，即绘制顺序的问题。比如，z-index 影响元素叠放，如果有这个属性，那简单地按元素在 HTML 中出现的顺序绘制就会出错。</p>
<p><img src="/2021/05/30/browser/hz.png" alt="绘制"></p>
<p>2，布局 layout 之后，我们虽然知道了不同元素的结构，样式，几何关系，但要绘制出一个页面，我们还需要知道每个元素的绘制先后顺序，因此在绘制阶段，主线程会遍历布局树（layout tree），生成一系列的绘画记录（paint records）。绘画记录可以看做是记录各元素绘制先后顺序的笔记。比如“先画背景，然后画文本，最后画矩形”。</p>
<p><img src="/2021/05/30/browser/paint.png" alt="绘制"></p>
<p>3，渲染是一个流水线作业（pipeline）：前一道工序的输出就是下一道工序的输入。这意味着如果布局树有变化，则相应的绘制记录也要重新生成。</p>
<p><img src="/2021/05/30/browser/hz2.gif" alt="绘制"></p>
<p>4，如果元素有动画，浏览器就需要每帧运行一次渲染流水线。目前显示器的刷新率为每秒 60 次（60fps），也就是说每秒更新 60 帧，动画会显得很流畅。如果中间缺了帧，那页面看起来就会“闪眼睛”。</p>
<p><img src="/2021/05/30/browser/hz3.png" alt="渲染帧"></p>
<p>5，即便渲染操作的频率能跟上屏幕刷新率，但由于计算发生在主线程上，而主线程可能因为运行 JavaScript 被阻塞。此时动画会因为阻塞被卡住。</p>
<p><img src="/2021/05/30/browser/hz4.png" alt="渲染帧"></p>
<ul>
<li>此时，可以使用 requestAnimationFrame()将涉及动画的 JavaScript 操作分块并调度到每一帧的开始去运行。对于耗时的不必操作 DOM 的 JavaScript 操作，可以考虑 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers">Web Worker</a>，避免阻塞主线程。</li>
</ul>
<h4 id="合成-Compositing"><a href="#合成-Compositing" class="headerlink" title="合成(Compositing)"></a>合成(Compositing)</h4><p>1，文档结构、元素的样式、元素的几何关系、绘画顺序，这些信息我们都有了，这个时候如果要绘制一个页面，我们需要做的是把这些信息转化为显示器中的像素，这个转化的过程，叫做光栅化（rasterizing）。</p>
<p>2，要绘制一个页面，最简单的做法是只光栅化视口内（viewport）的网页内容，如果用户进行了页面滚动，就移动光栅帧（rastered frame）并且光栅化更多的内容以补上页面缺失的部分，如下：</p>
<p><img src="/2021/05/30/browser/compositing.gif" alt="合成"></p>
<ul>
<li>Chrome 第一个版本就是采用这种简单的绘制方式，这一方式唯一的缺点就是每当页面滚动，光栅线程都需要对新移进视图的内容进行光栅化，这是一定的性能损耗，为了优化这种情况，Chrome 采取一种更加复杂的叫做合成（compositing）的做法。</li>
</ul>
<p>3，什么是合成？合成是一种将页面分成若干层，然后分别对它们进行光栅化，最后在一个单独的线程 - 合成线程（compositor thread）里面合并成一个页面的技术。当用户滚动页面时，由于页面各个层都已经被光栅化了，浏览器需要做的只是合成一个新的帧来展示滚动后的效果罢了。页面的动画效果实现也是类似，将页面上的层进行移动并构建出一个新的帧即可。</p>
<p><img src="/2021/05/30/browser/compositor.gif" alt="分层后合成"></p>
<p>4，为了实现合成技术，需要对元素进行分层，确定哪些元素需要放置在哪一层，主线程需要遍历渲染树来创建一棵层次树（Layer Tree），对于添加了 will-change CSS 属性的元素，会被看做单独的一层，没有 will-change CSS 属性的元素，浏览器会根据情况决定是否要把该元素放在单独的层。</p>
<p><img src="/2021/05/30/browser/layoutTree.png" alt="层次树"></p>
<p>5，一旦 Layer Tree 被创建，渲染顺序被确定，主线程会把这些信息通知给合成器线程，合成器线程开始对层次树的每一层进行光栅化。有的层可以达到整个页面的大小，所以合成线程需要将它们切分为一块又一块的小图块（tiles），之后将这些小图块分别进行发送给一系列光栅线程（raster threads）进行光栅化，结束后光栅线程会将每个图块的光栅结果存在 GPU Process 的内存中。</p>
<p><img src="/2021/05/30/browser/raster.png" alt="光栅化"></p>
<p>6，为了优化显示体验，合成线程可以给不同的光栅线程赋予不同的优先级，将那些在视口中的或者视口附近的层先被光栅化。</p>
<p>7，当图层上面的图块都被栅格化后，合成线程会收集图块上面叫做绘画四边形（draw quads）的信息来构建一个合成帧（compositor frame）。</p>
<ul>
<li><p>绘画四边形：包含图块在内存的位置以及图层合成后图块在页面的位置之类的信息。</p>
</li>
<li><p>合成帧：代表页面一个帧的内容的绘制四边形集合。</p>
</li>
</ul>
<p>8，以上所有步骤完成后，合成线程就会通过 IPC 向浏览器进程（browser process）提交（commit）一个渲染帧。这个时候可能有另外一个合成帧被浏览器进程的 UI 线程（UI thread）提交以改变浏览器的 UI。这些合成帧都会被发送给 GPU 从而展示在屏幕上。如果合成线程收到页面滚动的事件，合成线程会构建另外一个合成帧发送给 GPU 来更新页面。</p>
<p><img src="/2021/05/30/browser/hcz.png" alt="合成帧"></p>
<p>9，合成的好处在于这个过程没有涉及到主线程，所以合成线程不需要等待样式的计算以及 JavaScript 完成执行。这就是为什么合成器相关的动画最流畅，如果某个动画涉及到布局或者绘制的调整，就会涉及到主线程的重新计算，自然会慢很多。</p>
<blockquote>
<p>什么是光栅化：光栅化是将一个图元转变为一个二维图像的过程（就是将几何数据经过一系列变换后最终转换为像素，从而呈现在显示设备上的过程）。二维图像上每个点都包含了颜色、深度和纹理数据。将该点和相关信息叫做一个片元（fragment）。光栅化的目的，是找出一个几何单元（比如三角形）所覆盖的像素。</p>
<ul>
<li>粗略地讲：模型的那些顶点在经过各种矩阵变换后也仅仅是顶点。而由顶点构成的三角形要在屏幕上显示出来，除了需要三个顶点的信息以外，还需要确定构成这个三角形的所有像素的信息。光栅化就是干这个的：<br><img src="/2021/05/30/browser/gsh.png" alt="光栅化"></li>
<li>光栅化会根据三角形顶点的位置，来确定需要多少个像素点才能构成这个三角形，以及每个像素点都应该得到哪些信息，比如 uv 坐标该是什么等。这是通过对顶点数据进行插值来完成的。</li>
<li>光栅化是将几何数据经过一系列变换后最终转换为像素，从而呈现在显示设备上的过程，如下图：<br><img src="/2021/05/30/browser/gsh2.png" alt="光栅化"></li>
<li>光栅化的本质是坐标变换、几何离散化。</li>
<li>总结：光栅化，就是将几何信息转换成一个个栅格组成的图像的过程。</li>
</ul>
<p>光栅化主要有以下几步：</p>
<ul>
<li>读取模型的顶点，3 个 3 个的读，因为要画三角形。</li>
<li>将 3 个顶点两两连成线，形成三角形。</li>
<li>计算屏幕像素点在三角形内还是三角形外。在三角形内部的，就上色（颜色是通过一系列计算得出来的），在三角形外部的，就不上色。<ul>
<li>注意：如果一个三角形挡在另一个三角形前面，我们应该只画前面的三角形。所以这里还需要比较一下正准备上色的这个像素点是不是已经上过色了。如果这个像素点已经上过色了，并且它是被 Z=1 的顶点上的色，而我们正准备上色的这个顶点的 Z=2（说明这个顶点被挡在了后面），那么这个顶点就不应该上色，因为它是被挡住的点。</li>
</ul>
</li>
<li>不断的循环，直到画完 3D 模型的所有三角形，这样一个模型就出来了。</li>
</ul>
</blockquote>
<h3 id="浏览器对事件的处理"><a href="#浏览器对事件的处理" class="headerlink" title="浏览器对事件的处理"></a>浏览器对事件的处理</h3><h4 id="浏览器对事件的处理说明"><a href="#浏览器对事件的处理说明" class="headerlink" title="浏览器对事件的处理说明"></a>浏览器对事件的处理说明</h4><p>1，当页面渲染完毕以后，TAB 内已经显示出了可交互的 WEB 页面，用户可以进行移动鼠标、点击页面等操作了，而当这些事件发生时候，浏览器是如何处理这些事件的呢？</p>
<ul>
<li>以点击事件（click event）为例，让鼠标点击页面时候，首先接受到事件信息的是 Browser Process，但是 Browser Process 只知道事件发生的类型和发生的位置，具体怎么对这个点击事件进行处理，还是由 Tab 内的 Renderer Process 进行的。Browser Process 接受到事件后，随后便把事件的信息传递给了渲染进程，渲染进程会找到根据事件发生的坐标，找到目标对象（target），并且运行这个目标对象的点击事件绑定的监听函数（listener）。</li>
</ul>
<p><img src="/2021/05/30/browser/event.png" alt="浏览器事件处理"></p>
<h4 id="渲染进程中合成器线程接收事件"><a href="#渲染进程中合成器线程接收事件" class="headerlink" title="渲染进程中合成器线程接收事件"></a>渲染进程中合成器线程接收事件</h4><p>1，前面我们说到，合成器线程可以独立于主线程之外通过已光栅化的层创建组合帧，例如页面滚动，如果没有对页面滚动绑定相关的事件，组合器线程可以独立于主线程创建组合帧，如果页面绑定了页面滚动事件，合成器线程会等待主线程进行事件处理后才会创建组合帧。那么，合成器线程是如何判断出这个事件是否需要给主线程处理的呢？</p>
<ul>
<li>由于执行 JS 是主线程的工作，当页面合成时，合成器线程会标记页面中绑定有事件处理器的区域为非快速滚动区域(non-fast scrollable region)，如果事件发生在这些存在标注的区域，合成器线程会把事件信息发送给主线程，等待主线程进行事件处理，如果事件不是发生在这些区域，合成器线程则会直接合成新的帧而不用等到主线程的响应。</li>
</ul>
<p><img src="/2021/05/30/browser/nofast.png" alt="非快速滚动区域"></p>
<p>2，而对于非快速滚动区域的标记，开发者需要注意全局事件的绑定，比如我们使用事件委托，将目标元素的事件交给根元素 body 进行处理，代码如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">&quot;touchstart&quot;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (event.target === area) &#123;</span><br><span class="line">    event.preventDefault();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>在开发者角度看，这一段代码没什么问题，但是从浏览器角度看，这一段代码给 body 元素绑定了事件监听器，也就意味着整个页面都被编辑为一个非快速滚动区域，这会使得即使你的页面的某些区域没有绑定任何事件，每次用户触发事件时，合成器线程也需要和主线程通信并等待反馈，流畅的合成器独立处理合成帧的模式就失效了。</li>
</ul>
<p><img src="/2021/05/30/browser/bodyEvent.png" alt="body绑定事件"></p>
<ul>
<li>其实这种情况也很好处理，只需要在事件监听时传递 <strong>passtive</strong> 参数为 <strong>true</strong>，passtive 会告诉浏览器你既要绑定事件，又要让组合器线程直接跳过主线程的事件处理直接合成创建组合帧。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.addEventListener(</span><br><span class="line">  <span class="string">&quot;touchstart&quot;</span>,</span><br><span class="line">  (event) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.target === area) &#123;</span><br><span class="line">      event.preventDefault();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">passive</span>: <span class="literal">true</span> &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h4 id="查找事件的目标对象-event-target"><a href="#查找事件的目标对象-event-target" class="headerlink" title="查找事件的目标对象(event target)"></a>查找事件的目标对象(event target)</h4><p>1，当合成器线程接收到事件信息，判定到事件发生不在非快速滚动区域后，合成器线程会向主线程发送这个事件信息，主线程获取到事件信息的第一件事就是通过命中测试（hit test）去找到事件的目标对象。具体的命中测试流程是遍历在绘制阶段生成的绘画记录（paint records）来找到包含了事件发生坐标上的元素对象。</p>
<p><img src="/2021/05/30/browser/paintRecords.png" alt="查找事件的目标对象"></p>
<h4 id="浏览器对事件的优化"><a href="#浏览器对事件的优化" class="headerlink" title="浏览器对事件的优化"></a>浏览器对事件的优化</h4><p>1，一般我们屏幕的帧率是每秒 60 帧，也就是 60fps，但是某些事件触发的频率超过了这个数值，比如 wheel，mousewheel，mousemove，pointermove，touchmove，这些连续性的事件一般每秒会触发 60~120 次，假如每一次触发事件都将事件发送到主线程处理，由于屏幕的刷新速率相对来说较低，这样使得主线程会触发过量的命中测试以及 JS 代码，使得性能有了没必要是损耗。</p>
<p><img src="/2021/05/30/browser/target.png" alt="浏览器对事件的优化"></p>
<ul>
<li>出于优化的目的，浏览器会合并这些连续的事件，延迟到下一帧渲染是执行，也就是 requestAnimationFrame 之前。</li>
</ul>
<p><img src="/2021/05/30/browser/target2.png" alt="浏览器对事件的优化"></p>
<ul>
<li>而对于非连续性的事件，如 keydown，keyup，mousedown，mouseup，touchstart，touchend 等，会直接派发给主线程去执行。</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>1，浏览器的多进程架构，根据不同的功能划分了不同的进程，进程内不同的使命划分了不同的线程，当用户开始浏览网页时候，浏览器进程进行处理输入、开始导航请求数据、请求响应数据，查找新建渲染进程，提交导航，之后渲染又进行了解析 HTML 构建 DOM、构建过程加载子资源、下载并执行 JS 代码、样式计算、布局、绘制、合成，一步一步的构建出一个可交互的 WEB 页面，之后浏览器进程又接受页面的交互事件信息，并将其交给渲染进程，渲染进程内主进程进行命中测试，查找目标元素并执行绑定的事件，完成页面的交互。</p>
]]></content>
      <categories>
        <category>浏览器</category>
      </categories>
      <tags>
        <tag>browser</tag>
      </tags>
  </entry>
  <entry>
    <title>Class</title>
    <url>/2020/04/01/class/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="Class（类）"><a href="#Class（类）" class="headerlink" title="Class（类）"></a>Class（类）</h4><p>1、为什么会出现类？</p>
<ul>
<li>因为 JavaScript 语言的传统方法是通过构造函数，定义并生成新对象。写法跟传统的面向对象语言（比如 C++和 Java）差异很大，很容易让新学习这门语言的程序员感到困惑，如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype.toString = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;(&quot;</span> + <span class="built_in">this</span>.name + <span class="string">&quot;, &quot;</span> + <span class="built_in">this</span>.age + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sn = <span class="keyword">new</span> Person(<span class="string">&quot;snsn&quot;</span>, <span class="number">27</span>);</span><br></pre></td></tr></table></figure>
<a id="more"></a>

<p>2、将上述构造函数写法改写成类的写法如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name, age</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 当前this指向当前类的实例</span></span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.age = age;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;(&quot;</span> + <span class="built_in">this</span>.name + <span class="string">&quot;, &quot;</span> + <span class="built_in">this</span>.age + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sn = <span class="keyword">new</span> Person(<span class="string">&quot;snsn&quot;</span>, <span class="number">27</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>上述代码中，类中存在一个 constructor() 构造器方法，是类的构造函数（默认方法），用于传递参数，返回实例对象，<strong>通过 new 命令生成对象的实例时自动调用该方法</strong>。如果没有显示定义，类内部会自动创建一个 constructor()。其中的 this 关键字指向实例对象。</p>
</li>
<li><p>需要注意的是，类不可调用，必须使用 new 实例化对象。</p>
</li>
</ul>
<p>3、class 可以看作只是一个语法糖，它的绝大部分功能，ES5 都可以做到，新的 class 写法只是让对象原型的写法更加清晰、更像面向对象编程的语法而已。ES6 的类，完全可以看作构造函数的另一种写法，如下代码就能表明：<strong>类的数据类型就是函数，类本身就指向构造函数</strong>。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> Point; <span class="comment">// &quot;function&quot;</span></span><br><span class="line">Point === Point.prototype.constructor; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>4、类的所有方法都定义在类的 prototype 属性上面：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">toValue</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line">Point.prototype = &#123;</span><br><span class="line">  <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;&#125;,</span><br><span class="line">  <span class="function"><span class="title">toValue</span>(<span class="params"></span>)</span> &#123;&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>5、在类的实例上面调用方法，其实就是调用当前类的原型上的方法。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;&#125;</span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> B();</span><br><span class="line"></span><br><span class="line">b.constructor === B.prototype.constructor; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面代码中，b 是 B 类的实例，它的 constructor 方法就是 B 类原型的 constructor 方法。</p>
</blockquote>
<p>6、由于类的方法都定义在 prototype 对象上面，所以类的新方法可以添加在 prototype 对象上面。Object.assign 方法可以很方便地一次向类添加多个方法。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.assign(Point.prototype, &#123;</span><br><span class="line">  <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;&#125;,</span><br><span class="line">  <span class="function"><span class="title">toValue</span>(<span class="params"></span>)</span> &#123;&#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>prototype 对象的 constructor 属性，直接指向“类”的本身，这与 ES5 的行为是一致的。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Point.prototype.constructor === Point; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>7、类的内部所有定义的方法，都是不可枚举的（non-enumerable）。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">x, y</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.keys(Point.prototype);</span><br><span class="line"><span class="comment">// []</span></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyNames(Point.prototype);</span><br><span class="line"><span class="comment">// [&quot;constructor&quot;,&quot;toString&quot;]</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Object.keys()方法会返回一个由一个给定对象的自身可枚举(enumerable=true)属性组成的数组，数组中属性名的排列顺序和正常循环遍历该对象时返回的顺序一致 。<br>Object.getOwnPropertyNames()方法返回一个由指定对象的所有自身属性的属性名（包括不可枚举属性但不包括 Symbol 值作为名称的属性）组成的数组。</p>
</blockquote>
<ul>
<li>在 ES5 中，通过构造函数的写法，将 toString 定义在构造函数的原型上，那么 toString 就可以被枚举：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Point = <span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Point.prototype.toString = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.keys(Point.prototype);</span><br><span class="line"><span class="comment">// [&quot;toString&quot;]</span></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyNames(Point.prototype);</span><br><span class="line"><span class="comment">// [&quot;constructor&quot;,&quot;toString&quot;]</span></span><br></pre></td></tr></table></figure>
<p>8、类的属性名，可以采用表达式。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> methodName = <span class="string">&quot;getArea&quot;</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">length</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  [methodName]() &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>9、class 不存在变量提升，而这种规定的原因与下文要提到的继承有关，必须保证子类在父类之后定义。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> Foo(); <span class="comment">// ReferenceError</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>10、类和模块的内部，默认就是严格模式，所以不需要使用 use strict 指定运行模式。只要你的代码写在类或模块之中，就只有严格模式可用。</p>
<h4 id="constructor-NaN"><a href="#constructor-NaN" class="headerlink" title="constructor()"></a>constructor()</h4><p>1、constructor 方法是类的默认方法，通过 new 命令生成对象实例时，自动调用该方法。一个类必须有 constructor 方法，如果没有显式定义，一个空的 constructor 方法会被默认添加。</p>
<p>2、constructor 方法默认返回实例对象（即 this），但是可以手动让它返回另外一个对象。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.create(<span class="literal">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> Foo() <span class="keyword">instanceof</span> Foo); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo1</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> Foo1() <span class="keyword">instanceof</span> Foo1); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h4 id="类的实例对象"><a href="#类的实例对象" class="headerlink" title="类的实例对象"></a>类的实例对象</h4><p>1、生成类的实例对象的写法，与 ES5 完全一样，也是使用 new 命令。如果忘记加上 new，像函数那样调用 Class，将会报错。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 报错</span></span><br><span class="line"><span class="keyword">const</span> point = Point(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确</span></span><br><span class="line"><span class="keyword">const</span> point = <span class="keyword">new</span> Point(<span class="number">2</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure>
<p>2、与 ES5 一样，实例的属性除非显式定义在其本身（即定义在 this 对象上），否则都是定义在原型上（即定义在 class 上）。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name, age</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.age = age;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;(&quot;</span> + <span class="built_in">this</span>.name + <span class="string">&quot;, &quot;</span> + <span class="built_in">this</span>.age + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sn = <span class="keyword">new</span> Person(<span class="string">&quot;snsn&quot;</span>, <span class="number">27</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(sn.toString()); <span class="comment">// (snsn, 27)</span></span><br><span class="line"><span class="built_in">console</span>.log(sn.hasOwnProperty(<span class="string">&quot;name&quot;</span>)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(sn.hasOwnProperty(<span class="string">&quot;age&quot;</span>)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(sn.hasOwnProperty(<span class="string">&quot;toString&quot;</span>)); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(sn.__proto__.hasOwnProperty(<span class="string">&quot;toString&quot;</span>)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面代码中，name 和 age 都是实例对象 Person 自身的属性（因为定义在 this 变量上），所以 hasOwnProperty 方法返回 true，而 toString 是原型对象的属性（因为定义在 Person 类上），所以 hasOwnProperty 方法返回 false。这些都与 ES5 的行为保持一致。</p>
</blockquote>
<p>3、与 ES5 一样，类的所有实例共享一个原型对象。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> Point(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> Point(<span class="number">3</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(p1.__proto__ === p2.__proto__); <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<ul>
<li>上面代码中，p1 和 p2 都是 Point 的实例，它们的原型都是 Point.prototype，所以 <strong>__proto__</strong> 属性是相等的。这也意味着，可以通过实例的 <strong>__proto__</strong> 属性为 Class 添加方法。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> Person(<span class="string">&quot;snsn&quot;</span>, <span class="number">26</span>);</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> Person(<span class="string">&quot;hmhm&quot;</span>, <span class="number">27</span>);</span><br><span class="line"></span><br><span class="line">p1.__proto__.printName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;dnhyxc&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">p1.printName(); <span class="comment">// &quot;dnhyxc&quot;</span></span><br><span class="line">p2.printName(); <span class="comment">// &quot;dnhyxc&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p3 = <span class="keyword">new</span> Person(<span class="string">&quot;yhyh&quot;</span>, <span class="number">18</span>);</span><br><span class="line">p3.printName(); <span class="comment">// &quot;dnhyxc&quot;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面代码在 p1 的原型上添加了一个 printName 方法，由于 p1 的原型就是 p2 的原型，因此 p2 也可以调用这个方法。而且，此后新建的实例 p3 也可以调用这个方法。这意味着，使用实例的__proto__属性改写原型，必须相当谨慎，不推荐使用，因为这会改变 Class 的原始定义，影响到所有实例。</p>
</blockquote>
<h4 id="Class-表达式"><a href="#Class-表达式" class="headerlink" title="Class 表达式"></a>Class 表达式</h4><p>1、与函数一样，类也可以使用表达式的形式定义。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> MyClass = <span class="class"><span class="keyword">class</span> <span class="title">Me</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">getClassName</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Me.name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>上面代码使用表达式定义了一个类。需要注意的是，这个类的名字是 MyClass 而不是 Me，Me 只在 Class 的内部代码可用，指代当前类。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> inst = <span class="keyword">new</span> MyClass();</span><br><span class="line">inst.getClassName(); <span class="comment">// Me</span></span><br><span class="line">Me.name; <span class="comment">// ReferenceError: Me is not defined</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面代码表示，Me 只在 Class 内部有定义。</p>
</blockquote>
<p>2、如果类的内部没用到的话，可以省略 Me，也就是可以写成下面的形式。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> MyClass = <span class="class"><span class="keyword">class</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>3、采用 Class 表达式，可以写出立即执行的 Class。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> person = <span class="keyword">new</span> (<span class="class"><span class="keyword">class</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">sayName</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(<span class="string">&quot;snsn&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(person.sayName()); <span class="comment">// &quot;snsn&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="类的私有方法"><a href="#类的私有方法" class="headerlink" title="类的私有方法"></a>类的私有方法</h4><p>1、私有方法是常见需求，但 ES6 不提供，只能通过变通方法模拟实现。我们可以通过 Symbol 实现私有方法。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> sym = <span class="built_in">Symbol</span>(<span class="string">&quot;sym&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> bol = <span class="built_in">Symbol</span>(<span class="string">&quot;bol&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">myClass</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 公有方法</span></span><br><span class="line">  <span class="function"><span class="title">foo</span>(<span class="params">bol</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>[sym](bol);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 私有方法</span></span><br><span class="line">  [sym](bol) &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">this</span>[bol] = sym);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面代码中，sym 和 bol 都是 Symbol 值，导致第三方无法获取到它们，因此达到了私有方法和私有属性的效果。</p>
</blockquote>
<h4 id="class-中-this-的指向"><a href="#class-中-this-的指向" class="headerlink" title="class 中 this 的指向"></a>class 中 this 的指向</h4><p>1、类的方法内部如果含有 this，它默认指向类的实例。但是将该方法结构出来单独使用，将会报错。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">sayName</span>(<span class="params">name = <span class="string">&quot;snsn&quot;</span></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.say(<span class="string">`Hello <span class="subst">$&#123;name&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">say</span>(<span class="params">name</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> per = <span class="keyword">new</span> Person();</span><br><span class="line"><span class="keyword">const</span> &#123; sayName &#125; = per;</span><br><span class="line">sayName(); <span class="comment">// TypeError: Cannot read property &#x27;say&#x27; of undefined</span></span><br></pre></td></tr></table></figure>
<ul>
<li>上面代码中，sayName 方法中的 this，默认指向 Person 类的实例。但是，如果将这个方法提取出来单独使用，this 会指向该方法运行时所在的环境，因为找不到 say 方法而导致报错。</li>
</ul>
<p>2、解决 this 指向问题的方式：</p>
<ul>
<li>在构造方法中绑定 this：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.sayName = <span class="built_in">this</span>.say.bind(<span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用箭头函数：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.sayName = <span class="function">(<span class="params">name = <span class="string">&quot;snsn&quot;</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.say(<span class="string">`Hello <span class="subst">$&#123;name&#125;</span>`</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Class-的继承"><a href="#Class-的继承" class="headerlink" title="Class 的继承"></a>Class 的继承</h4><p>1、Class 之间可以通过 extends 关键字实现继承，这比 ES5 的通过修改原型链实现继承，要清晰和方便很多。</p>
<p>2、基本语法如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Son</span> <span class="keyword">extends</span> <span class="title">Parent</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>3、基本使用方式如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Son</span> <span class="keyword">extends</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">x, y, color</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(x, y); <span class="comment">// 调用父类的constructor(x, y)</span></span><br><span class="line">    <span class="built_in">this</span>.color = color;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.color + <span class="string">&quot; &quot;</span> + <span class="built_in">super</span>.toString(); <span class="comment">// 调用父类的toString()</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面代码中，constructor 方法和 toString 方法之中，都出现了 super 关键字，它在这里表示父类的构造函数，用来新建父类的 this 对象。</p>
</blockquote>
<p>4、子类必须在 constructor 方法中调用 super 方法，否则新建实例时会报错。这是因为子类没有自己的 this 对象，而是继承父类的 this 对象，然后对其进行加工。如果不调用 super 方法，子类就得不到 this 对象。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Per</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> per = <span class="keyword">new</span> Per(); <span class="comment">// ReferenceError</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>ES5 的继承，实质是先创造子类的实例对象 this，然后再将父类的方法添加到 this 上面（Parent.apply(this)）。ES6 的继承机制完全不同，实质是先创造父类的实例对象 this（所以必须先调用 super 方法），然后再用子类的构造函数修改 this。</p>
</blockquote>
<p>5、在子类的构造函数中，只有调用 super 之后，才可以使用 this 关键字，否则会报错。这是因为子类实例的构建，是基于对父类实例加工，只有 super 方法才能返回父类实例。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">x, y</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.x = x;</span><br><span class="line">    <span class="built_in">this</span>.y = y;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tiger</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">x, y, color</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.color = color; <span class="comment">// ReferenceError</span></span><br><span class="line">    <span class="built_in">super</span>(x, y);</span><br><span class="line">    <span class="built_in">this</span>.color = color; <span class="comment">// 正确</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> tiger = <span class="keyword">new</span> Tiger(<span class="number">25</span>, <span class="number">8</span>, <span class="string">&quot;白色&quot;</span>);</span><br><span class="line"></span><br><span class="line">tiger <span class="keyword">instanceof</span> Tiger; <span class="comment">// true</span></span><br><span class="line">tiger <span class="keyword">instanceof</span> Animal; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面代码中，实例对象 tiger 同时是 Tiger 和 Animal 两个类的实例，这与 ES5 的行为完全一致。</p>
</blockquote>
<h4 id="类的-prototype-属性和-proto-属性"><a href="#类的-prototype-属性和-proto-属性" class="headerlink" title="类的 prototype 属性和 __proto__ 属性"></a>类的 prototype 属性和 __proto__ 属性</h4><p>1、每一个对象都有__proto__属性，指向对应的构造函数的 prototype 属性。Class 作为构造函数的语法糖，同时有 prototype 属性和__proto__属性，因此同时存在两条继承链：</p>
<ul>
<li><p>子类的__proto__属性，表示构造函数的继承，总是指向父类。</p>
</li>
<li><p>子类 prototype 属性的__proto__属性，表示方法的继承，总是指向父类的 prototype 属性。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">B.__proto__ === A; <span class="comment">// true</span></span><br><span class="line">B.prototype.__proto__ === A.prototype; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<ul>
<li>上面代码中，子类 B 的__proto__属性指向父类 A，子类 B 的 prototype 属性的__proto__属性指向父类 A 的 prototype 属性。出现这样的结果，因为类的继承是按照下面的模式实现的。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// B的实例继承A的实例</span></span><br><span class="line"><span class="built_in">Object</span>.setPrototypeOf(B.prototype, A.prototype);</span><br><span class="line"></span><br><span class="line"><span class="comment">// B继承A的静态属性</span></span><br><span class="line"><span class="built_in">Object</span>.setPrototypeOf(B, A);</span><br></pre></td></tr></table></figure>
<ul>
<li>Object.setPrototypeOf 方法的实现如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Object</span>.setPrototypeOf = <span class="function"><span class="keyword">function</span> (<span class="params">obj, proto</span>) </span>&#123;</span><br><span class="line">  obj.__proto__ = proto;</span><br><span class="line">  <span class="keyword">return</span> obj;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>由上述代码可以得出：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Object</span>.setPrototypeOf(B.prototype, A.prototype);</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line">B.prototype.__proto__ = A.prototype;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.setPrototypeOf(B, A);</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line">B.__proto__ = A;</span><br></pre></td></tr></table></figure>
<p>2、这两条继承链，也可以这样理解：当作为一个对象时，子类（B）的原型（__proto__属性）是父类（A）。当作为一个构造函数时，子类（B）的原型（prototype 属性）是父类的实例。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Object</span>.create(A.prototype);</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line">B.prototype.__proto__ = A.prototype;</span><br></pre></td></tr></table></figure>
<h4 id="Object-getPrototypeOf"><a href="#Object-getPrototypeOf" class="headerlink" title="Object.getPrototypeOf()"></a>Object.getPrototypeOf()</h4><p>1、Object.getPrototypeOf 方法可以用来从子类上获取父类。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Object</span>.getPrototypeOf(ColorPoint) === Point; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h4 id="super-关键字"><a href="#super-关键字" class="headerlink" title="super 关键字"></a>super 关键字</h4><p>1、super 这个关键字，既可以当作函数使用，也可以当作对象使用。在这两种情况下，它的用法完全不同。</p>
<h5 id="作为函数调用"><a href="#作为函数调用" class="headerlink" title="作为函数调用"></a>作为函数调用</h5><p>1、super 作为函数调用时，<strong>代表父类的构造函数</strong>。ES6 要求，子类的构造函数必须执行一次 super 函数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、super 虽然代表了父类 A 的构造函数，但是<strong>返回的是子类 B 的实例</strong>，即 super 内部的 this 指的是 B，因此 super() 在这里相当于 A.prototype.constructor.call(this)。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">new</span>.target.name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> A(); <span class="comment">// A</span></span><br><span class="line"><span class="keyword">new</span> B(); <span class="comment">// B</span></span><br></pre></td></tr></table></figure>
<ul>
<li>上面代码中，new.target 指向当前正在执行的函数。可以看到，在 super() 执行时，它指向的是子类 B 的构造函数，而不是父类 A 的构造函数。也就是说，super() 内部的 this 指向的是 B。</li>
</ul>
<p>3、super 作为函数时，super() 只能用在子类的构造函数之中，用在其他地方就会报错。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">c</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(); <span class="comment">// 报错</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="作为对象时"><a href="#作为对象时" class="headerlink" title="作为对象时"></a>作为对象时</h5><p>1、super 作为对象时，指向父类的原型对象。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">p</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">super</span>.p()); <span class="comment">// 2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> B();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面代码中，子类 B 当中的 super.p()，就是将 super 当作一个对象使用。这时，super 指向 A.prototype，所以 super.p()就相当于 A.prototype.p()。</p>
</blockquote>
<p>2、由于 super 指向父类的原型对象，所以定义在父类实例上的方法或属性，是无法通过 super 访问的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.p = <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="keyword">get</span> <span class="title">c</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.p;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> B();</span><br><span class="line">b.c; <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<p>3、如果属性定义在父类的原型对象上，super 就可以取到。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;&#125;</span><br><span class="line">A.prototype.x = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">super</span>.x); <span class="comment">// 2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> B();</span><br></pre></td></tr></table></figure>
<p>4、通过 super 调用父类的方法时，super 会绑定子类的 this。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.x = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">print</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.x);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">this</span>.x = <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">m</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.print();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> B();</span><br><span class="line">b.m(); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面代码中，super.print() 虽然调用的是 A.prototype.print()，但是 A.prototype.print() 会绑定子类 B 的 this，导致输出的是 2，而不是 1。也就是说，实际上执行的是 super.print.call(this)。</p>
</blockquote>
<p>5、由于绑定子类的 this，所以如果通过 super 对某个属性赋值，这时 super 就是 this，赋值的属性会变成子类实例的属性。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.x = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">this</span>.x = <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">super</span>.x = <span class="number">3</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">super</span>.x); <span class="comment">// undefined</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.x); <span class="comment">// 3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> B();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面代码中，super.x 赋值为 3，这时等同于对 this.x 赋值为 3。而当读取 super.x 的时候，读的是 A.prototype.x，所以返回 undefined。</p>
</blockquote>
<p>6、使用 super 的时候，必须显式指定是作为函数、还是作为对象使用，否则会报错。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">super</span>); <span class="comment">// 报错</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="实例的-proto"><a href="#实例的-proto" class="headerlink" title="实例的 __proto__"></a>实例的 __proto__</h4><p>1、子类实例的 __proto__ 属性的 __proto__ 属性，指向父类实例的 __proto__ 属性。也就是说，子类的原型的原型，是父类的原型。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> A(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> B(<span class="number">2</span>, <span class="number">3</span>, <span class="string">&quot;red&quot;</span>);</span><br><span class="line"></span><br><span class="line">p2.__proto__ === p1.__proto__; <span class="comment">// false</span></span><br><span class="line">p2.__proto__.__proto__ === p1.__proto__; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<ul>
<li>B 继承了 A，促使了 B 原型的原型是 A 的原型。因此，通过子类实例的 __proto__.__proto__ 属性，可以修改父类实例的行为。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">p2.__proto__.__proto__.printName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;dnhyxc&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">p1.printName(); <span class="comment">// &quot;dnhyxc&quot;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面代码在 B 的实例 p2 上向 A 类添加方法，结果影响到了 A 的实例 p1。</p>
</blockquote>
<h4 id="getter-和-setter"><a href="#getter-和-setter" class="headerlink" title="getter 和 setter"></a>getter 和 setter</h4><p>1、与 ES5 一样，在 Class 内部可以使用 get 和 set 关键字，对某个属性设置存值函数和取值函数，拦截该属性的存取行为。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> <span class="title">prop</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// set 方法必须传入一个参数，否则将会报错</span></span><br><span class="line">  <span class="keyword">set</span> <span class="title">prop</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (value !== <span class="built_in">this</span>.name) &#123;</span><br><span class="line">      <span class="built_in">this</span>.name = value;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> inst = <span class="keyword">new</span> MyClass(<span class="string">&quot;snsn&quot;</span>);</span><br><span class="line"></span><br><span class="line">inst.prop = <span class="string">&quot;hmhm&quot;</span>; <span class="comment">// setter: 123</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(inst.prop); <span class="comment">// &#x27;hmhm&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="Class-的静态方法"><a href="#Class-的静态方法" class="headerlink" title="Class 的静态方法"></a>Class 的静态方法</h4><p>1、类相当于实例的原型，所有在类中定义的方法，都会被实例继承。如果在一个方法前，加上 static 关键字，就表示该方法不会被实例继承，而是直接通过类来调用，这就称为“静态方法”。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">classMethod</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Foo.classMethod(); <span class="comment">// &#x27;hello&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> foo = <span class="keyword">new</span> Foo();</span><br><span class="line">foo.classMethod();</span><br><span class="line"><span class="comment">// TypeError: foo.classMethod is not a function</span></span><br></pre></td></tr></table></figure>
<p>2、父类的静态方法，可以被子类继承。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">classMethod</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bar</span> <span class="keyword">extends</span> <span class="title">Foo</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Bar.classMethod(); <span class="comment">// &#x27;hello&#x27;</span></span><br></pre></td></tr></table></figure>
<p>3、静态方法也是可以从 super 对象上调用的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">classMethod</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bar</span> <span class="keyword">extends</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">classMethod</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.classMethod() + <span class="string">&quot;, too&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Bar.classMethod();</span><br></pre></td></tr></table></figure>
<h4 id="new-target-属性"><a href="#new-target-属性" class="headerlink" title="new.target 属性"></a>new.target 属性</h4><p>1、new 是从构造函数生成实例的命令。ES6 为 new 命令引入了一个 new.target 属性，在构造函数中返回 new 命令作用于的那个构造函数。如果构造函数不是通过 new 命令调用的，new.target 会返回 undefined，因此这个属性可以用来确定构造函数是怎么调用的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">new</span>.target !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;必须使用new生成实例&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 另一种写法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">new</span>.target === Person) &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;必须使用new生成实例&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person = <span class="keyword">new</span> Person(<span class="string">&quot;dnhyxc&quot;</span>); <span class="comment">// 正确</span></span><br><span class="line"><span class="keyword">const</span> notAPerson = Person.call(person, <span class="string">&quot;dnhyxc&quot;</span>); <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure>
<p>2、在 Class 内部调用 new.target 时，返回当前 Class。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">length, width</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">new</span>.target === Rectangle);</span><br><span class="line">    <span class="built_in">this</span>.length = length;</span><br><span class="line">    <span class="built_in">this</span>.width = width;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = <span class="keyword">new</span> Rectangle(<span class="number">3</span>, <span class="number">4</span>); <span class="comment">// 输出 true</span></span><br></pre></td></tr></table></figure>
<p>3、子类继承父类时，new.target 会返回子类。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">length, width</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">new</span>.target === Rectangle);</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">length</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(length, length);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = <span class="keyword">new</span> Square(<span class="number">3</span>); <span class="comment">// 输出 false</span></span><br></pre></td></tr></table></figure>
<ul>
<li>上面代码中，new.target 会返回子类，利用这个特点，可以写出不能独立使用、必须继承后才能使用的类。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">new</span>.target === Shape) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;本类不能实例化&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">length, width</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> x = <span class="keyword">new</span> Shape(); <span class="comment">// 报错</span></span><br><span class="line"><span class="keyword">const</span> y = <span class="keyword">new</span> Rectangle(<span class="number">3</span>, <span class="number">4</span>); <span class="comment">// 正确</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意，不能在在函数外部使用 new.target，否则将会报错。</p>
</blockquote>
<h4 id="class-实现单例模式"><a href="#class-实现单例模式" class="headerlink" title="class 实现单例模式"></a>class 实现单例模式</h4><p>1、单例模式概述：一个类创建出来的实例都是相等的，换句话说，每次创建出的实例都是同一个。</p>
<p>2、单例模式的作用：方便在项目中传递数据。</p>
<p>3、设计思路：首次创建实例对象时，会创建新的对象，除了首次之外，返回的都是第一次创建的实例对象。</p>
<p>4、具体实现方式如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>class单例模式<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="class"><span class="keyword">class</span> <span class="title">SingleMode</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">constructor</span>(<span class="params">name, age</span>)</span> &#123;</span></span><br><span class="line">          if (!SingleMode.isSingle) &#123;</span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.name = name;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.age = age;</span></span><br><span class="line"><span class="javascript">            SingleMode.isSingle = <span class="built_in">this</span>;</span></span><br><span class="line">          &#125;</span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> SingleMode.isSingle;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">setAddress</span>(<span class="params">address</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.address = address;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">getInfo</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="built_in">this</span>.name, <span class="string">&quot;toString-name&quot;</span>);</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="built_in">this</span>.age, <span class="string">&quot;toString-age&quot;</span>);</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="built_in">this</span>.address, <span class="string">&quot;toString-address&quot;</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="keyword">static</span> <span class="function"><span class="title">getSingle</span>(<span class="params">name, age</span>)</span> &#123;</span></span><br><span class="line">          if (!SingleMode.isSingle) &#123;</span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="keyword">new</span> SingleMode(name, age);</span></span><br><span class="line"><span class="javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> SingleMode.isSingle;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> sing1 = <span class="keyword">new</span> SingleMode(<span class="string">&quot;dnhyxc&quot;</span>, <span class="number">20</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> sing2 = SingleMode.getSingle(<span class="string">&quot;hmhm&quot;</span>, <span class="number">18</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> sing3 = SingleMode.getSingle(<span class="string">&quot;snsn&quot;</span>, <span class="number">28</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> sing4 = <span class="keyword">new</span> SingleMode(<span class="string">&quot;cxcx&quot;</span>, <span class="number">25</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      sing1.setAddress(<span class="string">&quot;hz&quot;</span>);</span></span><br><span class="line"></span><br><span class="line">      sing1.getInfo();</span><br><span class="line">      sing2.getInfo();</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(sing1 === sing2); <span class="comment">// true</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(sing2 === sing3); <span class="comment">// true</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(sing3 === sing4); <span class="comment">// true</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(sing4, <span class="string">&quot;sing4&quot;</span>); <span class="comment">// SingleMode &#123;name: &#x27;dnhyxc&#x27;, age: 20, address: &#x27;hz&#x27;&#125;</span></span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>JavaScript</category>
        <category>ES6</category>
      </categories>
      <tags>
        <tag>class</tag>
        <tag>constructor</tag>
        <tag>super</tag>
        <tag>prototype</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux</title>
    <url>/2021/10/24/Linux/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Linux-简介"><a href="#Linux-简介" class="headerlink" title="Linux 简介"></a>Linux 简介</h3><h4 id="Linux-系统内核与-Linux-发行套件的区别"><a href="#Linux-系统内核与-Linux-发行套件的区别" class="headerlink" title="Linux 系统内核与 Linux 发行套件的区别"></a>Linux 系统内核与 Linux 发行套件的区别</h4><p>1、Linux 系统内核指的是由 Linus Torvalds 负责维护，提供硬件抽象层、硬盘及文件系统控制及多任务功能的系统核心程序。</p>
<p>2、Linux 发行套件系统是我们常说的 Linux 操作系统，也即是由 Linux 内核与各种常用软件的集合产品。</p>
<p>3、<strong>总结</strong>：真正的 Linux 指的是系统内核，而我们常说的 Linux 指的是“发行版完整的包含一些基础软件的操作系统”。</p>
<h4 id="Linux-对比-Windows"><a href="#Linux-对比-Windows" class="headerlink" title="Linux 对比 Windows"></a>Linux 对比 Windows</h4><p>1、稳定且有效率。</p>
<p>2、免费（或少许费用）。</p>
<p>3、漏洞少且快速修补。</p>
<a id="more"></a>

<p>4、多任务多用户。</p>
<p>5、更加安全的用户与文件权限策略。</p>
<p>6、适合小内核程序的嵌入系统。</p>
<p>7、相对不耗资源。</p>
<h4 id="Linux-系统种类"><a href="#Linux-系统种类" class="headerlink" title="Linux 系统种类"></a>Linux 系统种类</h4><p>1、红帽企业版 Linux：RHEL 是全世界内使用最广泛的 Linux 系统。它具有极强的性能与稳定性，是众多生成环境中使用的（收费的）系统。</p>
<p>2、CentOS：通过把 RHEL 系统重新编译并发布给用户免费使用的 Linux 系统，具有广泛的使用人群。</p>
<p>3、Ubuntu：是一款派生自 Debian 的操作系统，对新款硬件具有极强的兼容能力。 Ubuntu 与 Fedora 都是极其出色的 Linux 桌面系统，而且 Ubuntu 也可用于服务器领域。</p>
<p>4、Debian：稳定性、安全性强，提供了免费的基础支持，在国外拥有很高的认可度和使用率。</p>
<p>5、Deepin：中国发行，对优秀的开源成品进行集成和配置。</p>
<p>6、Fedora：由红帽公司发布的桌面版系统套件，用户可以免费体验到最新的技术或工具，这些技术或工具在成熟后会被加入到 RHEL 系统中，因此 Fedora 也成为 RHEL 系统的试验版本。</p>
<h4 id="Linux-快捷方式"><a href="#Linux-快捷方式" class="headerlink" title="Linux 快捷方式"></a>Linux 快捷方式</h4><p>1、通过上下方向键可以调取过往执行过的命令。</p>
<p>2、命令或参数仅需输入前几位就可以使用 Tab 键自动补全。</p>
<p>3、ctrl + R：用于查找使用过的命令（history 命令用于列出之前使用过的所有命令，然后输入 <code>!</code> 命令加上编号如 <code>!2</code> 就可以执行该历史命令）。</p>
<p>4、ctrl + l：清除屏幕并将当前行移动到页面顶部。</p>
<p>5、ctrl + c：终止当前正在执行的命令。</p>
<p>6、ctrl + u：从光标位置剪切到行首。</p>
<p>7、ctrl + k：从光标位置剪切到行尾。</p>
<p>8、ctrl + w：剪切光标左侧的一个单词。</p>
<p>9、ctrl + y：粘贴剪切的内容。</p>
<p>10、ctrl + a：光标跳到命令行的开头。</p>
<p>11、ctrl + d：关闭 shell 会话。</p>
<h3 id="文件及目录"><a href="#文件及目录" class="headerlink" title="文件及目录"></a>文件及目录</h3><h4 id="常见目录说明"><a href="#常见目录说明" class="headerlink" title="常见目录说明"></a>常见目录说明</h4><p>1、<strong>bin</strong>：存放二进制可执行文件(ls,cat,mkdir 等)，常用命令一般都在这里。</p>
<p>2、<strong>etc</strong>：存放系统管理和配置文件。</p>
<p>3、<strong>home</strong>：存放所有用户文件的根目录，是用户主目录的基点，比如用户 user 的主目录就是/home/user，可以用~user 表示。</p>
<p>4、<strong>usr</strong>：用于存放系统应用程序。</p>
<p>5、<strong>opt</strong>：额外安装的可选应用程序包所放置的位置。一般情况下，我们可以把 tomcat 等都安装到这里。</p>
<p>6、<strong>proc</strong>：虚拟文件系统目录，是系统内存的映射。可直接访问这个目录来获取系统信息。</p>
<p>7、<strong>root</strong>：超级用户（系统管理员）的主目录，即 root 用户的家目录。</p>
<p>8、<strong>sbin</strong>：存放二进制可执行文件，只有 root 才能访问。这里存放的是系统管理员使用的系统级别的管理命令和程序。如 ifconfig 等。</p>
<p>9、<strong>dev</strong>：主要用于存放外接设备，例如：盘、其它的光盘等。在其中的外接设备是不能直接被使用的需要挂载（类型 windows 下的分配盘符）。</p>
<p>10、<strong>mnt</strong>：系统管理员安装临时文件系统的安装点，系统提供这个目录是让用户临时挂载其他的文件系统。</p>
<p>11、<strong>boot</strong>：存放用于系统引导时使用的各种文件。</p>
<p>12、<strong>lib</strong>：存放着和系统运行相关的库文件。</p>
<p>13、<strong>tmp</strong>：用于存放各种临时文件，是公用的临时文件存储点。</p>
<p>14、<strong>var</strong>：用于存放运行时需要改变数据的文件，也是某些大文件的溢出区，比方说各种服务的日志文件（系统启动日志等。）等。</p>
<p>15、<strong>lost+found</strong>：这个目录平时是空的，系统非正常关机而留下“无家可归”的文件就在这里。</p>
<h4 id="查看路径"><a href="#查看路径" class="headerlink" title="查看路径"></a>查看路径</h4><h5 id="pwd"><a href="#pwd" class="headerlink" title="pwd"></a>pwd</h5><p>1、该命令用于显示当前目录的路径。</p>
<h5 id="which"><a href="#which" class="headerlink" title="which"></a>which</h5><p>1、查看命令的可执行文件所在路径， 在 Linux 下，每一条命令其实都对应一个可执行程序，在终端中输入命令，按回车的时候，就是执行了对应的那个程序， which 命令本身对应的程序也存在于 Linux 中。总的来说一个命令就是一个可执行程序。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[root@dnhyxc ~]# which node</span><br><span class="line">/usr/local/bin/node</span><br></pre></td></tr></table></figure>
<h4 id="浏览和切换目录"><a href="#浏览和切换目录" class="headerlink" title="浏览和切换目录"></a>浏览和切换目录</h4><h5 id="ls"><a href="#ls" class="headerlink" title="ls"></a>ls</h5><p>1、该命令用于列出文件和目录。</p>
<p>2、常用参数：</p>
<ul>
<li><p>-a：显示所有文件和目录包括隐藏的文件或目录。</p>
</li>
<li><p>-l：显示详细列表。</p>
</li>
<li><p>-h：显示适合人类阅读的格式。</p>
</li>
<li><p>-t：按文件最近一次修改时间排序。</p>
</li>
<li><p>-i：显示文件的 inode（inode 是问价内容的标识）。</p>
</li>
</ul>
<h5 id="cd"><a href="#cd" class="headerlink" title="cd"></a>cd</h5><p>1、cd 是英文 change directory 的缩写，表示切换目录。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">cd /  <span class="comment">// 跳转到根目录</span></span><br><span class="line"></span><br><span class="line">cd ~  <span class="comment">//  跳转到家目录</span></span><br><span class="line"></span><br><span class="line">cd .. <span class="comment">// 跳转到上级目录</span></span><br><span class="line"></span><br><span class="line">cd ./home <span class="comment">// 跳转到当前目录的home目录下</span></span><br><span class="line"></span><br><span class="line">cd /home/lion <span class="comment">// 跳转到根目录下的home目录下的lion目录</span></span><br><span class="line">cd  <span class="comment">// 不添加任何参数，也是回到家目录</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>输入 cd /ho + 单次 tab 键会自动补全路径，+ 两次 tab 键会列出所有可能的目录列表。</p>
</blockquote>
<h5 id="du"><a href="#du" class="headerlink" title="du"></a>du</h5><p>1、该命令用于列举目录大小信息。</p>
<p>2、常用参数：</p>
<ul>
<li><p>-h：适合人类阅读的格式。</p>
</li>
<li><p>-a：同时列举出目录下文件的大小信息。</p>
</li>
<li><p>-s：只显示总计大小，不显示具体信息。</p>
</li>
</ul>
<h4 id="浏览和创建文件"><a href="#浏览和创建文件" class="headerlink" title="浏览和创建文件"></a>浏览和创建文件</h4><h5 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h5><p>1、一次性显示文件的所有内容，适合查看比较小的文件。</p>
<p>2、常用参数：</p>
<ul>
<li>-n：显示行号。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">cat cloud-init.log</span><br></pre></td></tr></table></figure>
<h5 id="less"><a href="#less" class="headerlink" title="less"></a>less</h5><p>1、分页显示文件内容，更适合查看大的文件。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">less cloud-init.log</span><br></pre></td></tr></table></figure>
<p>2、快捷操作：</p>
<ul>
<li><p>空格键：前进一页（一个屏幕）。</p>
</li>
<li><p>b 键：后退一页。</p>
</li>
<li><p>回车键：前进一页。</p>
</li>
<li><p>y 键：后退一行。</p>
</li>
<li><p>上下键：回退或前进一行。</p>
</li>
<li><p>d 键：前进半页。</p>
</li>
<li><p>u 键：后退半页。</p>
</li>
<li><p>q 键：停止读取文件，终止 less 命令。</p>
</li>
<li><p>= 键：显示当前页面的内容是文件中的第几行到第几行以及一些其它关于本页内容的详细信息。</p>
</li>
<li><p>h 键：显示帮助文档。</p>
</li>
<li><p>/ 键：进入搜索模式后，按 n 键跳到一个符合项目，按 N 键跳到上一个符合项目，同时也可以输入正则表达式进行匹配。</p>
</li>
</ul>
<h5 id="head"><a href="#head" class="headerlink" title="head"></a>head</h5><p>1、显示文件的开头几行（默认是 10 行）。</p>
<p>2、常用参数：</p>
<ul>
<li>-n：用于指定行数 <code>head cloud-init.log -n 2</code>。</li>
</ul>
<h5 id="tail"><a href="#tail" class="headerlink" title="tail"></a>tail</h5><p>1、用于显示文件的结尾几行（默认是 10 行）。</p>
<p>2、常用参数：</p>
<ul>
<li><p>-n：用于指定行数 <code>tail cloud-init.log -n 2</code>。</p>
</li>
<li><p>-f：每过 1 秒检查文件是否有更新内容，也可以用 -s 参数指定间隔时间 <code>tail -f -s 4 xxx.log</code>。</p>
</li>
</ul>
<h5 id="touch"><a href="#touch" class="headerlink" title="touch"></a>touch</h5><p>1、用于创建一个文件。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">touch new_file</span><br></pre></td></tr></table></figure>
<h5 id="mkdir"><a href="#mkdir" class="headerlink" title="mkdir"></a>mkdir</h5><p>1、用于创建一个目录。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">mkdir new_folder</span><br></pre></td></tr></table></figure>
<p>2、常用参数：</p>
<ul>
<li>-p：递归的创建目录结构 <code>mkdir -p one/two/three</code>。</li>
</ul>
<h4 id="文件的复制和移动"><a href="#文件的复制和移动" class="headerlink" title="文件的复制和移动"></a>文件的复制和移动</h4><h5 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h5><p>1、用于拷贝文件和目录。</p>
<p>2、常用参数：</p>
<ul>
<li>-r：递归的拷贝，常用来拷贝整个目录。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">cp file file_copy <span class="comment">// file 是目标文件，file_copy 是拷贝出来的文件</span></span><br><span class="line"></span><br><span class="line">cp file one <span class="comment">// 把 file 文件拷贝到 one 目录下，并且文件名依然为 file</span></span><br><span class="line"></span><br><span class="line">cp file one/file_copy <span class="comment">// 把 file 文件拷贝到 one 目录下，文件名为file_copy</span></span><br><span class="line"></span><br><span class="line">cp *.txt folder <span class="comment">// 把当前目录下所有 txt 文件拷贝到 folder 目录下</span></span><br></pre></td></tr></table></figure>
<h5 id="mv"><a href="#mv" class="headerlink" title="mv"></a>mv</h5><p>1、用于移动（重命名）文件或目录，与 cp 命令用法相似。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">mv file one <span class="comment">// 将 file 文件移动到 one 目录下</span></span><br><span class="line"></span><br><span class="line">mv new_folder one <span class="comment">// 将 new_folder 文件夹移动到one目录下</span></span><br><span class="line">mv *.txt folder <span class="comment">// 把当前目录下所有 txt 文件移动到 folder 目录下</span></span><br><span class="line">mv file new_file  <span class="comment">// file 文件重命名为 new_file</span></span><br></pre></td></tr></table></figure>
<h4 id="文件的删除和链接"><a href="#文件的删除和链接" class="headerlink" title="文件的删除和链接"></a>文件的删除和链接</h4><h5 id="rm"><a href="#rm" class="headerlink" title="rm"></a>rm</h5><p>1、用于删除文件和目录，由于 Linux 下没有回收站，一旦删除非常难恢复，因此需要谨慎操作。</p>
<p>2、常用参数：</p>
<ul>
<li><p>-i：向用户确认是否删除。</p>
</li>
<li><p>-f：文件强制删除。</p>
</li>
<li><p>-r：递归删除文件夹，著名的删除操作 <code>rm -rf</code>。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">rm new_file <span class="comment">// 删除 new_file 文件</span></span><br><span class="line">rm f1 f2 f3 <span class="comment">// 同时删除 f1 f2 f3 3个文件</span></span><br></pre></td></tr></table></figure>
<h5 id="ln"><a href="#ln" class="headerlink" title="ln"></a>ln</h5><p>1、link 的缩写，表示创建链接。</p>
<p>2、常用参数：</p>
<ul>
<li>-s：用于创建软链接。</li>
</ul>
<h4 id="Linux-存储文件的方式"><a href="#Linux-存储文件的方式" class="headerlink" title="Linux 存储文件的方式"></a>Linux 存储文件的方式</h4><p>1、Linux 文件的存储方式分为 3 个部分，文件名、文件内容以及权限，其中文件名的列表是存储在硬盘中的，和文件内容是分开的，每个文件名通过 <strong>inode</strong> 标识绑定文件内容。</p>
<p>2、Linux 两种链接方式：</p>
<ul>
<li><strong>硬链接</strong>：使链接的两个文件共享同样文件内容，就是同样的 inode，一旦文件 1 和文件 2 之间有了硬链接，那么修改任何一个文件，修改的都是同一块内容，它的缺点是，只能创建指向文件的硬链接，而如果要创建指向目录的链接就很复杂。而软链接既可以创建指向文件的链接，也可以创建指向目录的链接。因此软连接使用更加广泛。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ln file1 file2  创建 file2 为 file1 的硬链接</span><br><span class="line"></span><br><span class="line">文件1 -----------------&gt; inode 标识</span><br><span class="line">                          10100110</span><br><span class="line">                          10100110</span><br><span class="line">                          10100110</span><br><span class="line">                            ⬆</span><br><span class="line">                            |</span><br><span class="line">                            |</span><br><span class="line">文件2 ----------------------&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如上图所示，如果用 rm file1 删除 file1，对 file2 没什么影响，对于硬链接来说，删除任意一方文件，共同指向的文件内容并不会从硬盘中删除，只有同时删除了 file1 和 file2 后，它们共同指向的文件内容才会消失。</p>
</blockquote>
<ul>
<li><strong>软连接</strong>：软链接就类似于 windows 中创建的快捷方式。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ln -s file1 file2</span><br><span class="line"></span><br><span class="line">文件1 ----------------------&gt;  inode 标识</span><br><span class="line">  ⬆                             10100110</span><br><span class="line">  |                             10100110</span><br><span class="line">  |                             10100110</span><br><span class="line">  |</span><br><span class="line">文件2</span><br></pre></td></tr></table></figure>
<ul>
<li>此时执行 <code>ls -l</code> 命令查看当前目录下的文件具体信息如下：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 0 Jan 14 06:29 file1</span><br><span class="line">lrwxrwxrwx 1 root root 5 Jan 14 06:42 file2 -&gt; file1  # 表示file2 指向 file1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>其实 file2 只是 file1 的一个快捷方式，它指向的是 file1，所以显示的是 file1 的内容，但其实 file2 的 inode 与 file1 并不相同。如果删除了 file2 的话，file1 不会受到影响，但如果删除了 file1 的话，file2 就会变成死链接，因为指向的文件不见了。</p>
</blockquote>
<h4 id="查找文件"><a href="#查找文件" class="headerlink" title="查找文件"></a>查找文件</h4><h5 id="locate"><a href="#locate" class="headerlink" title="locate"></a>locate</h5><p>1、搜索包含关键字的所有文件和目录，后面接上需要查找的文件名，也可以用正则表达式。</p>
<p>2、安装 locate：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">yum -y install mlocate  <span class="comment">// 安装包</span></span><br><span class="line">updatedb  <span class="comment">// 更新数据库</span></span><br><span class="line"></span><br><span class="line">locate file.txt</span><br><span class="line">locate fil*.txt</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong>：locate 命令会去文件数据库中查找，而不是全盘查找，而刚创建的文件并不会更新到数据库中，所以无法被查到，可以执行 <strong>updatedb</strong> 命令去更新数据库。</p>
</blockquote>
<h5 id="find"><a href="#find" class="headerlink" title="find"></a>find</h5><p>1、用于查找文件、它回去遍历实际的硬盘进行查找，而且它允许对每个找到的文件进行后续操作，功能非常强大。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find &lt;何处&gt; &lt;何物&gt; &lt;做什么&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>何处：指定在哪个目录查找，此目录的所有子目录也会被查找。</p>
</li>
<li><p>何物：查找什么，可以根据文件的名字来查找，也可以根据其大小来查找，还可以根据其最近访问时间来查找。</p>
</li>
<li><p>做什么：找到文件后，可以进行后续处理，如果不指定这个参数，find 命令只会显示找到的文件。</p>
</li>
</ul>
<p>2、根据文件名查找：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">find -name <span class="string">&quot;file.txt&quot;</span> <span class="comment">// 当前目录以及子目录下通过名称查找文件</span></span><br><span class="line"></span><br><span class="line">find . -name <span class="string">&quot;syslog&quot;</span> <span class="comment">// 当前目录以及子目录下通过名称查找文件</span></span><br><span class="line"></span><br><span class="line">find / -name <span class="string">&quot;syslog&quot;</span> <span class="comment">// 整个硬盘下查找syslog</span></span><br><span class="line"></span><br><span class="line">find /<span class="keyword">var</span>/log -name <span class="string">&quot;syslog&quot;</span>  <span class="comment">// 在指定的目录/var/log下查找syslog文件</span></span><br><span class="line"></span><br><span class="line">find /<span class="keyword">var</span>/log -name <span class="string">&quot;syslog*&quot;</span> <span class="comment">// 查找syslog1、syslog2 ... 等文件，通配符表示所有</span></span><br><span class="line"></span><br><span class="line">find /<span class="keyword">var</span>/log -name <span class="string">&quot;*syslog*&quot;</span>  <span class="comment">// 查找包含syslog的文件</span></span><br></pre></td></tr></table></figure>
<p>3、根据文件大小查找：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">find /<span class="keyword">var</span> -size +10M  <span class="comment">// /var 目录下查找文件大小超过 10M 的文件</span></span><br><span class="line"></span><br><span class="line">find /<span class="keyword">var</span> -size -50k  <span class="comment">// /var 目录下查找文件大小小于 50k 的文件</span></span><br><span class="line"></span><br><span class="line">find /<span class="keyword">var</span> -size +1G <span class="comment">// /var 目录下查找文件大小查过 1G 的文件</span></span><br><span class="line"></span><br><span class="line">find /<span class="keyword">var</span> -size 1M  <span class="comment">// /var 目录下查找文件大小等于 1M 的文件</span></span><br></pre></td></tr></table></figure>
<p>4、根据文件最近访问时间查找：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">find -name <span class="string">&quot;*.txt&quot;</span> -atime -<span class="number">7</span>  <span class="comment">// 近 7天内访问过的.txt结尾的文件</span></span><br></pre></td></tr></table></figure>
<p>5、仅查找目录或文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">find . -name <span class="string">&quot;file&quot;</span> -type f <span class="comment">// 只查找当前目录下的file文件</span></span><br><span class="line"></span><br><span class="line">find . -name <span class="string">&quot;file&quot;</span> -type d <span class="comment">// 只查找当前目录下的file目录</span></span><br></pre></td></tr></table></figure>
<p>6、操作查找结果：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">find -name <span class="string">&quot;*.txt&quot;</span> -printf <span class="string">&quot;%p - %u\n&quot;</span>  <span class="comment">// 找出所有后缀为txt的文件，并按照 %p - %u\n 格式打印，其中%p=文件名，%u=文件所有者</span></span><br><span class="line"></span><br><span class="line">find -name <span class="string">&quot;*.jpg&quot;</span> -<span class="keyword">delete</span>  <span class="comment">// 删除当前目录以及子目录下所有.jpg为后缀的文件，不会有删除提示，因此要慎用</span></span><br><span class="line"></span><br><span class="line">find -name <span class="string">&quot;*.c&quot;</span> -exec chmod <span class="number">600</span> &#123;&#125; \;  <span class="comment">// 对每个.c结尾的文件，都进行 -exec 参数指定的操作，&#123;&#125; 会被查找到的文件替代，\; 是必须的结尾</span></span><br><span class="line"></span><br><span class="line">find -name <span class="string">&quot;*.c&quot;</span> -ok chmod <span class="number">600</span> &#123;&#125; \;  <span class="comment">// 和上面的功能一样，会多一个确认提示</span></span><br></pre></td></tr></table></figure>
<h3 id="用户与权限"><a href="#用户与权限" class="headerlink" title="用户与权限"></a>用户与权限</h3><h4 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h4><p>1、Linux 是一个多用户的操作系统。在 Linux 中，理论上来说，我们可以创建无数个用户，但是这些用户是被划分到不同的群组里面的，有一个用户，名叫 root ，是一个很特殊的用户，它是超级用户，拥有最高权限。</p>
<p>2、自己创建的用户是有限权限的用户，这样大大提高了 Linux 系统的安全性，有效防止误操作或是病毒攻击，但是我们执行的某些命令需要更高权限时可以使用 <strong>sudo</strong> 命令。</p>
<h5 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h5><p>1、使用该命令可使自己创建的用户以 root 身份运行命令。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">sudo shutdown   <span class="comment">// 关机</span></span><br></pre></td></tr></table></figure>
<h5 id="useradd-与-passwd"><a href="#useradd-与-passwd" class="headerlink" title="useradd 与 passwd"></a>useradd 与 passwd</h5><p>1、useradd：用于添加新用户。</p>
<p>2、passwd：用于修改用户密码。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">sudo useradd dnhyxc <span class="comment">// 添加一个lion用户，添加完之后在 /home 路径下可以查看</span></span><br><span class="line">sudo passwd dnhyxc  <span class="comment">// 修改lion用户的密码</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：这两个命令需要 root 用户权限才能执行成功。</p>
</blockquote>
<h5 id="userdel"><a href="#userdel" class="headerlink" title="userdel"></a>userdel</h5><p>1、userdel：用于删除用户，需要 root 用户权限。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">userdel dnhyxc	<span class="comment">// 只会删除用户名，不会从/home中删除对应文件夹</span></span><br><span class="line">userdel dnhyxc -r	<span class="comment">// 会同时删除/home下的对应文件夹</span></span><br></pre></td></tr></table></figure>
<h5 id="su"><a href="#su" class="headerlink" title="su"></a>su</h5><p>1、用于切换用户，需要 root 用户权限。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">sudo su   <span class="comment">// 切换为root用户（exit 命令或 CTRL + D 快捷键都可以使普通用户切换为 root 用户）</span></span><br><span class="line">su dnhyxc   <span class="comment">// 切换为普通用户</span></span><br><span class="line">su -	<span class="comment">// 切换为root用户</span></span><br></pre></td></tr></table></figure>
<h4 id="群组管理"><a href="#群组管理" class="headerlink" title="群组管理"></a>群组管理</h4><p>1、Linux 中每个用户都属于一个特定的群组，如果你不设置用户的群组，默认会创建一个和它的用户名一样的群组，并且把用户划归到这个群组。</p>
<h5 id="groupadd"><a href="#groupadd" class="headerlink" title="groupadd"></a>groupadd</h5><p>1、groupadd：用于创建群组，用法和 useradd 类似。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">groupadd friends  <span class="comment">// 创建friends群组</span></span><br></pre></td></tr></table></figure>
<h5 id="groupdel"><a href="#groupdel" class="headerlink" title="groupdel"></a>groupdel</h5><p>1、groupdel：用于删除一个已存在的群组。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">groupdel friends 	<span class="comment">// 删除foo群组</span></span><br></pre></td></tr></table></figure>
<h5 id="groups"><a href="#groups" class="headerlink" title="groups"></a>groups</h5><p>1、groups：用于查看用户所在群组。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">groups dnhyxc   <span class="comment">// 查看 lion 用户所在的群组</span></span><br></pre></td></tr></table></figure>
<h5 id="usermod"><a href="#usermod" class="headerlink" title="usermod"></a>usermod</h5><p>1、usermod：用于修改用户的账户。</p>
<p>2、常用参数：</p>
<ul>
<li><p><code>-l</code>：对用户重命名。需要注意的是 /home 中的用户家目录的名字不会改变，需要手动修改。</p>
</li>
<li><p><code>-g</code>：修改用户所在的群组，例如 <code>usermod -g friends dnhyxc</code> 修改 dnhyxc 用户的群组为 friends 。</p>
</li>
<li><p><code>-G</code>：一次性让用户添加多个群组，例如 <code>usermod -G friends,foo,bar dnhyxc</code> 。</p>
</li>
<li><p><code>-a -G</code>：会让你离开原先的群组，如果你不想这样做的话，就得再添加 -a 参数，意味着 append 追加的意思。</p>
</li>
</ul>
<h5 id="chgrp"><a href="#chgrp" class="headerlink" title="chgrp"></a>chgrp</h5><p>1、用于修改文件的群组。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">chgrp bar file.txt	<span class="comment">// file.txt文件的群组修改为bar</span></span><br></pre></td></tr></table></figure>
<h5 id="chown"><a href="#chown" class="headerlink" title="chown"></a>chown</h5><p>1、用于改变文件的所有者，需要 root 身份才能运行。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">chown dnhyxc file.txt	  <span class="comment">// 把其它用户创建的file.txt转让给dnhyxc用户</span></span><br><span class="line">chown dnhyxc:bar file.txt	  <span class="comment">// 把file.txt的用户改为dnhyxc，群组改为bar</span></span><br></pre></td></tr></table></figure>
<p>2、常用参数：</p>
<ul>
<li><code>-R</code>：递归设置子目录和子文件， <code>chown -R dnhyxc:dnhyxc /home/frank</code> 把 frank 文件夹的用户和群组都改为 dnhyxc 。</li>
</ul>
<h4 id="文件权限管理"><a href="#文件权限管理" class="headerlink" title="文件权限管理"></a>文件权限管理</h4><h5 id="chmod"><a href="#chmod" class="headerlink" title="chmod"></a>chmod</h5><p>1、chmod：用于修改访问权限。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">chmod <span class="number">740</span> file.txt</span><br></pre></td></tr></table></figure>
<p>2、常用参数：</p>
<ul>
<li><code>-R</code>：可以递归地修改文件访问权限，例如 chmod -R 777 /home/dnhyxc。</li>
</ul>
<h5 id="Linux-的文件权限"><a href="#Linux-的文件权限" class="headerlink" title="Linux 的文件权限"></a>Linux 的文件权限</h5><p>1、以下方记录为例，<strong>drwxr-xr-x</strong> 表示文件或目录的权限。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[root@dnhyxc ~]# ls -l</span><br><span class="line">drwxr-xr-x <span class="number">5</span> root root <span class="number">4096</span> Apr <span class="number">13</span>  <span class="number">2020</span> climb</span><br><span class="line">lrwxrwxrwx <span class="number">1</span> root root    <span class="number">7</span> Jan <span class="number">14</span> <span class="number">06</span>:<span class="number">41</span> hello2.c -&gt; hello.c</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root  <span class="number">149</span> Jan <span class="number">13</span> <span class="number">06</span>:<span class="number">14</span> hello.c</span><br></pre></td></tr></table></figure>
<p>2、具体说明如下：</p>
<ul>
<li><p>d：表示目录，就是说这是一个目录，普通文件是 <code>-</code> ，链接是 <code>l</code> 。</p>
</li>
<li><p>r：read 表示文件可读。</p>
</li>
<li><p>w：write 表示文件可写，一般有写的权限，就有删除的权限。</p>
</li>
<li><p>x：execute 表示文件可执行。</p>
</li>
<li><p>-：表示没有相应权限。</p>
</li>
</ul>
<p>3、数字分配权限：</p>
<ul>
<li><p>r：对应 4。</p>
</li>
<li><p>w：对应 2。</p>
</li>
<li><p>x：对应 1。</p>
</li>
</ul>
<p>4、可以使用 <strong>chmod</strong> 进行权限修改，该命令不是 root 用户也能执行，只要是此文件的所有者就可以用 chmod 来修改文件的访问权限了。具体操作如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">chmod 640 hello.txt # 分析 6 = 4 + 2 + 0 表示所有者具有 rw 权限 4 = 4 + 0 + 0</span><br><span class="line">表示群组用户具有 r 权限 0 = 0 + 0 + 0 表示其它用户没有权限</span><br><span class="line">对应文字权限为：-rw-r-----</span><br></pre></td></tr></table></figure>
<p>5、字母所代表权限含义：</p>
<ul>
<li><p>u：user 的缩写，表示所有者。</p>
</li>
<li><p>g：group 的缩写，表示群组用户。</p>
</li>
<li><p>o：other 的缩写，表示其他用户。</p>
</li>
<li><p>+：加号，表示添加权限。</p>
</li>
<li><p>-：减号，表示去除权限。</p>
</li>
<li><p>=：等号，表示分配权限。</p>
</li>
</ul>
<p>6、用字母分配权限具体做法如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">chmod u+rx file <span class="comment">// 文件file的所有者增加读和运行的权限</span></span><br><span class="line"></span><br><span class="line">chmod g+r file  <span class="comment">// 文件file的群组用户增加读的权限</span></span><br><span class="line"></span><br><span class="line">chmod o-r file  <span class="comment">// 文件file的其它用户移除读的权限</span></span><br><span class="line"></span><br><span class="line">chmod g+r o-r file  <span class="comment">// 文件file的群组用户增加读的权限，其它用户移除读的权限</span></span><br><span class="line"></span><br><span class="line">chmod go-r file <span class="comment">// 文件file的群组和其他用户移除读的权限</span></span><br><span class="line"></span><br><span class="line">chmod +x file <span class="comment">// 文件file的所有用户增加运行的权限</span></span><br><span class="line"></span><br><span class="line">chmod u=rwx,g=r,o=- file  <span class="comment">// 文件file的所有者分配读写和执行的权限，群组其它用户分配读的权限，其他用户没有任何权限</span></span><br></pre></td></tr></table></figure>
<h3 id="软件仓库"><a href="#软件仓库" class="headerlink" title="软件仓库"></a>软件仓库</h3><h4 id="软件仓库概述"><a href="#软件仓库概述" class="headerlink" title="软件仓库概述"></a>软件仓库概述</h4><p>1、Linux 下软件是以包的形式存在的，一个软件包其实就是软件的所有文件的压缩包，是二进制的形式，包含了安装软件的所有指令。<code>Red Hat</code> 家族的软件包后缀名一般为 <code>.rpm</code>，<code>Debian</code> 家族的软件包后缀是 <code>.deb</code>。</p>
<p>2、Linux 的包都存在一个仓库，叫做软件仓库，它可以使用 <strong>yum</strong> 来管理软件包，yum 是 CentOS 中默认的包管理工具，适用于 <code>Red Hat</code> 一族。可以理解成 nodejs 的 npm。</p>
<h4 id="yum-常用命令"><a href="#yum-常用命令" class="headerlink" title="yum 常用命令"></a>yum 常用命令</h4><p>1、<strong>yum update | yum updrade</strong>：用于更新软件包。</p>
<p>2、<strong>yum search xxx</strong>：用于搜索相应的软件包。</p>
<p>3、<strong>yum install xxx</strong>：用于安装软件包。</p>
<p>4、<strong>yum remove xxx</strong>：用于删除软件包。</p>
<h4 id="切换-CentOS-软件源"><a href="#切换-CentOS-软件源" class="headerlink" title="切换 CentOS 软件源"></a>切换 CentOS 软件源</h4><p>1、有时候 CentOS 默认的 yum 源不一定是国内镜像，导致 yum 在线安装及更新速度不是很理想，这时候需要将 yum 源设置为国内镜像站点。国内主要开源的镜像站点是网易和阿里云。</p>
<p>2、具体操作过程如下：</p>
<ul>
<li>首先备份系统自带的 yum 源文件 <code>mv /etc/yum.repos.d/entOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</code>：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mv &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo.backup</span><br></pre></td></tr></table></figure>
<ul>
<li>下载阿里云的 yum 源配置文件到 <code>/etc/yum.repos.d/CentOS7</code>：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget -O &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;Centos-7.repo</span><br></pre></td></tr></table></figure>
<ul>
<li>最后生成缓存：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum makecache</span><br></pre></td></tr></table></figure>
<h3 id="阅读手册"><a href="#阅读手册" class="headerlink" title="阅读手册"></a>阅读手册</h3><h4 id="Linux-命令查找"><a href="#Linux-命令查找" class="headerlink" title="Linux 命令查找"></a>Linux 命令查找</h4><p>1、Linux 命令种类繁杂，我们凭借记忆不可能全部记住，可以通过 <strong>man</strong> 指令查找相关命令的用法。</p>
<h4 id="man-手册种类"><a href="#man-手册种类" class="headerlink" title="man 手册种类"></a>man 手册种类</h4><p>1、可执行程序或 Shell  命令。</p>
<p>2、系统调用（ Linux  内核提供的函数）。</p>
<p>3、库调用（程序库中的函数）。</p>
<p>4、文件（例如 /etc/passwd ）。</p>
<p>5、特殊文件（通常在 /dev  下）。</p>
<p>6、游戏。</p>
<p>7、杂项（ man(7) ，groff(7) ）。</p>
<p>8、系统管理命令（通常只能被 root  用户使用）。</p>
<p>9、内核子程序。</p>
<h4 id="man-数字-命令"><a href="#man-数字-命令" class="headerlink" title="man + 数字 + 命令"></a>man + 数字 + 命令</h4><p>1、输入 man + 数字 + 命令/函数，可以查找相关的命令和函数，若不加数字，man 默认从数字较小的手册中寻找相关命令和函数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">man <span class="number">3</span> rand  <span class="comment">// 表示在手册的第三部分查找 rand 函数</span></span><br><span class="line">man ls  <span class="comment">// 查找 ls 用法手册</span></span><br></pre></td></tr></table></figure>
<p>2、man 手册核心区域解析（以 man pwd 为例）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">NAME # 命令名称和简单描述</span><br><span class="line">     pwd -- return working directory name</span><br><span class="line"></span><br><span class="line">SYNOPSIS # 使用此命令的所有方法</span><br><span class="line">     pwd [-L | -P]</span><br><span class="line"></span><br><span class="line">DESCRIPTION # 包括所有参数以及用法</span><br><span class="line">     The pwd utility writes the absolute pathname of the current working directory to the standard output.</span><br><span class="line"></span><br><span class="line">     Some shells may provide a builtin pwd command which is similar or identical to this utility.  Consult the builtin(1) manual page.</span><br><span class="line"></span><br><span class="line">     The options are as follows:</span><br><span class="line"></span><br><span class="line">     -L      Display the logical current working directory.</span><br><span class="line"></span><br><span class="line">     -P      Display the physical current working directory (all symbolic links resolved).</span><br><span class="line"></span><br><span class="line">     If no options are specified, the -L option is assumed.</span><br><span class="line"></span><br><span class="line">SEE ALSO # 扩展阅读相关命令</span><br><span class="line">     builtin(1), cd(1), csh(1), sh(1), getcwd(3)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="help"><a href="#help" class="headerlink" title="help"></a>help</h4><p>1、man 命令像新华词典一样可以查询到命令或函数的详细信息，但其实我们还有更加快捷的方式去查询， command –help 或 command -h ，它没有 man 命令显示的那么详细，但是它更加易于阅读。</p>
<h3 id="Linux-高级"><a href="#Linux-高级" class="headerlink" title="Linux 高级"></a>Linux 高级</h3><h4 id="文本操作"><a href="#文本操作" class="headerlink" title="文本操作"></a>文本操作</h4><h5 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h5><p>1、全局搜索一个正则表达式，并且打印到屏幕。简单来说就是在文件中查找关键字，并显示关键字所在行。</p>
<p>2、基础用法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">grep text file # text代表要搜索的文本，file代表供搜索的文件</span><br><span class="line"></span><br><span class="line"># 实例</span><br><span class="line">[root@dnhyxc ~]# grep path &#x2F;etc&#x2F;profile</span><br><span class="line">pathmunge () &#123;</span><br><span class="line">    pathmunge &#x2F;usr&#x2F;sbin</span><br><span class="line">    pathmunge &#x2F;usr&#x2F;local&#x2F;sbin</span><br><span class="line">    pathmunge &#x2F;usr&#x2F;local&#x2F;sbin after</span><br><span class="line">    pathmunge &#x2F;usr&#x2F;sbin after</span><br><span class="line">unset -f pathmunge</span><br></pre></td></tr></table></figure>
<p>3、常用参数：</p>
<ul>
<li><p>-i：忽略大小写 <code>grep -i path /etc/profile</code>。</p>
</li>
<li><p>-n：显示行号 <code>grep -n path /etc/profile</code>。</p>
</li>
<li><p>-v：只显示搜索文本不在的那些行 <code>grep -v path /etc/profile</code>。</p>
</li>
<li><p>-r：递归查找 <code>grep -r hello /etc</code> ，Linux 中还有一个 <strong>rgrep</strong> 命令，作用相当于 <code>grep -r</code>。</p>
</li>
</ul>
<p>4、高级用法：</p>
<ul>
<li>grep 可以配合正则表达式使用：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">grep -E path /etc/profile <span class="comment">// 完全匹配path</span></span><br><span class="line">grep -E ^path /etc/profile  <span class="comment">// 匹配path开头的字符串</span></span><br><span class="line">grep -E [Pp]ath /etc/profile  <span class="comment">// 匹配path或Path</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>操作系统</category>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>MediaSource</title>
    <url>/2021/11/13/MediaSource/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Media-Source-Extensions"><a href="#Media-Source-Extensions" class="headerlink" title="Media Source Extensions"></a>Media Source Extensions</h3><h4 id="Media-Source-Extensions-概述"><a href="#Media-Source-Extensions-概述" class="headerlink" title="Media Source Extensions 概述"></a>Media Source Extensions 概述</h4><p>1、2016 年 11 月 17 日，W3C 的 HTML 媒体扩展工作组（HTML Media Extensions Working Group）发布了媒体源扩展（Media Source Extensions）的正式推荐标准。</p>
<p>2、该规范允许通过 JavaScript 为 <code>&lt;audio&gt;</code> 和 <code>&lt;video&gt;</code> 动态构造媒体源，它定义了 MediaSource 对象，作为 HTML5 中 HTMLMediaElement 的媒体数据源。<strong>MediaSource 对象可以有一个或多个 SourceBuffer 对象</strong>。应用程序可以向 SourceBuffer 对象动态添加数据片段，并可以根据系统系能及其他因素自适应调整所添加媒体数据的数据质量。来自 SourceBuffer 对象的数据可以解码为音频、视频或文本数据，并由浏览器或播放器处理。与媒体源扩展一同使用，还是包括媒体原扩展字节流格式注册表及一组预定义的字节流格式规范。</p>
<h4 id="为什么需要-MSE"><a href="#为什么需要-MSE" class="headerlink" title="为什么需要 MSE"></a>为什么需要 MSE</h4><p>1、随着 HTML5 的普及，web 逐渐淘汰 flash 开始使用 <code>&lt;audio&gt;/&lt;video&gt;</code> 标签进行视频播放。但在没有 MSE 标准出现之前，前端对于 video 的操作仅限于<code>&lt;video&gt;</code> 标签提供的一些能力，不能对视频流进行做任何操作。</p>
<p>2、假设我们需要开发一个切换清晰度的功能，很容易就能想到动态更改 <code>&lt;video&gt;</code> 标签 src 的方案。</p>
<a id="more"></a>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">      &lt;video</span><br><span class="line">        id=&quot;video&quot;</span><br><span class="line">        controls=&quot;controls&quot;</span><br><span class="line">        width=&quot;800&quot;</span><br><span class="line">        src=&quot;./xxx.mp4&quot;</span><br><span class="line">        type=&quot;video/mp4&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;extras&quot;</span>&gt;</span>切换清晰度<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> switchButton = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#extras&quot;</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> video = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#video&quot;</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> handleClick = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> currentTime = video.currentTime;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> src = video.src;</span></span><br><span class="line"><span class="javascript">        video.src = src === <span class="string">&quot;./hd.mp4&quot;</span> ? <span class="string">&quot;./sd.mp4&quot;</span> : <span class="string">&quot;./hd.mp4&quot;</span>;</span></span><br><span class="line">        video.currentTime = currentTime;</span><br><span class="line">        video.play();</span><br><span class="line">      &#125;;</span><br><span class="line"><span class="javascript">      switchButton.addEventListener(<span class="string">&quot;click&quot;</span>, handleClick);</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>通过这种方式存在两个缺点：切换 src 必然导致视频中断、无法做出平滑切换的效果。这显然不符合无缝播放的要求。</li>
</ul>
<p>3、为了解决平滑切换的效果，可以用 Blob URL 指向一个视频二进制数据，然后不断将下一段视频的二进制数据添加拼接进去。这样就可以在不影响播放的情况下，不断的更新视频内容并播放下去。要实现这个功能就需要通过 MediaSource 来实现，MediaSource 接口功能也很纯粹，作为一个媒体数据容器可以和 HTMLMediaElement 进行绑定。基本流程就是通过 URL.createObjectURL 创建容器的 BLob URL，设置到 video 标签的 src 上，在播放过程中，我们仍然可以通过 MediaSource.appendBuffer 方法往容器里添加数据，达到更新视频内容的目的。实现代码如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> video = <span class="built_in">document</span>.querySelector(<span class="string">&quot;video&quot;</span>);</span><br><span class="line"><span class="comment">//视频资源存放路径，假设下面有5个分段视频 video1.mp4 ~ video5.mp4，第一个段为初始化视频init.mp4</span></span><br><span class="line"><span class="keyword">const</span> assetURL = <span class="string">&quot;http://www.demo.com&quot;</span>;</span><br><span class="line"><span class="comment">//视频格式和编码信息，主要为判断浏览器是否支持视频格式，但如果信息和视频不符可能会报错</span></span><br><span class="line"><span class="keyword">const</span> mimeCodec = <span class="string">&#x27;video/mp4; codecs=&quot;avc1.42E01E, mp4a.40.2&quot;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;MediaSource&quot;</span> <span class="keyword">in</span> <span class="built_in">window</span> &amp;&amp; MediaSource.isTypeSupported(mimeCodec)) &#123;</span><br><span class="line">  <span class="keyword">const</span> mediaSource = <span class="keyword">new</span> MediaSource();</span><br><span class="line">  video.src = URL.createObjectURL(mediaSource); <span class="comment">//将video与MediaSource绑定，此处生成一个Blob URL</span></span><br><span class="line">  mediaSource.addEventListener(<span class="string">&quot;sourceopen&quot;</span>, sourceOpen); <span class="comment">//可以理解为容器打开</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">//浏览器不支持该视频格式</span></span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">&quot;Unsupported MIME type or codec: &quot;</span>, mimeCodec);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sourceOpen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> mediaSource = <span class="built_in">this</span>;</span><br><span class="line">  <span class="keyword">const</span> sourceBuffer = mediaSource.addSourceBuffer(mimeCodec);</span><br><span class="line">  <span class="keyword">let</span> i = <span class="number">1</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getNextVideo</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//ajax代码实现翻看上文，数据请求类型为arraybuffer</span></span><br><span class="line">    ajax(url, <span class="function"><span class="keyword">function</span> (<span class="params">buf</span>) </span>&#123;</span><br><span class="line">      <span class="comment">//往容器中添加请求到的数据，不会影响当下的视频播放。</span></span><br><span class="line">      sourceBuffer.appendBuffer(buf);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//每次appendBuffer数据更新完之后就会触发</span></span><br><span class="line">  sourceBuffer.addEventListener(<span class="string">&quot;updateend&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i === <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">//第一个初始化视频加载完就开始播放</span></span><br><span class="line">      video.play();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">6</span>) &#123;</span><br><span class="line">      <span class="comment">//一段视频加载完成后，请求下一段视频</span></span><br><span class="line">      getNextVideo(<span class="string">`<span class="subst">$&#123;assetURL&#125;</span>/video<span class="subst">$&#123;i&#125;</span>.mp4`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (i === <span class="number">6</span>) &#123;</span><br><span class="line">      <span class="comment">//全部视频片段加载完关闭容器</span></span><br><span class="line">      mediaSource.endOfStream();</span><br><span class="line">      URL.revokeObjectURL(video.src); <span class="comment">//Blob URL已经使用并加载，不需要再次使用的话可以释放掉。</span></span><br><span class="line">    &#125;</span><br><span class="line">    i++;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//加载初始视频</span></span><br><span class="line">  getNextVideo(<span class="string">`<span class="subst">$&#123;assetURL&#125;</span>/init.mp4`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="MSE-的作用"><a href="#MSE-的作用" class="headerlink" title="MSE 的作用"></a>MSE 的作用</h4><p>1、动态清晰度切换。</p>
<p>2、进行视频拼接。</p>
<p>3、音频语言切换。</p>
<p>4、动态控制视频加载。</p>
<h3 id="MediaSource"><a href="#MediaSource" class="headerlink" title="MediaSource"></a>MediaSource</h3><h4 id="MediaSource-概述"><a href="#MediaSource-概述" class="headerlink" title="MediaSource 概述"></a>MediaSource 概述</h4><p>1、MediaSource 是 Media Source Extensions API 表示媒体资源 HTMLMediaElement 对象的接口。MediaSource 对象可以附着在 HTMLMediaElement 在客户端进行播放。</p>
<h4 id="MediaSource-1"><a href="#MediaSource-1" class="headerlink" title="MediaSource()"></a>MediaSource()</h4><p>1、MediaSource() 是 MediaSource 的构造函数 返回一个没有分配 source buffers 新的 MediaSource 对象。</p>
<p>2、MediaSource() 语法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> mediaSource = <span class="keyword">new</span> MediaSource();</span><br></pre></td></tr></table></figure>
<p>3、使用实例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> video = <span class="built_in">document</span>.querySelector(<span class="string">&quot;video&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> assetURL = <span class="string">&quot;frag_bunny.mp4&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> mimeCodec = <span class="string">&#x27;video/mp4; codecs=&quot;avc1.42E01E, mp4a.40.2&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;MediaSource&quot;</span> <span class="keyword">in</span> <span class="built_in">window</span> &amp;&amp; MediaSource.isTypeSupported(mimeCodec)) &#123;</span><br><span class="line">  <span class="keyword">const</span> mediaSource = <span class="keyword">new</span> MediaSource();</span><br><span class="line">  video.src = URL.createObjectURL(mediaSource);</span><br><span class="line">  mediaSource.addEventListener(<span class="string">&quot;sourceopen&quot;</span>, sourceOpen);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">&quot;Unsupported MIME type or codec: &quot;</span>, mimeCodec);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="MediaSource-的实例属性"><a href="#MediaSource-的实例属性" class="headerlink" title="MediaSource 的实例属性"></a>MediaSource 的实例属性</h4><h5 id="duration"><a href="#duration" class="headerlink" title="duration"></a>duration</h5><p>1、该属性用来获取或者设置当前媒体展示的时长，该值是以秒为单位的双精度浮点数。</p>
<p>2、语法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 设置时长</span></span><br><span class="line">mediaSource.duration = <span class="number">9.2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取时长</span></span><br><span class="line"><span class="keyword">const</span> myDuration = mediaSource.duration;</span><br></pre></td></tr></table></figure>
<p>3、基本使用实例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sourceOpen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.readyState); <span class="comment">// open</span></span><br><span class="line">  <span class="keyword">const</span> mimeCodec = <span class="string">&#x27;video/mp4; codecs=&quot;avc1.42E01E, mp4a.40.2&quot;&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> mediaSource = <span class="built_in">this</span>;</span><br><span class="line">  <span class="keyword">const</span> sourceBuffer = mediaSource.addSourceBuffer(mimeCodec);</span><br><span class="line"></span><br><span class="line">  sourceBuffer.appendBuffer(buf);</span><br><span class="line"></span><br><span class="line">  fetchAB(assetURL, <span class="function"><span class="keyword">function</span> (<span class="params">buf</span>) </span>&#123;</span><br><span class="line">    sourceBuffer.addEventListener(<span class="string">&quot;updateend&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      mediaSource.endOfStream();</span><br><span class="line"></span><br><span class="line">      mediaSource.duration = <span class="number">120</span>;</span><br><span class="line"></span><br><span class="line">      video.play();</span><br><span class="line">      <span class="built_in">console</span>.log(mediaSource.readyState); <span class="comment">// ended</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="readyState"><a href="#readyState" class="headerlink" title="readyState"></a>readyState</h5><p>1、readyState 是 MediaSource 接口的一个只读属性。它返回一个集合表明当前 MediaSource 的状态。它有三种可能的返回值：</p>
<ul>
<li><p><strong>open</strong>: 当前源已附着到一个 media 元素并准备好接收 SourceBuffer 对象。</p>
</li>
<li><p><strong>closed</strong>: 当前源并未附着到一个 media 元素上。</p>
</li>
<li><p><strong>ended</strong>: 当前源已附着到一个 media 元素，但流已被 MediaSource.endOfStream() 结束。</p>
</li>
</ul>
<p>2、语法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> myReadyState = mediaSource.readyState;</span><br></pre></td></tr></table></figure>
<p>3、具体使用示例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> mimeCodec = <span class="string">&#x27;video/mp4; codecs=&quot;avc1.42E01E, mp4a.40.2&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;MediaSource&quot;</span> <span class="keyword">in</span> <span class="built_in">window</span> &amp;&amp; MediaSource.isTypeSupported(mimeCodec)) &#123;</span><br><span class="line">  <span class="keyword">const</span> mediaSource = <span class="keyword">new</span> MediaSource();</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(mediaSource.readyState); <span class="comment">// closed</span></span><br><span class="line"></span><br><span class="line">  video.src = URL.createObjectURL(mediaSource);</span><br><span class="line"></span><br><span class="line">  mediaSource.addEventListener(<span class="string">&quot;sourceopen&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.readyState); <span class="comment">// open</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> sourceBuffer = mediaSource.addSourceBuffer(mimeCodec);</span><br><span class="line"></span><br><span class="line">    fetchAB(assetURL, <span class="function"><span class="keyword">function</span> (<span class="params">buf</span>) </span>&#123;</span><br><span class="line">      sourceBuffer.appendBuffer(buf);</span><br><span class="line"></span><br><span class="line">      sourceBuffer.addEventListener(<span class="string">&quot;updateend&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        mediaSource.endOfStream();</span><br><span class="line"></span><br><span class="line">        video.play();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(mediaSource.readyState); <span class="comment">// ended</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">&quot;Unsupported MIME type or codec: &quot;</span>, mimeCodec);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="sourceBuffers"><a href="#sourceBuffers" class="headerlink" title="sourceBuffers"></a>sourceBuffers</h5><p>1、sourceBuffers 是 mediaSource 实例上的一个属性，它返回的是一个 <strong>SourceBufferList</strong> 的对象，里面可以获取当前 mediaSource 上挂载的所有 sourceBuffer。不过，只有当 mediaSource 为 open 状态的时候，它才可以访问。</p>
<p>2、语法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> sourceBuffers = mediaSource.sourceBuffers;</span><br></pre></td></tr></table></figure>
<p>3、可以通过 index（索引）来获取 sourceBuffers 中具体的某个 sourceBuffer 对象：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> sourceBuffers = mediaSource.sourceBuffers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> firstSourceBuffer = sourceBuffers[<span class="number">0</span>];</span><br></pre></td></tr></table></figure>
<p>4、SourceBufferList 对象还提供了 <strong>addsourcebuffer</strong> 和 <strong>removesourcebuffer</strong> 事件，如果你想监听 sourceBuffer 的变化，可以直接通过 SourceBufferList 来做。这也是为什么 mediaSource 没有提供监听事件的一个原因。所以，删除某一个 sourceBuffer 就可以通过 SourceBufferList 查找，然后，利用 removesourcebuffer 方法移除即可：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> sourceBuffers = mediaSource.sourceBuffers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> firstSourceBuffer = sourceBuffers[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">mediaSource.removeSourceBuffer(firstSourceBuffer);</span><br></pre></td></tr></table></figure>
<h5 id="activeSourceBuffers"><a href="#activeSourceBuffers" class="headerlink" title="activeSourceBuffers"></a>activeSourceBuffers</h5><p>1、activeSourceBuffers 实际上是 sourceBuffers 的子集，返回的同样也是 SourceBufferList 对象。为什么说也是子集呢？</p>
<ul>
<li>因为 1、activeSourceBuffers 包含的是当前正在使用的 sourceBuffer。因为前面说了，每个 sourceBuffer 实际上都可以具体代表一个 track，比如，video track，audio track，text track 等等。那怎么标识正在使用的 sourceBuffer 呢？很简单，不用标识啊，因为控制哪一个 sourceBuffer 正在使用是你来决定的。如果非要标识，就需要使用到 HTML 中的 video 和 audio 节点。</li>
</ul>
<p>2、activeSourceBuffers 的使用方式与 sourceBuffers 类似，参照 sourceBuffers 进行使用即可。</p>
<h4 id="MediaSource-的方法"><a href="#MediaSource-的方法" class="headerlink" title="MediaSource 的方法"></a>MediaSource 的方法</h4><h5 id="isTypeSupported"><a href="#isTypeSupported" class="headerlink" title="isTypeSupported()"></a>isTypeSupported()</h5><p>1、isTypeSupported 主要是用来检测 MediaSource 是否支持某个特定的编码和容器盒子。例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">MediaSource.isTypeSupported(<span class="string">&#x27;video/mp4; codecs=&quot;avc1.42E01E, mp4a.40.2&quot;&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>2、具体的 mimeType 参考列表，<a href="https://wiki.whatwg.org/wiki/Video_type_parameters#Browser_Support" title="mimeType">请戳这里查看</a>。</p>
<h5 id="addSourceBuffer"><a href="#addSourceBuffer" class="headerlink" title="addSourceBuffer()"></a>addSourceBuffer()</h5><p>1、addSourceBuffer() 方法会根据给定的 MIME 类型创建一个新的 SourceBuffer 对象，然后会将它追加到 MediaSource 的 SourceBuffers 列表中。</p>
<p>2、语法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> sourceBuffer = mediaSource.addSourceBuffer(mimeType);</span><br></pre></td></tr></table></figure>
<ul>
<li>mimeType：创建的 source buffer 的 MIME 类型，如：<code>&#39;video/mp4; codecs=&quot;avc1.42E01E, mp4a.40.2&quot;&#39;</code>。</li>
</ul>
<p>3、具体使用示例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> assetURL = <span class="string">&quot;frag_bunny.mp4&quot;</span>;</span><br><span class="line"><span class="comment">// ./mp4info frag_bunny.mp4 | grep Codec</span></span><br><span class="line"><span class="keyword">const</span> mimeCodec = <span class="string">&#x27;video/mp4; codecs=&quot;avc1.42E01E, mp4a.40.2&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;MediaSource&quot;</span> <span class="keyword">in</span> <span class="built_in">window</span> &amp;&amp; MediaSource.isTypeSupported(mimeCodec)) &#123;</span><br><span class="line">  <span class="keyword">const</span> mediaSource = <span class="keyword">new</span> MediaSource();</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(mediaSource.readyState); <span class="comment">// closed</span></span><br><span class="line"></span><br><span class="line">  video.src = URL.createObjectURL(mediaSource);</span><br><span class="line"></span><br><span class="line">  mediaSource.addEventListener(<span class="string">&quot;sourceopen&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.readyState); <span class="comment">// open</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> sourceBuffer = mediaSource.addSourceBuffer(mimeCodec);</span><br><span class="line"></span><br><span class="line">    fetchAB(assetURL, <span class="function">(<span class="params">buf</span>) =&gt;</span> &#123;</span><br><span class="line">      sourceBuffer.appendBuffer(buf);</span><br><span class="line"></span><br><span class="line">      sourceBuffer.addEventListener(<span class="string">&quot;updateend&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        mediaSource.endOfStream();</span><br><span class="line"></span><br><span class="line">        video.play();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(mediaSource.readyState); <span class="comment">// ended</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">&quot;Unsupported MIME type or codec: &quot;</span>, mimeCodec);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="removeSourceBuffer"><a href="#removeSourceBuffer" class="headerlink" title="removeSourceBuffer()"></a>removeSourceBuffer()</h5><p>1、用来移除某个 sourceBuffer。比如当前流已经结束，就没必要再保留当前 sourceBuffer，可以直接移除，防止占用多余的空间，具体方式为：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">mediaSource.removeSourceBuffer(sourceBuffer);</span><br></pre></td></tr></table></figure>
<h5 id="endOfStream"><a href="#endOfStream" class="headerlink" title="endOfStream()"></a>endOfStream()</h5><p>1、endOfStream() 方法的调用就意味着流的结束，注意，这里<strong>并不是断开</strong>，相当于只是下好了一部分视频，可以进行播放。此时，mediaSource 的状态将变为 ended。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> sourceBuffer = mediaSource.addSourceBuffer(mimeCodec);</span><br><span class="line">fetchAB(assetURL, <span class="function"><span class="keyword">function</span> (<span class="params">buf</span>) </span>&#123;</span><br><span class="line">  sourceBuffer.addEventListener(<span class="string">&quot;updateend&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    mediaSource.endOfStream(); <span class="comment">// 结束当前的流</span></span><br><span class="line">    video.play(); <span class="comment">// 可以播放当前获得的流</span></span><br><span class="line">  &#125;);</span><br><span class="line">  sourceBuffer.appendBuffer(buf);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="mediaSource-的事件"><a href="#mediaSource-的事件" class="headerlink" title="mediaSource 的事件"></a>mediaSource 的事件</h4><h5 id="sourceopen"><a href="#sourceopen" class="headerlink" title="sourceopen"></a>sourceopen</h5><p>1、当状态变为 open 时触发。常常在 mediaSource 和 HTMLMedia 绑定时触发。</p>
<p>2、sourceopen 事件相同于是一个总领事件，只有当 sourceopen 时间触发后，后续对于 mediaSource 来说，才是一个可操作的对象。通常来说，只有当 mediaSource 和 video 元素成功绑定时，才会正常触发：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> mediaSource = <span class="keyword">new</span> MediaSource();</span><br><span class="line"><span class="comment">// mediaSource 和 video 元素进行绑定</span></span><br><span class="line">vidElement.src = URL.createObjectURL(mediaSource);</span><br></pre></td></tr></table></figure>
<h5 id="sourceended"><a href="#sourceended" class="headerlink" title="sourceended"></a>sourceended</h5><p>1、当状态变为 ended 时触发。</p>
<p>2、sourceended 的触发条件其实很简单，当调用 endOfStream 的时候就会触发。</p>
<h5 id="sourceclose"><a href="#sourceclose" class="headerlink" title="sourceclose"></a>sourceclose</h5><p>1、当状态变为 closed 时触发。</p>
<p>2、sourceclose 是在 media 元素和 mediaSource 断开的时候，才会触发。</p>
<p>3、如果要手动触发 sourceclose 事件，需要进行如下步骤：</p>
<ul>
<li><p>将 readyState 设置为 closed。</p>
</li>
<li><p>将 mediaSource.duration 设置为 NaN。</p>
</li>
<li><p>移除 activeSourceBuffers 上的所有 Buffer。通过触发 activeSourceBuffers 的 removesourcebuffer 事件。</p>
</li>
<li><p>移除 sourceBuffers 上的 SourceBuffer。通过触发 sourceBuffers 的 removesourcebuffer 事件。</p>
</li>
<li><p>通过以上步骤，最终才会触发 MediaSource 的 sourceclose 事件。</p>
</li>
</ul>
<h3 id="sourceBuffer"><a href="#sourceBuffer" class="headerlink" title="sourceBuffer"></a>sourceBuffer</h3><h4 id="sourceBuffer-简介"><a href="#sourceBuffer-简介" class="headerlink" title="sourceBuffer 简介"></a>sourceBuffer 简介</h4><p>1、sourceBuffer 是由 mediaSource 创建的，并直接和 HTMLMediaElement 接触。简单来说，它就是一个流的容器，里面提供的 append() 和 remove() 方法来对流进行操作，它可以包含一个或者多个 media segments（就是每次通过 append 添加进去的流片段）。</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> SourceBuffer : EventTarget &#123;</span><br><span class="line">           attribute AppendMode          mode;</span><br><span class="line">  <span class="keyword">readonly</span> attribute <span class="built_in">boolean</span>             updating;</span><br><span class="line">  <span class="keyword">readonly</span> attribute TimeRanges          buffered;</span><br><span class="line">           attribute double              timestampOffset;</span><br><span class="line">  <span class="keyword">readonly</span> attribute AudioTrackList      audioTracks;</span><br><span class="line">  <span class="keyword">readonly</span> attribute VideoTrackList      videoTracks;</span><br><span class="line">  <span class="keyword">readonly</span> attribute TextTrackList       textTracks;</span><br><span class="line">           attribute double              appendWindowStart;</span><br><span class="line">           attribute unrestricted double appendWindowEnd;</span><br><span class="line">           attribute EventHandler        onupdatestart;</span><br><span class="line">           attribute EventHandler        onupdate;</span><br><span class="line">           attribute EventHandler        onupdateend;</span><br><span class="line">           attribute EventHandler        onerror;</span><br><span class="line">           attribute EventHandler        onabort;</span><br><span class="line">  <span class="built_in">void</span> appendBuffer(BufferSource data);</span><br><span class="line">  <span class="built_in">void</span> abort();</span><br><span class="line">  <span class="built_in">void</span> remove(double start, unrestricted double end);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="sourceBuffer-的方法"><a href="#sourceBuffer-的方法" class="headerlink" title="sourceBuffer 的方法"></a>sourceBuffer 的方法</h4><h5 id="appendBuffer"><a href="#appendBuffer" class="headerlink" title="appendBuffer"></a>appendBuffer</h5><p>1、可以动态地向 MediaSource 中添加视频/音频片段（对于一个 MediaSource，可以同时存在多个 SourceBuffer）。</p>
<p>2、如果视频很长，存在多个 chunk 的话，就需要不停地向 SourceBuffer 中加入新的 chunk。这里就需要注意一个问题了，即 appendBuffer 是异步执行的，在完成前，不能 append 新的 chunk，而是应该监听 SourceBuffer 上的 updateend 事件，确定空闲后，再加入新的 chunk。</p>
<ul>
<li>错误示例：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">sourceBuffer.appendBuffer(buffer1)</span><br><span class="line">sourceBuffer.appendBuffer(buffer2)</span><br><span class="line"><span class="comment">// Uncaught DOMException:</span></span><br><span class="line">Failed to set the <span class="string">&#x27;timestampOffset&#x27;</span> property on <span class="string">&#x27;SourceBuffer&#x27;</span>:</span><br><span class="line">This SourceBuffer is still processing</span><br><span class="line">an <span class="string">&#x27;appendBuffer&#x27;</span> or <span class="string">&#x27;remove&#x27;</span> operation.</span><br></pre></td></tr></table></figure>
<ul>
<li>正确示例：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">sourceBuffer.addEventListener(<span class="string">&#x27;updateend&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 这个时候才能加入新 chunk</span></span><br><span class="line">  <span class="comment">// 先设定新chunk加入的位置，比如第20秒处</span></span><br><span class="line">  sourceBuffer.timestampOffset = <span class="number">20</span></span><br><span class="line">  <span class="comment">// 然后加入</span></span><br><span class="line">  sourceBuffer.append(newBuffer)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="sourceBuffer-的属性"><a href="#sourceBuffer-的属性" class="headerlink" title="sourceBuffer 的属性"></a>sourceBuffer 的属性</h4><h5 id="mode"><a href="#mode" class="headerlink" title="mode"></a>mode</h5><p>1、mode：有两种格式：</p>
<ul>
<li><p>segments: 乱序排放。通过 timestamps 来标识其具体播放的顺序。比如：20s 的 buffer，30s 的 buffer 等。</p>
<ul>
<li>segments 表示 A/V 的播放时根据你视频播放流中的 pts 来决定，该模式也是最常使用的。因为音视频播放中，最重要的就是 pts 的排序。因为，pts 可以决定播放的时长和顺序，如果一旦 A/V 的 pts 错开，有可能就会造成 A/V sync drift。</li>
</ul>
</li>
<li><p>sequence: 按序排放。通过 appendBuffer 的顺序来决定每个 mode 添加的顺序。timestamps 根据 sequence 自动产生。</p>
<ul>
<li>sequence 则是根据空间上来进行播放的。每次通过 appendBuffer 来添加指定的 Buffer 的时候，实际上就是添加一段 A/V segment。此时，播放器会根据其添加的位置，来决定播放顺序。还需要注意，在播放的同时，你需要告诉 sourceBuffer，这段 segment 有多长，也就是该段 Buffer 的实际偏移量。而该段偏移量就是由 timestampOffset 决定的。整个过程用代码描述一下就是：</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">sourceBuffer.appendBuffer(media.segment);</span><br><span class="line">sourceBuffer.timestampOffset += media.duration;</span><br></pre></td></tr></table></figure>
<p>2、一般情况下，我们不用管 mode 的值。不过可以在后面将 segments 设置为 sequence。但是如果将 sequence 设置为 segments 就会出现问题。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> bufferMode = sourceBuffer.mode;</span><br><span class="line"><span class="keyword">if</span> (bufferMode == <span class="string">&quot;segments&quot;</span>) &#123;</span><br><span class="line">  sourceBuffer.mode = <span class="string">&quot;sequence&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="buffered"><a href="#buffered" class="headerlink" title="buffered"></a>buffered</h5><p>1、返回一个 timeRange 对象。用来表示当前被存储在 sourceBuffer 中的 buffer。</p>
<ul>
<li>timeRange：当加载一个 <code>&lt;audio&gt;</code> 或 <code>&lt;video&gt;</code> 元素使用的媒体资源时，该 timeRange 接口用于表示已缓冲的媒体资源的时间范围、已播放的时间范围以及可查找的时间范围。</li>
</ul>
<h5 id="updating"><a href="#updating" class="headerlink" title="updating"></a>updating</h5><p>1、返回布尔值，表示当前 sourceBuffer 是否正在被更新。例如: sourceBuffer.appendBuffer()，sourceBuffer.appendStream()，sourceBuffer.remove() 调用时。</p>
<ul>
<li><p>true：当前 sourceBuffer 正在处理添加或者移除的 segment。</p>
</li>
<li><p>false：当前 sourceBuffer 处于空闲状态。当且仅当 updating = false 的时候，才可以对 sourceBuffer 进行额外的操作。</p>
</li>
</ul>
<h4 id="sourceBuffer-的事件"><a href="#sourceBuffer-的事件" class="headerlink" title="sourceBuffer 的事件"></a>sourceBuffer 的事件</h4><h5 id="updatestart"><a href="#updatestart" class="headerlink" title="updatestart"></a>updatestart</h5><p>1、当 updating 由 false 变为 true 时会被触发。</p>
<p>2、使用方式如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">sourceBuffer.addEventListener(<span class="string">&quot;updatestart&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="update"><a href="#update" class="headerlink" title="update"></a>update</h5><p>1、当 append()/remove() 方法被成功调用完成时被触发，此时 updating 将由 true 变为 false。</p>
<p>2、使用方式如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">sourceBuffer.addEventListener(<span class="string">&quot;update&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 当指定的 buffer 加载完后，就可以开始播放</span></span><br><span class="line">  mediaSource.endOfStream();</span><br><span class="line">  video.play();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="updateend"><a href="#updateend" class="headerlink" title="updateend"></a>updateend</h5><p>1、当 append()/remove() 已经结束时被触发。</p>
<p>2、注意：update 和 updateend 都是表示处理的结束，不同的是，update 比 updateend 先触发。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">sourceBuffer.addEventListener(<span class="string">&quot;updateend&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 当指定的 buffer 加载完后，就可以开始播放</span></span><br><span class="line">  mediaSource.endOfStream();</span><br><span class="line">  video.play();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="error"><a href="#error" class="headerlink" title="error"></a>error</h5><p>1、在 append() 过程中发生错误时被触发，此时 updating 将由 true 变为 false。</p>
<p>2、使用方式如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">sourceBuffer.addEventListener(<span class="string">&quot;error&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="abort"><a href="#abort" class="headerlink" title="abort"></a>abort</h5><p>1、当 append()/remove() 过程中，使用 abort() 方法终止时，会被触发。此时 updating 将由 true 变为 false。</p>
<p>2、使用方式如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">sourceBuffer.addEventListener(<span class="string">&quot;abort&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="添加-移除-buffer"><a href="#添加-移除-buffer" class="headerlink" title="添加/移除 buffer"></a>添加/移除 buffer</h4><p>1、在添加 Buffer 的时候，需要知道你所采用的 mode 是哪种类型，sequence 或者 segments。这两种是完全两种不同的添加方式。</p>
<ul>
<li>segments：这种方式是直接根据 MP4 文件中的 pts 来决定播放的位置和顺序，它的添加方式极其简单，只需要判断 updating === false，然后，直接通过 appendBuffer 添加即可。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!sourceBuffer.updating) &#123;</span><br><span class="line">  <span class="keyword">let</span> mediaSource = <span class="built_in">this</span>._mergeBuffer(media.tmpBuffer);</span><br><span class="line"></span><br><span class="line">  sourceBuffer.appendBuffer(mediaSource);</span><br><span class="line"></span><br><span class="line">  media.duration += lib.duration;</span><br><span class="line">  media.tmpBuffer = [];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>sequence：如果你是采用这种方式进行添加 Buffer 进行播放的话，那么你也就没必要了解 FMP4 格式，而是了解 MP4 格式。因为，该模式下，sourceBuffer 是根据具体添加的位置来进行播放的。所以，如果你是 FMP4 的话，有可能就有点不适合了。针对 sequence 来说，每段 buffer 都必须有自己本身的指定时长，每段 buffer 不需要参考的 baseDts，即，他们直接可以毫无关联。那 sequence 具体怎么操作呢？简单来说，就是在每一次添加过后，都需要根据指定 sourceBuffer 上的 timestampOffset。该属性，是用来控制具体 Buffer 的播放时长和位置的。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!sourceBuffer.updating) &#123;</span><br><span class="line">  <span class="keyword">let</span> mediaSource = <span class="built_in">this</span>._mergeBuffer(media.tmpBuffer);</span><br><span class="line"></span><br><span class="line">  sourceBuffer.appendBuffer(mediaSource);</span><br><span class="line"></span><br><span class="line">  sourceBuffer.timestampOffset += lib.duration;</span><br><span class="line">  media.tmpBuffer = [];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="控制播放片段"><a href="#控制播放片段" class="headerlink" title="控制播放片段"></a>控制播放片段</h4><p>1、如果要在 video 标签中控制指定片段的播放，一般是不可能的。因为，在加载整个视频 buffer 的时候，视频长度就已经固定的，剩下的只是你如果在 video 标签中控制播放速度和音量大小。而在 mediaSourceE 中，如何在已获得整个视频流 Buffer 的前提下，完成底层视频 Buffer 的切割和指定时间段播放呢？这里，需要利用 sourceBuffer 下的 <strong>appendWindowStart</strong> 和 <strong>appendWindowEnd</strong> 这两个属性。</p>
<ul>
<li>这两个属性主要是为了设置当有视频 Buffer 添加时，只有符合在 <code>[start, end]</code> 之间的 media frame 才能 append，否则，无法 append。例如：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">sourceBuffer.appendWindowStart = <span class="number">2.0</span>;</span><br><span class="line">sourceBuffer.appendWindowEnd = <span class="number">5.0</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>设置添加 Buffer 的时间戳为 <code>[2s, 5s]</code> 之间。appendWindowStart 和 appendWindowEnd 的基准单位为 s。该属性值通常需要在添加 Buffer 之前设置。</p>
</blockquote>
<h4 id="sourceBuffer-内存释放"><a href="#sourceBuffer-内存释放" class="headerlink" title="sourceBuffer 内存释放"></a>sourceBuffer 内存释放</h4><p>1、sourceBuffer 内存释放其实就和在 JS 中，将一个变量指向 null 一样的过程。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">1024</span> * <span class="number">1000</span>);</span><br><span class="line">a = <span class="literal">null</span>; <span class="comment">// start garbage collection</span></span><br></pre></td></tr></table></figure>
<p>2、在 sourceBuffer 中，简单的来说，就是移除指定的 time ranges’ buffer。需要用到的 API 为：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">remove(double start, unrestricted double end);</span><br></pre></td></tr></table></figure>
<p>3、具体的步骤为：</p>
<ul>
<li><p>找到具体需要移除的 segment。</p>
</li>
<li><p>得到其开始（start）的时间戳（以 s 为单位）。</p>
</li>
<li><p>得到其结束（end）的时间戳（以 s 为单位）。</p>
</li>
<li><p>此时，updating 为 true，表明正在移除。</p>
</li>
<li><p>完成之后，触发 updateend 事件。</p>
</li>
</ul>
<p>4、如果想直接清空 Buffer 重新添加的话，可以直接利用 abort() 方法来实现。它的工作是清空当前 sourceBuffer 中所有的 segment，使用方法也很简单，不过就是需要注意不要和 remove 操作一起执行。更保险的做法就是直接，通过 updating===false 来完成：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (sourceBuffer.updating === <span class="literal">false</span>) &#123;</span><br><span class="line">  sourceBuffer.abort();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>这时候，abort 的主要流程为：</p>
<ul>
<li><p>确保 mediaSource.readyState 是否为 open 状态。</p>
</li>
<li><p>将 appendWindowStart 设置为 pts 原始值，比如：0。</p>
</li>
<li><p>将 appendWindowEnd 设置为正无限大，即，Infinity。</p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>用来放弃当前 append 流的操作。不过，该方法的业务场景也比较有限。它只能用在当 sourceBuffer 正在更新流的时候。即，此时通过 fetch，已经接受到新流，并且使用 appendBuffer 添加，此为开始的时间。然后到 updateend 事件触发之前，这段时间之内调用 abort()。有一个业务场景是，当用户移动进度条快进时，而此时 fetch 已经获取前一次的 media segments，那么可以使用 abort 放弃该操作，转而请求新的 media segments。</p>
</blockquote>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>MSE</tag>
        <tag>MediaSource</tag>
      </tags>
  </entry>
  <entry>
    <title>DesignPattern</title>
    <url>/2020/05/16/design/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h4><p>1、设计模式是一种写代码的方式，它是为了解决特定问题而给出的简洁、优化的解决方案。</p>
<p>2、主要用到的设计模式有：<strong>单例模式</strong>、<strong>观察者模式</strong>、<strong>发布订阅模式</strong>、<strong>策略模式</strong>等。</p>
<h4 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h4><p>1、单例模式：指的是一个构造函数一生只能有一个实例，即：不管 new 多少次，得到的都是同一个实例。</p>
<p>2、应用场景：可以用来实现页面自定义弹出层，类似实现 antd 中的 Modal 组件。</p>
<p>3、具体应用实例：</p>
<a id="more"></a>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>设计模式-单例模式<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="css">        <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .action &#123;</span><br><span class="line"><span class="css">        <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .showModal &#123;</span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">88px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">32px</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .wrap &#123;</span><br><span class="line"><span class="css">        <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="css">        <span class="attribute">top</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">left</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .container &#123;</span><br><span class="line"><span class="css">        <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">        <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="css">        <span class="attribute">justify-content</span>: space-between;</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">500px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">margin</span>: auto;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .header &#123;</span><br><span class="line"><span class="css">        <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">        <span class="attribute">justify-content</span>: space-between;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">line-height</span>: <span class="number">45px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">padding-left</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">padding-right</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .close &#123;</span><br><span class="line"><span class="css">        <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .content &#123;</span><br><span class="line"><span class="css">        <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">        <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="css">        <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="css">        <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">        <span class="attribute">min-height</span>: <span class="number">200px</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .footer &#123;</span><br><span class="line"><span class="css">        <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">        <span class="attribute">justify-content</span>: flex-end;</span></span><br><span class="line"><span class="css">        <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .cancel,</span><br><span class="line">      .ok &#123;</span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">80px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">32px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">margin-left</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;action&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;showModal&quot;</span>&gt;</span>显示弹窗<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrap&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> Modal = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> instance = <span class="literal">null</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">// 创建类，因为使用单例模式，该类只会被实例化一次</span></span></span><br><span class="line"><span class="javascript">        <span class="class"><span class="keyword">class</span> <span class="title">CreateModal</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.ele = <span class="built_in">document</span>.createElement(<span class="string">&quot;div&quot;</span>);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.ele.className = <span class="string">&quot;container&quot;</span>;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.querySelector(<span class="string">&quot;.wrap&quot;</span>).appendChild(<span class="built_in">this</span>.ele);</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 绑定事件，只需要实例化的时候执行一次就行了，目的是为this.ele的子元素通过冒泡的形式绑定事件</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.bindEvent();</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.callback = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">          <span class="comment">// 该方法需要在每次实例化的时候都执行一次，用于实时改变content的内容</span></span></span><br><span class="line"><span class="javascript">          <span class="function"><span class="title">setContent</span>(<span class="params">&#123; title, content, close = <span class="literal">true</span>, footer = <span class="literal">true</span> &#125;</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.ele.innerHTML = <span class="string">`</span></span></span><br><span class="line"><span class="javascript">              &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;header&quot;</span>&gt;</span></span><br><span class="line"><span class="handlebars"><span class="xml">                <span class="tag">&lt;<span class="name">div</span>&gt;</span>$&#123;title&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span><br><span class="line"><span class="javascript">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;close&quot;</span> style=<span class="string">&quot;$&#123;</span></span></span><br><span class="line"><span class="javascript">                  close ? <span class="string">&quot;display:block&quot;</span> : <span class="string">&quot;display:none&quot;</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                &#125;&quot;&gt;叉<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span><br><span class="line">              $&#123;content&#125;</span><br><span class="line"><span class="javascript">              &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;footer&quot;</span> style=<span class="string">&quot;$&#123;</span></span></span><br><span class="line"><span class="javascript">                footer ? <span class="string">&quot;display:flex&quot;</span> : <span class="string">&quot;display:none&quot;</span></span></span><br><span class="line">              &#125;&quot;&gt;</span><br><span class="line"><span class="handlebars"><span class="xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;ok&quot;</span>&gt;</span>确定<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;cancel&quot;</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span>`;</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.ele.style.display = <span class="string">&quot;flex&quot;</span>;</span></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">          <span class="comment">// 绑定事件，该方法只需要在实例化的时候执行一次，之后不需要再执行</span></span></span><br><span class="line"><span class="javascript">          <span class="function"><span class="title">bindEvent</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.ele.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">              e = e || <span class="built_in">window</span>.event;</span></span><br><span class="line"><span class="javascript">              <span class="keyword">const</span> target = e.target || e.srcElement;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">              <span class="keyword">if</span> (target.className === <span class="string">&quot;close&quot;</span>) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.ele.style.display = <span class="string">&quot;none&quot;</span>;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.callback(<span class="literal">false</span>);</span></span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">              <span class="keyword">if</span> (target.className === <span class="string">&quot;cancel&quot;</span>) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.ele.style.display = <span class="string">&quot;none&quot;</span>;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.callback(<span class="literal">false</span>);</span></span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">              <span class="keyword">if</span> (target.className === <span class="string">&quot;ok&quot;</span>) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.ele.style.display = <span class="string">&quot;none&quot;</span>;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.callback(<span class="literal">true</span>);</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">          <span class="comment">// 设置弹窗样式</span></span></span><br><span class="line"><span class="javascript">          <span class="function"><span class="title">setStyle</span>(<span class="params">&#123; bgColor &#125;</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.ele.querySelector(<span class="string">&quot;.header&quot;</span>).style.backgroundColor = bgColor;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">// 使用单例模式</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">content, cb</span>) </span>&#123;</span></span><br><span class="line">          if (!instance) &#123;</span><br><span class="line"><span class="javascript">            instance = <span class="keyword">new</span> CreateModal();</span></span><br><span class="line">          &#125;</span><br><span class="line"><span class="javascript">          <span class="comment">// 每次根据传入的内容改变content的内容</span></span></span><br><span class="line">          instance.setContent(content);</span><br><span class="line"><span class="javascript">          <span class="comment">// 为实例绑定回调，之所以需要写一个空的函数，是为了防止不传cb时页面报错</span></span></span><br><span class="line"><span class="javascript">          instance.callback = cb || <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span></span><br><span class="line">          instance.setStyle(content);</span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> instance;</span></span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;)();</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> showModal = <span class="built_in">document</span>.querySelector(<span class="string">&quot;.showModal&quot;</span>);</span></span><br><span class="line"><span class="javascript">      showModal.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="handlebars"><span class="xml">        const content = `<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height:300px&quot;</span>&gt;</span>使用单例模式实现弹出层<span class="tag">&lt;/<span class="name">div</span>&gt;</span>`;</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> modal1 = Modal(</span></span><br><span class="line"><span class="javascript">          &#123; <span class="attr">title</span>: <span class="string">&quot;单例模式&quot;</span>, content, <span class="attr">bgColor</span>: <span class="string">&quot;#ccc&quot;</span> &#125;,</span></span><br><span class="line">          (res) =&gt; &#123;</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(res, <span class="string">&quot;callback&quot;</span>);</span></span><br><span class="line">          &#125;</span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h4><p>1、观察者模式：监控一个对象的状态，一旦该对象的状态发生变化，马上触发观察者对应的事件。</p>
<ul>
<li><p>被观察者提供维护观察者的一系列方法。</p>
</li>
<li><p>观察者提供更新接口。</p>
</li>
<li><p>观察者把自己注册到被观察者中。</p>
</li>
<li><p>在被观察者发生变化的时候，调用观察者的方法。</p>
</li>
</ul>
<p>2、观察者需要具备的属性及方法：</p>
<ul>
<li><p>必须要有一个身份证明，如：观察者的名称。</p>
</li>
<li><p>需要有一个事件，当被观察者状态发生改变时，能触发该事件。</p>
</li>
</ul>
<p>3、被观察者需要具备的属性及方法：</p>
<ul>
<li><p>需要有属性，表明自己的状态。</p>
</li>
<li><p>需要有一个数组，用于记录都有哪些观察者观察自己。</p>
</li>
<li><p>需要有一个设置属性的方法。</p>
</li>
<li><p>需要有一个获取属性的方法。</p>
</li>
<li><p>需要有一个添加观察者的方法。</p>
</li>
<li><p>需要有一个删除观察者的方法。</p>
</li>
<li><p>可以有一个删除所有观察者的方法。</p>
</li>
</ul>
<p>4、具体实现方式如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 观察者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name, fn = () =&gt; &#123;&#125;</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.fn = fn;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 被观察者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      name: state.name || <span class="string">&quot;&quot;</span>,</span><br><span class="line">      action: state.action || <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">this</span>.observers = [];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置状态</span></span><br><span class="line">  <span class="function"><span class="title">setState</span>(<span class="params">val</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.state = &#123; ...this.state, ...val &#125;;</span><br><span class="line">    <span class="built_in">this</span>.observers.forEach(<span class="function">(<span class="params">i</span>) =&gt;</span> &#123;</span><br><span class="line">      i.fn(val);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取状态</span></span><br><span class="line">  <span class="function"><span class="title">getState</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.state;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 添加观察者</span></span><br><span class="line">  <span class="function"><span class="title">addObserver</span>(<span class="params">obs</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.observers.includes(obs)) &#123;</span><br><span class="line">      <span class="built_in">this</span>.observers.push(obs);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除观察者</span></span><br><span class="line">  <span class="function"><span class="title">delObserver</span>(<span class="params">obs</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.observers.includes(obs)) &#123;</span><br><span class="line">      <span class="built_in">this</span>.observers = <span class="built_in">this</span>.observers.filter(<span class="function">(<span class="params">i</span>) =&gt;</span> i !== obs);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 清除所有观察者</span></span><br><span class="line">  <span class="function"><span class="title">delAll</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.observers = [];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> snsn = <span class="keyword">new</span> Observer(<span class="string">&quot;snsn&quot;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`嘻嘻！snsn发现<span class="subst">$&#123;data.name || <span class="string">&quot;你&quot;</span>&#125;</span><span class="subst">$&#123;data.action || <span class="string">&quot;&quot;</span>&#125;</span>了`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> hmhm = <span class="keyword">new</span> Observer(<span class="string">&quot;hmhm&quot;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`哈哈！hmhm发现<span class="subst">$&#123;data.name || <span class="string">&quot;你&quot;</span>&#125;</span><span class="subst">$&#123;data.action || <span class="string">&quot;&quot;</span>&#125;</span>了`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sub1 = <span class="keyword">new</span> Subject(&#123; <span class="attr">name</span>: <span class="string">&quot;dnhyxc&quot;</span>, <span class="attr">action</span>: <span class="string">&quot;code&quot;</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> sub2 = <span class="keyword">new</span> Subject(&#123; <span class="attr">action</span>: <span class="string">&quot;code&quot;</span> &#125;);</span><br><span class="line">sub1.addObserver(snsn);</span><br><span class="line">sub1.addObserver(hmhm);</span><br><span class="line">sub1.setState(&#123; <span class="attr">action</span>: <span class="string">&quot;看电影&quot;</span> &#125;);</span><br><span class="line">sub1.setState(&#123; <span class="attr">name</span>: <span class="string">&quot;听音乐的dnhyxc&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line">sub2.addObserver(snsn);</span><br><span class="line">sub2.addObserver(hmhm);</span><br><span class="line">sub2.setState(&#123; <span class="attr">action</span>: <span class="string">&quot;听音乐&quot;</span> &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(sub1);</span><br><span class="line"><span class="built_in">console</span>.log(sub2);</span><br><span class="line">sub2.delObserver(hmhm);</span><br><span class="line">sub2.setState(&#123; <span class="attr">action</span>: <span class="string">&quot;听音乐&quot;</span> &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(sub2);</span><br><span class="line"></span><br><span class="line">sub1.delAll();</span><br><span class="line">sub1.setState(&#123; <span class="attr">action</span>: <span class="string">&quot;发现不了了吧&quot;</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> res = sub1.getState();</span><br><span class="line"><span class="built_in">console</span>.log(res);</span><br><span class="line"><span class="built_in">console</span>.log(sub1);</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>设计模式</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>DvaStructure</title>
    <url>/2020/07/09/dvaStructure/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><h4 id="读完本文您将了解以下几点"><a href="#读完本文您将了解以下几点" class="headerlink" title="读完本文您将了解以下几点"></a>读完本文您将了解以下几点</h4><p>1，如何配置一个基于 Dva + antd + ts + eslint 的项目。</p>
<p>2，webpack 是如何打包 js、jsx、ts、tsx、css、less、img、svg 等资源。以及常用的一些 plugins 的配置等。</p>
<p>3，TypeStript 的 tsconfig.json 是如何配置的。</p>
<p>4，如何处理 antd 按需加载。</p>
<p>5，eslint 是如何配置的。</p>
<h3 id="Dva-配置"><a href="#Dva-配置" class="headerlink" title="Dva 配置"></a>Dva 配置</h3><h4 id="安装-Dva"><a href="#安装-Dva" class="headerlink" title="安装 Dva"></a>安装 Dva</h4><p>1，全局安装 dva-cli：</p>
<a id="more"></a>

<figure class="highlight"><table><tr><td class="code"><pre><span class="line">npm install dva-cli -g</span><br></pre></td></tr></table></figure>
<p>2，初始化 dva 项目：</p>
<ul>
<li><p>安装方式一：dva new myapp。</p>
</li>
<li><p>安装方式二：在创建好的项目文件夹中运行 dva init。</p>
</li>
</ul>
<h3 id="安装-webpack"><a href="#安装-webpack" class="headerlink" title="安装 webpack"></a>安装 webpack</h3><h4 id="安装-webpack-webpack-cli-webpack-dev-server"><a href="#安装-webpack-webpack-cli-webpack-dev-server" class="headerlink" title="安装 webpack webpack-cli webpack-dev-server"></a>安装 webpack webpack-cli webpack-dev-server</h4><blockquote>
<p>注意：webpack webpack-cli 下载的版本需要与全局的版本保持一致，防止出现不必要的错误，webpack-dev-server 版本不能下太高，否则可能出现兼容性错误。</p>
</blockquote>
<p>1，我本地 webpack webpack-cli 分别为：<a href="mailto:&#x77;&#101;&#x62;&#x70;&#97;&#x63;&#107;&#64;&#x34;&#46;&#x34;&#52;&#46;&#50;">&#x77;&#101;&#x62;&#x70;&#97;&#x63;&#107;&#64;&#x34;&#46;&#x34;&#52;&#46;&#50;</a>，webpack-cli@4.4.0。webpack-dev-server 为：<a href="mailto:&#119;&#101;&#x62;&#x70;&#97;&#99;&#x6b;&#x2d;&#100;&#x65;&#118;&#45;&#x73;&#x65;&#x72;&#118;&#x65;&#x72;&#x40;&#51;&#x2e;&#x31;&#49;&#46;&#x32;">&#119;&#101;&#x62;&#x70;&#97;&#99;&#x6b;&#x2d;&#100;&#x65;&#118;&#45;&#x73;&#x65;&#x72;&#118;&#x65;&#x72;&#x40;&#51;&#x2e;&#x31;&#49;&#46;&#x32;</a></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm i webpack@<span class="number">4.44</span><span class="number">.2</span> webpack-cli@<span class="number">4.4</span><span class="number">.0</span> webpack-dev-server@<span class="number">3.11</span><span class="number">.2</span> -D</span><br></pre></td></tr></table></figure>
<h3 id="配置-webpack-config-js-文件"><a href="#配置-webpack-config-js-文件" class="headerlink" title="配置 webpack.config.js 文件"></a>配置 webpack.config.js 文件</h3><blockquote>
<p>在项目根目录中创建 webpack.config.js 文件。</p>
</blockquote>
<h4 id="配置入口及输出路径"><a href="#配置入口及输出路径" class="headerlink" title="配置入口及输出路径"></a>配置入口及输出路径</h4><p>1，相关配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">entry: <span class="string">&quot;./src/index.ts&quot;</span>,</span><br><span class="line">output: &#123;</span><br><span class="line">  filename: <span class="string">&quot;bundle.js&quot;</span>,</span><br><span class="line">  path: path.resolve(__dirname, <span class="string">&quot;build&quot;</span>),</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h4 id="打包样式资源"><a href="#打包样式资源" class="headerlink" title="打包样式资源"></a>打包样式资源</h4><p>1，打包样式资源需要使用的 loader（以下 loader 具体的用处可自行百度）：</p>
<ul>
<li>style-loader、css-loader、less、less-loader、postcss-normalize。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm i style-loader css-loader less less-loader postcss-normalize -D</span><br></pre></td></tr></table></figure>
<p>2，如果是移动端，可以配置 px2rem-loader 将 px 自动转为 rem。</p>
<ul>
<li>安装 px2rem-loader 的同时还需安装 lib-flexible。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm i px2rem-loader lib-flexible -D</span><br></pre></td></tr></table></figure>
<ul>
<li>安装完毕以后需要在项目入口 js/ts 文件中引入 lib-flexible。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;lib-flexible&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>3，具体配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.(css|less)$/</span>,</span><br><span class="line">      use: [</span><br><span class="line">        devMode ? MiniCssExtractPlugin.loader : <span class="string">&quot;style-loader&quot;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            modules: &#123;</span><br><span class="line">              mode: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">              localIdentName: <span class="string">&quot;[name]__[local]&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            importLoaders: <span class="number">1</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">&quot;less-loader&quot;</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            lessOptions: &#123;</span><br><span class="line">              <span class="comment">// modifyVars: &#123;</span></span><br><span class="line">              <span class="comment">//   &#x27;primary-color&#x27;: &#x27;green&#x27;,</span></span><br><span class="line">              <span class="comment">//   &#x27;menu-item-active-bg&#x27;: &#x27;green&#x27;,</span></span><br><span class="line">              <span class="comment">// &#125;,</span></span><br><span class="line">              javascriptEnabled: <span class="literal">true</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">&quot;px2rem-loader&quot;</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            importLoaders: <span class="number">1</span>,</span><br><span class="line">            remUnit: <span class="number">37.5</span>,</span><br><span class="line">            min: <span class="number">2</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            postcssOptions: &#123;</span><br><span class="line">              ident: <span class="string">&quot;postcss&quot;</span>,</span><br><span class="line">              plugins: [</span><br><span class="line">                [</span><br><span class="line">                  <span class="string">&quot;postcss-preset-env&quot;</span>,</span><br><span class="line">                  &#123;</span><br><span class="line">                    autoprefixer: &#123;</span><br><span class="line">                      <span class="comment">// browsers: [</span></span><br><span class="line">                      <span class="comment">//   &#x27;&gt;1%&#x27;,</span></span><br><span class="line">                      <span class="comment">//   &#x27;last 4 versions&#x27;,</span></span><br><span class="line">                      <span class="comment">//   &#x27;Firefox ESR&#x27;,</span></span><br><span class="line">                      <span class="comment">//   &#x27;not ie &lt; 9&#x27;,</span></span><br><span class="line">                      <span class="comment">// ],</span></span><br><span class="line">                      flexbox: <span class="string">&quot;no-2009&quot;</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    stage: <span class="number">3</span>,</span><br><span class="line">                  &#125;,</span><br><span class="line">                ],</span><br><span class="line">                postcssNormalize(),</span><br><span class="line">              ],</span><br><span class="line">            &#125;,</span><br><span class="line">            sourceMap: <span class="literal">false</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="打包-js-jsx-ts-tsx-等资源"><a href="#打包-js-jsx-ts-tsx-等资源" class="headerlink" title="打包 js/jsx/ts/tsx 等资源"></a>打包 js/jsx/ts/tsx 等资源</h4><p>1，打包 js/jsx/ts/tsx 等资源需要使用的 loader（以下 loader 具体的用处可自行百度）：</p>
<ul>
<li>@babel/core、@babel/preset-env、babel-loader、@babel/preset-react、@babel/plugin-transform-runtime、ts-loader、typescript</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm i @babel/core @babel/preset-env babel-loader @babel/preset-react @babel/plugin-transform-runtime ts-loader typescript -D</span><br></pre></td></tr></table></figure>
<p>2，具体配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.(js|jsx|ts|tsx)$/</span>,</span><br><span class="line">      use: [</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            presets: [</span><br><span class="line">              [</span><br><span class="line">                <span class="string">&quot;@babel/preset-env&quot;</span>,</span><br><span class="line">                &#123;</span><br><span class="line">                  modules: <span class="literal">false</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">              ],</span><br><span class="line">              <span class="string">&quot;@babel/preset-react&quot;</span>,</span><br><span class="line">            ],</span><br><span class="line">            plugins: [</span><br><span class="line">              [</span><br><span class="line">                <span class="string">&quot;@babel/plugin-transform-runtime&quot;</span>,</span><br><span class="line">                &#123;</span><br><span class="line">                  useESModules: <span class="literal">true</span>,</span><br><span class="line">                  corejs: <span class="number">3</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">              ],</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">&quot;ts-loader&quot;</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            happyPackMode: <span class="literal">true</span>,</span><br><span class="line">            transpileOnly: <span class="literal">true</span>,</span><br><span class="line">            compilerOptions: &#123;</span><br><span class="line">              noEmit: <span class="literal">false</span>,</span><br><span class="line">              <span class="built_in">module</span>: <span class="string">&quot;esnext&quot;</span>,</span><br><span class="line">              target: devMode ? <span class="string">&quot;es2017&quot;</span> : <span class="string">&quot;es5&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">      exclude: [<span class="regexp">/node_modules/</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="打包图片资源"><a href="#打包图片资源" class="headerlink" title="打包图片资源"></a>打包图片资源</h4><p>1，打包图片资源需要使用的 loader（以下 loader 具体的用处可自行百度）：</p>
<ul>
<li>url-loader、html-loader、file-loader</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm i url-loader html-loader file-loader -D</span><br></pre></td></tr></table></figure>
<p>2，具体配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.(mp4|png|jpg|jpeg|png|svg|cur|gif|webp|webm|otf)$/</span>,</span><br><span class="line">      use: [</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">&quot;url-loader&quot;</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            limit: <span class="number">8192</span>,</span><br><span class="line">            name: <span class="string">&quot;static/[name].[hash:11].[ext]&quot;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">      exclude: <span class="regexp">/assets\/icons\/|components\/Base\/Icon\/icons\//</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.html$/</span>,</span><br><span class="line">      loader: <span class="string">&quot;html-loader&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="打包-svg-资源"><a href="#打包-svg-资源" class="headerlink" title="打包 svg 资源"></a>打包 svg 资源</h4><p>1，打包 svg 资源需要使用的 loader（以下 loader 具体的用处可自行百度）：</p>
<ul>
<li>svg-sprite-loader</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm i svg-sprite-loader -D</span><br></pre></td></tr></table></figure>
<p>2，具体配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.svg$/</span>,</span><br><span class="line">      include: <span class="regexp">/assets\/icons\/|components\/Base\/Icon\/icons\//</span>,</span><br><span class="line">      use: [</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">&quot;svg-sprite-loader&quot;</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            symbolId: <span class="string">&quot;icon-[name]&quot;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="plugins-配置"><a href="#plugins-配置" class="headerlink" title="plugins 配置"></a>plugins 配置</h4><p>1，所需插件：html-webpack-plugin、mini-css-extract-plugin、optimize-css-assets-webpack-plugin</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm i html-webpack-plugin mini-css-extract-plugin optimize-css-assets-webpack-plugin -D</span><br></pre></td></tr></table></figure>
<p>2，具体配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">    filename: <span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">    template: path.resolve(__dirname, <span class="string">&quot;./src/index.ejs&quot;</span>),</span><br><span class="line">    minify: &#123;</span><br><span class="line">      removeComments: <span class="literal">true</span>, <span class="comment">// 移除注释</span></span><br><span class="line">      collapseWhitespace: <span class="literal">true</span>, <span class="comment">// 移除空格</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">    filename: <span class="string">&quot;[name].css&quot;</span>,</span><br><span class="line">    chunkFilename: <span class="string">&quot;[name].css&quot;</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="keyword">new</span> OptimizeCSSAssetsPlugin(),</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<h4 id="配置-dll"><a href="#配置-dll" class="headerlink" title="配置 dll"></a>配置 dll</h4><p>1，在根目录下创建 webpack.config.dll.js 文件。</p>
<p>2，dll 可以将不常更新的公共包（antd，react…）打包到一起，避免每次 run dev / run build 的时候重复编译。</p>
<p>3，当公共包需要更新时，比如升级版本/添加新的公共包：</p>
<ul>
<li><p>使用 npm run dll 编译公共包。</p>
</li>
<li><p>更新 index.ejs 的 vendor 版本号，和项目一起发布。</p>
</li>
</ul>
<p>4，具体 dll 配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将不常更新的公共包打包到一起，避免每次 run dev / run build 的时候重复编译。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 当公共包需要更新时，比如升级版本/添加新的公共包：</span></span><br><span class="line"><span class="comment"> * 1. npm run dll # 编译公共包</span></span><br><span class="line"><span class="comment"> * 2. npm run dll-ship # 发布公共包（cship 在 npm run 下运行有问题，请复制 dll-ship 内容手动运行）</span></span><br><span class="line"><span class="comment"> * 3. 更新 index.ejs 的 vendor 版本号，和项目一起发布。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 注意：</span></span><br><span class="line"><span class="comment"> * 1. 如果需要更新公共包，切记公共包和项目包需要一起发布，不可二缺一！</span></span><br><span class="line"><span class="comment"> * 2. 开发和线上分别使用一份 vendor，每个 vendor 和 manifest 是对应的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">env, argv</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> isDev = argv.mode === <span class="string">&quot;development&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> name = isDev ? <span class="string">&quot;vendor-[hash].dev&quot;</span> : <span class="string">&quot;vendor-[hash]&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    context: __dirname,</span><br><span class="line">    entry: [</span><br><span class="line">      <span class="string">&quot;react&quot;</span>,</span><br><span class="line">      <span class="string">&quot;react-dom&quot;</span>,</span><br><span class="line">      <span class="string">&quot;antd&quot;</span>,</span><br><span class="line">      <span class="string">&quot;antd/dist/antd.min.css&quot;</span>,</span><br><span class="line">      <span class="string">&quot;@babel/polyfill&quot;</span>,</span><br><span class="line">      <span class="string">&quot;react-router-dom&quot;</span>,</span><br><span class="line">    ],</span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: <span class="string">`<span class="subst">$&#123;name&#125;</span>.js`</span>,</span><br><span class="line">      path: path.resolve(__dirname, <span class="string">&quot;./vendor/dist/&quot;</span>),</span><br><span class="line">      library: <span class="string">&quot;vendor&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        filename: <span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">        template: path.resolve(__dirname, <span class="string">&quot;./src/index.ejs&quot;</span>),</span><br><span class="line">        chunksSortMode: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> webpack.IgnorePlugin(<span class="regexp">/^\.\/locale$/</span>, <span class="regexp">/moment$/</span>),</span><br><span class="line">      <span class="keyword">new</span> webpack.DllPlugin(&#123;</span><br><span class="line">        name: <span class="string">&quot;vendor&quot;</span>,</span><br><span class="line">        path: path.resolve(</span><br><span class="line">          __dirname,</span><br><span class="line">          isDev</span><br><span class="line">            ? <span class="string">&quot;./vendor/vendor-manifest-dev.json&quot;</span></span><br><span class="line">            : <span class="string">&quot;./vendor/vendor-manifest.json&quot;</span></span><br><span class="line">        ),</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">        filename: <span class="string">`<span class="subst">$&#123;name&#125;</span>.css`</span>,</span><br><span class="line">        chunkFilename: <span class="string">&quot;[id].css&quot;</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">    ],</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">          use: [MiniCssExtractPlugin.loader, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">    devtool: <span class="string">&quot;source-map&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>说明</strong>：由于 antd 样式资源使用 dll 进行了打包，因此在项目中即可使用按需加载 antd 的样式了，无需在其他地方在进行配置。</p>
</blockquote>
<h4 id="配置-devServer"><a href="#配置-devServer" class="headerlink" title="配置 devServer"></a>配置 devServer</h4><p>1，在 devServer 具体配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">  port: <span class="number">8000</span>,</span><br><span class="line">  host: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  <span class="comment">// open: true,</span></span><br><span class="line">  disableHostCheck: <span class="literal">true</span>,</span><br><span class="line">  historyApiFallback: <span class="literal">true</span>,</span><br><span class="line">  proxy: &#123;</span><br><span class="line">    <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">      target: <span class="string">&#x27;http://test.xxx.xxx.com&#x27;</span>,</span><br><span class="line">      changeOrigin: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">before</span>(<span class="params">app</span>)</span> &#123;</span><br><span class="line">    apiMocker(app, path.resolve(__dirname, <span class="string">&#x27;./mock/mock.js&#x27;</span>));</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 配置启动时在终端需要显示及隐藏的提示信息</span></span><br><span class="line">  stats: &#123;</span><br><span class="line">    colors: <span class="literal">true</span>,</span><br><span class="line">    hash: <span class="literal">false</span>, <span class="comment">// 编译使用的 hash</span></span><br><span class="line">    version: <span class="literal">false</span>, <span class="comment">// 用来编译的 webpack 的版本</span></span><br><span class="line">    timings: <span class="literal">true</span>, <span class="comment">// 编译耗时 (ms)</span></span><br><span class="line">    assets: <span class="literal">false</span>, <span class="comment">// 是否开启assets提示</span></span><br><span class="line">    chunks: <span class="literal">false</span>,</span><br><span class="line">    modules: <span class="literal">false</span>, <span class="comment">// 是否开启modules提示</span></span><br><span class="line">    reasons: <span class="literal">false</span>,</span><br><span class="line">    children: <span class="literal">false</span>,</span><br><span class="line">    source: <span class="literal">false</span>,</span><br><span class="line">    errors: <span class="literal">true</span>, <span class="comment">// 处理这个模块发现的错误的数量</span></span><br><span class="line">    errorDetails: <span class="literal">false</span>,</span><br><span class="line">    warnings: <span class="literal">true</span>,</span><br><span class="line">    publicPath: <span class="literal">false</span>,</span><br><span class="line">    warningsFilter: <span class="regexp">/export .* was not found in/</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="配置-stats"><a href="#配置-stats" class="headerlink" title="配置 stats"></a>配置 stats</h4><blockquote>
<p>在与 plugins 或 devServer 同层次下添加 stats 配置。</p>
</blockquote>
<p>1，该配置主要用于设置在项目 build 打包时在终端的提示信息。</p>
<p>2，具体配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">devServer:[</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">],</span><br><span class="line"><span class="comment">// 设置打包构建时终端中的提示信息</span></span><br><span class="line">stats: &#123;</span><br><span class="line">  hash: <span class="literal">false</span>, <span class="comment">// 编译使用的 hash</span></span><br><span class="line">  timings: <span class="literal">true</span>,  <span class="comment">// 告知 stats 添加时间信息</span></span><br><span class="line">  modules: <span class="literal">false</span>, <span class="comment">// 告知 stats 是否添加关于构建模块的信息</span></span><br><span class="line">  chunks: <span class="literal">false</span>,  <span class="comment">// 告知 stats 是否添加关于 chunk 的信息</span></span><br><span class="line">  version: <span class="literal">false</span>, <span class="comment">// 是否展示用来编译的 webpack 的版本</span></span><br><span class="line">  assets: <span class="literal">false</span>,  <span class="comment">// 是否关闭展示资源信息</span></span><br><span class="line">  children: <span class="literal">false</span>,  <span class="comment">// 是否不添加关于子模块的信息</span></span><br><span class="line">  warningsFilter: <span class="function"><span class="params">warning</span> =&gt;</span> <span class="regexp">/Conflicting order between/gm</span>.test(warning), <span class="comment">// 排除掉匹配的告警信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="配置-performance"><a href="#配置-performance" class="headerlink" title="配置 performance"></a>配置 performance</h4><blockquote>
<p>在与 plugins 或 devServer 同层次下添加 performance 配置。</p>
</blockquote>
<p>1，该配置主要用来控制 webpack 如何通知「资源(asset)和入口起点超过指定文件限制」，如果不配置该属性，如果一个资源超过 250kb，webpack 会对此输出一个警告（报黄）来通知你。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">devServer:[</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">],</span><br><span class="line"><span class="comment">// 配置如何展示性能提示。例如，如果一个资源超过 250kb，webpack 会对此输出一个警告来通知你。</span></span><br><span class="line">performance: &#123;</span><br><span class="line">  hints: <span class="string">&quot;warning&quot;</span>, <span class="comment">// 不展示警告或错误提示。</span></span><br><span class="line">  maxAssetSize: <span class="number">30000000</span>, <span class="comment">// 整数类型（以字节为单位）</span></span><br><span class="line">  maxEntrypointSize: <span class="number">50000000</span>, <span class="comment">// 整数类型（以字节为单位）</span></span><br><span class="line">  assetFilter: <span class="function"><span class="keyword">function</span> (<span class="params">assetFilename</span>) </span>&#123; <span class="comment">// 此属性允许 webpack 控制用于计算性能提示的文件</span></span><br><span class="line">    <span class="comment">// 提供资源文件名的断言函数</span></span><br><span class="line">    <span class="keyword">return</span> assetFilename.endsWith(<span class="string">&#x27;.css&#x27;</span>) || assetFilename.endsWith(<span class="string">&#x27;.js&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="更改-package-json"><a href="#更改-package-json" class="headerlink" title="更改 package.json"></a>更改 package.json</h4><p>1，具体更改如下：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;start&quot;: &quot;webpack serve --mode=development --config=webpack.config.js --hot --inline&quot;,</span><br><span class="line">&quot;build&quot;: &quot;npm i &amp;&amp; webpack --mode=production --progress&quot;,</span><br></pre></td></tr></table></figure>
<h3 id="配置-typescript"><a href="#配置-typescript" class="headerlink" title="配置 typescript"></a>配置 typescript</h3><h4 id="配置-tsconfig-json"><a href="#配置-tsconfig-json" class="headerlink" title="配置 tsconfig.json"></a>配置 tsconfig.json</h4><p>1，文件具体配置如下：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;es5&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;module&quot;</span>: <span class="string">&quot;commonjs&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;lib&quot;</span>: [<span class="string">&quot;es6&quot;</span>, <span class="string">&quot;es2016&quot;</span>, <span class="string">&quot;es2017&quot;</span>, <span class="string">&quot;es2018&quot;</span>, <span class="string">&quot;esnext&quot;</span>, <span class="string">&quot;dom&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;allowJs&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;skipLibCheck&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;jsx&quot;</span>: <span class="string">&quot;react&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;sourceMap&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;noEmit&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;importHelpers&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;strict&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;strictNullChecks&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;noUnusedLocals&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;moduleResolution&quot;</span>: <span class="string">&quot;node&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;baseUrl&quot;</span>: <span class="string">&quot;./&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;paths&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;@/*&quot;</span>: [<span class="string">&quot;src/*&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;$/*&quot;</span>: [<span class="string">&quot;typings/*&quot;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;allowSyntheticDefaultImports&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;esModuleInterop&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;experimentalDecorators&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;include&quot;</span>: [<span class="string">&quot;src&quot;</span>, <span class="string">&quot;typings&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;exclude&quot;</span>: [<span class="string">&quot;build&quot;</span>, <span class="string">&quot;vendor&quot;</span>, <span class="string">&quot;**/*/_*&quot;</span>, <span class="string">&quot;src/components/VideoClipper&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="增加-typings-文件配置"><a href="#增加-typings-文件配置" class="headerlink" title="增加 typings 文件配置"></a>增加 typings 文件配置</h4><blockquote>
<p>说明：由于当使用模块化引入 less 样式资源文件时，防止报找不到模块的错误，因此需要全局导出相应的资源文件。</p>
</blockquote>
<p>1，在 typings 文件夹中增加 index.d.ts 文件，相关配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">declare <span class="built_in">module</span> <span class="string">&#x27;*.svg&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> url: string;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> url;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">declare <span class="built_in">module</span> <span class="string">&#x27;*.png&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> url: string;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> url;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">declare <span class="built_in">module</span> <span class="string">&#x27;*.webp&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> url: string;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> url;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">declare <span class="built_in">module</span> <span class="string">&#x27;*.webm&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> url: string;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> url;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">declare <span class="built_in">module</span> <span class="string">&#x27;*.mp4&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> url: string;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> url;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">declare <span class="built_in">module</span> <span class="string">&#x27;*.jpg&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> url: string;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> url;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 考虑使用 typed-css-modules 对 less 自动生成 d.ts （主要是需要开进程 watch 编译，比较麻烦）</span></span><br><span class="line"><span class="comment"> * 或者调研 TypeScript 扩展</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">declare <span class="built_in">module</span> <span class="string">&#x27;*.less&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> styles: Record&lt;string, string&gt;;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> styles;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">declare <span class="built_in">module</span> <span class="string">&#x27;dva-loading&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">createLoading</span>(<span class="params">options: any</span>): <span class="title">any</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">declare <span class="built_in">module</span> <span class="string">&#x27;*.woff&#x27;</span>;</span><br><span class="line">declare <span class="built_in">module</span> <span class="string">&#x27;*.woff2&#x27;</span>;</span><br><span class="line">declare <span class="built_in">module</span> <span class="string">&#x27;*.otf&#x27;</span>;</span><br><span class="line"></span><br><span class="line">declare <span class="built_in">module</span> <span class="string">&#x27;*.json&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> value: any;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">declare interface Window &#123;</span><br><span class="line">  liangzhu_data_info: any;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">declare <span class="built_in">module</span> <span class="string">&#x27;echarts/map/json/*.json&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> json: any;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> json;</span><br><span class="line">&#125;</span><br><span class="line">declare <span class="built_in">module</span> <span class="string">&#x27;react-lines-ellipsis&#x27;</span> &#123;</span><br><span class="line">  <span class="comment">// type definitions goes here</span></span><br><span class="line">  <span class="keyword">const</span> LinesEllipsis: any;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> LinesEllipsis;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">declare <span class="built_in">module</span> <span class="string">&#x27;react-lines-ellipsis/lib/responsiveHOC&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> responsiveHOC: any;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> responsiveHOC;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">declare <span class="built_in">module</span> <span class="string">&#x27;react-useanimations&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> UseAnimations: any;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> UseAnimations;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface HTMLVideoElement &#123;</span><br><span class="line">  __hls__?: Hls;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface Window &#123;</span><br><span class="line">  HLS_JS_DEBUG?: boolean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">declare <span class="built_in">module</span> <span class="string">&#x27;china-division/dist/*.json&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> json: any;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> json;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">declare <span class="built_in">module</span> <span class="string">&#x27;braft-utils&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> ContentUtils: any;</span><br><span class="line">  <span class="keyword">export</span> &#123; ContentUtils &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">declare <span class="built_in">module</span> <span class="string">&#x27;rc-form&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> createForm: any;</span><br><span class="line">  <span class="keyword">export</span> &#123; createForm &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="配置-eslint"><a href="#配置-eslint" class="headerlink" title="配置 eslint"></a>配置 eslint</h3><h4 id="eslint-所需插件"><a href="#eslint-所需插件" class="headerlink" title="eslint 所需插件"></a>eslint 所需插件</h4><p>1，插件需要注意版本问题，否则会出现莫名错误，所需插件及版本如下：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;@typescript-eslint/eslint-plugin&quot;: &quot;~2.6.1&quot;,</span><br><span class="line">&quot;@typescript-eslint/parser&quot;: &quot;~2.6.1&quot;,</span><br><span class="line">&quot;babel-eslint&quot;: &quot;^8.2.3&quot;,</span><br><span class="line">&quot;eslint&quot;: &quot;^5.3.0&quot;,</span><br><span class="line">&quot;eslint-config-airbnb&quot;: &quot;^17.1.0&quot;,</span><br><span class="line">&quot;eslint-loader&quot;: &quot;~3.0.2&quot;,</span><br><span class="line">&quot;eslint-plugin-import&quot;: &quot;^2.17.3&quot;,</span><br><span class="line">&quot;eslint-plugin-jsx-a11y&quot;: &quot;^6.1.2&quot;,</span><br><span class="line">&quot;eslint-plugin-react&quot;: &quot;^7.16.0&quot;,</span><br><span class="line">&quot;eslint-plugin-react-ext&quot;: &quot;^0.1.0&quot;,</span><br><span class="line">&quot;eslint-plugin-react-hooks&quot;: &quot;^1.7.0&quot;,</span><br></pre></td></tr></table></figure>
<h4 id="创建-eslintrc-文件"><a href="#创建-eslintrc-文件" class="headerlink" title="创建 .eslintrc 文件"></a>创建 .eslintrc 文件</h4><p>1，该配置文件主要用于定义 eslint 的规则，具体配置如下：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Eslint (JavaScript 和 TypeScript)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 如果希望在编辑时能实时看到 eslint 效果，需要按照 vscode eslint 插件</span></span><br><span class="line"><span class="comment"> * 注：eslint 插件默认不会校验 TypeScript 文件，需要在设置中修改：</span></span><br><span class="line"><span class="comment"> * 将设置（JSON）的 &quot;eslint.validate&quot;: [ &quot;javascript&quot;, &quot;javascriptreact&quot;]</span></span><br><span class="line"><span class="comment"> * 后面加上 , &quot;typescript&quot;, &quot;typescriptreact&quot;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// TODO 目前 @typescript-eslint/parser 和 babel-eslint 对 jsx 的处理有一些差异，所以 js 还是维持原 parser</span></span><br><span class="line">  <span class="attr">&quot;parser&quot;</span>: <span class="string">&quot;babel-eslint&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;plugins&quot;</span>: [<span class="string">&quot;@typescript-eslint&quot;</span>, <span class="string">&quot;react-ext&quot;</span>, <span class="string">&quot;react-hooks&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;extends&quot;</span>: <span class="string">&quot;airbnb&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;env&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;browser&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;parserOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;ecmaFeatures&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;experimentalObjectRestSpread&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;react&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;pragma&quot;</span>: <span class="string">&quot;React&quot;</span>, <span class="comment">// Pragma to use, default to &quot;React&quot;</span></span><br><span class="line">      <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;detect&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;rules&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;linebreak-style&quot;</span>: [<span class="number">0</span>, <span class="string">&quot;erron&quot;</span>, <span class="string">&quot;windows&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;react-hooks/rules-of-hooks&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;react-hooks/exhaustive-deps&quot;</span>: <span class="string">&quot;warn&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;arrow-body-style&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;camelcase&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;error&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;properties&quot;</span>: <span class="string">&quot;never&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;allow&quot;</span>: [<span class="string">&quot;^UNSAFE_&quot;</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;consistent-return&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;generator-star-spacing&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;global-require&quot;</span>: [<span class="string">&quot;error&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;import/extensions&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;import/no-extraneous-dependencies&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;import/no-unresolved&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;import/prefer-default-export&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;import/no-cycle&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;jsx-a11y/no-static-element-interactions&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;no-bitwise&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;no-console&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;no-else-return&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;no-loop-func&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;no-nested-ternary&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;no-restricted-syntax&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;react/forbid-prop-types&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;react/jsx-filename-extension&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;react/jsx-no-bind&quot;</span>: [<span class="string">&quot;error&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;react/prefer-stateless-function&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;react/prop-types&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;react/no-unsafe&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;error&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;checkAliases&quot;</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;react/no-unused-state&quot;</span>: [<span class="string">&quot;warn&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;react-ext/no-unused-class-property&quot;</span>: <span class="string">&quot;warn&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;require-yield&quot;</span>: [<span class="number">1</span>],</span><br><span class="line">    <span class="attr">&quot;no-continue&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;no-mixed-operators&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;no-underscore-dangle&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;no-plusplus&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;no-unused-expressions&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;no-param-reassign&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;no-await-in-loop&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;no-alert&quot;</span>: [<span class="string">&quot;error&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;no-restricted-globals&quot;</span>: [<span class="string">&quot;error&quot;</span>, <span class="string">&quot;event&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;jsx-a11y/click-events-have-key-events&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;import/first&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;jsx-a11y/anchor-is-valid&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;react/require-default-props&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;arrow-parens&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;react/sort-comp&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;function-paren-newline&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;prefer-template&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;prefer-arrow-callback&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;error&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;allowNamedFunctions&quot;</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;jsx-a11y/media-has-caption&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;jsx-a11y/alt-text&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;jsx-a11y/anchor-has-content&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;jsx-a11y/no-noninteractive-element-interactions&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;jsx-a11y/label-has-for&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;jsx-a11y/label-has-associated-control&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;jsx-a11y/mouse-events-have-key-events&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;class-methods-use-this&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;react/destructuring-assignment&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;operator-linebreak&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;max-len&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;error&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;code&quot;</span>: <span class="number">160</span>,</span><br><span class="line">        <span class="attr">&quot;ignoreComments&quot;</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;react/button-has-type&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;react/no-access-state-in-setstate&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;react/jsx-no-target-blank&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;react/jsx-one-expression-per-line&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;react/no-danger&quot;</span>: <span class="string">&quot;off&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;overrides&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;files&quot;</span>: [<span class="string">&quot;**/*.ts&quot;</span>, <span class="string">&quot;**/*.tsx&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;parser&quot;</span>: <span class="string">&quot;@typescript-eslint/parser&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;parserOptions&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;project&quot;</span>: <span class="string">&quot;./tsconfig.json&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;rules&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;import/export&quot;</span>: [<span class="string">&quot;off&quot;</span>], <span class="comment">// 这一条不需要</span></span><br><span class="line">        <span class="comment">// 下面的这些需要禁用，然后启用 @typescript-eslint 下同名的</span></span><br><span class="line">        <span class="attr">&quot;no-unused-vars&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">        <span class="attr">&quot;no-useless-constructor&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">        <span class="attr">&quot;camelcase&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">        <span class="attr">&quot;indent&quot;</span>: [<span class="string">&quot;off&quot;</span>],</span><br><span class="line">        <span class="attr">&quot;no-undef&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;no-use-before-define&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;no-empty-function&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;@typescript-eslint/no-unused-vars&quot;</span>: [</span><br><span class="line">          <span class="string">&quot;warn&quot;</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;vars&quot;</span>: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;args&quot;</span>: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;ignoreRestSiblings&quot;</span>: <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">&quot;@typescript-eslint/no-useless-constructor&quot;</span>: [<span class="string">&quot;error&quot;</span>],</span><br><span class="line">        <span class="attr">&quot;@typescript-eslint/camelcase&quot;</span>: [</span><br><span class="line">          <span class="string">&quot;error&quot;</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;properties&quot;</span>: <span class="string">&quot;never&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;allow&quot;</span>: [<span class="string">&quot;^UNSAFE_&quot;</span>]</span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">&quot;@typescript-eslint/indent&quot;</span>: [<span class="string">&quot;error&quot;</span>, <span class="number">2</span>],</span><br><span class="line">        <span class="attr">&quot;@typescript-eslint/no-empty-function&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;@typescript-eslint/array-type&quot;</span>: [</span><br><span class="line">          <span class="string">&quot;error&quot;</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;default&quot;</span>: <span class="string">&quot;array-simple&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">&quot;@typescript-eslint/member-delimiter-style&quot;</span>: [<span class="string">&quot;error&quot;</span>],</span><br><span class="line">        <span class="attr">&quot;@typescript-eslint/type-annotation-spacing&quot;</span>: [<span class="string">&quot;error&quot;</span>],</span><br><span class="line">        <span class="attr">&quot;@typescript-eslint/prefer-for-of&quot;</span>: [<span class="string">&quot;error&quot;</span>],</span><br><span class="line">        <span class="attr">&quot;@typescript-eslint/no-this-alias&quot;</span>: [</span><br><span class="line">          <span class="string">&quot;warn&quot;</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;allowDestructuring&quot;</span>: <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">&quot;@typescript-eslint/prefer-string-starts-ends-with&quot;</span>: [<span class="string">&quot;error&quot;</span>],</span><br><span class="line">        <span class="attr">&quot;@typescript-eslint/prefer-includes&quot;</span>: [<span class="string">&quot;error&quot;</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="创建-eslintignore-文件"><a href="#创建-eslintignore-文件" class="headerlink" title="创建 .eslintignore 文件"></a>创建 .eslintignore 文件</h4><p>1，该文件主要用于告诉 eslint 检查时忽略的文件，具体配置如下：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">app/proxy*</span><br><span class="line">coverage</span><br><span class="line">dist</span><br><span class="line">build</span><br><span class="line">fntest</span><br><span class="line">mocks</span><br><span class="line">node_modules</span><br><span class="line">spm_modules</span><br><span class="line">test/fixtures</span><br><span class="line">src/components/VideoClipper</span><br><span class="line">*.config.js</span><br></pre></td></tr></table></figure>
<h4 id="更改-package-中-lint-命令"><a href="#更改-package-中-lint-命令" class="headerlink" title="更改 package 中 lint 命令"></a>更改 package 中 lint 命令</h4><p>1，具体修改如下：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;lint&quot;: &quot;eslint --fix --ext .js,.jsx,.ts,.tsx src -c .eslintrc&quot;</span><br></pre></td></tr></table></figure>
<h4 id="异常报错"><a href="#异常报错" class="headerlink" title="异常报错"></a>异常报错</h4><p>1，TypeError: cli.isValidationError is not a function at Command.cli.makeCommand。</p>
<ul>
<li>解决方式：升级 webpack-cli。</li>
</ul>
<p>2，TypeError: Cannot read property ‘tap’ of undefined at HtmlWebpackPlugin.apply。</p>
<ul>
<li>解决方式：将 html-webpack-plugin 版本问题导致，可将其降级成 4.5.1 版本。</li>
</ul>
<p>3，UnhandledPromiseRejectionWarning: TypeError: expecting a function but got [object Undefined]</p>
<ul>
<li>解决方式：由于没有安装 html-webpack-plugin，将其装上即可。</li>
</ul>
<p>4，TypeError: this.getOptions is not a function at Object.lessLoader。</p>
<ul>
<li>解决方式：该错误由于 less-loader 版本问题导致，可将其降级为：5.0.0 即可。</li>
</ul>
<p>5，Can’t resolve ‘@babel/runtime-corejs3/helpers/esm/classCallCheck’。</p>
<ul>
<li>解决方式：安装 @babel/runtime-corejs3 即可。</li>
</ul>
<p>6，Error: Failed to load plugin @typescript-eslint: Cannot find module ‘eslint-plugin-@typescript-eslint’。</p>
<ul>
<li>解决方式：该错误由于没有安装 eslint-loader 导致，安装即可。</li>
</ul>
<h3 id="详细配置及所需包名"><a href="#详细配置及所需包名" class="headerlink" title="详细配置及所需包名"></a>详细配置及所需包名</h3><h4 id="完整-webpack-配置"><a href="#完整-webpack-配置" class="headerlink" title="完整 webpack 配置"></a>完整 webpack 配置</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="comment">// const &#123; name, version &#125; = require(&#x27;./package.json&#x27;);</span></span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> OptimizeCSSAssetsPlugin = <span class="built_in">require</span>(<span class="string">&quot;optimize-css-assets-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> postcssNormalize = <span class="built_in">require</span>(<span class="string">&quot;postcss-normalize&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> apiMocker = <span class="built_in">require</span>(<span class="string">&quot;mocker-api&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> matchSVGSprite = <span class="regexp">/assets\/icons\/|components\/Base\/Icon\/icons\//</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ESLINT_LOADER_DISABLED &#125; = process.env; <span class="comment">// 通过环境变量禁用 eslint-loader</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">env, argv</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> devMode = argv.mode !== <span class="string">&quot;production&quot;</span>;</span><br><span class="line">  <span class="comment">// const publicPath = devMode ? &#x27;/&#x27; : `//x.xxx.cn/$&#123;name&#125;/$&#123;version&#125;/`;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    entry: <span class="string">&quot;./src/index.ts&quot;</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: <span class="string">&quot;bundle.js&quot;</span>,</span><br><span class="line">      path: path.resolve(__dirname, <span class="string">&quot;build&quot;</span>),</span><br><span class="line">      <span class="comment">// publicPath</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生产模式下关闭map文件</span></span><br><span class="line">    devtool: devMode ? <span class="string">&quot;source-map&quot;</span> : <span class="string">&quot;none&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置路径别名</span></span><br><span class="line">    resolve: &#123;</span><br><span class="line">      extensions: [<span class="string">&quot;.ts&quot;</span>, <span class="string">&quot;.tsx&quot;</span>, <span class="string">&quot;.js&quot;</span>, <span class="string">&quot;.jsx&quot;</span>, <span class="string">&quot;.json&quot;</span>],</span><br><span class="line">      alias: &#123;</span><br><span class="line">        <span class="string">&quot;@&quot;</span>: path.resolve(__dirname, <span class="string">&quot;./src&quot;</span>),</span><br><span class="line">        $: path.resolve(__dirname, <span class="string">&quot;./typings&quot;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">        !devMode &amp;&amp; !ESLINT_LOADER_DISABLED</span><br><span class="line">          ? &#123;</span><br><span class="line">              enforce: <span class="string">&quot;pre&quot;</span>,</span><br><span class="line">              test: <span class="regexp">/\.jsx?|\.tsx?$/</span>,</span><br><span class="line">              include: path.resolve(__dirname, <span class="string">&quot;src&quot;</span>),</span><br><span class="line">              loader: <span class="string">&quot;eslint-loader&quot;</span>,</span><br><span class="line">              options: &#123;</span><br><span class="line">                cache: <span class="literal">true</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;</span><br><span class="line">          : &#123;&#125;,</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 解析样式资源，需要安装style-loader、css-loader、less、less-loader、postcss-normalize</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/\.(css|less)$/</span>,</span><br><span class="line">          use: [</span><br><span class="line">            devMode ? MiniCssExtractPlugin.loader : <span class="string">&quot;style-loader&quot;</span>,</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">              options: &#123;</span><br><span class="line">                modules: &#123;</span><br><span class="line">                  mode: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">                  localIdentName: <span class="string">&quot;[name]__[local]&quot;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                importLoaders: <span class="number">1</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">&quot;less-loader&quot;</span>,</span><br><span class="line">              options: &#123;</span><br><span class="line">                lessOptions: &#123;</span><br><span class="line">                  <span class="comment">// modifyVars: &#123;</span></span><br><span class="line">                  <span class="comment">//   &#x27;primary-color&#x27;: &#x27;green&#x27;,</span></span><br><span class="line">                  <span class="comment">//   &#x27;menu-item-active-bg&#x27;: &#x27;green&#x27;,</span></span><br><span class="line">                  <span class="comment">// &#125;,</span></span><br><span class="line">                  javascriptEnabled: <span class="literal">true</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">&quot;px2rem-loader&quot;</span>,</span><br><span class="line">              options: &#123;</span><br><span class="line">                importLoaders: <span class="number">1</span>,</span><br><span class="line">                remUnit: <span class="number">37.5</span>,</span><br><span class="line">                min: <span class="number">2</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">              options: &#123;</span><br><span class="line">                postcssOptions: &#123;</span><br><span class="line">                  ident: <span class="string">&quot;postcss&quot;</span>,</span><br><span class="line">                  plugins: [</span><br><span class="line">                    [</span><br><span class="line">                      <span class="string">&quot;postcss-preset-env&quot;</span>,</span><br><span class="line">                      &#123;</span><br><span class="line">                        autoprefixer: &#123;</span><br><span class="line">                          flexbox: <span class="string">&quot;no-2009&quot;</span>,</span><br><span class="line">                        &#125;,</span><br><span class="line">                        stage: <span class="number">3</span>,</span><br><span class="line">                      &#125;,</span><br><span class="line">                    ],</span><br><span class="line">                    postcssNormalize(),</span><br><span class="line">                  ],</span><br><span class="line">                &#125;,</span><br><span class="line">                sourceMap: <span class="literal">false</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 使用babel-loader编译js|jsx|ts|tsx</span></span><br><span class="line"><span class="comment">         * 需要下载 <span class="doctag">@babel</span>/core <span class="doctag">@babel</span>/preset-env babel-loader</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@babel</span>/preset-react <span class="doctag">@babel</span>/plugin-transform-runtime</span></span><br><span class="line"><span class="comment">         * ts-loader typescript</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/\.(js|jsx|ts|tsx)$/</span>,</span><br><span class="line">          use: [</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">              options: &#123;</span><br><span class="line">                presets: [</span><br><span class="line">                  [</span><br><span class="line">                    <span class="string">&quot;@babel/preset-env&quot;</span>,</span><br><span class="line">                    &#123;</span><br><span class="line">                      modules: <span class="literal">false</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                  ],</span><br><span class="line">                  <span class="string">&quot;@babel/preset-react&quot;</span>,</span><br><span class="line">                ],</span><br><span class="line">                plugins: [</span><br><span class="line">                  [</span><br><span class="line">                    <span class="string">&quot;@babel/plugin-transform-runtime&quot;</span>,</span><br><span class="line">                    &#123;</span><br><span class="line">                      useESModules: <span class="literal">true</span>,</span><br><span class="line">                      corejs: <span class="number">3</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                  ],</span><br><span class="line">                ],</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">&quot;ts-loader&quot;</span>,</span><br><span class="line">              options: &#123;</span><br><span class="line">                happyPackMode: <span class="literal">true</span>,</span><br><span class="line">                transpileOnly: <span class="literal">true</span>,</span><br><span class="line">                compilerOptions: &#123;</span><br><span class="line">                  noEmit: <span class="literal">false</span>,</span><br><span class="line">                  <span class="built_in">module</span>: <span class="string">&quot;esnext&quot;</span>,</span><br><span class="line">                  target: devMode ? <span class="string">&quot;es2017&quot;</span> : <span class="string">&quot;es5&quot;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          ],</span><br><span class="line">          exclude: [<span class="regexp">/node_modules/</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 打包图片资源，需要下载 url-loader html-loader file-loader</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/\.(mp4|png|jpg|jpeg|png|svg|cur|gif|webp|webm|otf)$/</span>,</span><br><span class="line">          use: [</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">&quot;url-loader&quot;</span>,</span><br><span class="line">              options: &#123;</span><br><span class="line">                limit: <span class="number">8192</span>,</span><br><span class="line">                name: <span class="string">&quot;static/[name].[hash:11].[ext]&quot;</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          ],</span><br><span class="line">          exclude: matchSVGSprite,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/\.html$/</span>,</span><br><span class="line">          loader: <span class="string">&quot;html-loader&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 打包svg资源，需要下载 svg-sprite-loader(用于将svg图以img标签的形式引入)</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/\.svg$/</span>,</span><br><span class="line">          include: matchSVGSprite,</span><br><span class="line">          use: [</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">&quot;svg-sprite-loader&quot;</span>,</span><br><span class="line">              options: &#123;</span><br><span class="line">                symbolId: <span class="string">&quot;icon-[name]&quot;</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * plugins配置，需要下载：html-webpack-plugin、mini-css-extract-plugin</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        filename: <span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">        template: path.resolve(__dirname, <span class="string">&quot;./src/index.ejs&quot;</span>),</span><br><span class="line">        minify: &#123;</span><br><span class="line">          removeComments: <span class="literal">true</span>, <span class="comment">// 移除注释</span></span><br><span class="line">          collapseWhitespace: <span class="literal">true</span>, <span class="comment">// 移除空格</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">        filename: <span class="string">&quot;[name].css&quot;</span>,</span><br><span class="line">        chunkFilename: <span class="string">&quot;[name].css&quot;</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> OptimizeCSSAssetsPlugin(),</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 热更新</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">      port: <span class="number">8000</span>,</span><br><span class="line">      host: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">      <span class="comment">// open: true,</span></span><br><span class="line">      disableHostCheck: <span class="literal">true</span>,</span><br><span class="line">      historyApiFallback: <span class="literal">true</span>,</span><br><span class="line">      proxy: &#123;</span><br><span class="line">        <span class="string">&quot;/api&quot;</span>: &#123;</span><br><span class="line">          target: <span class="string">&quot;http://test.bat.xinhuazhiyun.com&quot;</span>,</span><br><span class="line">          changeOrigin: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="title">before</span>(<span class="params">app</span>)</span> &#123;</span><br><span class="line">        apiMocker(app, path.resolve(__dirname, <span class="string">&quot;./mock/mock.js&quot;</span>));</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 配置启动时终端提示信息</span></span><br><span class="line">      stats: &#123;</span><br><span class="line">        colors: <span class="literal">true</span>,</span><br><span class="line">        hash: <span class="literal">false</span>, <span class="comment">// 编译使用的 hash</span></span><br><span class="line">        version: <span class="literal">false</span>, <span class="comment">// 用来编译的 webpack 的版本</span></span><br><span class="line">        timings: <span class="literal">true</span>, <span class="comment">// 编译耗时 (ms)</span></span><br><span class="line">        assets: <span class="literal">false</span>, <span class="comment">// 是否开启assets提示</span></span><br><span class="line">        chunks: <span class="literal">false</span>,</span><br><span class="line">        modules: <span class="literal">false</span>, <span class="comment">// 是否开启modules提示</span></span><br><span class="line">        reasons: <span class="literal">false</span>,</span><br><span class="line">        children: <span class="literal">false</span>,</span><br><span class="line">        source: <span class="literal">false</span>,</span><br><span class="line">        errors: <span class="literal">true</span>, <span class="comment">// 处理这个模块发现的错误的数量</span></span><br><span class="line">        errorDetails: <span class="literal">false</span>,</span><br><span class="line">        warnings: <span class="literal">true</span>,</span><br><span class="line">        publicPath: <span class="literal">false</span>,</span><br><span class="line">        warningsFilter: <span class="regexp">/export .* was not found in/</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置打包构建时终端中的提示信息</span></span><br><span class="line">    stats: &#123;</span><br><span class="line">      hash: <span class="literal">false</span>, <span class="comment">// 编译使用的 hash</span></span><br><span class="line">      timings: <span class="literal">true</span>, <span class="comment">// 告知 stats 添加时间信息</span></span><br><span class="line">      modules: <span class="literal">false</span>, <span class="comment">// 告知 stats 是否添加关于构建模块的信息</span></span><br><span class="line">      chunks: <span class="literal">false</span>, <span class="comment">// 告知 stats 是否添加关于 chunk 的信息。</span></span><br><span class="line">      version: <span class="literal">false</span>, <span class="comment">// 是否用来编译的 webpack 的版本</span></span><br><span class="line">      assets: <span class="literal">true</span>, <span class="comment">// 是否关闭展示资源信息</span></span><br><span class="line">      children: <span class="literal">false</span>, <span class="comment">// 不添加关于子模块的信息。</span></span><br><span class="line">      warningsFilter: <span class="function">(<span class="params">warning</span>) =&gt;</span> <span class="regexp">/Conflicting order between/gm</span>.test(warning), <span class="comment">// 排除掉匹配的告警信息</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    performance: &#123;</span><br><span class="line">      hints: <span class="string">&quot;warning&quot;</span>, <span class="comment">// 枚举</span></span><br><span class="line">      maxAssetSize: <span class="number">30000000</span>, <span class="comment">// 整数类型（以字节为单位）</span></span><br><span class="line">      maxEntrypointSize: <span class="number">50000000</span>, <span class="comment">// 整数类型（以字节为单位）</span></span><br><span class="line">      assetFilter: <span class="function"><span class="keyword">function</span> (<span class="params">assetFilename</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 提供资源文件名的断言函数</span></span><br><span class="line">        <span class="keyword">return</span> assetFilename.endsWith(<span class="string">&quot;.css&quot;</span>) || assetFilename.endsWith(<span class="string">&quot;.js&quot;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="package-json-资源包"><a href="#package-json-资源包" class="headerlink" title="package.json 资源包"></a>package.json 资源包</h4><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;private&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;start&quot;</span>: <span class="string">&quot;webpack serve --mode=development --config=webpack.config.js --hot --inline&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;build&quot;</span>: <span class="string">&quot;npm i &amp;&amp; webpack --mode=production --progress&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;lint&quot;</span>: <span class="string">&quot;eslint --fix --ext .js,.jsx,.ts,.tsx src -c .eslintrc&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;precommit&quot;</span>: <span class="string">&quot;npm run lint&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;dva&quot;</span>: <span class="string">&quot;^2.4.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;react&quot;</span>: <span class="string">&quot;^16.2.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;react-dom&quot;</span>: <span class="string">&quot;^16.2.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;@babel/core&quot;</span>: <span class="string">&quot;^7.13.10&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;@babel/plugin-transform-runtime&quot;</span>: <span class="string">&quot;^7.13.10&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;@babel/preset-env&quot;</span>: <span class="string">&quot;^7.13.12&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;@babel/preset-react&quot;</span>: <span class="string">&quot;^7.12.13&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;@babel/preset-typescript&quot;</span>: <span class="string">&quot;^7.13.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;@babel/runtime-corejs3&quot;</span>: <span class="string">&quot;^7.13.10&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;@typescript-eslint/eslint-plugin&quot;</span>: <span class="string">&quot;~2.6.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;@typescript-eslint/parser&quot;</span>: <span class="string">&quot;~2.6.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;babel-eslint&quot;</span>: <span class="string">&quot;^8.2.3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;babel-loader&quot;</span>: <span class="string">&quot;^8.2.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;babel-plugin-dva-hmr&quot;</span>: <span class="string">&quot;^0.3.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;css-loader&quot;</span>: <span class="string">&quot;^5.1.4&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;eslint&quot;</span>: <span class="string">&quot;^5.3.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;eslint-config-airbnb&quot;</span>: <span class="string">&quot;^17.1.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;eslint-loader&quot;</span>: <span class="string">&quot;~3.0.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;eslint-plugin-import&quot;</span>: <span class="string">&quot;^2.17.3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;eslint-plugin-jsx-a11y&quot;</span>: <span class="string">&quot;^6.1.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;eslint-plugin-react&quot;</span>: <span class="string">&quot;^7.16.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;eslint-plugin-react-ext&quot;</span>: <span class="string">&quot;^0.1.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;eslint-plugin-react-hooks&quot;</span>: <span class="string">&quot;^1.7.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;file-loader&quot;</span>: <span class="string">&quot;^6.2.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;html-loader&quot;</span>: <span class="string">&quot;^2.1.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;html-webpack-plugin&quot;</span>: <span class="string">&quot;^4.5.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;husky&quot;</span>: <span class="string">&quot;^0.12.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;less&quot;</span>: <span class="string">&quot;^4.1.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;less-loader&quot;</span>: <span class="string">&quot;^5.0.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;lib-flexible&quot;</span>: <span class="string">&quot;^0.3.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;mini-css-extract-plugin&quot;</span>: <span class="string">&quot;^1.3.9&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;mocker-api&quot;</span>: <span class="string">&quot;^2.8.3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;optimize-css-assets-webpack-plugin&quot;</span>: <span class="string">&quot;^5.0.4&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;postcss-normalize&quot;</span>: <span class="string">&quot;^9.0.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;px2rem-loader&quot;</span>: <span class="string">&quot;^0.1.9&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;redbox-react&quot;</span>: <span class="string">&quot;^1.4.3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;roadhog&quot;</span>: <span class="string">&quot;^2.5.0-beta.4&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;style-loader&quot;</span>: <span class="string">&quot;^2.0.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;svg-sprite-loader&quot;</span>: <span class="string">&quot;^6.0.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;ts-loader&quot;</span>: <span class="string">&quot;^8.0.18&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;typescript&quot;</span>: <span class="string">&quot;^4.2.3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;url-loader&quot;</span>: <span class="string">&quot;^4.1.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;webpack&quot;</span>: <span class="string">&quot;^4.44.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;webpack-cli&quot;</span>: <span class="string">&quot;^4.5.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;webpack-dev-server&quot;</span>: <span class="string">&quot;^3.11.2&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;husky&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;hooks&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;pre-commit&quot;</span>: <span class="string">&quot;sh ./.git-hooks/pre-commit.sh&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>最后附上该项目 github 仓库地址<a href="https://github.com/dnhyxc/project-config" title="仓库地址">猛戳这里查看吧</a></p>
</blockquote>
]]></content>
      <categories>
        <category>项目构建</category>
        <category>dva</category>
      </categories>
      <tags>
        <tag>webpack</tag>
        <tag>dva</tag>
        <tag>ts</tag>
        <tag>eslint</tag>
      </tags>
  </entry>
  <entry>
    <title>FileOperation</title>
    <url>/2020/02/08/fileOperation/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Blob"><a href="#Blob" class="headerlink" title="Blob"></a>Blob</h3><h4 id="Blob-概述"><a href="#Blob-概述" class="headerlink" title="Blob 概述"></a>Blob 概述</h4><p>1、Blob（Binary Large Object）表示二进制类型的大对象。在数据库管理系统中，将二进制数据存储为一个单一个体的集合。Blob 通常是影像、声音或多媒体文件。<strong>在 JavaScript 中 Blob 类型的对象表示不可变的类似文件对象的原始数据</strong>。</p>
<p>2、Blob 由一个可选的字符串 type（通常是 MIME 类型）和 blobParts 组成：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">                 blobParts                            type(MIME)</span><br><span class="line">                     |                                    |</span><br><span class="line">Blob &#x3D; [Blob ArrayBuffer DOMString]  +  image&#x2F;png 或 text&#x2F;html 或 text&#x2F;plain...</span><br></pre></td></tr></table></figure>
<blockquote>
<p>MIME（Multipurpose Internet Mail Extensions）多用途互联网邮件扩展类型，是设定某种扩展名的文件用一种应用程序来打开的方式类型，当该扩展名文件被访问的时候，浏览器会自动使用指定应用程序来打开。多用于指定一些客户端自定义的文件名，以及一些媒体文件打开方式。<br>常见的 MIME 类型有：超文本标记语言文本 <strong>.html text/html</strong>、<strong>PNG 图像 .png image/png</strong>、<strong>普通文本 .txt text/plain</strong> 等。</p>
</blockquote>
<a id="more"></a>

<h4 id="创建-Blob-的方式"><a href="#创建-Blob-的方式" class="headerlink" title="创建 Blob 的方式"></a>创建 Blob 的方式</h4><p>1、通过构造函数创建 Blob 对象：</p>
<ul>
<li>语法：<code>const myBlob = new Blob(blobParts, options)</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> blob = <span class="keyword">new</span> Blob([<span class="string">&quot;hello world&quot;</span>], &#123; <span class="attr">type</span>: <span class="string">&quot;text/plain&quot;</span> &#125;);</span><br></pre></td></tr></table></figure>
<p>2、相关参数说明：</p>
<ul>
<li><p>blobParts：它是一个由 ArrayBuffer，ArrayBufferView，Blob，DOMString 等对象构成的数组。DOMStrings 会被编码为 UTF-8。</p>
</li>
<li><p>options：一个可选的对象，包含以下两个属性：</p>
<ul>
<li><p>type —— 默认值为 “”，它代表了将会被放入到 blob 中的数组内容的 MIME 类型。</p>
</li>
<li><p>endings —— 默认值为 <strong>transparent</strong>，用于指定包含行结束符 <strong>\n</strong> 的字符串如何被写入。 它是以下两个值中的一个：<strong>native</strong>，代表行结束符会被更改为适合宿主操作系统文件系统的换行符，或者 <strong>transparent</strong>，代表会保持 blob 中保存的结束符不变。</p>
</li>
</ul>
</li>
</ul>
<h4 id="Blob-创建示例"><a href="#Blob-创建示例" class="headerlink" title="Blob 创建示例"></a>Blob 创建示例</h4><p>1、通过字符串创建 Blob：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> myBlobParts = [<span class="string">&quot;&lt;html&gt;&lt;h2&gt;Hello Semlinker&lt;/h2&gt;&lt;/html&gt;&quot;</span>];</span><br><span class="line"><span class="keyword">let</span> myBlob = <span class="keyword">new</span> Blob(myBlobParts, &#123;</span><br><span class="line">  type: <span class="string">&quot;text/html&quot;</span>,</span><br><span class="line">  endings: <span class="string">&quot;transparent&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(myBlob.size + <span class="string">&quot;bytes size&quot;</span>); <span class="comment">// 37 bytes size</span></span><br><span class="line"><span class="built_in">console</span>.log(myBlob.type + <span class="string">&quot;is the type&quot;</span>); <span class="comment">// text/html is the type</span></span><br></pre></td></tr></table></figure>
<p>2、通过类型化数组和字符串创建 Blob：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> hello = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>([<span class="number">72</span>, <span class="number">101</span>, <span class="number">108</span>, <span class="number">108</span>, <span class="number">111</span>]); <span class="comment">// 二进制格式的 &quot;hello&quot;</span></span><br><span class="line"><span class="keyword">let</span> blob = <span class="keyword">new</span> Blob([hello, <span class="string">&quot; &quot;</span>, <span class="string">&quot;dnhyxc&quot;</span>], &#123; <span class="attr">type</span>: <span class="string">&quot;text/plain&quot;</span> &#125;);</span><br><span class="line">blob.text().then(<span class="function">(<span class="params">data</span>) =&gt;</span> <span class="built_in">console</span>.log(data)); <span class="comment">// Hello dnhyxc</span></span><br></pre></td></tr></table></figure>
<h4 id="Blob-的属性"><a href="#Blob-的属性" class="headerlink" title="Blob 的属性"></a>Blob 的属性</h4><p>1、<strong>size</strong>：只读属性，表示 Blob 对象中所包含数据的大小（以字节为单位）。</p>
<p>2、<strong>type</strong>：只读属性，是一个字符串，表明该 Blob 对象所包含数据的 MIME 类型。如果类型未知，则该值为空字符串。</p>
<h4 id="Blob-的方法"><a href="#Blob-的方法" class="headerlink" title="Blob 的方法"></a>Blob 的方法</h4><p>1、<strong>slice</strong>([start[, end[, contentType]]])：返回一个新的 Blob 对象，包含了源 Blob 对象中指定范围内的数据。</p>
<p>2、<strong>stream</strong>( )：返回一个能读取 blob 内容的 <strong>ReadableStream</strong>。</p>
<p>3、<strong>text</strong>( )：返回一个 Promise 对象且包含 blob 所有内容的 UTF-8 格式的 USVString。</p>
<p>4、<strong>arrayBuffer</strong>( )：返回一个 Promise 对象且包含 blob 所有内容的二进制格式的 ArrayBuffer。</p>
<blockquote>
<p>由于 Blob 对象是不可改变的。我们不能直接在一个 Blob 中更改数据，但是我们可以对一个 Blob 进行分割，从其中创建新的 Blob 对象，将它们混合到一个新的 Blob 中。这种行为类似于 JavaScript 字符串：我们无法更改字符串中的字符，但可以创建新的更正后的字符串。</p>
</blockquote>
<h4 id="Blob-的使用场景"><a href="#Blob-的使用场景" class="headerlink" title="Blob 的使用场景"></a>Blob 的使用场景</h4><h5 id="切片上传"><a href="#切片上传" class="headerlink" title="切片上传"></a>切片上传</h5><p>1、由于 File 对象是特殊类型的 Blob，且可以用在任意的 Blob 类型的上下文中。所以针对大文件传输的场景，我们可以使用 slice 方法对大文件进行切割，然后分片进行上传，具体示例如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> file = <span class="keyword">new</span> File([<span class="string">&quot;a&quot;</span>.repeat(<span class="number">1000000</span>)], <span class="string">&quot;test.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> chunkSize = <span class="number">40000</span>;</span><br><span class="line"><span class="keyword">const</span> url = <span class="string">&quot;https://httpbin.org/post&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">chunkedUpload</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> start = <span class="number">0</span>; start &lt; file.size; start += chunkSize) &#123;</span><br><span class="line">    <span class="keyword">const</span> chunk = file.slice(start, start + chunkSize + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">const</span> fd = <span class="keyword">new</span> FormData();</span><br><span class="line">    fd.append(<span class="string">&quot;data&quot;</span>, chunk);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> fetch(url, &#123; <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>, <span class="attr">body</span>: fd &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> res.text());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="数据下载"><a href="#数据下载" class="headerlink" title="数据下载"></a>数据下载</h5><p>1、使用以 ajax 从互联网上下载数据并将数据存储到 Blob 对象中：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> downloadBlob = <span class="function">(<span class="params">url, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  xhr.open(<span class="string">&quot;GET&quot;</span>, url);</span><br><span class="line">  xhr.responseType = <span class="string">&quot;blob&quot;</span>;</span><br><span class="line">  xhr.onload = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    callback(xhr.response);</span><br><span class="line">  &#125;;</span><br><span class="line">  xhr.send(<span class="literal">null</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>2、除了使用 ajax 之外，也可以使用 fetch 来实现以流的方式获取二进制数据：</p>
<ul>
<li>使用 fetch 获取线上图片并在本地显示：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> myImage = <span class="built_in">document</span>.querySelector(<span class="string">&quot;img&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> myRequest = <span class="keyword">new</span> Request(<span class="string">&quot;flowers.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">fetch(myRequest)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> response.blob();</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">myBlob</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> objectURL = URL.createObjectURL(myBlob);</span><br><span class="line">    myImage.src = objectURL;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>当 fetch 请求成功的时候，调用 response 对象的 blob() 方法，从 response 对象中读取一个 Blob 对象，然后使用 createObjectURL() 方法创建一个 objectURL，然后把它赋值给 img 元素的 src 属性从而显示这张图片。</p>
</blockquote>
<h5 id="Blob-用作-URL"><a href="#Blob-用作-URL" class="headerlink" title="Blob 用作 URL"></a>Blob 用作 URL</h5><p>1、<strong>Blob URL/Object URL</strong> 简介：</p>
<ul>
<li>Blob URL/Object URL 是一种伪协议，允许 Blob 和 File 对象用作图像，下载二进制数据链接等的 URL 源。在浏览器中，我们使用 URL.createObjectURL 方法来创建 Blob URL，该方法接收一个 Blob 对象，并为其创建一个唯一的 URL，其形式为 <code>blob:&lt;origin&gt;/&lt;uuid&gt;</code>，对应的示例如下：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">blob:https:&#x2F;&#x2F;example.org&#x2F;40a5fb5a-d56d-4a33-b4e2-0acf6a8e5f641</span><br></pre></td></tr></table></figure>
<ul>
<li><p>浏览器内部为每个通过 URL.createObjectURL 生成的 URL 存储了一个 URL → Blob 映射。因此，此类 URL 较短，但可以访问 Blob。生成的 URL 仅在当前文档打开的状态下才有效。它允许引用 <code>&lt;img&gt;、&lt;a&gt;</code> 中的 Blob，但如果你访问的 Blob URL 不再存在，则会从浏览器中收到 404 错误。</p>
</li>
<li><p>虽然 Blob URL 看似很不错，但实际上它也有副作用。虽然存储了 URL → Blob 的映射，但 Blob 本身仍驻留在内存中，浏览器无法释放它。映射在文档卸载时自动清除，因此 Blob 对象随后被释放。但是，如果应用程序寿命很长，那不会很快发生。因此，如果我们创建一个 Blob URL，即使不再需要该 Blob，它也会存在内存中。</p>
</li>
<li><p>针对这个问题，我们可以调用 <code>URL.revokeObjectURL(url)</code> 方法，从内部映射中删除引用，从而允许删除 Blob（如果没有其他引用），并释放内存。</p>
</li>
</ul>
<p>2、根据上述说明，举一个 Blob 文件下载示例：</p>
<ul>
<li>index.html 内容：</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Blob 文件下载示例<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;downloadBtn&quot;</span>&gt;</span>文件下载<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>index.js 内容：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> download = <span class="function">(<span class="params">fileName, blob</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> link = <span class="built_in">document</span>.createElement(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">  link.href = URL.createObjectURL(blob);</span><br><span class="line">  link.download = fileName;</span><br><span class="line">  link.click();</span><br><span class="line">  link.remove();</span><br><span class="line">  URL.revokeObjectURL(link.href);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> downloadBtn = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#downloadBtn&quot;</span>);</span><br><span class="line">downloadBtn.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> fileName = <span class="string">&quot;blob.txt&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> myBlob = <span class="keyword">new</span> Blob([<span class="string">&quot;一文彻底掌握 Blob File 数据流&quot;</span>], &#123;</span><br><span class="line">    type: <span class="string">&quot;text/plain&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  download(fileName, myBlob);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="Blob-转换为-Base64"><a href="#Blob-转换为-Base64" class="headerlink" title="Blob 转换为 Base64"></a>Blob 转换为 Base64</h5><p>1、URL.createObjectURL 的一个替代方法是，将 Blob 转换为 base64 编码的字符串。Base64 是一种基于 64 个可打印字符来表示二进制数据的表示方法，它常用于在处理文本数据的场合，表示、传输、存储一些二进制数据，包括 MIME 的电子邮件及 XML 的一些复杂数据。</p>
<p>2、在 MIME 格式的电子邮件中，base64 可以用来将二进制的字节序列数据编码成 ASCII 字符序列构成的文本。使用时，在传输编码方式中指定 base64。使用的字符包括大小写拉丁字母各 26 个、数字 10 个、加号 + 和斜杠 /，共 64 个字符，等号 = 用来作为后缀用途。</p>
<p>3、如何在 HTML 中嵌入 base64 编码的图片：</p>
<ul>
<li>在编写 HTML 网页时，对于一些简单图片，通常会选择将图片内容直接内嵌在网页中，从而减少不必要的网络请求，但是图片数据是二进制数据，该怎么嵌入呢？绝大多数现代浏览器都支持一种名为 Data URLs 的特性，允许使用 base64 对图片或其他文件的二进制数据进行编码，将其作为文本字符串嵌入网页中。</li>
</ul>
<p>4、Data URLs 由四个部分组成：前缀（data:）、指示数据类型的 MIME 类型、如果非文本则为可选的 base64 标记、数据本身：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">data:[&lt;mediatype&gt;][;base64],&lt;data&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>mediatype 是个 MIME 类型的字符串，例如 “image/jpeg” 表示 JPEG 图像文件。如果被省略，则默认值为 text/plain;charset=US-ASCII。如果数据是文本类型，你可以直接将文本嵌入（根据文档类型，使用合适的实体字符或转义字符）。如果是二进制数据，你可以将数据进行 base64 编码之后再进行嵌入。比如嵌入一张图片：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;img alt&#x3D;&quot;logo&quot; src&#x3D;&quot;data:image&#x2F;png;base64,iVBORw0KGgoAAAANSUhEUg...&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>5、如果图片较大，图片的色彩层次比较丰富，则不适合使用这种方式，因为该图片经过 base64 编码后的字符串非常大，会明显增大 HTML 页面的大小，从而影响加载速度。 除此之外，利用 FileReader API，我们也可以方便的实现图片本地预览功能，具体代码如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> <span class="attr">onchange</span>=<span class="string">&quot;loadFile(event)&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;output&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> loadFile = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader();</span></span><br><span class="line"><span class="javascript">    reader.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> output = <span class="built_in">document</span>.querySelector(<span class="string">&quot;output&quot;</span>);</span></span><br><span class="line">      output.src = reader.result;</span><br><span class="line">    &#125;;</span><br><span class="line">    reader.readAsDataURL(event.target.files[0]);</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="图片压缩"><a href="#图片压缩" class="headerlink" title="图片压缩"></a>图片压缩</h5><p>1、在一些场合中，我们希望在上传本地图片时，先对图片进行一定的压缩，然后再提交到服务器，从而减少传输的数据量。在前端要实现图片压缩，我们可以利用 Canvas 对象提供的 <code>toDataURL()</code> 方法，该方法接收 <strong>type</strong> 和 <strong>encoderOptions</strong> 两个可选参数。其中 <code>type</code> 表示<strong>图片格式</strong>，默认为 image/png。而 <code>encoderOptions</code> 用于表示<strong>图片的质量</strong>，在指定图片格式为 image/jpeg 或 image/webp 的情况下，可以从 0 到 1 的区间内选择图片的质量。如果超出取值范围，将会使用默认值 0.92，其他参数会被忽略。</p>
<p>2、具体实现图片压缩的方式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> MAX_WIDTH = <span class="number">800</span>; <span class="comment">// 图片最大宽度</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compress</span>(<span class="params">base64, quality, mimeType</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line">  <span class="keyword">let</span> img = <span class="built_in">document</span>.createElement(<span class="string">&quot;img&quot;</span>);</span><br><span class="line">  img.crossOrigin = <span class="string">&quot;anonymous&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    img.src = base64;</span><br><span class="line">    img.onload = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> targetWidth, targetHeight;</span><br><span class="line">      <span class="keyword">if</span> (img.width &gt; MAX_WIDTH) &#123;</span><br><span class="line">        targetWidth = MAX_WIDTH;</span><br><span class="line">        targetHeight = (img.height * MAX_WIDTH) / img.width;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        targetWidth = img.width;</span><br><span class="line">        targetHeight = img.height;</span><br><span class="line">      &#125;</span><br><span class="line">      canvas.width = targetWidth;</span><br><span class="line">      canvas.height = targetHeight;</span><br><span class="line">      <span class="keyword">let</span> ctx = canvas.getContext(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line">      ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, targetWidth, targetHeight); <span class="comment">// 清除画布</span></span><br><span class="line">      ctx.drawImage(img, <span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span><br><span class="line">      <span class="keyword">let</span> imageData = canvas.toDataURL(mimeType, quality / <span class="number">100</span>);</span><br><span class="line">      resolve(imageData);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>对于返回的 Data URL 格式的图片数据，为了进一步减少传输的数据量，我们可以把它转换为 Blob 对象：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dataUrlToBlob</span>(<span class="params">base64, mimeType</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> bytes = <span class="built_in">window</span>.atob(base64.split(<span class="string">&quot;,&quot;</span>)[<span class="number">1</span>]);</span><br><span class="line">  <span class="keyword">let</span> ab = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(bytes.length);</span><br><span class="line">  <span class="keyword">let</span> ia = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(ab);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; bytes.length; i++) &#123;</span><br><span class="line">    ia[i] = bytes.charCodeAt(i);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Blob([ab], &#123; <span class="attr">type</span>: mimeType &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>在转换完成后，我们就可以压缩后的图片对应的 Blob 对象封装在 FormData 对象中，然后再通过 AJAX 提交到服务器上：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">uploadFile</span>(<span class="params">url, blob</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">  <span class="keyword">let</span> request = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  formData.append(<span class="string">&quot;image&quot;</span>, blob);</span><br><span class="line">  request.open(<span class="string">&quot;POST&quot;</span>, url, <span class="literal">true</span>);</span><br><span class="line">  request.send(formData);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、Canvas 对象除了提供 toDataURL() 方法之外，它还提供了一个 toBlob() 方法，该方法的语法为：<code>canvas.toBlob(callback, mimeType, qualityArgument)</code>。</p>
<ul>
<li>和 toDataURL() 方法相比，toBlob() 方法是异步的，因此多了个 callback 参数，这个 callback 回调方法默认的第一个参数就是转换好的 blob 文件信息。</li>
</ul>
<p>4、本地图片压缩的完整示例：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>本地图片压缩<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> <span class="attr">onchange</span>=<span class="string">&quot;loadFile(event)&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./compress.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> loadFile = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader();</span></span><br><span class="line"><span class="javascript">        reader.onload = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">let</span> compressedDataURL = <span class="keyword">await</span> compress(</span></span><br><span class="line">            reader.result,</span><br><span class="line">            90,</span><br><span class="line"><span class="javascript">            <span class="string">&quot;image/jpeg&quot;</span></span></span><br><span class="line">          );</span><br><span class="line"><span class="javascript">          <span class="keyword">let</span> compressedImageBlob = dataUrlToBlob(compressedDataURL);</span></span><br><span class="line"><span class="javascript">          uploadFile(<span class="string">&quot;https://httpbin.org/post&quot;</span>, compressedImageBlob);</span></span><br><span class="line">        &#125;;</span><br><span class="line">        reader.readAsDataURL(event.target.files[0]);</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="生成-PDF-文档"><a href="#生成-PDF-文档" class="headerlink" title="生成 PDF 文档"></a>生成 PDF 文档</h5><p>1、PDF（便携式文件格式，Portable Document Format）是由 Adobe Systems 在 1993 年用于文件交换所发展出的文件格式。在浏览器端，利用一些现成的开源库，比如 jsPDF，我们也可以方便地生成 PDF 文档。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>客户端生成 PDF 示例<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>客户端生成 PDF 示例<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/jspdf@latest/dist/jspdf.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      (<span class="function"><span class="keyword">function</span> <span class="title">generatePdf</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> doc = <span class="keyword">new</span> jsPDF();</span></span><br><span class="line"><span class="javascript">        doc.text(<span class="string">&quot;Hello semlinker!&quot;</span>, <span class="number">66</span>, <span class="number">88</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> blob = <span class="keyword">new</span> Blob([doc.output()], &#123; <span class="attr">type</span>: <span class="string">&quot;application/pdf&quot;</span> &#125;);</span></span><br><span class="line"><span class="javascript">        blob.text().then(<span class="function">(<span class="params">blobAsText</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(blobAsText);</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;)();</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在以上示例中，首先创建 PDF 文档对象，然后调用该对象上的 text() 方法在指定的坐标点上添加 Hello semlinker! 文本，然后我们利用生成的 PDF 内容来创建对应的 Blob 对象，需要注意的是我们设置 Blob 的类型为 application/pdf，最后把 Blob 对象中保存的内容转换为文本并输出到控制台。截取部分输出结果如下：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">%PDF-1.3</span><br><span class="line">%ºß¬à</span><br><span class="line">3 0 obj</span><br><span class="line">&lt;&lt;&#x2F;Type &#x2F;Page</span><br><span class="line">&#x2F;Parent 1 0 R</span><br><span class="line">&#x2F;Resources 2 0 R</span><br><span class="line">&#x2F;MediaBox [0 0 595.28 841.89]</span><br><span class="line">&#x2F;Contents 4 0 R</span><br><span class="line">&gt;&gt;</span><br><span class="line">endobj</span><br><span class="line">....</span><br></pre></td></tr></table></figure>
<p>2、jsPDF 除了支持纯文本之外，它也可以生成带图片的 PDF 文档，比如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> imgData = <span class="string">&quot;data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/...&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> doc = <span class="keyword">new</span> jsPDF();</span><br><span class="line"></span><br><span class="line">doc.setFontSize(<span class="number">40</span>);</span><br><span class="line">doc.text(<span class="number">35</span>, <span class="number">25</span>, <span class="string">&quot;Paranyan loves jsPDF&quot;</span>);</span><br><span class="line">doc.addImage(imgData, <span class="string">&quot;JPEG&quot;</span>, <span class="number">15</span>, <span class="number">40</span>, <span class="number">180</span>, <span class="number">160</span>);</span><br></pre></td></tr></table></figure>
<h3 id="File"><a href="#File" class="headerlink" title="File"></a>File</h3><h4 id="File-概述"><a href="#File-概述" class="headerlink" title="File 概述"></a>File 概述</h4><p>1、File 对象提供有关文件的信息，并允许网页中的 JavaScript 读写文件，它继承了 Blob。</p>
<p>2、最常见的使用场合是表单的文件上传控件，用户在一个 <code>&lt;input type=&quot;file&quot;&gt;</code> 元素上选择文件后，浏览器会生成一个数组，里面是每一个用户选中的文件，它们都是 File 实例对象。</p>
<p>3、<strong>特别说明</strong>：File 对象是一种特殊 <strong>Blob</strong> 对象，并且可以用在任意的 Blob 对象的 context 中。比如说， FileReader, <strong>URL.createObjectURL()</strong>, <strong>createImageBitmap()</strong>, 及 <strong>XMLHttpRequest.send()</strong> 都能处理 Blob 和 File。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> file = <span class="built_in">document</span>.getElementById(<span class="string">&quot;fileItem&quot;</span>).files[<span class="number">0</span>];</span><br><span class="line">file <span class="keyword">instanceof</span> File; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h4 id="File-构造函数"><a href="#File-构造函数" class="headerlink" title="File 构造函数"></a>File 构造函数</h4><p>1、浏览器原生提供一个 File() 构造函数，用来生成 File 实例对象。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> myFile = <span class="keyword">new</span> File(bits, name[, options]);</span><br></pre></td></tr></table></figure>
<p>2、参数说明：</p>
<ul>
<li><p><strong>bits</strong>：一个包含 ArrayBuffer，ArrayBufferView，Blob，或者 DOMString 对象的数组，或者任何这些对象的组合。这是 UTF-8 编码的文件内容。通过这个参数，也可以实现 ArrayBuffer，ArrayBufferView，Blob 转换为 File 对象。</p>
</li>
<li><p><strong>name</strong>：字符串，表示文件名或文件路径。</p>
</li>
<li><p><strong>options</strong>：配置对象，设置实例的属性。该参数可选。可选值有如下两种：</p>
<ul>
<li><p><code>type</code>：DOMString，表示将要放到文件中的内容的 MIME 类型。默认值为 “” 。</p>
</li>
<li><p><code>lastModified</code>：数值，表示文件最后修改时间的 Unix 时间戳（毫秒）。默认值为 Date.now()。</p>
</li>
</ul>
</li>
</ul>
<p>3、使用示例如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> myFile = <span class="keyword">new</span> File([<span class="string">&quot;dnhyxc1&quot;</span>, <span class="string">&quot;dnhyxc2&quot;</span>], <span class="string">&quot;dnhyxc.txt&quot;</span>, &#123;</span><br><span class="line">  type: <span class="string">&quot;text/plain&quot;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>4、根据已有 blob 对象创建 File 对象：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> myFile = <span class="keyword">new</span> File([blob], <span class="string">&quot;leo.png&quot;</span>, &#123; <span class="attr">type</span>: <span class="string">&quot;image/png&quot;</span> &#125;);</span><br></pre></td></tr></table></figure>
<h4 id="File-实例属性"><a href="#File-实例属性" class="headerlink" title="File 实例属性"></a>File 实例属性</h4><p>1、<strong>File.lastModified</strong>：只读属性，用户获取最后修改时间，是个时间戳（自 UNIX 时间起始值（1970 年 1 月 1 日 00:00:00 UTC）以来的毫秒数）。</p>
<p>2、<strong>File.name</strong>：只读属性，返回文件名。</p>
<p>3、<strong>File.size</strong>：只读属性，返回文件大小（单位字节）。</p>
<p>4、<strong>File.type</strong>：只读属性，返回文件的 MIME 类型。</p>
<p>5、<strong>File.lastModifiedDate</strong>：只读属性，返回文件最后的修改时间，一个 Date 对象。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> myFile = <span class="built_in">document</span>.querySelector(<span class="string">&quot;.fileInp&quot;</span>);</span><br><span class="line"></span><br><span class="line">myFile.addEventListener(<span class="string">&quot;change&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> file = e.target.files[<span class="number">0</span>];</span><br><span class="line">  <span class="built_in">console</span>.log(file.name); <span class="comment">// 4m.jpg</span></span><br><span class="line">  <span class="built_in">console</span>.log(file.size); <span class="comment">// 215626</span></span><br><span class="line">  <span class="built_in">console</span>.log(file.type); <span class="comment">// image/jpeg</span></span><br><span class="line">  <span class="built_in">console</span>.log(file.lastModified); <span class="comment">// 1636091486080</span></span><br><span class="line">  <span class="built_in">console</span>.log(file.lastModifiedDate); <span class="comment">// Fri Nov 05 2021 13:51:26 GMT+0800 (中国标准时间)</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="File-实例方法"><a href="#File-实例方法" class="headerlink" title="File 实例方法"></a>File 实例方法</h4><p>1、File 对象没有定义任何方法，但是它从 Blob 接口继承了以下方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">File.slice([start[, end[, contentType]]])</span><br></pre></td></tr></table></figure>
<p>2、slice 方法会返回一个新的 File 对象，它包含有源 File 对象中指定范围内的数据。</p>
<h3 id="FileList"><a href="#FileList" class="headerlink" title="FileList"></a>FileList</h3><h4 id="FileList-概述"><a href="#FileList-概述" class="headerlink" title="FileList 概述"></a>FileList 概述</h4><p>1、FileList 对象是一个类数组对象，每个成员都是一个 File 实例，主要出现在两种场合：</p>
<ul>
<li><p>通过 <code>&lt;input type=&quot;file&quot; multiple&gt;</code> 控件的 files 属性，返回一个 FileList 实例。另外，当 input 元素拥有 <strong>multiple</strong> 属性，则可以用它来选择多个文件。</p>
</li>
<li><p>通过拖放文件，查看 DataTransfer.files 属性，返回一个 FileList 实例。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> multipleInp = <span class="built_in">document</span>.querySelector(<span class="string">&quot;.multipleInp&quot;</span>);</span><br><span class="line">multipleInp.addEventListener(<span class="string">&quot;change&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> files = e.target.files;</span><br><span class="line">  <span class="built_in">console</span>.log(files <span class="keyword">instanceof</span> FileList); <span class="comment">// true</span></span><br><span class="line">  <span class="built_in">console</span>.log(files);</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  FileList &#123;0: File, 1: File, length: 2&#125;</span></span><br><span class="line"><span class="comment">    0: File</span></span><br><span class="line"><span class="comment">      lastModified: 1636091486080</span></span><br><span class="line"><span class="comment">      lastModifiedDate: Fri Nov 05 2021 13:51:26 GMT+0800 (中国标准时间) &#123;&#125;</span></span><br><span class="line"><span class="comment">      name: &quot;4m.jpg&quot;</span></span><br><span class="line"><span class="comment">      size: 215626</span></span><br><span class="line"><span class="comment">      type: &quot;image/jpeg&quot;</span></span><br><span class="line"><span class="comment">      webkitRelativePath: &quot;&quot;</span></span><br><span class="line"><span class="comment">      [[Prototype]]: File</span></span><br><span class="line"><span class="comment">    1: File</span></span><br><span class="line"><span class="comment">      lastModified: 1636091419330</span></span><br><span class="line"><span class="comment">      lastModifiedDate: Fri Nov 05 2021 13:50:19 GMT+0800 (中国标准时间) &#123;&#125;</span></span><br><span class="line"><span class="comment">      name: &quot;11.jpg&quot;</span></span><br><span class="line"><span class="comment">      size: 26050</span></span><br><span class="line"><span class="comment">      type: &quot;image/jpeg&quot;</span></span><br><span class="line"><span class="comment">      webkitRelativePath: &quot;&quot;</span></span><br><span class="line"><span class="comment">      [[Prototype]]: File</span></span><br><span class="line"><span class="comment">      length: 2</span></span><br><span class="line"><span class="comment">      [[Prototype]]: FileList        </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(files[<span class="number">0</span>]);</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    lastModified: 1636091486080</span></span><br><span class="line"><span class="comment">    lastModifiedDate: Fri Nov 05 2021 13:51:26 GMT+0800 (中国标准时间) &#123;&#125;</span></span><br><span class="line"><span class="comment">    name: &quot;4m.jpg&quot;</span></span><br><span class="line"><span class="comment">    size: 215626</span></span><br><span class="line"><span class="comment">    type: &quot;image/jpeg&quot;</span></span><br><span class="line"><span class="comment">    webkitRelativePath: &quot;&quot;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="FileList-实例属性"><a href="#FileList-实例属性" class="headerlink" title="FileList 实例属性"></a>FileList 实例属性</h4><p>1、<strong>FileList.length</strong>：只读属性，返回列表中的文件数量。</p>
<h4 id="FileList-实例方法"><a href="#FileList-实例方法" class="headerlink" title="FileList 实例方法"></a>FileList 实例方法</h4><p>1、FileList.item()：用来返回指定位置的实例，从 0 开始，类似于通过索引获取<code>files[0]、files[1]</code>。</p>
<blockquote>
<p>由于 FileList 实例是个类数组对象，可以直接用方括号运算符，即 myFileList[0] 等同于 myFileList.item(0) ，所以一般用不到 item()方法。</p>
</blockquote>
<h3 id="FileReader"><a href="#FileReader" class="headerlink" title="FileReader"></a>FileReader</h3><h4 id="FileReader-概述"><a href="#FileReader-概述" class="headerlink" title="FileReader 概述"></a>FileReader 概述</h4><p>1、FileReader 对象允许 Web 应用程序<strong>异步读取</strong>存储在用户计算机上的文件（或原始数据缓冲区）的内容，使用 File 或 Blob 对象指定要读取的文件或数据。</p>
<blockquote>
<p><strong>注意</strong>： FileReader 仅用于以安全的方式从用户（远程）系统读取文件内容，它不能用于从文件系统中按路径名简单地读取文件。要在 JavaScript 中按路径名读取文件，应使用标准 Ajax 解决方案进行服务器端文件读取，如果读取跨域，则需要使用 CORS 等方式处理跨域问题。</p>
</blockquote>
<p>2、具体使用示例如：初始化后，监听 load 事件，然后调用读取方法。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line">reader.onload = <span class="function"><span class="keyword">function</span> (<span class="params">evt</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(evt.target.result);</span><br><span class="line">&#125;;</span><br><span class="line">reader.readAsText(file);</span><br></pre></td></tr></table></figure>
<h4 id="FileReader-属性"><a href="#FileReader-属性" class="headerlink" title="FileReader 属性"></a>FileReader 属性</h4><p>1、error：一个 DOMException，表示读取文件时发生的错误（只读属性）。</p>
<p>2、readyState：用于获取加载文件时的状态，其中 0 代表还没加载，1 代表加载中，2 代表加载完成（只读属性）。</p>
<p>3、result：用户获取读取到的文件内容（只读属性）。</p>
<h4 id="FileReader-事件"><a href="#FileReader-事件" class="headerlink" title="FileReader 事件"></a>FileReader 事件</h4><p>1、<strong>onabort</strong>：读取操作被中断的事件，在读取被中断时触发。</p>
<p>2、<strong>onload</strong>：读取操作完成的事件，在读取操作完成时触发。</p>
<p>3、<strong>onprogress</strong>：读取 Blob 时触发。</p>
<p>4、<strong>onloadstart</strong>：在读取操作开始时触发。</p>
<p>5、<strong>onloadend</strong>：在读取操作结束时（要么成功，要么失败）触发。</p>
<p>6、<strong>onerror</strong>：读取操作发生错误的事件，在读取操作发生错误时触发。</p>
<h4 id="FileReader-方法"><a href="#FileReader-方法" class="headerlink" title="FileReader 方法"></a>FileReader 方法</h4><p>1、<strong>fr.abort</strong> ( )：终止读取操作，readyState 属性将变成 2。</p>
<p>2、<strong>fr.readAsArrayBuffer</strong> ( )：以 ArrayBuffer 的格式读取文件，读取完成后 result 属性将返回一个 <code>ArrayBuffer</code> 实例。</p>
<p>3、<strong>fr.readAsDataURL</strong> ( )：读取完成后，result 属性将返回一个 <code>Data URL 格式（Base64 编码）的字符串</code>，代表文件内容。</p>
<p>4、<strong>fr.readAsText</strong> ( )：读取完成后，result 属性将返回文件内容的<code>文本字符串</code>。</p>
<p>5、<strong>fr.readAsBinaryString</strong> ( )：读取完成后，result 属性将返回原始的<code>二进制数据（二进制字符串）</code>。</p>
<h3 id="URL-amp-URLSearchParams"><a href="#URL-amp-URLSearchParams" class="headerlink" title="URL &amp; URLSearchParams"></a>URL &amp; URLSearchParams</h3><h4 id="URL-概述"><a href="#URL-概述" class="headerlink" title="URL 概述"></a>URL 概述</h4><p>1、URL 接口用于解析、构造、规范化和编码 URL。其构造的实例支持若干属性和方法，可以用来读写 URL 相关的属性值。我们甚至可以把文件内容作为 URL 的一部分进行呈现。</p>
<h4 id="URL-与-URLSearchParams-的作用"><a href="#URL-与-URLSearchParams-的作用" class="headerlink" title="URL 与 URLSearchParams 的作用"></a>URL 与 URLSearchParams 的作用</h4><p>1、当需要对地址栏中的 URL 地址进行分析处理，需要自己进行字符串分析，例如：<code>https://dnhyxc.gitee.io/file/?s=url</code>，如果我们需要获取 s 的属性值，就需要进行字符串切割或者进行正则匹配。而 URL 与 URLSearchParams 就是用来对 url 进行处理的，如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> URL(<span class="string">&quot;https://dnhyxc.gitee.io/file/?n=dnhyxc&quot;</span>).searchParams.get(<span class="string">&quot;n&quot;</span>); <span class="comment">// dnhyxc</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> URLSearchParams(<span class="string">&quot;?n=dnhyxc&quot;</span>).get(<span class="string">&quot;n&quot;</span>); <span class="comment">// dnhyxc</span></span><br></pre></td></tr></table></figure>
<h4 id="URLSearchParams-语法"><a href="#URLSearchParams-语法" class="headerlink" title="URLSearchParams() 语法"></a>URLSearchParams() 语法</h4><p>1、URLSearchParams() 语法如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// URL查询字符串</span></span><br><span class="line"><span class="keyword">const</span> myUrlSearchParams = <span class="keyword">new</span> URLSearchParams(strSearchParams);</span><br><span class="line"><span class="comment">// 查询字符序列</span></span><br><span class="line"><span class="keyword">const</span> myUrlSearchParams = <span class="keyword">new</span> URLSearchParams(arrSearchSequence);</span><br><span class="line"><span class="comment">// 查询键值对象</span></span><br><span class="line"><span class="keyword">const</span> myUrlSearchParams = <span class="keyword">new</span> URLSearchParams(objSearchKeyValue);</span><br></pre></td></tr></table></figure>
<p>2、参数说明：</p>
<ul>
<li>strSearchParams：表示 URL 查询字符串，或者对当前地址栏地址的查询字符串。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> params1 = <span class="keyword">new</span> URLSearchParams(<span class="string">&quot;?n=dnhyxc&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params2 = <span class="keyword">new</span> URLSearchParams(location.search);</span><br></pre></td></tr></table></figure>
<ul>
<li>arrSearchSequence：数组形式的查询字符序列。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> params3 = <span class="keyword">new</span> URLSearchParams([</span><br><span class="line">  [<span class="string">&quot;n&quot;</span>, <span class="string">&quot;dnhyxc&quot;</span>],</span><br><span class="line">  [<span class="string">&quot;id&quot;</span>, <span class="number">1</span>],</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<ul>
<li>objSearchKeyValue：键值对形式的查询对象。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> params4 = <span class="keyword">new</span> URLSearchParams(&#123; <span class="attr">n</span>: <span class="string">&quot;dnhyxc&quot;</span>, <span class="attr">id</span>: <span class="number">2</span> &#125;);</span><br></pre></td></tr></table></figure>
<h4 id="URLSearchParams-实例方法"><a href="#URLSearchParams-实例方法" class="headerlink" title="URLSearchParams 实例方法"></a>URLSearchParams 实例方法</h4><p>1、执行 new URLSearchParams() 的返回值 myUrlSearchParams 就是一个 URLSearchParams 实例。</p>
<h5 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="toString()"></a>toString()</h5><p>1、把 URLSearchParams 对象转换成查询字符串。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> params = <span class="keyword">new</span> URLSearchParams(<span class="string">&quot;?n=dnhyxc&quot;</span>); <span class="comment">// 可以省略问号直接&#x27;n=dnhyxc&#x27;</span></span><br><span class="line">params.append(<span class="string">&quot;from&quot;</span>, <span class="string">&quot;snsn&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(params1.toString()); <span class="comment">// n=dnhyxc&amp;from=snsn</span></span><br></pre></td></tr></table></figure>
<h5 id="append-name-key"><a href="#append-name-key" class="headerlink" title="append(name, key)"></a>append(name, key)</h5><p>1、append 方法可以添加新的键值对作为查询参数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> params = <span class="keyword">new</span> URLSearchParams(<span class="string">&quot;?n=dnhyxc&quot;</span>); <span class="comment">// 可以省略问号直接&#x27;n=dnhyxc&#x27;</span></span><br><span class="line">params.append(<span class="string">&quot;from&quot;</span>, <span class="string">&quot;snsn&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(params1.toString()); <span class="comment">// n=dnhyxc&amp;from=snsn</span></span><br></pre></td></tr></table></figure>
<h5 id="delete-name"><a href="#delete-name" class="headerlink" title="delete(name)"></a>delete(name)</h5><p>1、删除已存在的查询参数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> params2 = <span class="keyword">new</span> URLSearchParams(<span class="string">&quot;n=dnhyxc&amp;from=snsn&quot;</span>);</span><br><span class="line">params2.delete(<span class="string">&quot;from&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(params2.toString()); <span class="comment">// n=dnhyxc</span></span><br></pre></td></tr></table></figure>
<h5 id="entries"><a href="#entries" class="headerlink" title="entries()"></a>entries()</h5><p>1、返回查询参数的迭代器对象，可以遍历该迭代器对象获得所有的键值对，如使用 for..of 进行遍历：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> searchParams = <span class="keyword">new</span> URLSearchParams(<span class="string">&quot;n=dnhyxc&amp;from=snsn&amp;id=209&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(searchParams.entries()); <span class="comment">// Iterator &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> arr <span class="keyword">of</span> searchParams.entries()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(arr[<span class="number">0</span>] + <span class="string">&quot;, &quot;</span> + arr[<span class="number">1</span>]);</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    n, dnhyxc</span></span><br><span class="line"><span class="comment">    from, snsn</span></span><br><span class="line"><span class="comment">    id, 209</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  params[arr[<span class="number">0</span>]] = arr[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(params, <span class="string">&quot;params&quot;</span>); <span class="comment">// &#123;n: &#x27;dnhyxc&#x27;, from: &#x27;snsn&#x27;, id: &#x27;209&#x27;&#125;</span></span><br></pre></td></tr></table></figure>
<h5 id="forEach-callback"><a href="#forEach-callback" class="headerlink" title="forEach(callback)"></a>forEach(callback)</h5><p>1、该方法可以遍历查询对象，其中 callback 是遍历方法，支持两个参数，分别是每个键值对的值和键。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> searchParams = <span class="keyword">new</span> URLSearchParams(<span class="string">&quot;n=dnhyxc&amp;from=snsn&amp;id=209&quot;</span>);</span><br><span class="line"><span class="comment">// 输出值和键的内容</span></span><br><span class="line">searchParams.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">value, key</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(key, value);</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    n dnhyxc</span></span><br><span class="line"><span class="comment">    from snsn</span></span><br><span class="line"><span class="comment">    id 209</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="get-name"><a href="#get-name" class="headerlink" title="get(name)"></a>get(name)</h5><p>1、该方法可以返回指定关键字对象的值，如果没有对应的值，则返回 null。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> params = <span class="keyword">new</span> URLSearchParams(<span class="string">&quot;n=dnhyxc&amp;from=snsn&amp;id=209&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(params.get(<span class="string">&quot;n&quot;</span>)); <span class="comment">// dnhyxc</span></span><br></pre></td></tr></table></figure>
<h5 id="getAll-name"><a href="#getAll-name" class="headerlink" title="getAll(name)"></a>getAll(name)</h5><p>1、以数组形式返回所有当前查询关键字对应的值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> params = <span class="keyword">new</span> URLSearchParams(<span class="string">&quot;n=dnhyxc&amp;from=snsn&amp;n=209&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(params.getAll(<span class="string">&quot;n&quot;</span>)); <span class="comment">// [&#x27;dnhyxc&#x27;, &#x27;209&#x27;]</span></span><br></pre></td></tr></table></figure>
<h5 id="has-name"><a href="#has-name" class="headerlink" title="has(name)"></a>has(name)</h5><p>1、返回布尔值，true 或者 false，是否包含某个查询关键字。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> params = <span class="keyword">new</span> URLSearchParams(<span class="string">&quot;n=dnhyxc&amp;from=snsn&amp;id=209&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(params.has(<span class="string">&quot;n&quot;</span>)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h5 id="keys"><a href="#keys" class="headerlink" title="keys()"></a>keys()</h5><p>1、返回一个迭代器对象，允许迭代该对象中所有的关键字。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> searchParams = <span class="keyword">new</span> URLSearchParams(<span class="string">&quot;n=dnhyxc&amp;from=snsn&quot;</span>);</span><br><span class="line"><span class="comment">// 显示所有的键</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">of</span> searchParams.keys()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(key); <span class="comment">// n from</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="values"><a href="#values" class="headerlink" title="values()"></a>values()</h5><p>1、返回一个迭代器对象，允许迭代该对象中所有的关键字值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> searchParams = <span class="keyword">new</span> URLSearchParams(<span class="string">&quot;n=dnhyxc&amp;from=snsn&quot;</span>);</span><br><span class="line"><span class="comment">// 显示所有的值</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> searchParams.values()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value); <span class="comment">// dnhyxc snsn</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="set-name-value"><a href="#set-name-value" class="headerlink" title="set(name, value)"></a>set(name, value)</h5><p>1、当存在该属性时，将其属性值替换为传入的新值，不存在该属性值则直接设置。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> params = <span class="keyword">new</span> URLSearchParams(<span class="string">&quot;n=dnhyxc&amp;from=snsn&quot;</span>);</span><br><span class="line">params.set(<span class="string">&quot;from&quot;</span>, <span class="string">&quot;hz&quot;</span>);</span><br><span class="line">params.set(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;209&quot;</span>);</span><br><span class="line">consol.log(params.toString()); <span class="comment">// n=dnhyxc&amp;from=hz&amp;id=209</span></span><br></pre></td></tr></table></figure>
<h5 id="sort"><a href="#sort" class="headerlink" title="sort()"></a>sort()</h5><p>1、该方法将此对象中包含的所有键/值对就地排序，并返回 undefined。排序顺序是以 Unicode 码位为依据。该方法使用一种稳定的排序算法（即保留具有相同键的键/值对之间的相对顺序）。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> searchParams = <span class="keyword">new</span> URLSearchParams(<span class="string">&quot;c=6&amp;a=2&amp;d=9&amp;b=3&amp;a=1&quot;</span>);</span><br><span class="line"><span class="comment">// 键值对排序</span></span><br><span class="line">searchParams.sort();</span><br><span class="line"><span class="comment">// 显示排序后的查询字符串</span></span><br><span class="line"><span class="built_in">console</span>.log(searchParams.toString()); <span class="comment">// a=2&amp;a=1&amp;b=3&amp;c=6&amp;d=9</span></span><br></pre></td></tr></table></figure>
<h4 id="URL-语法"><a href="#URL-语法" class="headerlink" title="URL() 语法"></a>URL() 语法</h4><p>1、URL() 语法如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> myUrl = <span class="keyword">new</span> URL(url, [base]);</span><br></pre></td></tr></table></figure>
<p>2、参数说明：</p>
<ul>
<li><p>url：相对地址或者绝对地址。如果是相对地址，需要设置 base 参数，如果是绝对地址，则会忽略 base 设置。我们也可以使用 URL 对象作为 url 参数。此时作用的值是 URL 对象中的 href 属性值。</p>
</li>
<li><p>base：如果 URL 地址是相对地址，则需要这个参数，作用是作为相对计算的基础地址。我们也可以使用 URL 对象作为 base 参数，此时作用的值是 URL 对象中的 href 属性值。如果不设置该参数，则会按照空字符串’’进行处理。</p>
</li>
</ul>
<blockquote>
<p>如果参数值无法组合成完整 URL 地址，则会报 TypeError 错误。</p>
</blockquote>
<p>3、具体用法如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> base = <span class="string">&quot;https://dnhyxc.gitee.io&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> URL(<span class="string">&quot;dnhyxc&quot;</span>, base).href); <span class="comment">// https://dnhyxc.gitee.io/dnhyxc</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> URL(<span class="string">&quot;/dnhyxc&quot;</span>, base).href); <span class="comment">// https://dnhyxc.gitee.io/dnhyxc</span></span><br></pre></td></tr></table></figure>
<ul>
<li>使用 URL 对象作为参数：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> base = <span class="string">&quot;https://dnhyxc.gitee.io&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> urlFromBase = <span class="keyword">new</span> URL(<span class="string">&quot;dnhyxc&quot;</span>, base);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> URL(urlFromBase).href); <span class="comment">// https://dnhyxc.gitee.io/dnhyxc</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> URL(<span class="string">&quot;snsn&quot;</span>, urlFromBase).href); <span class="comment">// https://dnhyxc.gitee.io/snsn</span></span><br></pre></td></tr></table></figure>
<ul>
<li>带有较深层级 base 地址和不同相对地址形式：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> base = <span class="string">&quot;https://dnhyxc.gitee.io/dnhyxc/a/b/c&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> URL(<span class="string">&quot;study/url&quot;</span>, base).href); <span class="comment">// https://dnhyxc.gitee.io/dnhyxc/a/b/study/url</span></span><br><span class="line"><span class="comment">// ./和裸露相对地址没有区别</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> URL(<span class="string">&quot;./study/url&quot;</span>, base).href); <span class="comment">// https://dnhyxc.gitee.io/dnhyxc/a/b/study/url</span></span><br><span class="line"><span class="comment">// 向上一层URL层级深度</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> URL(<span class="string">&quot;../study/url&quot;</span>, base).href); <span class="comment">// https://dnhyxc.gitee.io/dnhyxc/a/study/url</span></span><br><span class="line"><span class="comment">// 层级按照斜杠进行计算</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> URL(<span class="string">&quot;../study/url&quot;</span>, base + <span class="string">&quot;/&quot;</span>).href); <span class="comment">// https://dnhyxc.gitee.io/dnhyxc/a/b/study/url</span></span><br><span class="line"><span class="comment">// 斜杠开头表示从origin开始匹配，即从io开始</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> URL(<span class="string">&quot;/study/url&quot;</span>, base).href); <span class="comment">// https://dnhyxc.gitee.io/study/url</span></span><br></pre></td></tr></table></figure>
<ul>
<li>不同域名：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> base = <span class="string">&quot;https://www.baidu.com&quot;</span>;</span><br><span class="line"><span class="comment">// 没有协议的url认为是相对地址，协议取自base地址</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> URL(<span class="string">&quot;//gitee.dnhyxc.com&quot;</span>, <span class="string">&quot;http://www.baidu.com&quot;</span>).href); <span class="comment">// http://gitee.dnhyxc.com/</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> URL(<span class="string">&quot;//gitee.dnhyxc.com&quot;</span>, <span class="string">&quot;https://www.baidu.com&quot;</span>).href); <span class="comment">// https://gitee.dnhyxc.com/</span></span><br><span class="line"><span class="comment">// 这里url是完整的绝对地址，因此，忽略后面的base参数</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> URL(<span class="string">&quot;https://gitee.dnhyxc.com&quot;</span>, base).href); <span class="comment">// https://gitee.dnhyxc.com/</span></span><br></pre></td></tr></table></figure>
<h4 id="URL-实例对象的属性"><a href="#URL-实例对象的属性" class="headerlink" title="URL 实例对象的属性"></a>URL 实例对象的属性</h4><p>1、new URL()返回值就是一个实例对象。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> giteeUrl = <span class="keyword">new</span> URL(</span><br><span class="line">  <span class="string">&quot;https://dnhyxc.gitee.io:80/dnhyxc/snsn?n=dnhyxc#fileList&quot;</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">const</span> ftp = <span class="keyword">new</span> URL(<span class="string">&quot;ftp://username:password@192.168.1.1/path/file&quot;</span>);</span><br></pre></td></tr></table></figure>
<h5 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h5><p>1、URL 地址中的锚链值，包含字符串’#’，例如上述 giteeUrl 中，url.hash 的返回值是’#fileList’。</p>
<h5 id="host"><a href="#host" class="headerlink" title="host"></a>host</h5><p>1、URL 地址中 host 主机地址，包括协议端口号，上述 giteeUrl.host 的返回值是’dnhyxc.gitee.io:80’。</p>
<h5 id="hostname"><a href="#hostname" class="headerlink" title="hostname"></a>hostname</h5><p>1、URL 地址中主机名称，不包括端口号，上述 giteeUrl.hostname 的返回值是’dnhyxc.gitee.io’。</p>
<h5 id="href"><a href="#href" class="headerlink" title="href"></a>href</h5><p>1、完成的 URL 地址。</p>
<h5 id="pathname"><a href="#pathname" class="headerlink" title="pathname"></a>pathname</h5><p>1、返回 URL 中的目录+文件名。例如上述 ftp.pathname 的返回值是’/dnhyxc/snsn/‘。</p>
<h5 id="search"><a href="#search" class="headerlink" title="search"></a>search</h5><p>1、返回 URL 地址的查询字符串，如果有参数，则返回值以问号’?’开头。例如上述 giteeUrl.search 的返回值是’?n=dnhyxc’。</p>
<h5 id="origin-（只读）"><a href="#origin-（只读）" class="headerlink" title="origin （只读）"></a>origin （只读）</h5><p>1、返回 URL 地址的来源，会包含 URL 协议，域名和端口。如：’<a href="https://dnhyxc.gitee.io:80&#39;。">https://dnhyxc.gitee.io:80&#39;。</a></p>
<h5 id="password"><a href="#password" class="headerlink" title="password"></a>password</h5><p>1、返回 URL 地址域名前的密码。ftp 协议中比较常见。如：上述 ftp 中的 ftp.password 的返回值是’password’。</p>
<h5 id="username"><a href="#username" class="headerlink" title="username"></a>username</h5><p>1、返回 URL 地址域名前的用户名。ftp 协议中比较常见。如：上述 ftp 中的 ftp.username 的返回值是’username’。</p>
<h5 id="port"><a href="#port" class="headerlink" title="port"></a>port</h5><p>1、返回 URL 地址中的端口号。例如上述 giteeUrl 中 giteeUrl.port 的返回值是’80’，ftp.port 的返回值是’’。</p>
<h5 id="protocol"><a href="#protocol" class="headerlink" title="protocol"></a>protocol</h5><p>1、返回 URL 地址的协议，包括后面的冒号’:’。例如上述 giteeUrl.protocol 的返回值是’https:’，ftp.protocol 的返回值是’ftp:’。</p>
<h5 id="searchParams"><a href="#searchParams" class="headerlink" title="searchParams"></a>searchParams</h5><p>1、返回一个 URLSearchParams 对象，可以调用 URLSearchParams 对象各种方法，对查询字符串进行非常方便的处理。例如我们想要知道查询关键字 n 对应的值，可以：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">giteeUrl.searchParams.get(<span class="string">&quot;n&quot;</span>); <span class="comment">// dnhyxc</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>上述属性中，除了 origin 属性是只读的之外，其它属性都可以用来给 url 实例进行赋值操作，即可读可写。</p>
</blockquote>
<h4 id="URL-实例的方法"><a href="#URL-实例的方法" class="headerlink" title="URL 实例的方法"></a>URL 实例的方法</h4><h5 id="toString"><a href="#toString" class="headerlink" title="toString()"></a>toString()</h5><p>1、返回的完整的 URL 地址，可以理解为 URL.href 的另外一种形式，不过这个只能输出，不能修改值。</p>
<h5 id="toJSON"><a href="#toJSON" class="headerlink" title="toJSON()"></a>toJSON()</h5><p>1、同样返回完整的 URL 地址，返回的字符串和 URL.href 属性一样。</p>
<h4 id="URL-实例的静态方法"><a href="#URL-实例的静态方法" class="headerlink" title="URL 实例的静态方法"></a>URL 实例的静态方法</h4><h5 id="URL-createObjectURL-object"><a href="#URL-createObjectURL-object" class="headerlink" title="URL.createObjectURL(object)"></a>URL.createObjectURL(object)</h5><p>1、可以把 File，Blob 或者 MediaSource 对象变成一个一个唯一的 blob URL。其中参数 object 可以是 File，Blob 或者 MediaSource 对象。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>createObjectURL<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;upload&quot;</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;preview&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;预览&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> upload = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#upload&quot;</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> preview = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#preview&quot;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      upload.onchange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> file = upload.files[<span class="number">0</span>]; <span class="comment">//File对象</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> src = URL.createObjectURL(file);</span></span><br><span class="line">        preview.src = src;</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="URL-revokeObjectURL-objectURL"><a href="#URL-revokeObjectURL-objectURL" class="headerlink" title="URL.revokeObjectURL(objectURL)"></a>URL.revokeObjectURL(objectURL)</h5><p>1、撤消之前使用 URL.createObjectURL()创建的 URL 对象。其中参数 objectURL 表示之前使用 URL.createObjectURL()创建的 URL 返回值。</p>
<h5 id="静态方法使用示例"><a href="#静态方法使用示例" class="headerlink" title="静态方法使用示例"></a>静态方法使用示例</h5><p>1、使用 Ajax 请求一个跨域图片避免 canvas 产生跨域问题，即可以使用这两个静态方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> url = URL.createObjectURL(<span class="built_in">this</span>.response);</span><br><span class="line">  <span class="keyword">const</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">  img.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 此时你就可以使用canvas对img为所欲为了</span></span><br><span class="line">    <span class="comment">// ... code ...</span></span><br><span class="line">    <span class="comment">// 图片用完后记得释放内存</span></span><br><span class="line">    URL.revokeObjectURL(url);</span><br><span class="line">  &#125;;</span><br><span class="line">  img.src = url;</span><br><span class="line">&#125;;</span><br><span class="line">xhr.open(<span class="string">&quot;GET&quot;</span>, url, <span class="literal">true</span>);</span><br><span class="line">xhr.responseType = <span class="string">&quot;blob&quot;</span>;</span><br><span class="line">xhr.send();</span><br></pre></td></tr></table></figure>
<h3 id="Blob、ArrayBuffer、File-的区别"><a href="#Blob、ArrayBuffer、File-的区别" class="headerlink" title="Blob、ArrayBuffer、File 的区别"></a>Blob、ArrayBuffer、File 的区别</h3><h4 id="Blob、ArrayBuffer、File-的类别"><a href="#Blob、ArrayBuffer、File-的类别" class="headerlink" title="Blob、ArrayBuffer、File 的类别"></a>Blob、ArrayBuffer、File 的类别</h4><p>1、Blob、ArrayBuffer、File 可以归为一类，它们都是数据。</p>
<ul>
<li>File 对象是一种特殊 Blob 对象。</li>
</ul>
<h4 id="Blob-与-ArrayBuffer-的区别"><a href="#Blob-与-ArrayBuffer-的区别" class="headerlink" title="Blob 与 ArrayBuffer 的区别"></a>Blob 与 ArrayBuffer 的区别</h4><p>1、ArrayBuffer 对象用于表示<code>通用的，固定长度的原始二进制数据缓冲区</code>。你不能直接操纵 ArrayBuffer 的内容，而是需要创建一个类型化数组对象或 <strong>DataView</strong> 对象，该对象以特定格式表示缓冲区，并使用该对象读取和写入缓冲区的内容。</p>
<p>2、Blob 类型的对象表示<code>不可变的类似文件对象的原始数据</code>。Blob 表示的不一定是 JavaScript 原生格式的数据。File 接口基于 Blob，继承了 Blob 功能并将其扩展为支持用户系统上的文件。</p>
<p>3、除非你需要使用 ArrayBuffer 提供的写入/编辑的能力，否则 Blob 格式可能是最好的。</p>
<p>4、Blob 对象是不可变的，而 ArrayBuffer 是可以通过 TypedArrays 或 DataView 来操作。</p>
<p>5、ArrayBuffer 是存在内存中的，可以直接操作。而 Blob 可以位于磁盘、高速缓存内存和其他不可用的位置。</p>
<p>6、虽然 Blob 可以直接作为参数传递给其他函数，比如 window.URL.createObjectURL()。但是，你可能仍需要 FileReader 之类的 File API 才能与 Blob 一起使用。</p>
<p>7、Blob 与 ArrayBuffer 对象之间是可以相互转化的：</p>
<ul>
<li><p>使用 FileReader 的 readAsArrayBuffer() 方法，可以把 Blob 对象转换为 ArrayBuffer 对象。</p>
</li>
<li><p>使用 Blob 构造函数，如 <code>new Blob([new Uint8Array(data])</code>，可以把 ArrayBuffer 对象转换为 Blob 对象。</p>
</li>
</ul>
<p>8、对于 HTTP 的场景，比如在 AJAX 场景下，Blob 和 ArrayBuffer 可以通过以下方式来使用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GET</span>(<span class="params">url, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  xhr.open(<span class="string">&quot;GET&quot;</span>, url, <span class="literal">true</span>);</span><br><span class="line">  xhr.responseType = <span class="string">&quot;arraybuffer&quot;</span>; <span class="comment">// or xhr.responseType = &quot;blob&quot;;</span></span><br><span class="line">  xhr.send();</span><br><span class="line"></span><br><span class="line">  xhr.onload = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (xhr.status != <span class="number">200</span>) &#123;</span><br><span class="line">      alert(<span class="string">&quot;Unexpected status code &quot;</span> + xhr.status + <span class="string">&quot; for &quot;</span> + url);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    callback(<span class="keyword">new</span> <span class="built_in">Uint8Array</span>(xhr.response)); <span class="comment">// or new Blob([xhr.response]);</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="文件互相转换方法"><a href="#文件互相转换方法" class="headerlink" title="文件互相转换方法"></a>文件互相转换方法</h3><h4 id="File-文件转换为-Blob-对象"><a href="#File-文件转换为-Blob-对象" class="headerlink" title="File 文件转换为 Blob 对象"></a>File 文件转换为 Blob 对象</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> aBlob = <span class="keyword">new</span> Blob([file], &#123; <span class="attr">type</span>: file.type &#125;);</span><br></pre></td></tr></table></figure>
<h4 id="Blob-转换为-File"><a href="#Blob-转换为-File" class="headerlink" title="Blob 转换为 File"></a>Blob 转换为 File</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> files = <span class="keyword">new</span> File([blob], file.name, &#123; <span class="attr">type</span>: file.type &#125;);</span><br></pre></td></tr></table></figure>
<h4 id="url-转-base64"><a href="#url-转-base64" class="headerlink" title="url 转 base64"></a>url 转 base64</h4><p>1、原理是：利用 canvas.toDataURL 的 API 转化成 base64：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">urlToBase64</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span> (<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> image = <span class="keyword">new</span> Image();</span><br><span class="line">    image.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">let</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">      canvas.width = <span class="built_in">this</span>.naturalWidth;</span><br><span class="line">      canvas.height = <span class="built_in">this</span>.naturalHeight;</span><br><span class="line">      <span class="comment">// 将图片插入画布并开始绘制</span></span><br><span class="line">      canvas.getContext(<span class="string">&#x27;2d&#x27;</span>).drawImage(image, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      <span class="comment">// result</span></span><br><span class="line">      <span class="keyword">let</span> result = canvas.toDataURL(<span class="string">&#x27;image/png&#x27;</span>)</span><br><span class="line">      resolve(result);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// CORS 策略，会存在跨域问题https://stackoverflow.com/questions/20424279/canvas-todataurl-securityerror</span></span><br><span class="line">    image.setAttribute(<span class="string">&quot;crossOrigin&quot;</span>,<span class="string">&#x27;Anonymous&#x27;</span>);</span><br><span class="line">    image.src = url;</span><br><span class="line">    <span class="comment">// 图片加载失败的错误处理</span></span><br><span class="line">    image.onerror = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;urlToBase64 error&#x27;</span>));</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line"><span class="keyword">let</span> imgUrL = <span class="string">`http://XXX.jpg`</span></span><br><span class="line">urlToBase64(imgUrL).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;base64&#x27;</span>, res)  <span class="comment">// 转化后的base64图片地址</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="base64-转-blob"><a href="#base64-转-blob" class="headerlink" title="base64 转 blob"></a>base64 转 blob</h4><p>1、原理：利用 URL.createObjectURL 为 blob 对象创建临时的 URL：</p>
<ul>
<li>方式一：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">base64ToBlob</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  b64data = <span class="string">&quot;&quot;</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  contentType = <span class="string">&quot;&quot;</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  sliceSize = <span class="number">512</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">&#125; = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 使用 atob() 方法将数据解码</span></span><br><span class="line">    <span class="keyword">let</span> byteCharacters = atob(b64data);</span><br><span class="line">    <span class="keyword">let</span> byteArrays = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> offset = <span class="number">0</span>; offset &lt; byteCharacters.length; offset += sliceSize) &#123;</span><br><span class="line">      <span class="keyword">let</span> slice = byteCharacters.slice(offset, offset + sliceSize);</span><br><span class="line">      <span class="keyword">let</span> byteNumbers = [];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; slice.length; i++) &#123;</span><br><span class="line">        byteNumbers.push(slice.charCodeAt(i));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 8 位无符号整数值的类型化数组。内容将初始化为 0。</span></span><br><span class="line">      <span class="comment">// 如果无法分配请求数目的字节，则将引发异常。</span></span><br><span class="line">      byteArrays.push(<span class="keyword">new</span> <span class="built_in">Uint8Array</span>(byteNumbers));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">new</span> Blob(byteArrays, &#123;</span><br><span class="line">      type: contentType,</span><br><span class="line">    &#125;);</span><br><span class="line">    result = <span class="built_in">Object</span>.assign(result, &#123;</span><br><span class="line">      <span class="comment">// 这里一定要处理一下 URL.createObjectURL</span></span><br><span class="line">      preview: URL.createObjectURL(result),</span><br><span class="line">      name: <span class="string">`XXX.png`</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    resolve(result);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line"><span class="keyword">let</span> base64 = base64.split(<span class="string">&quot;,&quot;</span>)[<span class="number">1</span>];</span><br><span class="line">base64ToBlob(&#123; <span class="attr">b64data</span>: base64, <span class="attr">contentType</span>: <span class="string">&quot;image/png&quot;</span> &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;blob&quot;</span>, res); <span class="comment">// 转后后的blob对象</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>方式二：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">base64ToBlob</span>(<span class="params">base64Data</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> arr = base64Data.split(<span class="string">&#x27;,&#x27;</span>),</span><br><span class="line">      fileType = arr[<span class="number">0</span>].match(<span class="regexp">/:(.*?);/</span>)[<span class="number">1</span>],</span><br><span class="line">      bstr = atob(arr[<span class="number">1</span>]),</span><br><span class="line">      l = bstr.length,</span><br><span class="line">      u8Arr = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(l);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (l--) &#123;</span><br><span class="line">      u8Arr[l] = bstr.charCodeAt(l);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Blob([u8Arr], &#123;</span><br><span class="line">      type: fileType</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h4 id="blob-转-base64"><a href="#blob-转-base64" class="headerlink" title="blob 转 base64"></a>blob 转 base64</h4><p>1、原理：利用 fileReader 的 readAsDataURL，将 blob 转为 base64：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">blobToBase64</span>(<span class="params">blob</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> fileReader = <span class="keyword">new</span> FileReader();</span><br><span class="line">    fileReader.onload = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      resolve(e.target.result);</span><br><span class="line">    &#125;;</span><br><span class="line">    fileReader.readAsDataURL(blob);</span><br><span class="line">    fileReader.onerror = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;blobToBase64 error&#x27;</span>));</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line">blobToBase64(blob).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;base64&#x27;</span>, res)  <span class="comment">// 转化后的base64</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>2、可以用于在浏览器上预览本地图片或者视频：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getWebUrl</span>(<span class="params">file</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> url = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// basic</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.createObjectURL != <span class="literal">undefined</span>) &#123;</span><br><span class="line">    url = <span class="built_in">window</span>.createObjectURL(file);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">window</span>.URL != <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="comment">// mozilla(firefox)</span></span><br><span class="line">    url = <span class="built_in">window</span>.URL.createObjectURL(file);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">window</span>.webkitURL != <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="comment">// webkit or chrome</span></span><br><span class="line">    url = <span class="built_in">window</span>.webkitURL.createObjectURL(file);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> url;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>JavaScript</category>
        <category>Blob</category>
        <category>File</category>
      </categories>
      <tags>
        <tag>FileReader</tag>
        <tag>Blob</tag>
        <tag>URL</tag>
        <tag>URLSearchParams</tag>
      </tags>
  </entry>
  <entry>
    <title>git</title>
    <url>/2020/03/06/git/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="git-生成-ssh"><a href="#git-生成-ssh" class="headerlink" title="git 生成 ssh"></a>git 生成 ssh</h4><p>1，查看是否设置用户名及邮箱：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">git config user.name  <span class="comment">// 查看用户名</span></span><br><span class="line"></span><br><span class="line">git config user.email <span class="comment">// 查看邮箱</span></span><br></pre></td></tr></table></figure>
<p>2，设置用户名及邮箱：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">git config --<span class="built_in">global</span> user.name <span class="string">&quot;xxxxx&quot;</span> <span class="comment">// 设置用户名</span></span><br><span class="line"></span><br><span class="line">git config --<span class="built_in">global</span> user.email <span class="string">&quot;xxxxx&quot;</span> <span class="comment">// 设置邮箱</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>

<p>3，查看是否配置过 ssh 文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">cd ~/.ssh</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果存在就能进入，说明已经创建过 ssh key 了，就不需要进行下面的步骤生成 ssh key 了。否则就不存在就说明还没有生成 ssh，使用如下步骤生成。</p>
</blockquote>
<p>4，生成 ssh key：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;你的邮箱地址&quot;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>此处会提示 Enter file in which to save the key (/Users/shutong/.ssh/id_rsa): 这样一段内容，让我们输入文件名，如果第 3 步的 ssh 文件存在的话最好在这里修改一下文件名以防覆盖之前的内容，如果第 3 步的 ssh 文件不存在的话则直接按 enter 键就好了。</p>
<p>之后会有提示你是否需要设置密码，如果设置了每次使用 Git 都会用到密码，一般都是直接不写为空，直接 enter 就好了。</p>
</blockquote>
<p>5，查看生成的 ssh 公钥：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">cat ~<span class="regexp">/.ssh/i</span>d_rsa.pub</span><br></pre></td></tr></table></figure>
<h4 id="git-删除远程分支"><a href="#git-删除远程分支" class="headerlink" title="git 删除远程分支"></a>git 删除远程分支</h4><p>1，使用如下命令查看远程分支：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">git branch -r</span><br></pre></td></tr></table></figure>
<p>2，使用如下命令删除查到的远程分支：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">git push origin --<span class="keyword">delete</span> [branch_name]</span><br></pre></td></tr></table></figure>
<h4 id="github-没有提交记录解决方式"><a href="#github-没有提交记录解决方式" class="headerlink" title="github 没有提交记录解决方式"></a>github 没有提交记录解决方式</h4><p>1，出现问题的原因：本地 ssh 生成的邮箱与 github 上的邮箱不一致导致。</p>
<p>2，处理方式：</p>
<ul>
<li><p>在需要提交到 github 的项目中使用 <strong>git config user.name ‘用户名’</strong> 生成局部用户名。使用 <strong>git config user.email ‘邮箱’</strong> 生成局部邮箱。</p>
</li>
<li><p>再使用 <strong>ssh-keygen -t rsa -C “刚设置的邮箱地址”</strong> 生成 ssh 公钥，生成的公钥最好改一下名称，否则会覆盖原来的。</p>
</li>
</ul>
<p>3，最后将生成的 ssh 公钥设置到 github 中，或者将全局的 ssh 公钥中处于公钥最后位置的邮箱地址修改为刚刚设置的局部邮箱地址也能达到相同的目的。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDCfmlAt2plCVbeObPxuWawsQovYcoanwwRZKVnA5O&#x2F;oMnGsyzjUWl+4dLOnSHmOo6dtEa9TDTZO7eWXtkVjMSLHyGTm5QvzrX31r&#x2F;kbkhC0E23ZUqB4uA8Re0fPnDWC8O1sFVvD1QGd1qjs+hQS&#x2F;sM0b+prwE0vWueM0zhuKpffjqSsbac9+6TkaCvGcaVvFIMNUWhGkhNWA4OjjhXTJEuDCwH+hT0orxzO&#x2F;mW9Si3aHJtXi0xptiX3zzTNFFO9gYmnH80KGgwwlMrbRC+SPlFBzGQybniN9quhzs7VYwOffY3jcCM81NRrdR+K9sJF+A6&#x2F;F2xV3VP+WAIjh1TQtVck2FF3k&#x2F;BdqMuVI4yo2JBHrhUG7apSwTN7vwasou3CGL4wygQatt+tdsGSDGyuQvVkImqPgBvS54fWzGb36pq4vI9Ix&#x2F;eLbVaunOwy+NnZGm1NU0oj1w203GS6OfO7yguxuoheeGoESn&#x2F;tiTmgcjkHbxNnl6oeCok&#x3D; xxx@xx.com</span><br></pre></td></tr></table></figure>
<ul>
<li>即将上述 ssh 公钥中的邮箱：<strong><a href="mailto:&#120;&#120;&#120;&#x40;&#x78;&#x78;&#46;&#99;&#111;&#109;">&#120;&#120;&#120;&#x40;&#x78;&#x78;&#46;&#99;&#111;&#109;</a></strong> 换成刚刚设置邮箱地址即可设置到 github 中生效。</li>
</ul>
<h4 id="git-合并分支"><a href="#git-合并分支" class="headerlink" title="git 合并分支"></a>git 合并分支</h4><p>1、git rebase -i HEAD~「需要合并的数量」进行合并：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 方式一：指定合并条数</span></span><br><span class="line">git rebase -i HEAD~<span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式二：选中最近的</span></span><br><span class="line">git rebase -i HEAD^^</span><br></pre></td></tr></table></figure>
<ul>
<li>当使用 git rebase -i HEAD~「需要合并的数量」命令时，会进入 vim 编辑界面，将内容更改为如下形式，只保留第一个 pick，之后所有 pick 改为 s，具体如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">pick dsa123ws 更改xxx</span><br><span class="line"></span><br><span class="line">s sdsad211 xxxxx</span><br><span class="line"></span><br><span class="line">s sdsad211 xxxxx</span><br><span class="line"></span><br><span class="line">s sdsad211 xxxxx</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>2、git rebase –abort 撤销合并。</p>
<p>3、当有冲突时的操作：</p>
<ul>
<li>首先使用 git add .，之后使用 git rebase –continue 保存：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">git add .</span><br><span class="line"></span><br><span class="line">git rebase --<span class="keyword">continue</span></span><br></pre></td></tr></table></figure>
<h4 id="获取指定的-commit"><a href="#获取指定的-commit" class="headerlink" title="获取指定的 commit"></a>获取指定的 commit</h4><p>1、使用 <strong>git cherry-pick</strong> 可以获取指定的 commit。 可以理解为 “挑拣” 提交，和 merge 合并一个分支的所有提交不同的是，它会获取某一个分支的单笔提交，并作为一个新的提交引入到你当前分支上。当需要在本地合入其他分支的提交时，如果不想对整个分支进行合并，而是只想将某一次提交合入到本地当前分支上，那么就要使用 git cherry-pick 了。</p>
<p>2、cherry-pick 语法为：<strong>git cherry-pick commit_id</strong>。</p>
<p>3、当执行 <code>git cherry-pick commit_id</code> 过程中出现冲突冲突，解决完冲突后，依次执行 <code>git add</code>、<code>git cherry-pick --continue</code>即可完成本次提交的挑拣。</p>
<h4 id="git-版本回退"><a href="#git-版本回退" class="headerlink" title="git 版本回退"></a>git 版本回退</h4><p>1、<strong>git reset –hard commit_id</strong>：该命令会把要回退版本之后提交的修改都删除掉，如在 master 分支上，有以下提交记录:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">42eae13 (HEAD -&gt; master) 第四次修改</span><br><span class="line">97ea0f9 第三次修改</span><br><span class="line">e50b7c2 第二次修改</span><br><span class="line">3a52650 第一次修改</span><br></pre></td></tr></table></figure>
<ul>
<li>当发现，在第四次修改有错误，需要回滚到第三次修改时，就可以用 reset 命令来回退。此时执行 <code>git reset --hard 97ea0f9</code> 命令，git 提交记录就会变为：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">97ea0f9 (HEAD -&gt; master) 第三次修改</span><br><span class="line">e50b7c2 第二次修改</span><br><span class="line">3a52650 第一次修改</span><br></pre></td></tr></table></figure>
<ul>
<li>执行 git reset 命令之后，42eae13（第四次修改）将消失在历史提交记录中，此时想要再次回退到第四次修改时，需要使用 <strong>git reflog</strong> 获取操作记录，根据操作记录中显示的第四次修改的 commit_id 进行回退，完整操作过程如下：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git reflog</span><br><span class="line"></span><br><span class="line">git reset --hard 42eae13</span><br></pre></td></tr></table></figure>
<ul>
<li>当发现第三次修改有错误，想要回到第三次修改，但同时要保留第四次修改时，就需要使用 <strong>git revert -n 97ea0f9</strong> 进行回退了。完整操作如下：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git revert -n 97ea0f9</span><br><span class="line">git commit -m &quot;恢复第三次修改&quot;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>-n 等价于 –no-commit，表示 revert 之后不自动进行 commit，而是需要自己手动进行 commit 提交。</p>
</blockquote>
<ul>
<li>执行上述命令之后，git 提交记录会变成：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">33b8b30 (HEAD -&gt; master) Revert &quot;恢复第三次修改&quot;</span><br><span class="line">42eae13 第四次修改</span><br><span class="line">97ea0f9 第三次修改</span><br><span class="line">e50b7c2 第二次修改</span><br><span class="line">3a52650 第一次修改</span><br></pre></td></tr></table></figure>
<blockquote>
<p>实际上，git 把第三次修改从提交中剔除（还原）了，还保留了第四次修改，并且产生了新的 commit_id。</p>
</blockquote>
<p>2、<strong>git revert</strong>：</p>
<ul>
<li><p><code>git revert commit_id</code>：表示回退到指定 commit_id 的版本。</p>
</li>
<li><p><code>git revert --no-commit HEAD~number^..HEAD</code>：表示从 HEAD 开始回退到 HEAD~number^。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git revert --no-commit HEAD~2^..HEAD</span><br><span class="line"></span><br><span class="line">等价于</span><br><span class="line"></span><br><span class="line">git revert --no-commit HEAD~3..HEAD</span><br><span class="line"></span><br><span class="line">等价于</span><br><span class="line"></span><br><span class="line">git revert --no-commit HEAD HEAD~1 HEAD~2</span><br></pre></td></tr></table></figure>
<ul>
<li>在 master 分支上有如下提交记录时：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">A1 ---&gt; A2 ---&gt; A3 ---&gt; A4 ---&gt; A5 ---&gt; A6</span><br></pre></td></tr></table></figure>
<ul>
<li>上述提交记录需要 revert A4 到 A6，此时范围表示为 HEAD<del>2^..HEAD 或者 HEAD</del>3..HEAD。当执行完 <code>git revert --no-commit HEAD~2^..HEAD</code> 时，commit 提交记录将变为：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">A1 ---&gt; A2 ---&gt; A3 ---&gt; A4 ---&gt; A5 ---&gt; A6 ---&gt; A3&#39;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此时 A4，A5，A6 依然在历史里，新的 A3’ commit 就是 revert 掉 A4，A5，A6 之后的结果，其实就是 A3 的状态，但历史都保留了。</p>
</blockquote>
<p>3、假如现在有三个提交，但很不巧的是，那个错误的提交刚好位于中间。如下图示：</p>
<p><img src="/2020/03/06/git/git1.png" alt="版本回退"></p>
<ul>
<li>上图中可以看出，B 是错误提交，而 C 提交是没问题的，此时就需要先把 B、C 都使用 revert 进行回退掉，在使用 <code>git cherry-pick C</code> 命令将 C 重新再生成一个新的提交 C’’，这样就实现了将 B 提交回退，而保留 C 提交的需求了。完整过程如下图：</li>
</ul>
<p><img src="/2020/03/06/git/git2.png" alt="版本回退"></p>
<p>4、git reset 与 git revert 的区别：</p>
<ul>
<li><p>git revert 是用一次新的 commit 来回滚到之前的 commit，而 git reset 是直接删除指定的 commit。</p>
</li>
<li><p>在回滚这一操作上看，这两者效果差不多。但是在之后继续 merge 以前的老版本时有区别。因为 git revert 是用一次逆向的 commit 中和之前的提交，因此之后合并老的 branch 时，这部分改变不会再次出现，可以减少冲突。但是 git reset 是之间把某些 commit 在某个 branch 上删除，因而和老的 branch 再次 merge 时，这些被回滚的 commit 应该还会被引入，会产生很多冲突。、</p>
</li>
<li><p>git reset 是把 HEAD 向后移动了一下，而 git revert 是 HEAD 继续前进，只是新的 commit 的内容和要 revert 的内容正好相反，能够抵消要被 revert 的内容。</p>
</li>
</ul>
<h4 id="git-打-tag"><a href="#git-打-tag" class="headerlink" title="git 打 tag"></a>git 打 tag</h4><p>1、使用 <code>git tag</code> 命令可以列出已有的 tag。</p>
<p>2、使用 <code>git tag v1.1.0</code> 进行新建 tag。</p>
<p>3、使用 <code>git push origin v1.1.0</code> 将新建的 tag 推送到远程服务器。</p>
<p>4、使用 <code>git tag -d v1.1.0</code> 删除本地某个 tag。</p>
<p>5、使用 <code>git push origin :refs/tags/v1.1.0</code> 删除远程某个 tag。</p>
<h4 id="vim-命令相关"><a href="#vim-命令相关" class="headerlink" title="vim 命令相关"></a>vim 命令相关</h4><p>1、多选：v + 上下键。</p>
<p>2、更改每行开头的指定内容：</p>
<ul>
<li><p>首先输入英文模式下的「：」。</p>
</li>
<li><p>之后输入「起始行数,终止行数」s/^pick/s（如：2，10 s/^pick/s 则表示将 2 到 10 行开头的 pick 全部改为 s）：</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">:<span class="number">2</span>,<span class="number">10</span> s/^pick/s</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>代码托管</category>
        <category>git</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>JsTools</title>
    <url>/2021/07/20/jsTools/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="检测当前页面是否被隐藏"><a href="#检测当前页面是否被隐藏" class="headerlink" title="检测当前页面是否被隐藏"></a>检测当前页面是否被隐藏</h4><p>1、使用 <strong>visibilitychange</strong> 事件可监测当前页面是否被隐藏，当切换页面时<strong>document.hidden</strong>显示为 true 则为隐藏, false 就是显示状态。</p>
<p>2、一般在工作用主要用到用户在页面停留了多长时间。如：爱奇艺广告播放时间居然是在当前标签页激活的时候才会进行倒计时，离开当前标签页的时候，倒计时停止。</p>
<p>2、基本使用方式如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">&quot;visibilitychange&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">document</span>.hidden);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<a id="more"></a>

<p>3、兼容性写法如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">&quot;visibilitychange&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> hidden;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">document</span>.hidden !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    hidden = <span class="string">&quot;hidden&quot;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">document</span>.mozHidden !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    hidden = <span class="string">&quot;mozHidden&quot;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">document</span>.msHidden !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    hidden = <span class="string">&quot;msHidden&quot;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">document</span>.webkitHidden !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    hidden = <span class="string">&quot;webkitHidden&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">document</span>.hidden) &#123;</span><br><span class="line">    <span class="built_in">document</span>.title = <span class="string">&quot;关闭&quot;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.title = <span class="string">&quot;显示&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="保留-N-位小数"><a href="#保留-N-位小数" class="headerlink" title="保留 N 位小数"></a>保留 N 位小数</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> toFixed = <span class="function">(<span class="params">n, fixed</span>) =&gt;</span> ~~(<span class="built_in">Math</span>.pow(<span class="number">10</span>, fixed) * n) / <span class="built_in">Math</span>.pow(<span class="number">10</span>, fixed);</span><br><span class="line"><span class="comment">// 事例</span></span><br><span class="line">toFixed(<span class="number">25.198726354</span>, <span class="number">1</span>); <span class="comment">// 25.1</span></span><br><span class="line">toFixed(<span class="number">25.198726354</span>, <span class="number">2</span>); <span class="comment">// 25.19</span></span><br><span class="line">toFixed(<span class="number">25.198726354</span>, <span class="number">3</span>); <span class="comment">// 25.198</span></span><br><span class="line">toFixed(<span class="number">25.198726354</span>, <span class="number">4</span>); <span class="comment">// 25.1987</span></span><br><span class="line">toFixed(<span class="number">25.198726354</span>, <span class="number">5</span>); <span class="comment">// 25.19872</span></span><br><span class="line">toFixed(<span class="number">25.198726354</span>, <span class="number">6</span>); <span class="comment">// 25.198726</span></span><br></pre></td></tr></table></figure>
<h4 id="检查当前是否有元素处于焦点中"><a href="#检查当前是否有元素处于焦点中" class="headerlink" title="检查当前是否有元素处于焦点中"></a>检查当前是否有元素处于焦点中</h4><p>1、使用 <strong>document.activeElement</strong> 属性检查一个元素是否当前处于焦点。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> elementIsInFocus = <span class="function">(<span class="params">el</span>) =&gt;</span> el === <span class="built_in">document</span>.activeElement;</span><br><span class="line">elementIsInFocus(anyElement);</span><br><span class="line"><span class="comment">// 如果在焦点中返回true，如果不在焦点中返回 false</span></span><br></pre></td></tr></table></figure>
<h4 id="js-实现复制功能"><a href="#js-实现复制功能" class="headerlink" title="js 实现复制功能"></a>js 实现复制功能</h4><p>1、可以使用 <code>document.execCommand(&quot;copy&quot;)</code> 实现，具体如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> copyToClipboard = <span class="function">(<span class="params">str</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(<span class="string">&quot;textarea&quot;</span>);</span><br><span class="line">  el.value = str;</span><br><span class="line">  <span class="comment">// 防止唤起虚拟键盘</span></span><br><span class="line">  el.setAttribute(<span class="string">&quot;readonly&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="comment">// 让文本域不显示在页面可视区域内</span></span><br><span class="line">  el.style.position = <span class="string">&quot;absolute&quot;</span>;</span><br><span class="line">  el.style.left = <span class="string">&quot;-9999px&quot;</span>;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(el);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> selected =</span><br><span class="line">    <span class="built_in">document</span>.getSelection().rangeCount &gt; <span class="number">0</span></span><br><span class="line">      ? <span class="built_in">document</span>.getSelection().getRangeAt(<span class="number">0</span>)</span><br><span class="line">      : <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  el.select();</span><br><span class="line">  <span class="built_in">document</span>.execCommand(<span class="string">&quot;copy&quot;</span>);</span><br><span class="line">  <span class="built_in">document</span>.body.removeChild(el);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (selected) &#123;</span><br><span class="line">    <span class="built_in">document</span>.getSelection().removeAllRanges();</span><br><span class="line">    <span class="built_in">document</span>.getSelection().addRange(selected);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="JS-实现千位分隔符"><a href="#JS-实现千位分隔符" class="headerlink" title="JS 实现千位分隔符"></a>JS 实现千位分隔符</h4><h5 id="实现方式一"><a href="#实现方式一" class="headerlink" title="实现方式一"></a>实现方式一</h5><p>1、首先将数字转为字符串数组，在循环整个数组，每三位添加一个分隔逗号，最后再合并成字符串。</p>
<p>2、由于分隔符在顺序上是从后往前添加的：比如 1234567 添加后是 1,234,567 而不是 123,456,7，所以方便起见可以先把数组倒序排列，添加完之后再将顺序倒回来，就是正常顺序了。</p>
<p>3、<strong>注意</strong>：如果数字带小数的话，要把小数部分分开处理。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">numFormat</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 分隔小数点</span></span><br><span class="line">  num = num.toString().split(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  <span class="comment">// 转换成字符数组并且倒序排列</span></span><br><span class="line">  <span class="keyword">var</span> arr = num[<span class="number">0</span>].split(<span class="string">&quot;&quot;</span>).reverse();</span><br><span class="line">  <span class="keyword">var</span> res = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (i % <span class="number">3</span> === <span class="number">0</span> &amp;&amp; i !== <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// 添加分隔符</span></span><br><span class="line">      res.push(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    res.push(arr[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 再次倒序成为正确的顺序</span></span><br><span class="line">  res.reverse();</span><br><span class="line">  <span class="comment">// 如果有小数的话添加小数部分</span></span><br><span class="line">  <span class="keyword">if</span> (num[<span class="number">1</span>]) &#123;</span><br><span class="line">    res = res.join(<span class="string">&quot;&quot;</span>).concat(<span class="string">&quot;.&quot;</span> + num[<span class="number">1</span>]);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res = res.join(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1234567894532</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="number">673439.4542</span>;</span><br><span class="line"><span class="built_in">console</span>.log(numFormat(a)); <span class="comment">// &quot;1,234,567,894,532&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(numFormat(b)); <span class="comment">// &quot;673,439.4542&quot;</span></span><br></pre></td></tr></table></figure>
<h5 id="实现方式二"><a href="#实现方式二" class="headerlink" title="实现方式二"></a>实现方式二</h5><p>1、使用 JS 自带的 API **toLocaleString()**，该方法返回这个数字在特定语言环境下的表示字符串。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">numObj.toLocaleString(locales, options);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>locales：缩写语言代码（BCP 47 language tag，例如：cmn-Hans-CN）的字符串或者这些字符串组成的数组。<br>options：包含一些或所有的下面属性的类。decimal =&gt; 用于纯数字格式，currency =&gt; 用于货币格式，percent =&gt; 用于百分比格式，unit =&gt; 用于单位格式。</p>
</blockquote>
<p>2、<strong>注意</strong>：该方法在没有指定区域时，返回时用默认的语言环境和默认选项格式化的字符串，所以不同地区数字格式可能会有一定的差异，因此最好确保使用 locales 参数指定了使用的语言。</p>
<p>3、实现数字插入千位符代码如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="number">1234567894532</span>;</span><br><span class="line"><span class="keyword">const</span> b = <span class="number">673439.4542</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a.toLocaleString()); <span class="comment">// &quot;1,234,567,894,532&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(b.toLocaleString()); <span class="comment">// &quot;673,439.454&quot;  （小数部分四舍五入了）</span></span><br></pre></td></tr></table></figure>
<h5 id="实现方式三"><a href="#实现方式三" class="headerlink" title="实现方式三"></a>实现方式三</h5><p>1、使用 <code>RegExp 和 replace()</code> 方法。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">numFormat</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 先提取整数部分</span></span><br><span class="line">  <span class="keyword">var</span> res = num.toString().replace(<span class="regexp">/\d+/</span>, <span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n.replace(<span class="regexp">/(\d)(?=(\d&#123;3&#125;)+$)/g</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$<span class="number">1</span></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $<span class="number">1</span> + <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1234567894532</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="number">673439.4542</span>;</span><br><span class="line"><span class="built_in">console</span>.log(numFormat(a)); <span class="comment">// &quot;1,234,567,894,532&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(numFormat(b)); <span class="comment">// &quot;673,439.4542&quot;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>上述代码中，对象或者字面量所匹配的内容会被第二个参数的返回值替换。</p>
</blockquote>
<h4 id="改变对象属性名的方式"><a href="#改变对象属性名的方式" class="headerlink" title="改变对象属性名的方式"></a>改变对象属性名的方式</h4><h5 id="JSON-parse-amp-amp-JSON-stringify"><a href="#JSON-parse-amp-amp-JSON-stringify" class="headerlink" title="JSON.parse() &amp;&amp; JSON.stringify()"></a>JSON.parse() &amp;&amp; JSON.stringify()</h5><p>1、缺点：如果属性值匹配到也会被更改，而且属性名中有部分匹配到也会被更改。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> aaa = [</span><br><span class="line">  &#123;</span><br><span class="line">    Name: <span class="string">&quot;test1Name&quot;</span>,</span><br><span class="line">    type: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    Name: <span class="string">&quot;test2&quot;</span>,</span><br><span class="line">    model: <span class="string">&quot;model2&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"><span class="keyword">var</span> bbb = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(aaa).replace(<span class="regexp">/Name/g</span>, <span class="string">&quot;title&quot;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(bbb);</span><br></pre></td></tr></table></figure>
<h5 id="使用递归遍历"><a href="#使用递归遍历" class="headerlink" title="使用递归遍历"></a>使用递归遍历</h5><p>1、使用递归遍历对数组中每一个对象的属性名进行更改。</p>
<p>2、函数第一个参数是要修改的对象，第二个参数传数组 key 为要被改的属性名，value 为改成的属性名。</p>
<p>3、函数本身是一个深拷贝，通过对其每层中对象的“键”做匹配替换即实现了多层的“键”替换，另外这里如果传空数组此函数就是一个深拷贝。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">copyTrans</span>(<span class="params">obj, typeArr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result;</span><br><span class="line">  <span class="keyword">const</span> &#123; toString &#125; = <span class="built_in">Object</span>.prototype;</span><br><span class="line">  <span class="keyword">if</span> (toString.call(obj) === <span class="string">&quot;[object Array]&quot;</span>) &#123;</span><br><span class="line">    result = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; obj.length; i++) &#123;</span><br><span class="line">      result[i] = copyTrans(obj[i], typeArr);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (toString.call(obj) === <span class="string">&quot;[object Object]&quot;</span>) &#123;</span><br><span class="line">    result = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> _key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">      <span class="keyword">if</span> (obj.hasOwnProperty(_key)) &#123;</span><br><span class="line">        <span class="keyword">let</span> flag = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">let</span> _value = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; typeArr.length; j++) &#123;</span><br><span class="line">          <span class="keyword">if</span> (typeArr[j].key === _key) &#123;</span><br><span class="line">            flag = <span class="number">1</span>;</span><br><span class="line">            _value = typeArr[j].value;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">          result[_value] = copyTrans(obj[_key], typeArr);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          result[_key] = copyTrans(obj[_key], typeArr);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr = [</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;key&quot;</span>, <span class="attr">age</span>: <span class="string">&quot;18&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">key</span>: <span class="string">&quot;name&quot;</span>, <span class="attr">address</span>: <span class="string">&quot;poyang&quot;</span> &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> res = copyTrans(arr, [</span><br><span class="line">  &#123; <span class="attr">key</span>: <span class="string">&quot;name&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;myname&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">key</span>: <span class="string">&quot;key&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;myvalue&quot;</span> &#125;,</span><br><span class="line">]);</span><br><span class="line"><span class="built_in">console</span>.log(res);</span><br></pre></td></tr></table></figure>
<h4 id="时间转换"><a href="#时间转换" class="headerlink" title="时间转换"></a>时间转换</h4><h5 id="将时长转成-时-分-秒"><a href="#将时长转成-时-分-秒" class="headerlink" title="将时长转成 时:分:秒"></a>将时长转成 时:分:秒</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> timeToMinute = <span class="function">(<span class="params">time</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> t;</span><br><span class="line">  <span class="keyword">if</span> (time &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> hour = <span class="built_in">Math</span>.floor(time / <span class="number">3600</span>);</span><br><span class="line">    <span class="keyword">const</span> min = <span class="built_in">Math</span>.floor(time / <span class="number">60</span>) % <span class="number">60</span>;</span><br><span class="line">    <span class="keyword">const</span> sec = time % <span class="number">60</span>;</span><br><span class="line">    <span class="keyword">if</span> (hour &lt; <span class="number">10</span>) &#123;</span><br><span class="line">      t = <span class="string">&quot;0&quot;</span> + hour + <span class="string">&quot;:&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      t = hour + <span class="string">&quot;:&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (min &lt; <span class="number">10</span>) &#123;</span><br><span class="line">      t += <span class="string">&quot;0&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    t += min + <span class="string">&quot;:&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (sec &lt; <span class="number">10</span>) &#123;</span><br><span class="line">      t += <span class="string">&quot;0&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    t += sec.toFixed(<span class="number">2</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  t = t.substring(<span class="number">0</span>, t.length - <span class="number">3</span>);</span><br><span class="line">  <span class="keyword">return</span> t;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> res = timeToMinute(<span class="number">320</span>);</span><br><span class="line"><span class="built_in">console</span>.log(res);</span><br></pre></td></tr></table></figure>
<h5 id="将时间转成-天-时-分-秒"><a href="#将时间转成-天-时-分-秒" class="headerlink" title="将时间转成 天/时/分/秒"></a>将时间转成 天/时/分/秒</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">secondsFormat</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> day = <span class="built_in">Math</span>.floor(s / (<span class="number">24</span> * <span class="number">3600</span>)); <span class="comment">// Math.floor()向下取整</span></span><br><span class="line">  <span class="keyword">var</span> hour = <span class="built_in">Math</span>.floor((s - day * <span class="number">24</span> * <span class="number">3600</span>) / <span class="number">3600</span>);</span><br><span class="line">  <span class="keyword">var</span> minute = <span class="built_in">Math</span>.floor((s - day * <span class="number">24</span> * <span class="number">3600</span> - hour * <span class="number">3600</span>) / <span class="number">60</span>);</span><br><span class="line">  <span class="keyword">var</span> second = s - day * <span class="number">24</span> * <span class="number">3600</span> - hour * <span class="number">3600</span> - minute * <span class="number">60</span>;</span><br><span class="line">  <span class="keyword">return</span> day + <span class="string">&quot;天&quot;</span> + hour + <span class="string">&quot;时&quot;</span> + minute + <span class="string">&quot;分&quot;</span> + second + <span class="string">&quot;秒&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(secondsFormat(<span class="number">5555555</span>)); <span class="comment">// 64天7时12分35秒</span></span><br><span class="line"><span class="built_in">console</span>.log(secondsFormat(<span class="number">1234</span>)); <span class="comment">// 0天0时20分34秒</span></span><br></pre></td></tr></table></figure>
<h5 id="将时间转成-年-月-日-时-分-秒"><a href="#将时间转成-年-月-日-时-分-秒" class="headerlink" title="将时间转成 年/月/日 时:分:秒"></a>将时间转成 年/月/日 时:分:秒</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getHMS</span>(<span class="params">timestamp</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(timestamp); <span class="comment">//时间戳为10位需*1000，时间戳为13位的话不需乘1000</span></span><br><span class="line">  <span class="keyword">var</span> Y = date.getFullYear() + <span class="string">&quot;/&quot;</span>;</span><br><span class="line">  <span class="keyword">var</span> M =</span><br><span class="line">    (date.getMonth() + <span class="number">1</span> &lt; <span class="number">10</span></span><br><span class="line">      ? <span class="string">&quot;0&quot;</span> + (date.getMonth() + <span class="number">1</span>)</span><br><span class="line">      : date.getMonth() + <span class="number">1</span>) + <span class="string">&quot;/&quot;</span>;</span><br><span class="line">  <span class="keyword">var</span> D = (date.getDate() &lt; <span class="number">10</span> ? <span class="string">&quot;0&quot;</span> + date.getDate() : date.getDate()) + <span class="string">&quot; &quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> h =</span><br><span class="line">    (date.getHours() &lt; <span class="number">10</span> ? <span class="string">&quot;0&quot;</span> + date.getHours() : date.getHours()) + <span class="string">&quot;:&quot;</span>;</span><br><span class="line">  <span class="keyword">var</span> m =</span><br><span class="line">    (date.getMinutes() &lt; <span class="number">10</span> ? <span class="string">&quot;0&quot;</span> + date.getMinutes() : date.getMinutes()) +</span><br><span class="line">    <span class="string">&quot;:&quot;</span>;</span><br><span class="line">  <span class="keyword">var</span> s = date.getSeconds() &lt; <span class="number">10</span> ? <span class="string">&quot;0&quot;</span> + date.getSeconds() : date.getSeconds();</span><br><span class="line">  <span class="keyword">return</span> Y + M + D + h + m + s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> HMS = getHMS(<span class="built_in">Date</span>.now());</span><br><span class="line"><span class="built_in">console</span>.log(HMS); <span class="comment">// 2021/01/12 14:06:25</span></span><br></pre></td></tr></table></figure>
<h5 id="时间戳转成-YYYY-MM-DD-hh-mm-ss-新思路"><a href="#时间戳转成-YYYY-MM-DD-hh-mm-ss-新思路" class="headerlink" title="时间戳转成 YYYY-MM-DD hh:mm:ss 新思路"></a>时间戳转成 YYYY-MM-DD hh:mm:ss 新思路</h5><p>1、Date 的 ‘toJSON’ 方法返回格林威治时间的 JSON 格式字符串，实际是使用 ‘toISOString’ 方法的结果。字符串形如’2018-08-09T10:20:54.396Z’，转化为北京时间需要额外增加八个时区，我们需要取字符串前 19 位，然后把 ‘T’ 替换为空格，即是我们需要的时间格式。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">time</span>(<span class="params">time = +<span class="keyword">new</span> <span class="built_in">Date</span>()</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(time + <span class="number">8</span> * <span class="number">3600</span> * <span class="number">1000</span>); <span class="comment">// 增加8小时</span></span><br><span class="line">  <span class="built_in">console</span>.log(date.toJSON()); <span class="comment">// 2021-01-12T14:20:21.511Z</span></span><br><span class="line">  <span class="keyword">return</span> date.toJSON().substr(<span class="number">0</span>, <span class="number">19</span>).replace(<span class="string">&quot;T&quot;</span>, <span class="string">&quot; &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> myTime = time();</span><br><span class="line"><span class="built_in">console</span>.log(myTime); <span class="comment">// 2021-01-12 14:13:13</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getTime</span>(<span class="params">time = +<span class="keyword">new</span> <span class="built_in">Date</span>()</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(time + <span class="number">8</span> * <span class="number">3600</span> * <span class="number">1000</span>); <span class="comment">// 增加8小时</span></span><br><span class="line">  <span class="keyword">return</span> date.toJSON().substr(<span class="number">0</span>, <span class="number">19</span>).replace(<span class="string">&quot;T&quot;</span>, <span class="string">&quot; &quot;</span>).replace(<span class="regexp">/-/g</span>, <span class="string">&quot;.&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> time1 = getTime();</span><br><span class="line"><span class="built_in">console</span>.log(time1); <span class="comment">// 2021.01.12 14:18:55</span></span><br></pre></td></tr></table></figure>
<h5 id="将时间转为时间戳"><a href="#将时间转为时间戳" class="headerlink" title="将时间转为时间戳"></a>将时间转为时间戳</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getTimestamp</span>(<span class="params">time</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(time).getTime();</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(getTimestamp(<span class="string">&quot;2020/12/25 11:02:09&quot;</span>)); <span class="comment">// 1608865329000</span></span><br><span class="line"><span class="built_in">console</span>.log(getTimestamp(<span class="string">&quot;2020-12-24 11:09:02&quot;</span>)); <span class="comment">// 1608779342000</span></span><br></pre></td></tr></table></figure>
<h4 id="获取文件后缀名"><a href="#获取文件后缀名" class="headerlink" title="获取文件后缀名"></a>获取文件后缀名</h4><p>1、使用场景：上传文件判断后缀名。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getExt</span>(<span class="params">filename</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> filename == <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> filename.split(<span class="string">&quot;.&quot;</span>).pop().toLowerCase();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;filename must be a string type&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="设置休眠事件"><a href="#设置休眠事件" class="headerlink" title="设置休眠事件"></a>设置休眠事件</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params">ms</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(resolve, ms));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用方式</span></span><br><span class="line"><span class="keyword">const</span> fetchData = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> sleep(<span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="生成随机字符串"><a href="#生成随机字符串" class="headerlink" title="生成随机字符串"></a>生成随机字符串</h4><p>1、可以用此方式生成唯一的 id。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">uuid</span>(<span class="params">length, chars</span>) </span>&#123;</span><br><span class="line">  chars =</span><br><span class="line">    chars || <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line">  length = length || <span class="number">8</span>;</span><br><span class="line">  <span class="keyword">var</span> result = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = length; i &gt; <span class="number">0</span>; --i)</span><br><span class="line">    result += chars[<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * chars.length)];</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="对象转化为-FormData-对象"><a href="#对象转化为-FormData-对象" class="headerlink" title="对象转化为 FormData 对象"></a>对象转化为 FormData 对象</h4><p>1、使用场景：上传文件时我们要新建一个 FormData 对象，然后有多少个参数就 append 多少次，使用该函数可以简化逻辑。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getFormData</span>(<span class="params">object</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">  <span class="built_in">Object</span>.keys(object).forEach(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> value = object[key];</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(value)) &#123;</span><br><span class="line">      value.forEach(<span class="function">(<span class="params">subValue, i</span>) =&gt;</span> formData.append(key + <span class="string">`[<span class="subst">$&#123;i&#125;</span>]`</span>, subValue));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      formData.append(key, object[key]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> formData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="js-生成随机颜色"><a href="#js-生成随机颜色" class="headerlink" title="js 生成随机颜色"></a>js 生成随机颜色</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 随机生成rgb颜色</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rgb</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> r = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">256</span>);</span><br><span class="line">  <span class="keyword">let</span> g = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">256</span>);</span><br><span class="line">  <span class="keyword">let</span> b = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">256</span>);</span><br><span class="line">  <span class="keyword">let</span> rgb = <span class="string">&quot;rgb(&quot;</span> + r + <span class="string">&quot;,&quot;</span> + g + <span class="string">&quot;,&quot;</span> + b + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> rgb;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 随机生成16进制颜色</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">color_16</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> r = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">256</span>);</span><br><span class="line">  <span class="keyword">let</span> g = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">256</span>);</span><br><span class="line">  <span class="keyword">let</span> b = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">256</span>);</span><br><span class="line">  <span class="keyword">let</span> color = <span class="string">&quot;#&quot;</span> + r.toString(<span class="number">16</span>) + g.toString(<span class="number">16</span>) + b.toString(<span class="number">16</span>);</span><br><span class="line">  <span class="keyword">return</span> color;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取指定的随机颜色</span></span><br><span class="line"><span class="keyword">const</span> randomColor = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> colors = [</span><br><span class="line">    <span class="string">&quot;#a18cd1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;#fad0c4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;#ff8177&quot;</span>,</span><br><span class="line">    <span class="string">&quot;#fecfef&quot;</span>,</span><br><span class="line">    <span class="string">&quot;#fda085&quot;</span>,</span><br><span class="line">    <span class="string">&quot;#f5576c&quot;</span>,</span><br><span class="line">    <span class="string">&quot;#330867&quot;</span>,</span><br><span class="line">    <span class="string">&quot;#30cfd0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;#38f9d7&quot;</span>,</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">var</span> colorIndex = <span class="built_in">Math</span>.floor(colors.length * <span class="built_in">Math</span>.random());</span><br><span class="line">  <span class="keyword">return</span> colors[colorIndex];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="js-随机设置字体大小"><a href="#js-随机设置字体大小" class="headerlink" title="js 随机设置字体大小"></a>js 随机设置字体大小</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获得一个包含最小值和最大值之间的随机数</span></span><br><span class="line"><span class="keyword">const</span> randomNumber = <span class="function">(<span class="params">lowerInteger = <span class="number">15</span>, upperInteger = <span class="number">35</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> choices = upperInteger - lowerInteger + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * choices + lowerInteger) + <span class="string">&quot;px&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="平滑滚动到底部"><a href="#平滑滚动到底部" class="headerlink" title="平滑滚动到底部"></a>平滑滚动到底部</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toBottom</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">scrollToBottom</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 外层容器 出现滚动条的dom</span></span><br><span class="line">    <span class="keyword">const</span> domWrapper = <span class="built_in">document</span>.querySelector(<span class="string">&quot;.wrapper&quot;</span>);</span><br><span class="line">    (<span class="function"><span class="keyword">function</span> <span class="title">smoothscroll</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 已经被卷掉的高度</span></span><br><span class="line">      <span class="keyword">const</span> currentScroll = domWrapper.scrollTop;</span><br><span class="line">      <span class="comment">// 容器高度</span></span><br><span class="line">      <span class="keyword">const</span> clientHeight = domWrapper.offsetHeight;</span><br><span class="line">      <span class="comment">// 内容总高度</span></span><br><span class="line">      <span class="keyword">const</span> scrollHeight = domWrapper.scrollHeight;</span><br><span class="line">      <span class="keyword">if</span> (scrollHeight - <span class="number">10</span> &gt; currentScroll + clientHeight) &#123;</span><br><span class="line">        requestAnimationFrame(smoothscroll);</span><br><span class="line">        domWrapper.scrollTo(</span><br><span class="line">          <span class="number">0</span>,</span><br><span class="line">          currentScroll + (scrollHeight - currentScroll - clientHeight) / <span class="number">2</span></span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">setTimeout</span>(scrollToBottom, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="平滑滚动到顶部"><a href="#平滑滚动到顶部" class="headerlink" title="平滑滚动到顶部"></a>平滑滚动到顶部</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> onBackToTop = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> domWrapper = <span class="built_in">document</span>.querySelector(<span class="string">&quot;.wrapper&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> toTop = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (domWrapper.scrollTop === <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">const</span> speed = <span class="number">100</span>;</span><br><span class="line">    domWrapper.scrollTop -= speed;</span><br><span class="line">    requestAnimationFrame(toTop);</span><br><span class="line">  &#125;;</span><br><span class="line">  requestAnimationFrame(toTop);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="数组转树形结构"><a href="#数组转树形结构" class="headerlink" title="数组转树形结构"></a>数组转树形结构</h4><p>1、使用递归实现：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> arrayToTree = <span class="function">(<span class="params">arr, pid</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> res = [];</span><br><span class="line">  arr.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (item.pid === pid) &#123;</span><br><span class="line">      <span class="keyword">let</span> itemChildren = arrayToTree(arr, item.id);</span><br><span class="line">      <span class="keyword">if</span> (itemChildren.length) &#123;</span><br><span class="line">        item.children = itemChildren;</span><br><span class="line">      &#125;</span><br><span class="line">      res.push(item);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>2、非递归实现：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> arrayToTree = <span class="function">(<span class="params">arr</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> result = [];</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(arr) || arr.length === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> map = &#123;&#125;;</span><br><span class="line">  arr.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> (map[item.id] = item));</span><br><span class="line">  arr.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> parent = map[item.pid];</span><br><span class="line">    <span class="keyword">if</span> (parent) &#123;</span><br><span class="line">      (parent.children || (parent.children = [])).push(item);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      result.push(item);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="筛选符合条件的数据并返回树结构"><a href="#筛选符合条件的数据并返回树结构" class="headerlink" title="筛选符合条件的数据并返回树结构"></a>筛选符合条件的数据并返回树结构</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> filterTreeByFunc = <span class="function">(<span class="params">tree, func</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(tree) || tree.length === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> tree.filter(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    item.children = item.children &amp;&amp; filterTreeByFunc(item.children, func);</span><br><span class="line">    <span class="keyword">return</span> func(item) || (item.children &amp;&amp; item.children.length);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 条件为show为true</span></span><br><span class="line"><span class="keyword">const</span> func = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> item.show === <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="findFibonacci-函数"><a href="#findFibonacci-函数" class="headerlink" title="findFibonacci 函数"></a>findFibonacci 函数</h4><p>1、在一堆正整数中，找到最长的一组斐波那契数列段：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 实现方式一</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">findFibnacci</span>(<span class="params">list</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> map = &#123;&#125;,</span><br><span class="line">    results = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> num1 <span class="keyword">of</span> list) &#123;</span><br><span class="line">    map[num1] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> num2 <span class="keyword">of</span> list) &#123;</span><br><span class="line">      <span class="keyword">if</span> (num2 &gt; num1) &#123;</span><br><span class="line">        results.push([num1, num2]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> longest = [];</span><br><span class="line">  <span class="keyword">while</span> (results.length) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = results.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">      <span class="keyword">let</span> result = results[i];</span><br><span class="line">      <span class="keyword">let</span> n1 = result[result.length - <span class="number">2</span>];</span><br><span class="line">      <span class="keyword">let</span> n2 = result[result.length - <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">let</span> next = n1 + n2;</span><br><span class="line">      <span class="keyword">if</span> (!map[next]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (result.length &gt; longest.length) &#123;</span><br><span class="line">          longest = result;</span><br><span class="line">        &#125;</span><br><span class="line">        results.splice(i, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      result.push(next);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> longest;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> res = findFibnacci([<span class="number">13</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">25</span>, <span class="number">31</span>, <span class="number">11</span>, <span class="number">21</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(res);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现方式二</span></span><br><span class="line"><span class="keyword">var</span> arr1 = arr.sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a - b;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> tempArr = [];</span><br><span class="line">tempArr.push(arr1[<span class="number">0</span>], arr[<span class="number">1</span>]);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">2</span>; i &lt; arr1.length; i++) &#123;</span><br><span class="line">  <span class="keyword">if</span> (arr1[i] == arr1[i - <span class="number">2</span>] + arr1[i - <span class="number">1</span>]) &#123;</span><br><span class="line">    tempArr.push(arr1[i]);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    arr1.splice(i, <span class="number">1</span>);</span><br><span class="line">    arr1 = arr1;</span><br><span class="line">    i--;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> tempArr;</span><br></pre></td></tr></table></figure>
<h4 id="过滤出数组对象-B-不存在与数组对象-A-中的所有相"><a href="#过滤出数组对象-B-不存在与数组对象-A-中的所有相" class="headerlink" title="过滤出数组对象 B 不存在与数组对象 A 中的所有相"></a>过滤出数组对象 B 不存在与数组对象 A 中的所有相</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> A = [</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;dnh&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;dnhy&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&quot;dnhyx&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">name</span>: <span class="string">&quot;dnhyxc&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">&quot;dnhyxcn&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">6</span>, <span class="attr">name</span>: <span class="string">&quot;dnhyxcnt&quot;</span> &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> B = [</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">11</span>, <span class="attr">name</span>: <span class="string">&quot;nt&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;ntd&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">33</span>, <span class="attr">name</span>: <span class="string">&quot;ntdn&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">77</span>, <span class="attr">name</span>: <span class="string">&quot;ntdnh&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">6</span>, <span class="attr">name</span>: <span class="string">&quot;ntdnhy&quot;</span> &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newArr = B.filter(<span class="function">(<span class="params">i</span>) =&gt;</span> !A.some(<span class="function">(<span class="params">j</span>) =&gt;</span> j.id === i.id));</span><br><span class="line"><span class="built_in">console</span>.log(newArr);</span><br></pre></td></tr></table></figure>
<h4 id="js-定时刷新页面"><a href="#js-定时刷新页面" class="headerlink" title="js 定时刷新页面"></a>js 定时刷新页面</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>定时刷新<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>定时刷新<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">&quot;timer&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;15&quot;</span>&gt;</span>15min<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;30&quot;</span>&gt;</span>30min<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;45&quot;</span>&gt;</span>45min<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;60&quot;</span>&gt;</span>60min<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;handle&quot;</span>&gt;</span>手动刷新<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> selectTime = <span class="built_in">document</span>.querySelector(<span class="string">&quot;.timer&quot;</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> handle = <span class="built_in">document</span>.querySelector(<span class="string">&quot;.handle&quot;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> timer;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> addTime15s = <span class="number">1500</span>; <span class="comment">// 15s</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> addTime30s = <span class="number">3000</span>; <span class="comment">// 30s</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> addTime45s = <span class="number">4500</span>; <span class="comment">// 45s</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> addTime60s = <span class="number">6000</span>; <span class="comment">// 60s</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> selectAddTime = addTime15s;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      selectTime.addEventListener(<span class="string">&quot;change&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (e.target.value === <span class="string">&quot;15&quot;</span>) &#123;</span></span><br><span class="line">          selectAddTime = addTime15s;</span><br><span class="line">          begin(selectAddTime);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (e.target.value === <span class="string">&quot;30&quot;</span>) &#123;</span></span><br><span class="line">          selectAddTime = addTime30s;</span><br><span class="line">          begin(selectAddTime);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (e.target.value === <span class="string">&quot;45&quot;</span>) &#123;</span></span><br><span class="line">          selectAddTime = addTime45s;</span><br><span class="line">          begin(selectAddTime);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (e.target.value === <span class="string">&quot;60&quot;</span>) &#123;</span></span><br><span class="line">          selectAddTime = addTime60s;</span><br><span class="line">          begin(selectAddTime);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> reflash = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">setTimeout</span>(<span class="keyword">async</span> () =&gt; &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">&quot;刷新页面,刷新页面&quot;</span>);</span></span><br><span class="line">          begin(selectAddTime);</span><br><span class="line">        &#125;, 1000);</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.onload = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line">        begin(selectAddTime);</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      handle.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (timer) <span class="built_in">clearInterval</span>(timer);</span></span><br><span class="line">        reflash();</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> begin = <span class="function">(<span class="params">time</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (timer) <span class="built_in">clearInterval</span>(timer);</span></span><br><span class="line"><span class="javascript">        timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line">          reflash();</span><br><span class="line">        &#125;, time);</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="标记搜索关键字"><a href="#标记搜索关键字" class="headerlink" title="标记搜索关键字"></a>标记搜索关键字</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">      .search &#123;</span><br><span class="line"><span class="css">        <span class="attribute">color</span>: red;</span></span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sign&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>得意时 “一日看尽长安花”<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>艰难时 “潦倒新停浊酒杯”<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>哪怕 “畏途巉岩不可攀”<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>也要 “会当凌绝顶”<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>napa “无人会，登临意”<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>yeyao “猛志固常在”<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>dnhyxc<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>DNHYXC<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>TeSt<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>tEsT<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;outSign&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>TeSt<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>tEsT<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">find</span>(<span class="params">keyword, color, element</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> sText = element.innerHTML;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> bgColor = color || <span class="string">&quot;#ffba00&quot;</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> num = -<span class="number">1</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 匹配传入的搜索值不区分大小写 i表示不区分大小写，g表示全局搜索</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> rStr = <span class="keyword">new</span> <span class="built_in">RegExp</span>(keyword, <span class="string">&quot;gi&quot;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 匹配html元素</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> rHtml = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">&quot;\&lt;.*?\&gt;&quot;</span>, <span class="string">&quot;ig&quot;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 存放html元素的数组</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> aHtml = sText.match(rHtml);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> arr = sText.match(rStr);</span></span><br><span class="line">      a = -1;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 替换html标签</span></span></span><br><span class="line"><span class="javascript">      sText = sText.replace(rHtml, <span class="string">&quot;&#123;~&#125;&quot;</span>);</span></span><br><span class="line"><span class="javascript">      sText = sText.replace(rStr, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line">        a++;</span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> (</span></span><br><span class="line"><span class="javascript">          <span class="string">&quot;&lt;span name=&#x27;addSpan&#x27; style=&#x27;background-color: &quot;</span> +</span></span><br><span class="line">          bgColor +</span><br><span class="line"><span class="javascript">          <span class="string">&quot;;&#x27;&gt;&quot;</span> +</span></span><br><span class="line">          arr[a] +</span><br><span class="line"><span class="javascript">          <span class="string">&quot;&lt;/span&gt;&quot;</span></span></span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 替换key</span></span></span><br><span class="line"><span class="javascript">      sText = sText.replace(<span class="regexp">/&#123;~&#125;/g</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 恢复html标签</span></span></span><br><span class="line">        num++;</span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> aHtml[num];</span></span><br><span class="line">      &#125;);</span><br><span class="line">      element.innerHTML = sText;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> element = <span class="built_in">document</span>.querySelector(<span class="string">&quot;.sign&quot;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    find(<span class="string">&quot;TeSt&quot;</span>, <span class="string">&quot;gold&quot;</span>, element);</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="判断父元素是否包含子元素"><a href="#判断父元素是否包含子元素" class="headerlink" title="判断父元素是否包含子元素"></a>判断父元素是否包含子元素</h4><p>1、原理：使用 <strong>contains</strong> 方法实现，如果 A 元素包含 B 元素，则返回 true，否则 false。</p>
<ul>
<li>注意：contains 存在兼容性问题，firefox 有些版本不兼容该方法，但可以使用 compareDocumentPosition() 方法代替。它的使用形式与 contains 差不多，但返回的不是 一个布尔值，而是一个很奇怪的数值。<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Node/compareDocumentPosition">具体请戳这里查看</a>。</li>
</ul>
<p>2、contains 语法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ParentElement.contains(childElement);</span><br></pre></td></tr></table></figure>
<p>3、处理 contains 兼容性：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> contains = <span class="function"><span class="keyword">function</span> (<span class="params">a, b, itself</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 第一个节点是否包含第二个节点</span></span><br><span class="line">  <span class="comment">// contains 方法支持情况：chrome+ firefox9+ ie5+，opera9.64+(估计从9.0+)，safari5.1.7+</span></span><br><span class="line">  <span class="keyword">if</span> (itself &amp;&amp; a === b) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">if</span> (a.contains) &#123;</span><br><span class="line">    <span class="keyword">if</span> (a.nodeType === <span class="number">9</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> a.contains(b);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a.compareDocumentPosition) &#123;</span><br><span class="line">    <span class="keyword">return</span> !!(a.compareDocumentPosition(b) &amp; <span class="number">16</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ((b = b.parentNode)) <span class="keyword">if</span> (a === b) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="根据文件后缀判断文件类型"><a href="#根据文件后缀判断文件类型" class="headerlink" title="根据文件后缀判断文件类型"></a>根据文件后缀判断文件类型</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> getFileType = <span class="function">(<span class="params">fileName</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 后缀获取</span></span><br><span class="line">  <span class="keyword">let</span> suffix = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="comment">// 获取类型结果</span></span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> flieArr = fileName.split(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    suffix = flieArr[flieArr.length - <span class="number">1</span>];</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    suffix = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// fileName无后缀返回 false</span></span><br><span class="line">  <span class="keyword">if</span> (!suffix) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  suffix = suffix.toLocaleLowerCase();</span><br><span class="line">  <span class="comment">// 匹配图片</span></span><br><span class="line">  <span class="keyword">const</span> imglist = [<span class="string">&quot;png&quot;</span>, <span class="string">&quot;jpg&quot;</span>, <span class="string">&quot;jpeg&quot;</span>, <span class="string">&quot;bmp&quot;</span>, <span class="string">&quot;gif&quot;</span>];</span><br><span class="line">  result = imglist.find(<span class="function">(<span class="params">item</span>) =&gt;</span> item === suffix);</span><br><span class="line">  <span class="keyword">if</span> (result) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;image&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 匹配txt</span></span><br><span class="line">  <span class="keyword">const</span> txtlist = [<span class="string">&quot;txt&quot;</span>];</span><br><span class="line">  result = txtlist.find(<span class="function">(<span class="params">item</span>) =&gt;</span> item === suffix);</span><br><span class="line">  <span class="keyword">if</span> (result) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;txt&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 匹配 excel</span></span><br><span class="line">  <span class="keyword">const</span> excelist = [<span class="string">&quot;xls&quot;</span>, <span class="string">&quot;xlsx&quot;</span>];</span><br><span class="line">  result = excelist.find(<span class="function">(<span class="params">item</span>) =&gt;</span> item === suffix);</span><br><span class="line">  <span class="keyword">if</span> (result) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;excel&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 匹配 word</span></span><br><span class="line">  <span class="keyword">const</span> wordlist = [<span class="string">&quot;doc&quot;</span>, <span class="string">&quot;docx&quot;</span>];</span><br><span class="line">  result = wordlist.find(<span class="function">(<span class="params">item</span>) =&gt;</span> item === suffix);</span><br><span class="line">  <span class="keyword">if</span> (result) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;word&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 匹配 pdf</span></span><br><span class="line">  <span class="keyword">const</span> pdflist = [<span class="string">&quot;pdf&quot;</span>];</span><br><span class="line">  result = pdflist.find(<span class="function">(<span class="params">item</span>) =&gt;</span> item === suffix);</span><br><span class="line">  <span class="keyword">if</span> (result) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;pdf&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 匹配 ppt</span></span><br><span class="line">  <span class="keyword">const</span> pptlist = [<span class="string">&quot;ppt&quot;</span>, <span class="string">&quot;pptx&quot;</span>];</span><br><span class="line">  result = pptlist.find(<span class="function">(<span class="params">item</span>) =&gt;</span> item === suffix);</span><br><span class="line">  <span class="keyword">if</span> (result) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;ppt&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 匹配 视频</span></span><br><span class="line">  <span class="keyword">const</span> videolist = [</span><br><span class="line">    <span class="string">&quot;mp4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;m2v&quot;</span>,</span><br><span class="line">    <span class="string">&quot;mkv&quot;</span>,</span><br><span class="line">    <span class="string">&quot;rmvb&quot;</span>,</span><br><span class="line">    <span class="string">&quot;wmv&quot;</span>,</span><br><span class="line">    <span class="string">&quot;avi&quot;</span>,</span><br><span class="line">    <span class="string">&quot;flv&quot;</span>,</span><br><span class="line">    <span class="string">&quot;mov&quot;</span>,</span><br><span class="line">    <span class="string">&quot;m4v&quot;</span>,</span><br><span class="line">  ];</span><br><span class="line">  result = videolist.find(<span class="function">(<span class="params">item</span>) =&gt;</span> item === suffix);</span><br><span class="line">  <span class="keyword">if</span> (result) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;video&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 匹配 音频</span></span><br><span class="line">  <span class="keyword">const</span> radiolist = [<span class="string">&quot;mp3&quot;</span>, <span class="string">&quot;wav&quot;</span>, <span class="string">&quot;wmv&quot;</span>];</span><br><span class="line">  result = radiolist.find(<span class="function">(<span class="params">item</span>) =&gt;</span> item === suffix);</span><br><span class="line">  <span class="keyword">if</span> (result) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;radio&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 匹配zip</span></span><br><span class="line">  <span class="keyword">const</span> zipList = [<span class="string">&quot;zip&quot;</span>];</span><br><span class="line">  result = zipList.find(<span class="function">(<span class="params">item</span>) =&gt;</span> item === suffix);</span><br><span class="line">  <span class="comment">// 匹配zip</span></span><br><span class="line">  <span class="keyword">const</span> htmlList = [<span class="string">&quot;html&quot;</span>];</span><br><span class="line">  result = htmlList.find(<span class="function">(<span class="params">item</span>) =&gt;</span> item === suffix);</span><br><span class="line">  <span class="comment">// 其他 文件类型</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;other&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>Web H5</title>
    <url>/2021/09/11/mobile/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>1、对于移动端开发而言，为了做到页面高清的效果，视觉稿的规范往往会遵循以下两点：</p>
<ul>
<li><p>首先，选取一款手机的屏幕宽高作为基准（以前是 iphone4 的 320×480，现在更多的是 iphone6 的 375×667）。</p>
</li>
<li><p>对于 retina 屏幕（如: dpr=2），为了达到高清效果，视觉稿的画布大小会是基准的 2 倍，也就是说像素点个数是原来的 4 倍（对 iphone6 而言：原先的 375×667，就会变成 750×1334）。</p>
</li>
</ul>
<h4 id="屏幕分辨率"><a href="#屏幕分辨率" class="headerlink" title="屏幕分辨率"></a>屏幕分辨率</h4><p>1、屏幕分辨率指一个屏幕具体由多少个像素点组成。即在横纵向上的像素（这里指物理像素）点数，单位是 px，1px = 1 个像素点（1 个物理像素）。一般以横向像素 × 纵向像素来表示一个手机的分辨率，如：1080 × 1920，这里提到的 1 像素指的是物理设备的 1 个像素点。</p>
<p>2、当然分辨率高不代表屏幕就清晰，屏幕的清晰程度还与尺寸有关。</p>
<h4 id="物理像素（physical-pixel）"><a href="#物理像素（physical-pixel）" class="headerlink" title="物理像素（physical pixel）"></a>物理像素（physical pixel）</h4><p>1、物理像素也称为设备像素，一个物理像素是显示器（手机屏幕）上最小的物理显示单元，在操作系统的调度下，每一个设备像素都有自己的颜色值和亮度值。</p>
<a id="more"></a>

<h4 id="CSS-像素"><a href="#CSS-像素" class="headerlink" title="CSS 像素"></a>CSS 像素</h4><p>1、css 像素是一个抽象的单位，主要使用在浏览器上，用来精确的度量（确定）Web 页面上的内容，它是为 web 开发者创造的，在 css 或者 js 中使用的一个抽象的层。</p>
<p>2、一般情况下，css 像素被称为与设备无关的像素（device-independent 像素），简称为 DIPS。</p>
<p>3、在一个标准的显示密度下，一个 css 像素对应这一个设备像素。</p>
<h4 id="设备独立像素（density-independent-pixel）"><a href="#设备独立像素（density-independent-pixel）" class="headerlink" title="设备独立像素（density-independent pixel）"></a>设备独立像素（density-independent pixel）</h4><p>1、设备独立像素（也叫密度无关像素），可以认为是计算机坐标系统中的一个点，这个点代表一个可以由程序使用的虚拟像素（比如: css 像素），然后由相关系统转换为物理像素。</p>
<p>2、设备独立像素是一个虚拟像素单位，至于为什么会有这种虚拟像素的产生呢？</p>
<ul>
<li><p>举个例子，iPhone 3GS 和 iPhone 4/4s 的尺寸都是 3.5 寸，但 iPhone 3GS 的分辨率是 320x480，iPhone 4/4s 的分辨率是 640x960，这也就是意味着同样长度的屏幕，iPhone 3GS 有 320 个物理像素，iPhone 4/4s 有 640 个物理像素。此时如果我们按照真实的物理像素进行布局，比如说我们按照 320 物理像素进行布局，到了 640 物理像素的手机上就会有一半的空白，为了避免这种问题，就产生了虚拟像素单位。</p>
</li>
<li><p>将 iPhone 3GS 和 iPhone 4/4s 统一设为 320 个虚拟像素，此时在 iPhone 3GS 上，最终 1 个虚拟像素换算成 1 个物理像素，而在 iphone 4s 中，1 个虚拟像素最终换算成 2 个物理像素。至于 1 个虚拟像素被换算成几个物理像素，这个数值就称之为设备像素比。</p>
</li>
</ul>
<h4 id="设备像素比（Device-Pixel-Ratio）"><a href="#设备像素比（Device-Pixel-Ratio）" class="headerlink" title="设备像素比（Device Pixel Ratio）"></a>设备像素比（Device Pixel Ratio）</h4><p>1、设备像素比（DPR） = 设备物理像素 / 设备独立像素。即设备物理像素与设备独立像素的比值就是像素比。如：</p>
<ul>
<li>物理像素为：750 × 1334，设备独立像素为：375 × 667，那么像素比就为：750 / 375 = 2，即像素比为 2。</li>
</ul>
<p>2、在 web 中，像素比可以通过 <strong>window.devicePixelRatio</strong> 来获取。</p>
<p>3、在 css 中，可以使用媒体查询 min-device-pixel-ratio，区分 dpr：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@media</span> (<span class="attribute">-webkit-min-device-pixel-ratio</span>: <span class="number">2</span>), (<span class="attribute">min-device-pixel-ratio</span>: <span class="number">2</span>) &#123;</span><br><span class="line">  <span class="comment">/* do some thing */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4、在 React Native 中，也可以使用 PixelRatio.get() 来获取 DPR。</p>
<p>5、当给定一个元素的高度为 200px（这里的 px 指物理像素，非 CSS 像素），以像素），iphone6 为例，iphone6 的设备像素比为 2，转化为 css 像素即为 100px。</p>
<h4 id="位图像素"><a href="#位图像素" class="headerlink" title="位图像素"></a>位图像素</h4><p>1、一个位图像素是栅格图像（png/jpg/gif…）的最小数据单元。</p>
<p>2、只有当 1 个位图像素对应 1 个物理像素时，图片才能得到完美清晰的展示。</p>
<h4 id="PPI（Pixel-Per-Inch）"><a href="#PPI（Pixel-Per-Inch）" class="headerlink" title="PPI（Pixel Per Inch）"></a>PPI（Pixel Per Inch）</h4><p>1、PPI（Pixel Per Inch）：每英寸包括的像素数，PPI 可以用于描述屏幕的清晰度以及一张图片的质量。</p>
<p>2、使用 PPI 描述图片时，PPI 越高，图片质量越高，使用 PPI 描述屏幕时，PPI 越高，屏幕越清晰。</p>
<p>3、PPI 计算方式如下：根号(水平像素点数的平方 + 垂直像素点数的平方)/屏幕尺寸。</p>
<h4 id="DPI（Dot-Per-Inch）"><a href="#DPI（Dot-Per-Inch）" class="headerlink" title="DPI（Dot Per Inch）"></a>DPI（Dot Per Inch）</h4><p>1、DPI（Dot Per Inch）：每英寸包括的点数，这里的点是一个抽象的单位，它可以是屏幕像素点、图片像素点也可以是打印机的墨点。</p>
<p>2、当使用 DPI 来描述图片和屏幕，这时的 DPI 应该和 PPI 是等价的，DPI 最常用的是用于描述打印机，表示打印机每英寸可以打印的点数。</p>
<p>3、一张图片在屏幕上显示时，它的像素点数是规则排列的，每个像素点都有特定的位置和颜色。而当使用打印机进行打印时，打印机可能不会规则的将这些点打印出来，而是使用一个个打印点来呈现这张图像，这些打印点之间会有一定的空隙，这就是 DPI 所描述的：<strong>打印点的密度</strong>。</p>
<p><img src="/2021/09/11/mobile/dpi.png" alt="DPI"></p>
<h4 id="实现-1px-线"><a href="#实现-1px-线" class="headerlink" title="实现 1px 线"></a>实现 1px 线</h4><p>1、在 retina 下设置 border: 1px，其实是 1 物理像素宽，而不是 1 CSS 像素宽度，对于 CSS 而言：</p>
<ul>
<li><p>在 dpr = 1 时，此时 1 物理像素等于 1 CSS 像素宽度。</p>
</li>
<li><p>在 dpr = 2 时，此时 1 物理像素等于 0.5 CSS 宽度像素，可以认为 border-width: 1px 这里的 1px 其实是 1 CSS 像素宽度，等于 2 像素物理宽度，设计师其实想要的是 border-width: 0.5px。</p>
</li>
<li><p>在 dpr = 3 时，此时 1 物理像素等于 0.33 CSS 宽度像素，设计师其实想要的是 border: 0.333px。</p>
</li>
</ul>
<p>2、并不是所有手机浏览器都能识别 border-width: 0.5px，在 iOS7 以下，Android 等其他系统里，小于 1px 的单位会被当成为 0px 处理，那么如何实现这 0.5px、0.33px 呢？主要可通过如下几种方式实现：</p>
<ul>
<li><p>使用缩放实现。</p>
</li>
<li><p>渐变实现。</p>
</li>
<li><p>使用图片实现（base64）。</p>
</li>
<li><p>使用 SVG 实现（嵌入 background url）。</p>
</li>
</ul>
]]></content>
      <categories>
        <category>mobile</category>
        <category>H5</category>
      </categories>
      <tags>
        <tag>H5</tag>
      </tags>
  </entry>
  <entry>
    <title>qiankun</title>
    <url>/2021/02/01/qiankun/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="coverInfo coverInfoTop" title="前言：近年来越来越多前端开始把注意力集中在复杂前端应用的架构上面。尤其是如何将前端整体分解，每一块可以独立开发、测试和部署，同时对用户而言仍是一个整体。这种技术就是微前端，我们将其定义为：一种多个团队通过独立发布功能的方式来共同构建现代化 web 应用的技术手段及方法策略。">
  前言：近年来越来越多前端开始把注意力集中在复杂前端应用的架构上面。尤其是如何将前端整体分解，每一块可以独立开发、测试和部署，同时对用户而言仍是一个整体。这种技术就是微前端，我们将其定义为：一种多个团队通过独立发布功能的方式来共同构建现代化 web 应用的技术手段及方法策略。
</div>

<div class="browserCover">
  <!-- <img src="c3.png" class="browserCover changeImg"> -->
</div>

<div class="coverInfo" title="本文主要讲的是基于 qiankun 搭建的微前端架构示例，主应用为 Dva，子应用接入 React 和 Vue 这两个主流的前端框架。其中将会详细的介绍主子应用的配置以及主子应用间的通信等。最终将实现一个可以用于实际项目开发的企业级微前端应用。">
  本文主要讲的是基于 qiankun 搭建的微前端架构示例，主应用为 React，子应用接入 React 和 Vue 这两个主流的前端框架。其中将会详细的介绍主子应用的配置以及主子应用间的通信等。最终将实现一个可以用于实际项目开发的企业级微前端应用。
</div>

<a id="more"></a>

<h3 id="微前端"><a href="#微前端" class="headerlink" title="微前端"></a>微前端</h3><h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>当下前端领域，基于 vue、react、angular 的单页应用（spa）开发模式已经成为业界主流。随着时间推移以及应用的功能丰富，应用开始变得庞大臃肿，逐渐成为一个难以维护的屎山应用，难以维护不说，每次开发、上线新需求时还需要花费不少的时间来构建项目，而且有可能改一处而动全身，对开发人员的开发效率和体验都造成了不好的影响。因此将一个屎山应用拆分为多个子应用就势在必行了。</p>
<h4 id="什么是微前端"><a href="#什么是微前端" class="headerlink" title="什么是微前端"></a>什么是微前端</h4><p>1、一种多个团队通过独立发布功能的方式来共同构建现代化 web 应用的技术手段及方法策略。</p>
<h4 id="微前端的特点"><a href="#微前端的特点" class="headerlink" title="微前端的特点"></a>微前端的特点</h4><p>1、主框架不限制接入应用的技术栈，微应用具备完全自主权。</p>
<p>2、微应用仓库独立，前后端可独立开发，部署完成后主框架自动完成同步更新。</p>
<p>3、在面对各种复杂场景时，我们通常很难对一个已经存在的系统做全量的技术栈升级或重构，而微前端是一种非常好的实施渐进式重构的手段和策略。</p>
<p>4、每个微应用之间状态隔离，运行时状态不共享。</p>
<h4 id="微前端能解决什么问题"><a href="#微前端能解决什么问题" class="headerlink" title="微前端能解决什么问题"></a>微前端能解决什么问题</h4><h5 id="拆分和细化"><a href="#拆分和细化" class="headerlink" title="拆分和细化"></a>拆分和细化</h5><p>1、基于业务来拆分应用。每个应用都有一个自己的仓库，<strong>独立开发</strong>、<strong>独立部署</strong>、<strong>独立访问</strong>、<strong>独立维护</strong>，还可以根据团队的特点自主选择适合自己的技术栈，极大的提升了开发人员的效率和体验，甚至隔壁团队误发布了一个半成品或有问题的特性也无关紧要。如果一个微前端已经准备好发布了，它就应该随时可发布，并且只由开发维护它的团队来定。</p>
<h5 id="整合历史系统"><a href="#整合历史系统" class="headerlink" title="整合历史系统"></a>整合历史系统</h5><p>1、在不少的业务中，或多或少会存在一些历史项目，介于日常运营，这些系统需要结合到新框架中来使用还不能抛弃，对此我们也没有理由浪费时间和精力重写旧的逻辑。而微前端可以将这些系统进行整合，在基本不修改来逻辑的同时来同时兼容新老两套系统并行运行。</p>
<h5 id="技术栈无关"><a href="#技术栈无关" class="headerlink" title="技术栈无关"></a>技术栈无关</h5><p>1、通过基座应用，可以融合 vue，react，angla，或者 js 开发的子项目。</p>
<h4 id="实现微前端常用的技术方案"><a href="#实现微前端常用的技术方案" class="headerlink" title="实现微前端常用的技术方案"></a>实现微前端常用的技术方案</h4><h5 id="iframe"><a href="#iframe" class="headerlink" title="iframe"></a>iframe</h5><p>1、iframe 作为一项非常古老的技术，也可以用于实现微前端。通过 iframe，可以很方便的将一个应用嵌入到另一个应用中，而且两个应用之间的 css 和 javascript 是相互隔离的，不会互相干扰。</p>
<p>2、iframe 的优点：</p>
<ul>
<li><p>实现简单。</p>
</li>
<li><p>css 和 js 天然隔离，互不干扰。</p>
</li>
<li><p>完全与技术栈无关。</p>
</li>
<li><p>多个子应用可以并存。</p>
</li>
<li><p>不需要对现有应用进行改造。</p>
</li>
</ul>
<p>3、iframe 的缺点：</p>
<ul>
<li><p>用户体验不好，每次切换应用时，浏览器需要重新加载页面。</p>
</li>
<li><p>UI 不同步，DOM 结构不共享。</p>
</li>
<li><p>全局上下文完全隔离，内存变量不共享，子应用之间通信、数据同步虽然可以使用 <strong>postMessage</strong> 实现，但是过程相对比较复杂。</p>
</li>
<li><p>子应用切换时可能需要重新登录，体验不好。</p>
</li>
<li><p>对 SEO 不友好。</p>
</li>
</ul>
<h5 id="single-spa"><a href="#single-spa" class="headerlink" title="single-spa"></a>single-spa</h5><p>1、single-spa 是最早的微前端框架，兼容多种前端技术栈。</p>
<p>2、现在前端应用开发的主流模式基本上都是基于 react、Vue 的单页应用开发模式。在这种模式下，我们需要维护一个路由注册表，每个路由对应各自的页面组件 url。切换路由时，如果是一个新的页面，需要动态获取路由对应的 js 脚本，然后执行脚本并渲染出对应的页面；如果是一个已经访问过的页面，那么直接从缓存中获取已缓存的页面方法，执行并渲染出对应的页面。而在微前端中，single-spa 就提供了新的技术方案，可以帮助我们实现类似单页应用的体验。</p>
<ul>
<li><p>在 single-spa 方案中，应用被分为两类：基座应用和子应用。其中，基座应用，是一个单独的应用，用于聚合子应用。而子应用就是需要被基座所聚合的应用。</p>
</li>
<li><p>和单页应用的实现原理类似，single-spa 会在基座应用中维护一个路由注册表，每个路由对应一个子应用。基座应用启动以后，当我们切换路由时，如果是一个新的子应用，会动态获取子应用的 js 脚本，然后执行脚本并渲染出相应的页面；如果是一个已经访问过的子应用，那么就会从缓存中获取已经缓存的子应用，激活子应用并渲染出对应的页面。</p>
</li>
</ul>
<p>3、single-spa 的优点：</p>
<ul>
<li><p>切换应用时，浏览器不用重载页面，提供和单页应用一样的用户体验。</p>
</li>
<li><p>完全与技术栈无关。</p>
</li>
<li><p>多个子应用可并存。</p>
</li>
<li><p>生态丰富。</p>
</li>
</ul>
<p>4、single-spa 的缺点：</p>
<ul>
<li><p>需要对原有应用进行改造，应用要兼容接入 sing-spa 和独立使用。</p>
</li>
<li><p>使用复杂，关于子应用加载、应用隔离、子应用通信等问题，需要框架使用者自己实现。</p>
</li>
<li><p>子应用间相同资源会重复加载。</p>
</li>
</ul>
<h5 id="qiankun"><a href="#qiankun" class="headerlink" title="qiankun"></a>qiankun</h5><p>1、qiankun 是阿里开源的微前端框架，它是基于 single-spa 进行二次封装，和 single-spa 一样，qiankun 也能给我们提供类似单页应用的用户体验。</p>
<p>2、qiankun 在框架层面解决了使用 single-spa 时需要开发人员自己编写子应用加载、通信、隔离等逻辑的问题，对开发者而言更加的友好了。</p>
<h3 id="qiankun-1"><a href="#qiankun-1" class="headerlink" title="qiankun"></a>qiankun</h3><h4 id="qiankun-简介"><a href="#qiankun-简介" class="headerlink" title="qiankun 简介"></a><a href="https://qiankun.umijs.org/zh">qiankun</a> 简介</h4><p>1、由于 qiankun 是在 single-spa 的基础上做的二次开发，所以 qiankun 的用法和 single-spa 基本一样，也分为 application 模式和 parcel 模式。</p>
<p>2、application 模式是基于路由工作的，它将应用分为两类：基座应用和子应用。其中，基座应用需要维护一个路由注册表，根据路由的变化来切换子应用；子应用是一个个独立的应用，需要提供生命周期方法供基座应用使用。parcel 模式和 application 模式相反，它与路由无关，子应用切换是手动控制的。</p>
<h3 id="qiankun-主子应用配置"><a href="#qiankun-主子应用配置" class="headerlink" title="qiankun 主子应用配置"></a>qiankun 主子应用配置</h3><h4 id="主应用"><a href="#主应用" class="headerlink" title="主应用"></a>主应用</h4><p>1、首先需要安装 qiankun：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add qiankun or npm i qiankun -S</span><br></pre></td></tr></table></figure>
<p>2、注册微应用：</p>
<ul>
<li>修改 <a href="https://github.com/dnhyxc/qiankun-react-main/blob/master/src/index.tsx">micro-react-main/src/index.tsx</a> 注册微应用并启动：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  registerMicroApps,</span><br><span class="line">  start,</span><br><span class="line">  runAfterFirstMounted,</span><br><span class="line">  addGlobalUncaughtErrorHandler,</span><br><span class="line">  initGlobalState,</span><br><span class="line">  MicroAppStateActions,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;qiankun&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./index.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; login, notfound, failed &#125; <span class="keyword">from</span> <span class="string">&quot;./pages/config&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;./App&quot;</span>;</span><br><span class="line"></span><br><span class="line">interface IProps &#123;</span><br><span class="line">  loading?: boolean;</span><br><span class="line">  needHeader?: boolean;</span><br><span class="line">  path?: string;</span><br><span class="line">  type?: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> render = <span class="function">(<span class="params">porps: IProps</span>) =&gt;</span> &#123;</span><br><span class="line">  ReactDOM.render(</span><br><span class="line">    &lt;React.StrictMode&gt;</span><br><span class="line">      &lt;App &#123;...porps&#125; /&gt;</span><br><span class="line">    &lt;/React.StrictMode&gt;,</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">&quot;main-root&quot;</span>)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">render(&#123; <span class="attr">loading</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> appStart = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 设置子应用首次加载loading效果</span></span><br><span class="line">  <span class="keyword">const</span> loader = <span class="function">(<span class="params">loading: boolean</span>) =&gt;</span> render(&#123; loading &#125;);</span><br><span class="line"></span><br><span class="line">  interface AppParams &#123;</span><br><span class="line">    name: string;</span><br><span class="line">    entry: string;</span><br><span class="line">    activeRule: string;</span><br><span class="line">    container: string;</span><br><span class="line">    loader: <span class="function">(<span class="params">loading: boolean</span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">    props: &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> apps: AppParams[] = [</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&quot;reactApp&quot;</span>,</span><br><span class="line">      entry: <span class="string">&quot;//localhost:8989&quot;</span>,</span><br><span class="line">      activeRule: <span class="string">&quot;/dnhyxc/react&quot;</span>,</span><br><span class="line">      container: <span class="string">&quot;#sub-app-viewport&quot;</span>,</span><br><span class="line">      loader,</span><br><span class="line">      props: &#123;</span><br><span class="line">        info: <span class="string">&quot;来了老弟&quot;</span>,</span><br><span class="line">        routerBase: <span class="string">&quot;/dnhyxc/react&quot;</span>, <span class="comment">// 给子应用下发的基础路由</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&quot;vueApp&quot;</span>,</span><br><span class="line">      entry: <span class="string">&quot;//localhost:8686&quot;</span>,</span><br><span class="line">      activeRule: <span class="string">&quot;/dnhyxc/vue&quot;</span>,</span><br><span class="line">      container: <span class="string">&quot;#sub-app-viewport&quot;</span>,</span><br><span class="line">      loader,</span><br><span class="line">      props: &#123;</span><br><span class="line">        routerBase: <span class="string">&quot;/dnhyxc/vue&quot;</span>, <span class="comment">// 给子应用下发的基础路由</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 注册子应用</span></span><br><span class="line">  registerMicroApps(apps, &#123;</span><br><span class="line">    beforeLoad: (app): <span class="function"><span class="params">any</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;before load app.name=====&gt;&gt;&gt;&gt;&gt;&quot;</span>, app.name);</span><br><span class="line">    &#125;,</span><br><span class="line">    beforeMount: [</span><br><span class="line">      (app): <span class="function"><span class="params">any</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;[LifeCycle] before mount %c%s&quot;</span>, <span class="string">&quot;color: green;&quot;</span>, app.name);</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">    afterMount: [</span><br><span class="line">      (app): <span class="function"><span class="params">any</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;[LifeCycle] after mount %c%s&quot;</span>, <span class="string">&quot;color: green;&quot;</span>, app.name);</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">    afterUnmount: [</span><br><span class="line">      (app): <span class="function"><span class="params">any</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(</span><br><span class="line">          <span class="string">&quot;[LifeCycle] after unmount %c%s&quot;</span>,</span><br><span class="line">          <span class="string">&quot;color: green;&quot;</span>,</span><br><span class="line">          app.name</span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  start();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 微前端启动进入第一个子应用后回调函数</span></span><br><span class="line">  runAfterFirstMounted(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;[MainApp] first app mounted&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 添加全局异常捕获</span></span><br><span class="line">  addGlobalUncaughtErrorHandler(<span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">&quot;异常捕获&quot;</span>, event);</span><br><span class="line">    <span class="keyword">const</span> &#123; message &#125; = event <span class="keyword">as</span> any;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> errorApp: AppParams[] = [];</span><br><span class="line"></span><br><span class="line">    apps.forEach(<span class="function">(<span class="params">i</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (message &amp;&amp; message.includes(i.name)) &#123;</span><br><span class="line">        errorApp.splice(<span class="number">0</span>, <span class="number">1</span>, i);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加载失败时提示</span></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      message &amp;&amp;</span><br><span class="line">      message.includes(<span class="string">&quot;died in status LOADING_SOURCE_CODE&quot;</span>) &amp;&amp;</span><br><span class="line">      errorApp.length &amp;&amp;</span><br><span class="line">      <span class="built_in">window</span>.location.pathname === errorApp[<span class="number">0</span>].activeRule</span><br><span class="line">    ) &#123;</span><br><span class="line">      render(failed);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> initState = &#123;</span><br><span class="line">    AppName: <span class="string">&quot;micro-react-main&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  initGlobalState(initState);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions: MicroAppStateActions = initGlobalState(&#123;&#125;);</span><br><span class="line">(<span class="built_in">window</span> <span class="keyword">as</span> any).__MAIN_GLOBALSTATE_ACTIONS__ = actions;</span><br><span class="line">actions.onGlobalStateChange(<span class="function">(<span class="params">state, prev</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// state: 变更后的状态; prev 变更前的状态</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;[onGlobalStateChange - master]:&quot;</span>, state, prev);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置路由拦截</span></span><br><span class="line"><span class="keyword">const</span> routeIntercept = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.location.pathname === <span class="string">&quot;/dnhyxc/login&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">window</span>.location.href = <span class="string">&quot;/dnhyxc/react&quot;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    render(notfound);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模拟获取用户登录信息</span></span><br><span class="line"><span class="keyword">const</span> getUserInfo = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 页面加载判断</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.location.pathname === <span class="string">&quot;/&quot;</span>) &#123;</span><br><span class="line">  <span class="built_in">window</span>.location.href = <span class="string">&quot;/dnhyxc/react&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (getUserInfo()) &#123;</span><br><span class="line">    routeIntercept();</span><br><span class="line">    appStart();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    render(login);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、添加子应用容器：</p>
<ul>
<li>在 <a href="https://github.com/dnhyxc/qiankun-react-main/blob/master/src/App.tsx">micro-main/src/App.tsx</a> 中添加子应用容器元素：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> RenderPage <span class="keyword">from</span> <span class="string">&quot;./pages&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">&quot;./components/Header&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./App.css&quot;</span>;</span><br><span class="line"></span><br><span class="line">interface IProps &#123;</span><br><span class="line">  loading?: boolean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App: React.FC&lt;IProps&gt; = <span class="function">(<span class="params">&#123; loading, ...props &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;app-main&quot;</span>&gt;</span><br><span class="line">      &lt;header className=<span class="string">&quot;app-header&quot;</span>&gt;</span><br><span class="line">        &lt;Header /&gt;</span><br><span class="line">      &lt;/header&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;app-sub&quot;</span>&gt;</span><br><span class="line">        &lt;RenderPage loading=&#123;loading&#125; &#123;...props&#125; /&gt;</span><br><span class="line">        &#123;<span class="comment">/* 子应用容器 */</span>&#125;</span><br><span class="line">        &lt;div id=<span class="string">&quot;sub-app-viewport&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<h4 id="React-子应用"><a href="#React-子应用" class="headerlink" title="React 子应用"></a>React 子应用</h4><p>1、在 src 目录新增 public-path.js：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.__POWERED_BY_QIANKUN__) &#123;</span><br><span class="line">  __webpack_public_path__ = <span class="built_in">window</span>.__INJECTED_PUBLIC_PATH_BY_QIANKUN__;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、修改入口文件 react-app/src/index.js：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;./public-path&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;./App&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; container &#125; = props;</span><br><span class="line">  ReactDOM.render(</span><br><span class="line">    &lt;React.StrictMode&gt;</span><br><span class="line">      &lt;App /&gt;</span><br><span class="line">    &lt;/React.StrictMode&gt;,</span><br><span class="line">    <span class="comment">// 为了避免根 id #root 与其他的 DOM 冲突，需要限制查找范围。</span></span><br><span class="line">    container</span><br><span class="line">      ? container.querySelector(<span class="string">&quot;#root&quot;</span>)</span><br><span class="line">      : <span class="built_in">document</span>.querySelector(<span class="string">&quot;#root&quot;</span>)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">window</span>.__POWERED_BY_QIANKUN__) &#123;</span><br><span class="line">  render(&#123;&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * bootstrap 只会在微应用初始化的时候调用一次，下次微应用重新进入时会直接调用 mount 钩子，不会再重复触发 bootstrap。</span></span><br><span class="line"><span class="comment"> * 通常我们可以在这里做一些全局变量的初始化，比如不会在 unmount 阶段被销毁的应用级别的缓存等。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">bootstrap</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;[react17] react app bootstraped&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 应用每次进入都会调用 mount 方法，通常我们在这里触发应用的渲染方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">mount</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;[react17] props from main framework&quot;</span>, props);</span><br><span class="line">  render(props);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 应用每次 切出/卸载 会调用的方法，通常在这里我们会卸载微应用的应用实例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">unmount</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; container &#125; = props;</span><br><span class="line">  ReactDOM.unmountComponentAtNode(</span><br><span class="line">    container</span><br><span class="line">      ? container.querySelector(<span class="string">&quot;#root&quot;</span>)</span><br><span class="line">      : <span class="built_in">document</span>.querySelector(<span class="string">&quot;#root&quot;</span>)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 可选生命周期钩子，仅使用 loadMicroApp 方式加载微应用时生效</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;update props&quot;</span>, props);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、修改 webpack 配置：</p>
<p>修改 webpack 配置方式一：</p>
<ul>
<li>安装@rescripts/cli 插件：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i @rescripts&#x2F;cli -D</span><br></pre></td></tr></table></figure>
<ul>
<li>在根目录新增 .rescriptsrc.js 文件：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; name &#125; = <span class="built_in">require</span>(<span class="string">&quot;./package&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  webpack: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    config.output.library = <span class="string">`<span class="subst">$&#123;name&#125;</span>-[name]`</span>;</span><br><span class="line">    config.output.libraryTarget = <span class="string">&quot;umd&quot;</span>;</span><br><span class="line">    config.output.jsonpFunction = <span class="string">`webpackJsonp_<span class="subst">$&#123;name&#125;</span>`</span>;</span><br><span class="line">    config.output.globalObject = <span class="string">&quot;window&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  devServer: <span class="function">(<span class="params">_</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> config = _;</span><br><span class="line">    <span class="comment">// 主应用获取子应用时跨域响应头，必须要开启跨域</span></span><br><span class="line">    config.headers = &#123;</span><br><span class="line">      <span class="string">&quot;Access-Control-Allow-Origin&quot;</span>: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    config.historyApiFallback = <span class="literal">true</span>;</span><br><span class="line">    config.hot = <span class="literal">false</span>;</span><br><span class="line">    config.watchContentBase = <span class="literal">false</span>;</span><br><span class="line">    config.liveReload = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>修改 package.json：</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;start&quot;: &quot;rescripts start&quot;,</span><br><span class="line">&quot;build&quot;: &quot;rescripts build&quot;,</span><br><span class="line">&quot;test&quot;: &quot;rescripts test&quot;,</span><br></pre></td></tr></table></figure>
<p>修改 webpack 配置方式二：</p>
<ul>
<li><p>首先使用 <code>npm install react-app-rewired -D</code> 安装 react-app-rewired。</p>
</li>
<li><p>在与 src 平级的根目录下创建 config-overrides.js 文件：</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; name &#125; = <span class="built_in">require</span>(<span class="string">&quot;./package&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  webpack: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 微应用的包名</span></span><br><span class="line">    config.output.library = <span class="string">`<span class="subst">$&#123;name&#125;</span>-[name]`</span>;</span><br><span class="line">    <span class="comment">// 将 library 暴露为所有的模块定义下都可运行的方式</span></span><br><span class="line">    config.output.libraryTarget = <span class="string">&quot;umd&quot;</span>;</span><br><span class="line">    <span class="comment">// 按需加载相关，设置为 webpackJsonp_reactApp 即可</span></span><br><span class="line">    config.output.jsonpFunction = <span class="string">`webpackJsonp_<span class="subst">$&#123;name&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置引入别名</span></span><br><span class="line">    config.resolve.alias = &#123;</span><br><span class="line">      ...config.resolve.alias,</span><br><span class="line">      <span class="string">&quot;@&quot;</span>: path.resolve(__dirname, <span class="string">&quot;src&quot;</span>),</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  devServer: <span class="function">(<span class="params">configFunction</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">proxy, allowedHost</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> config = configFunction(proxy, allowedHost);</span><br><span class="line">      <span class="comment">// 关闭主机检查，使微应用可以被 fetch</span></span><br><span class="line">      config.disableHostCheck = <span class="literal">true</span>;</span><br><span class="line">      <span class="comment">// 主应用获取子应用时跨域响应头，必须要开启跨域</span></span><br><span class="line">      config.headers = &#123;</span><br><span class="line">        <span class="string">&quot;Access-Control-Allow-Origin&quot;</span>: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="comment">// 配置 history 模式</span></span><br><span class="line">      config.historyApiFallback = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">return</span> config;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="Vue-子应用配置"><a href="#Vue-子应用配置" class="headerlink" title="Vue 子应用配置"></a>Vue 子应用配置</h4><p>1、在 src 目录新增 public-path.js 文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.__POWERED_BY_QIANKUN__) &#123;</span><br><span class="line">  __webpack_public_path__ = <span class="built_in">window</span>.__INJECTED_PUBLIC_PATH_BY_QIANKUN__;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、修改入口文件 vue-app/src/main.js 文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;./public-path&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;./App.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> instance = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">props = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; container &#125; = props;</span><br><span class="line"></span><br><span class="line">  instance = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    render: <span class="function">(<span class="params">h</span>) =&gt;</span> h(App),</span><br><span class="line">  &#125;).$mount(container ? container.querySelector(<span class="string">&quot;#app&quot;</span>) : <span class="string">&quot;#app&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 独立运行时</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">window</span>.__POWERED_BY_QIANKUN__) &#123;</span><br><span class="line">  render();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">bootstrap</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;[vue] vue app bootstraped&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">mount</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;[vue] props from main framework&quot;</span>, props);</span><br><span class="line">  render(props);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">unmount</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  instance.$destroy();</span><br><span class="line">  instance.$el.innerHTML = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  instance = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、修改打包配置 vue.config.js 文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; name &#125; = <span class="built_in">require</span>(<span class="string">&quot;./package&quot;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    headers: &#123;</span><br><span class="line">      <span class="string">&quot;Access-Control-Allow-Origin&quot;</span>: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  configureWebpack: &#123;</span><br><span class="line">    output: &#123;</span><br><span class="line">      library: <span class="string">`<span class="subst">$&#123;name&#125;</span>-[name]`</span>,</span><br><span class="line">      libraryTarget: <span class="string">&quot;umd&quot;</span>, <span class="comment">// 把微应用打包成 umd 库格式</span></span><br><span class="line">      jsonpFunction: <span class="string">`webpackJsonp_<span class="subst">$&#123;name&#125;</span>`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="全局状态管理"><a href="#全局状态管理" class="headerlink" title="全局状态管理"></a>全局状态管理</h4><p>1、qiankun 通过 initGlobalState, onGlobalStateChange, setGlobalState 实现主应用的全局状态管理，然后默认会通过 props 将通信方法传递给子应用。</p>
<ul>
<li>主应用：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main/src/main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; initGlobalState &#125; <span class="keyword">from</span> <span class="string">&quot;qiankun&quot;</span>;</span><br><span class="line"><span class="comment">// 初始化 state</span></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  user: &#123;&#125;, <span class="comment">// 用户信息</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> actions = initGlobalState(initialState);</span><br><span class="line">actions.onGlobalStateChange(<span class="function">(<span class="params">state, prev</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// state: 变更后的状态; prev 变更前的状态</span></span><br><span class="line">  <span class="built_in">console</span>.log(state, prev);</span><br><span class="line">&#125;);</span><br><span class="line">actions.setGlobalState(state);</span><br><span class="line">actions.offGlobalStateChange();</span><br></pre></td></tr></table></figure>
<ul>
<li>子应用：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 从生命周期 mount 中获取通信方法，props默认会有onGlobalStateChange和setGlobalState两个api</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">mount</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  props.onGlobalStateChange(<span class="function">(<span class="params">state, prev</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// state: 变更后的状态; prev 变更前的状态</span></span><br><span class="line">    <span class="built_in">console</span>.log(state, prev);</span><br><span class="line">  &#125;);</span><br><span class="line">  props.setGlobalState(state);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、除了上述通信方式以外，还可以直接通过 props 进行传递：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> apps = [</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">&quot;reactApp&quot;</span>,</span><br><span class="line">    entry: <span class="string">&quot;//localhost:8686&quot;</span>,</span><br><span class="line">    activeRule: <span class="string">&quot;/dnhyxc/react&quot;</span>,</span><br><span class="line">    container: <span class="string">&quot;#subapp-viewport&quot;</span>,</span><br><span class="line">    loader,</span><br><span class="line">    props: &#123;</span><br><span class="line">      params: <span class="string">&quot;我是主应用传递过来的参数&quot;</span>,</span><br><span class="line">      routerBase: <span class="string">&quot;/dnhyxc/react&quot;</span>, <span class="comment">// 给子应用下发的基础路由</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<ul>
<li>通过 props 传递的参数，在子应用中，可以直接通过 props 获取到。</li>
</ul>
<h4 id="具体配置示例"><a href="#具体配置示例" class="headerlink" title="具体配置示例"></a>具体配置示例</h4><p>1、React 主应用 <a href="https://github.com/dnhyxc/qiankun-react-main">github 地址</a> | <a href="https://gitee.com/dnhyxc/qiankun-react-main">gitee 地址</a></p>
<p>2、React 子应用 <a href="https://github.com/dnhyxc/micro-react">github 地址</a> | <a href="https://gitee.com/dnhyxc/micro-react">gitee 地址</a></p>
<p>3、Vue 子应用 <a href="https://github.com/dnhyxc/micro-vue">github 地址</a> | <a href="https://gitee.com/dnhyxc/micro-vue">gitee 地址</a></p>
<p>4、Dva 项目级主应用 <a href="https://github.com/dnhyxc/qiankun-dva-main">github 地址</a> | <a href="https://gitee.com/dnhyxc/qiankun-dva-main">gitee 地址</a></p>
<h3 id="qiankun-实现原理"><a href="#qiankun-实现原理" class="headerlink" title="qiankun 实现原理"></a>qiankun 实现原理</h3><h5 id="应用加载"><a href="#应用加载" class="headerlink" title="应用加载"></a>应用加载</h5><p>1、基于 single-spa，qiankun 进行了一次封装，给出了一个更完整的应用加载方案，并将应用加载的功能装成了 npm 插件 <strong>import-html-entry</strong>。</p>
<ul>
<li>该方案的主要思路是允许以 html 文件为应用入口，然后通过一个 html 解析器从文件中提取 js 和 css 依赖，并通过 fetch 下载依赖，于是在 qiankun 中你可以这样配置入口：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> apps = [</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">&quot;react-app&quot;</span>,</span><br><span class="line">    entry: <span class="string">&quot;//localhost:8686&quot;</span>,</span><br><span class="line">    container: <span class="string">&quot;#sub-view&quot;</span>,</span><br><span class="line">    activeRule: <span class="string">&quot;/dnhyxc/react&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<ul>
<li>qiankun 会通过 import-html-entry 请求 <code>http://localhost:8686</code>，得到对应的 html 文件，解析内部的所有 script 和 style 标签，依次下载和执行它们，这使得应用加载变得更易用。</li>
</ul>
<h5 id="import-html-entry-的具体实现"><a href="#import-html-entry-的具体实现" class="headerlink" title="import-html-entry 的具体实现"></a>import-html-entry 的具体实现</h5><p>1、import-html-entry 暴露出的核心接口是 importHTML，用于加载 html 文件，它支持两个参数：</p>
<ul>
<li><p>url：要加载的文件地址，一般是服务中 html 的地址。</p>
</li>
<li><p>opts：配置参数，opts 如果是一个函数，则会替换默认的 fetch 作为新的下载文件的方法，此时其返回值应当是 Promise；如果是一个对象，那么它最多支持四个属性：fetch、getPublicPath、getDomain、getTemplate，用于替换默认的方法。</p>
</li>
</ul>
<p>2、importHTML 方法的主要逻辑如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">importHTML</span>(<span class="params">url, opts = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 此处省略一万字...</span></span><br><span class="line">  <span class="comment">// 如果已经加载过，则从缓存返回，否则fetch回来并保存到缓存中</span></span><br><span class="line">  <span class="keyword">return</span> embedHTMLCache[url] || (embedHTMLCache[url] = fetch(url)</span><br><span class="line">		.then(<span class="function"><span class="params">response</span> =&gt;</span> readResAsString(response, autoDecodeResponse))</span><br><span class="line">		.then(<span class="function"><span class="params">html</span> =&gt;</span> &#123;</span><br><span class="line">		  <span class="comment">// 对html字符串进行初步处理</span></span><br><span class="line">		  <span class="keyword">const</span> &#123; template, scripts, entry, styles &#125; =</span><br><span class="line">		    processTpl(getTemplate(html), assetPublicPath);</span><br><span class="line">		  <span class="comment">// 先将外部样式处理成内联样式</span></span><br><span class="line">		  <span class="comment">// 然后返回几个核心的脚本及样式处理方法</span></span><br><span class="line">		  <span class="keyword">return</span> getEmbedHTML(template, styles, &#123; fetch &#125;).then(<span class="function"><span class="params">embedHTML</span> =&gt;</span> (&#123;</span><br><span class="line">				template: embedHTML,</span><br><span class="line">				assetPublicPath,</span><br><span class="line">				getExternalScripts: <span class="function">() =&gt;</span> getExternalScripts(scripts, fetch),</span><br><span class="line">				getExternalStyleSheets: <span class="function">() =&gt;</span> getExternalStyleSheets(styles, fetch),</span><br><span class="line">				execScripts: <span class="function">(<span class="params">proxy, strictGlobal, execScriptsHooks = &#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">					<span class="keyword">if</span> (!scripts.length) &#123;</span><br><span class="line">						<span class="keyword">return</span> <span class="built_in">Promise</span>.resolve();</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">return</span> execScripts(entry, scripts, proxy, &#123;</span><br><span class="line">						fetch,</span><br><span class="line">						strictGlobal,</span><br><span class="line">						beforeExec: execScriptsHooks.beforeExec,</span><br><span class="line">						afterExec: execScriptsHooks.afterExec,</span><br><span class="line">					&#125;);</span><br><span class="line">				&#125;,</span><br><span class="line">			&#125;));</span><br><span class="line">		&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>上述代码中省略了一些参数预处理，从 return 语句开始，具体过程如下：</p>
<ul>
<li><p>检查是否有缓存，如果有，直接从缓存中返回。</p>
</li>
<li><p>如果没有，则通过 fetch 下载，并字符串化。</p>
</li>
<li><p>调用 processTpl 进行一次模板解析，主要任务是扫描出外联脚本和外联样式，保存在 scripts 和 styles 中.</p>
</li>
<li><p>调用 getEmbedHTML，将外联样式下载下来，并替换到模板内，使其变成内部样式。</p>
</li>
<li><p>返回一个对象，该对象包含处理后的模板，以及 <strong>getExternalScripts</strong>、<strong>getExternalStyleSheets</strong>、<strong>execScripts</strong> 等几个核心方法。</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">                    return 开始执行</span><br><span class="line">                          |</span><br><span class="line">                          |</span><br><span class="line">                          ⬇         是</span><br><span class="line">                      是否有缓存 --------&gt; 直接从缓存中读取返回 --------&gt; 结束</span><br><span class="line">                          |</span><br><span class="line">                          | 否</span><br><span class="line">                          ⬇</span><br><span class="line">                fetch下载，并字符串化</span><br><span class="line">                          |</span><br><span class="line">                          |</span><br><span class="line">                          ⬇</span><br><span class="line">调用processTpl方法，使用正则表达式解析模板，提取脚本和样式</span><br><span class="line">                          |</span><br><span class="line">                          |</span><br><span class="line">                          ⬇</span><br><span class="line">  调用getEmbedHTML，下载外部样式表，并将其处理成内部样式</span><br><span class="line">                          |</span><br><span class="line">                          |</span><br><span class="line">                          ⬇</span><br><span class="line">    返回处理后的模板，以及获取脚本和样式表的接口函数</span><br><span class="line">                          |</span><br><span class="line">                          |</span><br><span class="line">                          ⬇</span><br><span class="line">                        结 束</span><br></pre></td></tr></table></figure>
<p>3、getExternalStyleSheets 方法解析：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getExternalStyleSheets</span>(<span class="params">styles, fetch = defaultFetch</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.all(styles.map(<span class="function"><span class="params">styleLink</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (isInlineCode(styleLink)) &#123;</span><br><span class="line">	  <span class="comment">// if it is inline style</span></span><br><span class="line">	  <span class="keyword">return</span> getInlineCode(styleLink);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	  <span class="comment">// external styles</span></span><br><span class="line">	  <span class="keyword">return</span> styleCache[styleLink] ||</span><br><span class="line">	  (styleCache[styleLink] = fetch(styleLink).then(<span class="function"><span class="params">response</span> =&gt;</span> response.text()));</span><br><span class="line">	&#125;</span><br><span class="line">  ));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>该方法会遍历 styles 数组，如果是内联样式，则直接返回；否则判断缓存中是否存在，如果没有，则通过 fetch 去下载，并进行缓存。</li>
</ul>
<p>4、getExternalScripts 方法原理与 getExternalStyleSheets 方法类似，具体代码如下。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// scripts是解析html后得到的&lt;scripts&gt;标签的url的数组</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="title">getExternalScripts</span>(<span class="params">scripts, fetch = defaultFetch</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.all(scripts.map(<span class="function"><span class="params">script</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fetch(scriptUrl).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> response.text();</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5、execScripts 是实现 js 隔离的核心方法，可以通过给定的一个假 window 来执行所有 script 标签的脚本，这样就是真正模拟了浏览器执行 script 标签的行为。伪代码如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="title">execScripts</span>(<span class="params">proxy</span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 上面的getExternalScripts加载得到的&lt;scripts&gt;标签的内容</span></span><br><span class="line">  <span class="keyword">const</span> scriptsTexts = <span class="keyword">await</span> getExternalScripts(scripts)</span><br><span class="line">  <span class="built_in">window</span>.proxy = proxy;</span><br><span class="line">  <span class="comment">// 模拟浏览器，按顺序执行script</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> scriptsText <span class="keyword">of</span> scriptsTexts) &#123;</span><br><span class="line">    <span class="comment">// 调整sourceMap的地址，否则sourceMap失效</span></span><br><span class="line">    <span class="keyword">const</span> sourceUrl = <span class="string">&#x27;//# sourceURL=$&#123;scriptSrc&#125;\n&#x27;</span>;</span><br><span class="line">    <span class="comment">// 通过iife把proxy替换为window, 通过eval来执行这个script</span></span><br><span class="line">    <span class="built_in">eval</span>(<span class="string">`</span></span><br><span class="line"><span class="string">      ;(function(window, self)&#123;</span></span><br><span class="line"><span class="string">        ;<span class="subst">$&#123;scriptText&#125;</span></span></span><br><span class="line"><span class="string">        <span class="subst">$&#123;sourceUrl&#125;</span></span></span><br><span class="line"><span class="string">      &#125;).bind(window.proxy)(window.proxy, window.proxy);</span></span><br><span class="line"><span class="string">    `</span>;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="js-隔离机制"><a href="#js-隔离机制" class="headerlink" title="js 隔离机制"></a>js 隔离机制</h5><p>1、js 隔离机制是通过 execScripts 方法实现的，部分核心源码如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">execScripts</span>(<span class="params">entry, scripts, proxy = <span class="built_in">window</span>, opts = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  ... <span class="comment">// 初始化参数</span></span><br><span class="line">  <span class="keyword">return</span> getExternalScripts(scripts, fetch, error)</span><br><span class="line">	.then(<span class="function"><span class="params">scriptsText</span> =&gt;</span> &#123;</span><br><span class="line">	  <span class="comment">// 在proxy对象下执行脚本的方法</span></span><br><span class="line">	  <span class="keyword">const</span> geval = <span class="function">(<span class="params">scriptSrc, inlineScript</span>) =&gt;</span> &#123;</span><br><span class="line">	    <span class="keyword">const</span> rawCode = beforeExec(inlineScript, scriptSrc) || inlineScript;</span><br><span class="line">	    <span class="keyword">const</span> code = getExecutableScript(scriptSrc, rawCode, proxy, strictGlobal);</span><br><span class="line">        (<span class="number">0</span>, <span class="built_in">eval</span>)(code);</span><br><span class="line">        afterExec(inlineScript, scriptSrc);</span><br><span class="line">	  &#125;;</span><br><span class="line">	  <span class="comment">// 执行单个脚本的方法</span></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">exec</span>(<span class="params">scriptSrc, inlineScript, resolve</span>) </span>&#123; ... &#125;</span><br><span class="line">      <span class="comment">// 排期函数，负责逐个执行脚本</span></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">schedule</span>(<span class="params">i, resolvePromise</span>) </span>&#123; ... &#125;</span><br><span class="line">      <span class="comment">// 启动排期函数，执行脚本</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> schedule(<span class="number">0</span>, success || resolve));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>这个函数的关键是定义了三个函数：geval、exec、schedule，其中实现 js 隔离的是 geval 函数内调用的 getExecutableScript 函数。可以看出，在调这个函数时，会把外部传入的 proxy 作为参数传入了进去，而它返回的是一串新的脚本字符串，这段新的字符串内的 window 已经被 proxy 替代，具体实现逻辑如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getExecutableScript</span>(<span class="params">scriptSrc, scriptText, proxy, strictGlobal</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> sourceUrl = isInlineCode(scriptSrc)</span><br><span class="line">    ? <span class="string">&quot;&quot;</span></span><br><span class="line">    : <span class="string">`//# sourceURL=<span class="subst">$&#123;scriptSrc&#125;</span>\n`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 通过这种方式获取全局 window，因为 script 也是在全局作用域下运行的，所以我们通过 window.proxy 绑定时也必须确保绑定到全局 window 上</span></span><br><span class="line">  <span class="comment">// 否则在嵌套场景下， window.proxy 设置的是内层应用的 window，而代码其实是在全局作用域运行的，会导致闭包里的 window.proxy 取的是最外层的微应用的 proxy</span></span><br><span class="line">  <span class="keyword">const</span> globalWindow = (<span class="number">0</span>, <span class="built_in">eval</span>)(<span class="string">&quot;window&quot;</span>);</span><br><span class="line">  globalWindow.proxy = proxy;</span><br><span class="line">  <span class="comment">// TODO 通过 strictGlobal 方式切换切换 with 闭包，待 with 方式坑趟平后再合并</span></span><br><span class="line">  <span class="keyword">return</span> strictGlobal</span><br><span class="line">    ? <span class="string">`;(function(window, self, globalThis)&#123;with(window)&#123;;<span class="subst">$&#123;scriptText&#125;</span>\n<span class="subst">$&#123;sourceUrl&#125;</span>&#125;&#125;).bind(window.proxy)(window.proxy, window.proxy, window.proxy);`</span></span><br><span class="line">    : <span class="string">`;(function(window, self, globalThis)&#123;;<span class="subst">$&#123;scriptText&#125;</span>\n<span class="subst">$&#123;sourceUrl&#125;</span>&#125;).bind(window.proxy)(window.proxy, window.proxy, window.proxy);`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>上述核心代码就是<code>;(function(window, self, globalThis)&#123;with(window)&#123;;</code>${scriptText}\n${sourceUrl}}}).bind(window.proxy)(<code>window.proxy</code>,window.proxy, window.proxy);，它把解析出的 scriptText（即脚本字符串）用 with(window){}包裹起来，然后把 window.proxy 作为函数的第一个参数传进来，所以 with 语法内的 window 实际上是 window.proxy。这样，当在执行这段代码时，所有类似 let name = ‘dnhyxc’ 这样的语句添加的全局变量 name，实际上是被挂载到了 window.proxy 上，而不是真正的全局 window 上。当应用被卸载时，对应的 proxy 会被清除，因此不会导致 js 污染。而当你配置 webpack 的打包类型为 lib 时，你得到的接口大概如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> jquery = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;)();</span><br></pre></td></tr></table></figure>
<p>2、如果你的应用内使用了 jquery，那么这个 jquery 对象就会被挂载到 window.proxy 上。不过如果你在代码内直接写 window.name = ‘dnhyxc’ 来生成全局变量，那么 qiankun 就无法隔离 js 污染了。</p>
<ul>
<li>import-html-entry 实现了上述能力后，qiankun 要做的就很简单了，只需要在加载一个应用时为其初始化一个 proxy 传递进来即可，proxySandbox.ts 文件内容如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxySandbox</span> <span class="title">implements</span> <span class="title">SandBox</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name: string</span>)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(fakeWindow, &#123;</span><br><span class="line">      set () &#123; ... &#125;,</span><br><span class="line">      get () &#123; ... &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>每次加载一个应用，qiankun 就初始化这样一个 proxySandbox，传入上述 execScripts 函数中。</p>
</li>
<li><p>在 IE 下，由于 proxy 不被支持，并且没有可用的 polyfill，所以 qiankun 退而求其次，采用快照策略实现 js 隔离。它的大致思路是，在加载应用前，将 window 上的所有属性保存起来（即拍摄快照）；等应用被卸载时，再恢复 window 上的所有属性，这样也可以防止全局污染。但是当页面同时存在多个应用实例时，qiankun 无法将其隔离开，所以 IE 下的快照策略无法支持多实例模式。</p>
</li>
</ul>
<h5 id="css-隔离机制"><a href="#css-隔离机制" class="headerlink" title="css 隔离机制"></a>css 隔离机制</h5><p>1、qiankun 主要提供了两种样式隔离方案，一种是基于 shadowDom 的；另一种则是实验性的，思路类似于 Vue 中的 scoped 属性，给每个子应用的根节点添加一个特殊属性，用作对所有 css 选择器的约束。</p>
<p>2、开启样式隔离的语法如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">registerMicroApps(&#123;</span><br><span class="line">  name: <span class="string">&#x27;app1&#x27;</span>,</span><br><span class="line">  ...</span><br><span class="line">  sandbox: &#123;</span><br><span class="line">    strictStyleIsolation: <span class="literal">true</span></span><br><span class="line">    <span class="comment">// 实验性方案，scoped方式</span></span><br><span class="line">    <span class="comment">// experimentalStyleIsolation: true</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>当启用 strictStyleIsolation 时，qiankun 将采用 shadowDom 的方式进行样式隔离，即为子应用的根节点创建一个 shadow root。最终整个应用的所有 DOM 将形成一棵 shadow tree。我们知道，shadowDom 的特点是，它内部所有节点的样式对树外面的节点无效，因此自然就实现了样式隔离。</p>
</li>
<li><p>但是这种方案是存在缺陷的。因为某些 UI 框架可能会生成一些弹出框直接挂载到 document.body 下，此时由于脱离了 shadow tree，所以它的样式仍然会对全局造成污染。</p>
</li>
<li><p>此外 qiankun 也在探索类似于 scoped 属性的样式隔离方案，可以通过 experimentalStyleIsolation 来开启。这种方案的策略是为子应用的根节点添加一个特定的随机属性，如：</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;div</span><br><span class="line">  data-qiankun-asiw732sde</span><br><span class="line">  id=&quot;__qiankun_microapp_wrapper__&quot;</span><br><span class="line">  data-name=&quot;module-app1&quot;</span><br><span class="line">&gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>这种放肆需要为所有样式前面都加上这样的约束：</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">- <span class="selector-class">.app-main</span> &#123;</span><br><span class="line">-   字体大小：<span class="number">14</span> px ;</span><br><span class="line">- &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 使用如下写法代替上面的写法 */</span></span><br><span class="line">+ <span class="selector-tag">div</span><span class="selector-attr">[data-qiankun-asiw732sde]</span> <span class="selector-class">.app-main</span> &#123;</span><br><span class="line">+   字体大小：<span class="number">14</span> px ;</span><br><span class="line">+ &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>经过上述替换，这个样式就只能在当前子应用内生效了。虽然该方案已经提出很久了，但仍然是实验性的，因为它不支持 @keyframes，@font-face，@import，@page（即不会被重写）。</li>
</ul>
<h5 id="应用通信"><a href="#应用通信" class="headerlink" title="应用通信"></a>应用通信</h5><p>1、一般来说，微前端中各个应用之前的通信应该是尽量少的，而这依赖于应用的合理拆分。反过来说，如果你发现两个应用间存在极其频繁的通信，那么一般是拆分不合理造成的，这时往往需要将它们合并成一个应用。</p>
<p>2、qiankun 官方基于通信问题提供了一个简要的方案，思路是基于一个全局的 <strong>globalState</strong> 对象。这个对象由基座应用负责创建，内部包含一组用于通信的变量，以及两个分别用于修改变量值和监听变量变化的方法：<strong>setGlobalState</strong> 和 <strong>onGlobalStateChange</strong>，具体使用如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; initGlobalState, MicroAppStateActions &#125; <span class="keyword">from</span> <span class="string">&quot;qiankun&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> actions: MicroAppStateActions = initGlobalState(initialState);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> actions;</span><br></pre></td></tr></table></figure>
<ul>
<li>这里的 actions 对象就是我们说的 globalState，即全局状态。基座应用可以在加载子应用时通过 props 将 actions 传递到子应用内，而子应用通过以下语句即可监听全局状态变化：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">actions.onGlobalStateChange (globalState, oldGlobalState) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>修改全局状态：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">actions.setGlobalState(...);</span><br></pre></td></tr></table></figure>
<ul>
<li>同样的，子应用也可以从主应用传递下来的 props 中获取到 setGlobalState 方法修改全局状态。</li>
</ul>
]]></content>
      <categories>
        <category>项目构建</category>
        <category>qiankun</category>
        <category>dva</category>
      </categories>
      <tags>
        <tag>webpack</tag>
        <tag>JavaScript</tag>
        <tag>dva</tag>
        <tag>eslint</tag>
        <tag>qiankun</tag>
        <tag>TypeScript</tag>
      </tags>
  </entry>
  <entry>
    <title>webpack5</title>
    <url>/2020/12/09/webpack/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="webpack5"><a href="#webpack5" class="headerlink" title="webpack5"></a>webpack5</h3><h4 id="webpack-安装"><a href="#webpack-安装" class="headerlink" title="webpack 安装"></a>webpack 安装</h4><p>1、注意尽量不要在全局安装 webpack、在全局安装会把 webpack 版本锁死，可能导致其它项目打包出错。</p>
<p>2、可以通过如下方式在局部安装：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir webpack-test</span><br><span class="line"></span><br><span class="line">cd webpack-test</span><br><span class="line"></span><br><span class="line">npm init -y</span><br><span class="line"></span><br><span class="line">npm i webpack webpack-cli webpack-dev-server -D</span><br></pre></td></tr></table></figure>
<a id="more"></a>

<h4 id="entry-配置"><a href="#entry-配置" class="headerlink" title="entry 配置"></a>entry 配置</h4><p>1、entry 用于配置打包时的入口，其属性及配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="output-配置"><a href="#output-配置" class="headerlink" title="output 配置"></a>output 配置</h4><p>1、output 用于配置打包的出口，其属性及配置方式如下：</p>
<ul>
<li><p>clean：用于清除上次打包生成的 dist 或 build 文件夹。</p>
</li>
<li><p>filename：用于配置打包输出的文件名称，我们可以通过 filename 中的 <strong>substitutions</strong> 设置来定义输出文件的名称。webpack 提供了一种使用称为 substitutions（可替换模板字符串）的方式，通过带括号字符串来模板化文件名。其中 <strong>[contenthash]</strong> substitutions 将根据资源内容创建出唯一 hash。当资源内容发生变化时，contenthash 也会发生变化。</p>
</li>
<li><p>path：用于配置打包输出的文件夹路径。</p>
</li>
<li><p>assetModuleFilename：用于设置打包输出的资源模块（图片等）的文件名及路径。如：<code>assetModuleFilename: &quot;images/test.png&quot;</code> 就是将打包的资源模块输出到 dist 文件夹中的 images 文件夹下，名字为 test.png。</p>
</li>
<li><p>publicPath：该属性用于配置公共路径。这个配置在各种场景中都非常有用，我们可以通过它来指定应用程序中所有资源的基础路径。</p>
<ul>
<li>基于环境变量设置：在开发环境中，我们通常有一个 asset/ 文件夹，它与索引页面位于同一级别，这没太大问题，但是如果我们将所有的静态资源托管到 CDN 上，然后想在生产环境中使用该怎么解决呢？想要解决这个问题，可以直接使用环境变量，假设有一个环境变量 ASSET_PATH：</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> webpack <span class="keyword">from</span> <span class="string">&quot;webpack&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ASSET_PATH = process.env.ASSET_PATH || <span class="string">&quot;/&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&quot;[name].[contenthash].[ext]&quot;</span>,</span><br><span class="line">    path: path.reslove(__dirname, <span class="string">&quot;./dist&quot;</span>),</span><br><span class="line">    clean: <span class="literal">true</span>,</span><br><span class="line">    assetModuleFilename: <span class="string">&quot;images/[contenthash][ext]&quot;</span>,</span><br><span class="line">    publicPath: <span class="string">&quot;ASSET_PATH&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// 该配置可以帮助我们在代码中安全的使用环境变量</span></span><br><span class="line">    <span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">      <span class="string">&quot;process.env.ASSET_PATH&quot;</span>: <span class="built_in">JSON</span>.stringify(ASSET_PATH),</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>contenthash：表示根据文件的内容来生成一个 hash 字符串，ext 则表示文件的扩展名，这些都是 webpack 内置的写法。</p>
</blockquote>
<h4 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h4><p>1、想要消除 webpack.config.js 在开发环境和生产环境之间的差异，就需要环境变量。</p>
<p>2、webpack 命令行环境变量的 <strong>–env</strong> 参数，可以允许传入任意数量的环境变量。而在 webpack.config.js 中可以访问到这些环境变量。例如：<code>--env production</code> 或 <code>--env goal=local</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npx webpack --env production --goal&#x3D;local --progress</span><br></pre></td></tr></table></figure>
<p>3、注意：要使用 env 变量，必须将 module.exports 转换成函数的形式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">env</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> isDev = env.production ? <span class="literal">false</span> : <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    mode: isDev ? <span class="string">&quot;production&quot;</span> : <span class="string">&quot;development&quot;</span>,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h4><h5 id="html-webpack-plugin"><a href="#html-webpack-plugin" class="headerlink" title="html-webpack-plugin"></a>html-webpack-plugin</h5><p>1、该插件可以让 webpack 在打包时自动生成 index.html，并自定将打包生成的 js 文件引入生成的 index.html 中。</p>
<p>2、属性及配置方式如下：</p>
<ul>
<li><p>template：该属性用于配置 webpack 打包生成 index.html 的模板。</p>
</li>
<li><p>filename：配置生成 html 的文件名。</p>
</li>
<li><p>inject：配置引入 script 标签的位置，默认是放在 header 中，属性值如果配置为 body，将会引入到 body 中。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">    template: <span class="string">&quot;./index.html&quot;</span>,</span><br><span class="line">    filename: <span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">    inject: <span class="string">&quot;body&quot;</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<h5 id="webpack-bundle-analyzer"><a href="#webpack-bundle-analyzer" class="headerlink" title="webpack-bundle-analyzer"></a>webpack-bundle-analyzer</h5><p>1、该插件是一个 plugin 和 CLI 工具，可以用来配置打包时生成依赖图。它将 bundle 内容展示为一个便捷的、交互式、可缩放的树状图形式。即打包完成之后，会在浏览器中打开一个页面展示一个可视化的打包产物依赖图。</p>
<p>2、具体配置方式如下：</p>
<ul>
<li>首先需要安装 webpack-bundle-analyzer 这个插件：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i webpack-bundle-analyzer -D</span><br></pre></td></tr></table></figure>
<ul>
<li>之后在 plugins 中配置该插件：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; BundleAnalyzerPlugin &#125; = <span class="built_in">require</span>(<span class="string">&quot;webpack-bundle-analyzer&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  plugins: [<span class="keyword">new</span> BundleAnalyzerPlugin()],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="webpack-dev-server"><a href="#webpack-dev-server" class="headerlink" title="webpack-dev-server"></a>webpack-dev-server</h4><p>1、webpack-dev-server 可以提供一个基本的 web server，并且具有 live reloading（实时重新加载）功能。</p>
<p>2、webpack-dev-server 在编译之后不会输出任何文件，而是将 bundle 文件保存到内存中，然后将它们 serve 到 server 中，就好像它们是挂载在 server 根路径上的真实文件一样。</p>
<h5 id="常用属性属性及配置"><a href="#常用属性属性及配置" class="headerlink" title="常用属性属性及配置"></a>常用属性属性及配置</h5><p>1、static：该属性用于告知 webpack-dev-server 从什么位置查找文件，<code>static: &quot;./dist&quot;</code> 将告知其从 dist 目录下的文件作为 web 服务的根目录。</p>
<p>2、compress：该属性可以设置是否开启 gzip 压缩，及是不是在服务器端进行代码压缩。其中值为 <code>true</code> 则表示开启，否则反之。我们可以通过浏览器中 network 中的 Respons Headers 中的 <strong>Content-Encoding: gzip</strong> 属性查看是否开启了 gzip 压缩。</p>
<p>3、prot：用于配置浏览器访问的端口号。</p>
<p>4、proxy：该属性可以用来配置代理。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  devServer: &#123;</span><br><span class="line">    <span class="keyword">static</span>: path.resolve(__dirname, <span class="string">&quot;./dist&quot;</span>),</span><br><span class="line">    compress: <span class="literal">true</span>,</span><br><span class="line">    port：<span class="number">3000</span>,</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      <span class="string">&quot;/api&quot;</span>: <span class="string">&quot;http://localhost: 4001&quot;</span>,</span><br><span class="line">      pathRewrite: &#123;</span><br><span class="line">        <span class="string">&quot;^/api&quot;</span>: <span class="string">&quot; &quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="高级属性及配置"><a href="#高级属性及配置" class="headerlink" title="高级属性及配置"></a>高级属性及配置</h5><p>1、headers：可以将一个头部信息传递到请求头中。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    headers: &#123;</span><br><span class="line">      <span class="string">&quot;X-Access-Token&quot;</span>: <span class="string">&quot;abcxxx&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>2、https：是否将 http 服务变成 https 的服务。其中值为 true 为开启 https 服务。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    https: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>3、http2：是否使用 http2 的服务。其中值为 true，则表示开启 http2 的服务。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    http2: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>4、historyApiFallback：用于解决 SPA 单页应用配置 history 模式路由出现的 404 的问题。</p>
<ul>
<li>在一个 SPA 应用中，当在路由后面加上 <code>/article</code> 时，会发现此时刷新页面后，控制台会报错：<code>GRT http://localhost: 3000/article 404 (Not Found)</code>。这是因为浏览器把这个路由当作静态资源地址去请求了，然而我们并没有打包出 <code>/article</code> 这样的资源，所以就会出现 404 的情况。这时，就可以通过 <strong>historyApiFallback</strong> 属性来解决问题了。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    historyApiFallback: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>配置如上设置之后，重新刷新页面，就会发现请求变成了 <code>index.html</code>。</p>
</blockquote>
<ul>
<li>在多数应用场景下，我们需要根据不同的访问路径定制替代的页面，此时可以使用 <strong>rewrites</strong> 这个配置项，具体配置如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    historyApiFallback: &#123;</span><br><span class="line">      rewrites: [</span><br><span class="line">        &#123;<span class="attr">from</span>: <span class="regexp">/^\/$/</span>, to: <span class="string">&quot;/views/loading.html&quot;</span>&#125;</span><br><span class="line">        &#123;<span class="attr">from</span>: <span class="regexp">/^\/subpage$/</span>, to: <span class="string">&quot;/views/subpage.html&quot;</span>&#125;</span><br><span class="line">        &#123;<span class="attr">from</span>: <span class="regexp">/./</span>, to: <span class="string">&quot;/views/404.html&quot;</span>&#125;</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>5、host: 用于设置开发服务器主机，如果在开发环境中起了一个 devServer 服务，并期望在同一局域网下的他人也能访问到它，就可以使用如下配置解决：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    host: <span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>6、hot：用于开启模块热替换。</p>
<ul>
<li>模块热替换（HMR-hot module replacement）功能会在应用程序运行过程中，替换、添加或删除模块，而无需重新加载整个页面。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    hot: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>当配置了 style-loader 时，也就相当于开启了样式文件的热替换功能。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>7、liveReload：用于开启热加载功能。</p>
<ul>
<li>当开启了热加载时，当文件更新时，会自动刷新服务和页面。新版的 webpack-dev-server 默认已经开启了热加载功能。它对应的参数是 ddevServer.liveReload，默认为 true。注意：如果想要关掉它，需要将 liveReload 设置为 false 的同时将 hot 设置为 false。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    liveReload: <span class="literal">false</span>,</span><br><span class="line">    hot: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="资源文件"><a href="#资源文件" class="headerlink" title="资源文件"></a>资源文件</h3><h4 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h4><p>1、webpack 天生就可以解析 js 及 json 文件，而需要解析其它资源文件，就需要借助 loader 来实现了，比如在 js 中加载 css 模块，就需要通过 loader 来完成。</p>
<h4 id="loader-的定义"><a href="#loader-的定义" class="headerlink" title="loader 的定义"></a>loader 的定义</h4><p>1、test：用于识别出哪些文件需要被转换。</p>
<p>2、use：定义转化的时候需要用哪个 loader 进行转化。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      test: <span class="regexp">/\.txt$/</span>,</span><br><span class="line">      use: <span class="string">&quot;raw-loader&quot;</span>,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上述例子中，当 webpack 去解析一个 .txt 文件的时候，在对这个文件进行打包之前，先使用 raw-loader 进行转化一下，再打包输出。</p>
</blockquote>
<h4 id="解析-css-资源"><a href="#解析-css-资源" class="headerlink" title="解析 css 资源"></a>解析 css 资源</h4><p>1、解析 css 资源，需要安装 <strong>style-loader、css-loader</strong>。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i style-loader css-loader -D</span><br></pre></td></tr></table></figure>
<p>2、具体配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">      use: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>由于 loader 的加载顺序是从右到左，从下到上的，所以 style-loader 要放在 css-loader 之前，即先使用 css-loader 进行解析，之后再使用 style-loader 渲染到页面上。</p>
</blockquote>
<h4 id="PostCSS"><a href="#PostCSS" class="headerlink" title="PostCSS"></a>PostCSS</h4><p>1、PostCSS 是一个用 JS 工具和插件转换 CSS 代码的工具，比如可以使用 Autoprefixer 插件获取浏览器额流行度和能够支持的属性，并根据这些数据帮我们自动的为 CSS 规则添加前缀，将最新的 CSS 语法转换为大多数浏览器都能识别的语法。</p>
<p>2、使用 PostCSS 时，需要安装 style-loader、css-loader、postcss-loader 这三个 loader：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i style-loader css-loader postcss-loader -D</span><br></pre></td></tr></table></figure>
<p>3、PostCSS 具体配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/module/</span>,</span><br><span class="line">        use: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;postcss-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>4、在项目录下创建 postcss.config.js 文件，内容如下：</p>
<ul>
<li>首先需要安装 <strong>autoprefixer</strong> 这个插件，该插件的作用是可以为样式加上前缀，用于做浏览器的兼容性设置：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i autoprefixer -D</span><br></pre></td></tr></table></figure>
<ul>
<li>之后在 postcss.config.js 中使用该插件：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [<span class="built_in">require</span>(<span class="string">&quot;autoprefixer&quot;</span>)],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>最后需要在 package.json 中配置 <strong>browserslist</strong> 属性：</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;devDependencies&quot;: &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&quot;browserslist&quot;: &#123;</span><br><span class="line">  &quot;&gt; 1%&quot;,</span><br><span class="line">  <span class="string">&quot;last 2 versions&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>设置好以上配置之后，在 css 中设置 <code>body: &#123; display: flex; &#125;</code>，最终在浏览器中设置的样式为：</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">body</span>: &#123;</span><br><span class="line">  display: -webkit-box;</span><br><span class="line">  <span class="attribute">display</span>: -ms-flexbox;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="CSS-模块化设置"><a href="#CSS-模块化设置" class="headerlink" title="CSS 模块化设置"></a>CSS 模块化设置</h4><p>1、CSS 模块则能让你永远不用担心命名太大众化而造成冲突，只要用最有意义的名字就行了。</p>
<p>2、配置 css 模块化，只需要在 css-loader 中的设置 <code>options.module: true</code> 即可。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/module/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="string">&quot;style-loader&quot;</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              modules: <span class="literal">true</span>,</span><br><span class="line">              localIdentName: <span class="string">&quot;[hash:base64:6]&quot;</span>, <span class="comment">// 样式名设置</span></span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>3、除了将所有的 css 都设置为模块化之外，也可以部分开启 css 模块化形式，比如全局样式可以冠以 <code>.global</code> 前缀，如：<code>*.global.css 表示普通模式</code>，<code>*.css 表示 css 模块化模式</code>。</p>
<ul>
<li>模块化模式配置如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">`^(?!.*\\.global).*\\.css`</span>);</span><br><span class="line">  use: [</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">&quot;style-loader&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        modules: <span class="literal">true</span>,</span><br><span class="line">        localIdentName: <span class="string">&quot;[hash:base64:6]&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">  exclude: [path.resolve(__dirname, <span class="string">&quot;..&quot;</span>, <span class="string">&quot;node_modules&quot;</span>)];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>普通模式配置如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">`^(.*\\.global).*\\.css`</span>);</span><br><span class="line">  use: [</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">&quot;style-loader&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">  exclude: [path.resolve(__dirname, <span class="string">&quot;..&quot;</span>, <span class="string">&quot;node_modules&quot;</span>)];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="解析-less-资源"><a href="#解析-less-资源" class="headerlink" title="解析 less 资源"></a>解析 less 资源</h4><p>1、解析 less 需要安装 <strong>less、less-loader</strong>。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i less less-loader -D</span><br></pre></td></tr></table></figure>
<p>2、具体配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      test: <span class="regexp">/\.(css|less)$/</span>,</span><br><span class="line">      use: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="抽离-css"><a href="#抽离-css" class="headerlink" title="抽离 css"></a>抽离 css</h4><p>1、将 css 文件抽离成单独的文件，需要通过 <strong>mini-css-ectract-plugin</strong> 这个插件来完成。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i mini-css-ectract-plugin -D</span><br></pre></td></tr></table></figure>
<p>2、mini-css-ectract-plugin 属性及配置如下：</p>
<ul>
<li>filename：定义 css 打包输出的文件路径及文件名称。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-ectract-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      test: <span class="regexp">/\.(css|less)$/</span>,</span><br><span class="line">      use: [MiniCssExtractPlugin.loader, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line"></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">      filename: <span class="string">&quot;styles/[contenthash].css&quot;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="压缩-css"><a href="#压缩-css" class="headerlink" title="压缩 css"></a>压缩 css</h4><p>1、压缩 css 需要通过 <strong>css-minimizer-webpack-plugin</strong> 来完成。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i css-minimizer-webpack-plugin -D</span><br></pre></td></tr></table></figure>
<p>2、css-minimizer-webpack-plugin 配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-ectract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> CssMinimizerPlugin = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      test: <span class="regexp">/\.(css|less)$/</span>,</span><br><span class="line">      use: [MiniCssExtractPlugin.loader, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">      filename: <span class="string">&quot;styles/[contenthash].css&quot;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  optimization: &#123;</span><br><span class="line">    minimizer: [</span><br><span class="line">      <span class="keyword">new</span> CssMinimizerPlugin();</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  mode: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="压缩-js"><a href="#压缩-js" class="headerlink" title="压缩 js"></a>压缩 js</h4><p>1、压缩 js 本是 webpack 开箱即用的功能，但是如果在 optimization.minimizer 中配置了压缩 css 的功能之后，这个开箱即用的功能就失效了，需要单独配置，此时需要单独配置 <strong>terser-webpack-plugin</strong> 来实现：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i terser-webpack-plugin -D</span><br></pre></td></tr></table></figure>
<p>2、具体配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> CssMinimizerPlugin = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> TerserPlugin = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  optimization: &#123;</span><br><span class="line">    minimizer: [</span><br><span class="line">      <span class="comment">// 压缩css</span></span><br><span class="line">      <span class="keyword">new</span> CssMinimizerPlugin();</span><br><span class="line">      <span class="comment">// 压缩js</span></span><br><span class="line">      <span class="keyword">new</span> TerserPlugin();</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  mode: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：要使压缩 css 生效，必须将 mode 设置为生产模式。</p>
</blockquote>
<h4 id="加载数据"><a href="#加载数据" class="headerlink" title="加载数据"></a>加载数据</h4><p>1、类似于 NodeJS，webpack 加载 JSON 文件实际上是内置的，也就是说 <code>import Data from &#39;./data.json&#39;</code>，但要导入 CSV、TSV、XML 这些资源就需要使用 <strong>csv-loader 和 xml-loader</strong>。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i csv-loader xml-loader -D</span><br></pre></td></tr></table></figure>
<p>2、具体配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.(csv|tsv)$/</span>,</span><br><span class="line">      use: [<span class="string">&quot;csv-loader&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.xml$/</span>,</span><br><span class="line">      use: [<span class="string">&quot;xml-loader&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、使用如上配置，就可以直接在 js 文件中导入 csv、xml 等资源了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Data <span class="keyword">from</span> <span class="string">&quot;./assets/data.xml&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Notes <span class="keyword">from</span> <span class="string">&quot;./assets/data.csv&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(Data);</span><br><span class="line"><span class="built_in">console</span>.log(Notes);</span><br></pre></td></tr></table></figure>
<h4 id="自定义-JSON-模块-parser"><a href="#自定义-JSON-模块-parser" class="headerlink" title="自定义 JSON 模块 parser"></a>自定义 JSON 模块 parser</h4><p>1、通过自定义 parser 代替特定的 webpack loader，可以将任何 toml、yaml 或 json5 文件作为 JSON 模块导入。但要完成这个需求需要安装如下插件：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i toml yaml json5 -D</span><br></pre></td></tr></table></figure>
<p>2、在 webpack.config.js 文件中设置如下配置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">const</span> toml = <span class="built_in">require</span>(<span class="string">&quot;toml&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> yaml = <span class="built_in">require</span>(<span class="string">&quot;yaml&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> json5 = <span class="built_in">require</span>(<span class="string">&quot;json5&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.toml$/</span>,</span><br><span class="line">        type: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">        parser: &#123;</span><br><span class="line">          parse: toml.parse,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.yaml$/</span>,</span><br><span class="line">        type: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">        parser: &#123;</span><br><span class="line">          parse: yaml.parse,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.json5$/</span>,</span><br><span class="line">        type: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">        parser: &#123;</span><br><span class="line">          parse: json5.parse,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>3、设置了如上配置之后，就可以在 js 中导入使用上述资源了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> toml <span class="keyword">from</span> <span class="string">&quot;./assets/data.toml&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> yaml <span class="keyword">from</span> <span class="string">&quot;./assets/data.yaml&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> json5 <span class="keyword">from</span> <span class="string">&quot;./assets/data.json5&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(toml);</span><br><span class="line"><span class="built_in">console</span>.log(yaml);</span><br><span class="line"><span class="built_in">console</span>.log(json5);</span><br></pre></td></tr></table></figure>
<h4 id="babel-loader"><a href="#babel-loader" class="headerlink" title="babel-loader"></a>babel-loader</h4><p>1、babel-loader 可以将 es6 的 js 代码编译成 es5 的代码，如下 es6 中的 async await 的写法就可通过 babel-loader 编译成低版本浏览器可识别的 es5 的写法：</p>
<ul>
<li>在入口 js 文件中写入如下代码：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      resolve(<span class="string">&quot;Hello world&quot;</span>);</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">helloWorld</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> string = <span class="keyword">await</span> getString();</span><br><span class="line">  <span class="built_in">console</span>.log(string);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果在低版本的浏览器中运行上述代码，如果没有被 babel-loader 转义，在页面将不能正常显示。</p>
</blockquote>
<p>2、要使用 babel-loader，需要安装如下几个 loader：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i babel-loader @babel&#x2F;core @babel&#x2F;preset-env -D</span><br></pre></td></tr></table></figure>
<ul>
<li><p>babel-loader：在 webpack 里用于解析 ES6 的桥梁。</p>
</li>
<li><p>@babel/core：babel 核心模块。</p>
</li>
<li><p>@babel/preset-env：babel 预设，一组 babel 插件的集合。</p>
</li>
</ul>
<p>3、为了兼容 async/await 语法，webpack 会用到 regeneratorRuntime 插件。此时就需要安装 <strong>@babel/runtime、@babel/plugin-transform-runtime</strong> 这两个插件。否则在解析 async/await 语法的时候就会报错。</p>
<ul>
<li>@babel/plugin-transform-runtime：会在需要使用到 regeneratorRuntime 的地方自动 require 导包。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i @babel&#x2F;runtime @babel&#x2F;plugin-transform-runtime -D</span><br></pre></td></tr></table></figure>
<p>4、具体配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      use: &#123;</span><br><span class="line">        loader: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          presets: [<span class="string">&quot;@babel/preset-env&quot;</span>],</span><br><span class="line">          plugins: [[<span class="string">&quot;@babel/plugin-transform-runtime&quot;</span>]],</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="解析-TypeScript"><a href="#解析-TypeScript" class="headerlink" title="解析 TypeScript"></a>解析 TypeScript</h4><p>1、结合 webpack 使用 TS，首先需要安装 typescript 及 ts-loader：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i typescript ts-loader -D</span><br></pre></td></tr></table></figure>
<p>2、在项目根目录下添加一个 ts 配置文件 <code>tsconfig.json</code>，或者直接使用 ts 自带的工具来自动化生成该文件：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npx tsc --init</span><br></pre></td></tr></table></figure>
<ul>
<li>tsconfig.js 文件局部配置如下：</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;outDir&quot;</span>: <span class="string">&quot;./dist/&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;noImplicitAny&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;sourceMap&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;module&quot;</span>: <span class="string">&quot;es6&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;es5&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;jsx&quot;</span>: <span class="string">&quot;react&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;allowJs&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;moduleResolution&quot;</span>: <span class="string">&quot;node&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、webpack 编译 ts 具体配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = reauire(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&quot;./src/app.ts&quot;</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&quot;bundle.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  devtool: <span class="string">&quot;inline-source-map&quot;</span>,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.ts$/</span>,</span><br><span class="line">        use: <span class="string">&quot;ts-loader&quot;</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [<span class="keyword">new</span> HtmlWebpackPlugin()],</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    extensions: [<span class="string">&quot;.ts&quot;</span>, <span class="string">&quot;.js&quot;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  mode: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="资源模块"><a href="#资源模块" class="headerlink" title="资源模块"></a><a href="https://webpack.docschina.org/guides/asset-modules/">资源模块</a></h3><h4 id="asset-resource"><a href="#asset-resource" class="headerlink" title="asset/resource"></a>asset/resource</h4><p>1、asset/resource 会发送一个单独的文件并导出 URL，可以用来加载图片资源或者 fonts 字体等，如加载 <strong>png、jpg、jpeg</strong> 或者 <strong>woff、woff2、eot、tff、otf</strong> 等，具体配置如下：</p>
<ul>
<li><p>generator：可以在该属性中配置资源打包输出的文件名称及路径。</p>
<ul>
<li>filename：用于配置资源模块的路径及名称。</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.png$/</span>,</span><br><span class="line">      type: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">      generator：&#123;</span><br><span class="line">        filename: <span class="string">&quot;images/[contenthash][ext]&quot;</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.(woff|woff2|eot|tff|otf)$/</span>,</span><br><span class="line">      type: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在 generator 中配置的资源模块打包输出的路径及文件名优先级高于 在 output 配置中使用 assetModuleFilename 配置的路径及文件名。</p>
</blockquote>
<p>2、使用如上配置后，在 js 文件中就可以使用模块的方式导入图片资源及使用字体了，导入后可以直接作为 img.src 的属性值，如下：</p>
<ul>
<li>css 文件：</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&quot;iconfont&quot;</span>;</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&quot;./assets/iconfont.ttf&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.icon</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&quot;iconfont&quot;</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>js 文件：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> testImage <span class="keyword">from</span> <span class="string">&quot;./assets/img1.png&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myImage = <span class="keyword">new</span> Image(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">myImage.src = testImage;</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(myImage);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用字体</span></span><br><span class="line"><span class="keyword">const</span> span = <span class="built_in">document</span>.createElement(<span class="string">&quot;span&quot;</span>);</span><br><span class="line">span.classList.add(<span class="string">&quot;icon&quot;</span>);</span><br><span class="line">span.innerHTML = <span class="string">&quot;&amp;#xe668;&quot;</span>;</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(span);</span><br></pre></td></tr></table></figure>
<h4 id="asset-inline"><a href="#asset-inline" class="headerlink" title="asset/inline"></a>asset/inline</h4><p>1、asset/inline 会导出一个资源的 Data URL（base64 格式），可以用来加载 <strong>svg</strong> 图。具体配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.svg$/</span>,</span><br><span class="line">      type: <span class="string">&quot;asset/inline&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、使用如上配置后，在 js 文件中就可以使用模块的方式导入 svg 资源了，导入后可以直接作为 img.src 的属性值，如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> svgLogo <span class="keyword">from</span> <span class="string">&quot;./assets/logo.svg&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myImage = <span class="built_in">document</span>.createElement(<span class="string">&quot;img&quot;</span>);</span><br><span class="line">myImage.style.cssText = <span class="string">&quot;width: 600px; height: 200px&quot;</span>;</span><br><span class="line">myImage.src = svgLogo;</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(myImage);</span><br></pre></td></tr></table></figure>
<h4 id="asset-source"><a href="#asset-source" class="headerlink" title="asset/source"></a>asset/source</h4><p>1、asset/source 会导出资源的源代码，可以用来加载 <strong>text</strong> 文本文件，具体配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.text$/</span>,</span><br><span class="line">      type: <span class="string">&quot;asset/source&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、使用如上配置后，在 js 文件中就可以使用模块的方式导入 text 资源了，如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> textFile <span class="keyword">from</span> <span class="string">&quot;./assets/textFile.txt&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dom = <span class="built_in">document</span>.createElement(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">myImage.style.cssText = <span class="string">&quot;width: 200px; height: 200px; background: pink&quot;</span>;</span><br><span class="line">dom.textContent = textFile;</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(dom);</span><br></pre></td></tr></table></figure>
<h4 id="asset"><a href="#asset" class="headerlink" title="asset"></a>asset</h4><p>1、asset 是一个通用资源类型，它会在 resource 和 inline 之间自动进行选择：</p>
<ul>
<li><p>小于 8kb 的文件，将会被视为 inline 模块类型，否则会被视为 resource 模块类型。</p>
</li>
<li><p>可以在 webpack 配置的 module rule 层级中设置 Rule.parser.dataUrlCondition.maxSize 选项来修改此条件：</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    test: <span class="regexp">/\.jpg$/</span>,</span><br><span class="line">    type: <span class="string">&#x27;asset&#x27;</span>,</span><br><span class="line">    parser: &#123;</span><br><span class="line">      dataUrlCondition: &#123;</span><br><span class="line">        maxSize: <span class="number">4</span> * <span class="number">1024</span> <span class="comment">// 4kb</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="代码分离"><a href="#代码分离" class="headerlink" title="代码分离"></a>代码分离</h3><h4 id="为什么要进行代码分离"><a href="#为什么要进行代码分离" class="headerlink" title="为什么要进行代码分离"></a>为什么要进行代码分离</h4><p>1、当没有进行代码分离时：假设 a.html 引用了 a.js，b.html 引用了 b.js，而 a.js 和 b.js 都引用了一个 24kb 的 lodash，这时假设用户先访问了 a.html，再访问 b.html，那么用户访问 a.html 的时候下载 a.js 有 24kb+，之后 a.js 被浏览器缓存，用户访问 b.html 的时候下载 b.js 有 24kb+，然后 b.js 被浏览器缓存，这样用户一共下载了 48kb+ 的内容，显然 lodash 被下载了两次。而且 lodash 没有被浏览器缓存（缓存的是 a.js 和 b.js）。</p>
<p>2、代码分离之后：这时候将 lodash 单独打包放到 vendor.js 中，当用户访问 a.html 的时候会下载 a.js 和 vendor.js，同时 a.js 和 vendor.js 会被浏览器缓存，用户再访问 b.html 的时候，只会下载 b.js，而不会再去下载 vendor.js，因为会直接使用缓存中的 vendor.js。这样就只下载了一次 lodash，省下了 24kb+ 的带宽，同时还提升了访问速度。</p>
<h4 id="常用的代码分离方法"><a href="#常用的代码分离方法" class="headerlink" title="常用的代码分离方法"></a>常用的代码分离方法</h4><p>1、在入口起点中使用 entry 配置多入口手动分离代码。</p>
<p>2、使用 Entry dependencies 或者 SplitChunksPlugin 去重和分离代码。</p>
<p>3、使用动态导入，通过模块的内联函数调用来分离代码。</p>
<h4 id="入口起点的方式"><a href="#入口起点的方式" class="headerlink" title="入口起点的方式"></a>入口起点的方式</h4><p>1、使用多入口的方式，可以将多个入口的 js 文件单独打包到不同的文件中，从而实现代码的分离。</p>
<p>2、这种方式需要更改 output 配置中的 filename 属性，即使用 webpack 内置的写法，自动获取输出文件的文件名称，使分离的文件不会使用同一个出口，防止报错。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    index: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">    another: <span class="string">&quot;./src/another-module.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&quot;[name].bundle.js&quot;</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&quot;./dist&quot;</span>),</span><br><span class="line">    clean: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上述配置会将 index.js 及 another-module.js 分别输出到 dist 文件中，及将会在 dist 文件中同时生成 index.bundle.js 及 another.bundle.js 文件。而在输出的 index.html 文件中也会同时引入这两个 js 文件。</p>
</blockquote>
<p>3、使用 entry 配置多入口分离代码会存在一个致命的缺点，就是如果在入口的 chunk 之间，包含一些重复的代码，这些重复的代码就会被引入到各自的 bundle 中。</p>
<ul>
<li>如果在 index.js 中以及 another-module.js 中同时使用 lodash 的话，将会将 lodash 分别打包进入这两个 js 文件中，导致 lodash 重复打包。</li>
</ul>
<h4 id="防止重复打包"><a href="#防止重复打包" class="headerlink" title="防止重复打包"></a>防止重复打包</h4><p>1、需要在入口依赖中配置 dependOn option 选项，这样可以在多个 chunk 之间共享模块：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    index: &#123;</span><br><span class="line">      <span class="keyword">import</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">      dependOn: <span class="string">&quot;shared&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    another: &#123;</span><br><span class="line">      <span class="keyword">import</span>: <span class="string">&quot;./src/another-module.js&quot;</span>,</span><br><span class="line">      dependOn: <span class="string">&quot;shared&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    shared: <span class="string">&quot;lodash&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&quot;[name].bundle.js&quot;</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&quot;./dist&quot;</span>),</span><br><span class="line">    clean: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上述配置就实现了将 lodash 单独打包到 shared.bundle.js 文件中，而在 打包输出的文件中，会同时引入 index.bundle.js、another.bundle.js 及 shared.bundle.js。这样就让 index.js 及 another-module.js 能够共享 lodash。而不需要将 lodash 打包到自己的文件中。</p>
</blockquote>
<p>2、除了上述方法之外，还可以使用 webpack 内置的插件 <strong><a href="https://webpack.docschina.org/plugins/split-chunks-plugin/">split-chunks-plugin</a></strong> 来实现防止代码的重复打包：</p>
<ul>
<li><p>splitChunks.minSize：生成 chunk 的最小体积（以 bytes 为单位），默认是 20000。</p>
</li>
<li><p>splitChunks.chunks：表明那些模块需要单独打包。<code>all</code> 表示将所有大于 20000 的模块都进行单独打包，<code>async</code> 表示只将异步加载的模块进行打包，<code>initial</code> 表示只将 entry 入口中引入的模块进行单独打包。</p>
</li>
<li><p>splitChunks.name：打包输出的文件名称。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    index: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">    another: <span class="string">&quot;./src/another-module.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&quot;[name].bundle.js&quot;</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&quot;./dist&quot;</span>),</span><br><span class="line">    clean: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  optimization: &#123;</span><br><span class="line">    minimizer: [</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    ],</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      minSize: <span class="number">20000</span>,</span><br><span class="line">      chunks: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">      name: <span class="string">&quot;vendor&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="动态导入"><a href="#动态导入" class="headerlink" title="动态导入"></a>动态导入</h4><p>1、当涉及到动态代码拆分时，webpack 提供了两个类似的技术，第一种，也是推荐选择的方式是使用符合 ECMAScript 提案的 <strong>import()</strong> 语法来实现动态导入。第二种，则是 webpack 的遗留功能，使用 webpack 特定的 require.ensure。</p>
<p>2、webpack.config.js 具体配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    index: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&quot;[name].bundle.js&quot;</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&quot;./dist&quot;</span>),</span><br><span class="line">    clean: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>3、在 src 中创建一个使用第三方模块 lodash 的 async-module.js 文件，其内容如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">import</span>(<span class="string">&quot;lodash&quot;</span>).then(<span class="function">(<span class="params">&#123; <span class="keyword">default</span>: _ &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> element = <span class="built_in">document</span>.createElement(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">    element.innerHtml = _.join([<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;webpack&quot;</span>], <span class="string">&quot; &quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> element;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getComponent().then(<span class="function">(<span class="params">element</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(element);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>4、在入口 index.js 文件中引用 async-module.js：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;async-module.js&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>5、如果在入口 index.js 文件中即引入了使用 import() 动态导入的 lodash，同时也使用了静态导入的 lodash 时，为了使这两种方式都生效，就需要在 webpack.config.js 中开启 splitChunks 的配置。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    index: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">    another: <span class="string">&quot;./src/another-module.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&quot;[name].bundle.js&quot;</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&quot;./dist&quot;</span>),</span><br><span class="line">    clean: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  optimization: &#123;</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      chunks: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>入口 index.js 文件内容如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&quot;lodash&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;async-module.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(_.join([<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>, <span class="string">&quot;-index&quot;</span>], <span class="string">&quot; &quot;</span>));</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用上述配置，即可将 import() 动态导入的 lodash 和 index.js 中静态导入的 lodash 及 another.module.js 中导入的 lodash 共同打包到同一个 bundle 文件中。实现 lodash 的多方共享，同时也避免了重复打包。</p>
</blockquote>
<h4 id="使用动态导入实现懒加载"><a href="#使用动态导入实现懒加载" class="headerlink" title="使用动态导入实现懒加载"></a>使用动态导入实现懒加载</h4><p>1、懒加载或者按需加载，是一种很好的优化网页或应用的方式，这种方式实际上是先把你的代码在一些逻辑断点处分离开，然后在一些代码块中完成某些操作后，立即引用或即将引用另外一些新的代码块。这样加快了应用的初始加载速度，减轻了它的总体体积，因为某些代码，如果你不触发，可能永远不会被加载。</p>
<p>2、创建一个 math.js 文件，在主页中通过点击按钮调用其中的函数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> add = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> minus = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> x - y;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>3、编辑 index.js 文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> button = <span class="built_in">document</span>.createElement(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">button.textContent = <span class="string">&quot;点击进行加法运算&quot;</span>;</span><br><span class="line">button.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &#x27;math&#x27; */</span> <span class="string">&quot;./math.js&quot;</span>).then(<span class="function">(<span class="params">&#123; add &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(add(<span class="number">2</span>, <span class="number">9</span>));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(button);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上述代码中的注释 <code>/* webpackChunkName: math */</code> 称之为 webpack 魔法注释，用来告诉 webpack 打包生成的文件名为 math，即该文件会单独打包到一个 bundle 中。文件名称为 math。该文件如果没有触发按钮，将永远不会被加载，可以从浏览器的 network 中进行验证。</p>
</blockquote>
<h4 id="动态导入实现预加载-预获取模块"><a href="#动态导入实现预加载-预获取模块" class="headerlink" title="动态导入实现预加载/预获取模块"></a>动态导入实现预加载/预获取模块</h4><p>1、webpack v4.6.0+ 增加了对与获取和预加载的支持。在声明 import 时，使用下面这些内置指令就可以让 webpack 输出 “resource hint（资源提示）”，来告诉浏览器什么时候去加载该资源：</p>
<ul>
<li><p>prefetch（预获取）：将来某些导航下可能需要的资源。</p>
</li>
<li><p>preload（预加载）：当前导航下可能需要的资源。</p>
</li>
</ul>
<p>2、prefetch 的简单使用方式如下，编辑 index.js 文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> button = <span class="built_in">document</span>.createElement(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">button.textContent = <span class="string">&quot;点击进行加法运算&quot;</span>;</span><br><span class="line">button.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">import</span>(</span><br><span class="line">    <span class="comment">/* webpackChunkName: &#x27;math&#x27;, webpackPrefetch: true */</span> <span class="string">&quot;./math.js&quot;</span></span><br><span class="line">  ).then(<span class="function">(<span class="params">&#123; add &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(add(<span class="number">2</span>, <span class="number">9</span>));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(button);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>添加 <code>webpackPrefetch: true</code> 这句魔法注释用于告诉 webpack 执行预加载，这回生成 <code>&lt;link rel=&quot;prefetch&quot; href=&quot;math.js&quot;&gt;</code> 并追加到页面头部，指示着浏览器在闲置的时候获取 math.js 文件。<br><code>webpackPreload: true</code> 功能效果类似于懒加载。</p>
</blockquote>
<h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3><h4 id="缓存第三方库"><a href="#缓存第三方库" class="headerlink" title="缓存第三方库"></a>缓存第三方库</h4><p>1、将第三方库（如 lodash）提取到单独的 vendor chunk 文件中是比较推荐的做法，这是因为它们很少像本地的源代码那样频繁修改。因此通过实现以上步骤，利用 client 的长效缓存机制，命中缓存来消除请求，并减少向 server 获取资源，同时还能保证 client 代码和 server 代码版本一致。</p>
<p>2、要缓存第三方库，我们需要在 optimization.splitChunks 添加如下 cacheGroups 参数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">optimization: &#123;</span><br><span class="line">  splitChunks: &#123;</span><br><span class="line">    cacheGroups: &#123;</span><br><span class="line">      vendor: &#123;</span><br><span class="line">        test: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">        name: <span class="string">&quot;vendor&quot;</span>,</span><br><span class="line">        chunks: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h4 id="外部扩展"><a href="#外部扩展" class="headerlink" title="外部扩展"></a>外部扩展</h4><p>1、有时候为了减小 bundle 的体积，我们会把一些不变的第三方库使用 cdn 的方式引入，比如：jQuery，这个时候就可以使用 <strong>externals</strong> 属性实现。</p>
<p>2、externals 具体使用方式如下：</p>
<ul>
<li>首先我们需要在入口 html 文件中使用 scripts 标签引入 jQuery。</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>使用外部扩展<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>之后在 webpack 中配置 externals 属性：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&quot;app.js&quot;</span>,</span><br><span class="line"></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  externals: &#123;</span><br><span class="line">    jquery: <span class="string">&quot;jQuery&quot;</span>, <span class="comment">// 或者配置成 jquery: &quot;$&quot;,</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>如果不想在入口 index.html 中使用 scripts 引入 jQuery 时，也可以在 externals 中引入，这时就需要将 externals 配置改为如下形式了：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  externalsType: <span class="string">&quot;script&quot;</span>,</span><br><span class="line">  externals: &#123;</span><br><span class="line">    jquery: [<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js&quot;</span>, <span class="string">&quot;$&quot;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在 externals 中引入第三方库时必须配置 <strong>externalsType</strong> 属性，用于告诉 webpack 引入的链接以 script 标签的形式放置到页面中。</p>
</blockquote>
<ul>
<li>最后就可以在 js 文件中快乐的使用 jQuery 了：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">&quot;jquery&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log($);</span><br></pre></td></tr></table></figure>
<h3 id="项目基本打包配置"><a href="#项目基本打包配置" class="headerlink" title="项目基本打包配置"></a>项目基本打包配置</h3><h4 id="webpack-config-common-js"><a href="#webpack-config-common-js" class="headerlink" title="webpack.config.common.js"></a>webpack.config.common.js</h4><p>1、ebpack.config.common.js 为公共配置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> toml = <span class="built_in">require</span>(<span class="string">&quot;toml&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> yaml = <span class="built_in">require</span>(<span class="string">&quot;yaml&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> json5 = <span class="built_in">require</span>(<span class="string">&quot;json5&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    index: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&quot;../dist&quot;</span>),</span><br><span class="line">    clean: <span class="literal">true</span>,</span><br><span class="line">    assetModuleFilename: <span class="string">&quot;images/[contenthash][ext]&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_module/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            presets: [<span class="string">&quot;@babel/preset-env&quot;</span>],</span><br><span class="line">            plugins: [[<span class="string">&quot;@babel/plugin-transform-runtime&quot;</span>]],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(css|less)$/</span>,</span><br><span class="line">        use: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|jpg|jpeg)$/</span>,</span><br><span class="line">        type: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">        generator: &#123;</span><br><span class="line">          filename: <span class="string">&quot;images/[contenthash][ext]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(woff|woff2|eot|ttf|otf)$/</span>,</span><br><span class="line">        type: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(csv|tsv)$/</span>,</span><br><span class="line">        type: <span class="string">&quot;csv-loader&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.xml$/</span>,</span><br><span class="line">        type: <span class="string">&quot;xml-loader&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.toml$/</span>,</span><br><span class="line">        type: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">        parser: &#123;</span><br><span class="line">          parse: toml.parse,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.yaml$/</span>,</span><br><span class="line">        type: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">        parser: &#123;</span><br><span class="line">          parse: yaml.parse,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.json5$/</span>,</span><br><span class="line">        type: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">        parser: &#123;</span><br><span class="line">          parse: json5.parse,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.svg$/</span>,</span><br><span class="line">        type: <span class="string">&quot;asset/inline&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.txt$/</span>,</span><br><span class="line">        type: <span class="string">&quot;asset/source&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.jpg$/</span>,</span><br><span class="line">        type: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">        parser: &#123;</span><br><span class="line">          dataUrlCondition: &#123;</span><br><span class="line">            maxSize: <span class="number">4</span> * <span class="number">1204</span> * <span class="number">1024</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">&quot;./index.html&quot;</span>,</span><br><span class="line">      filename: <span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">      filename: <span class="string">&quot;styles[contenthash].css&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  optimization: &#123;</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      cacheGroups: &#123;</span><br><span class="line">        vendor: &#123;</span><br><span class="line">          test: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">          name: <span class="string">&quot;vendor&quot;</span>,</span><br><span class="line">          chunks: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="webpack-config-dev-js"><a href="#webpack-config-dev-js" class="headerlink" title="webpack.config.dev.js"></a>webpack.config.dev.js</h4><p>1、webpack.config.dev.js 为开发环境配置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&quot;scripts/[name].[ext]&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  devServer: &#123;</span><br><span class="line">    <span class="keyword">static</span>: <span class="string">&quot;./dist&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  devtool: <span class="string">&quot;inline-source-map&quot;</span>,</span><br><span class="line"></span><br><span class="line">  mode: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="webpack-config-prod-js"><a href="#webpack-config-prod-js" class="headerlink" title="webpack.config.prod.js"></a>webpack.config.prod.js</h4><p>1、webpack.config.prod.js 为 生产环境配置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> CssMinimizerPlugin = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> TerserPlugin = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&quot;scripts/[name].[contenthash].[ext]&quot;</span>,</span><br><span class="line">    publicPath: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  optimization: &#123;</span><br><span class="line">    minimizer: [<span class="keyword">new</span> CssMinimizerPlugin(), <span class="keyword">new</span> TerserPlugin()],</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  mode: <span class="string">&quot;production&quot;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 告诉 webpack 在发现提示时关闭抛出错误或警告。</span></span><br><span class="line">  performance: &#123;</span><br><span class="line">    hints: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="webpack-config-js"><a href="#webpack-config-js" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h4><p>1、配置文件拆分好后，需要安装 <strong>webpack-merge</strong> 这个插件将公共配置与生产及开发环境配置都合并到 webpack.config.js 中：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i webpack-merge -D</span><br></pre></td></tr></table></figure>
<p>2、具体配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; merge &#125; = <span class="built_in">require</span>(<span class="string">&quot;webpack-merge&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> commomConfig = <span class="built_in">require</span>(<span class="string">&quot;./webpcak.config.commom&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> productionConfig = <span class="built_in">require</span>(<span class="string">&quot;./webpcak.config.prod&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> developmentConfig = <span class="built_in">require</span>(<span class="string">&quot;./webpcak.config.dev&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">env</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> env.development:</span><br><span class="line">      <span class="keyword">return</span> merge(commomConfig, developmentConfig);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> env.production:</span><br><span class="line">      <span class="keyword">return</span> merge(commomConfig, productionConfig);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;No matching configuration was found&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="package-脚本配置"><a href="#package-脚本配置" class="headerlink" title="package 脚本配置"></a>package 脚本配置</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;start&quot;: &quot;webpack serve -c .&#x2F;config&#x2F;webpack.config.js --env development&quot;</span><br><span class="line">    &quot;build&quot;: &quot;webpack -c .&#x2F;config&#x2F;webpack.config.js --env production&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="高级应用"><a href="#高级应用" class="headerlink" title="高级应用"></a>高级应用</h3><h4 id="source-map"><a href="#source-map" class="headerlink" title="source-map"></a>source-map</h4><p>1、source-map 用于将报错信息（bundle 错误的语句几其所在行列）映射到源码上，方便调试。</p>
<p>2、webpack 中的 devtool 一共提供了如下七种 SourceMap 模式：</p>
<ul>
<li><p>eval：每个 module 会封装到 eval 里包裹起来执行，并且会在末尾追加注释 <code>//@sourceURL</code>。</p>
</li>
<li><p>source-map：生成一个 SourceMap 文件。</p>
</li>
<li><p>hidden-source-map：和 source-map 一样，但不会在 bundle 末尾追加注释。</p>
</li>
<li><p>inline-source-map：生成一个 DataUrl 形式的 SourceMap 文件。</p>
</li>
<li><p>eval-source-map：每个 module 会通过 eval() 来执行，并且生成一个 DataUrl 形式的 SourceMap。</p>
</li>
<li><p>cheap-source-map：生成一个没有列信息（column-mappings）的 SourceMap 文件，不包含 loader 的 sourcemap（比如：babel 的 sourcemap）。</p>
</li>
<li><p>cheap-module-source-map：生成一个没有列信息（column-mappings）的 SourceMap 文件，同时 loader 的 sourcemap 也被简化为只包含对应行的。</p>
</li>
</ul>
<blockquote>
<p>在开发环境中推荐使用 <code>cheap-module-source-map</code>，因为它既能单独的生成一个 map 文件，而且不会记录列数，从而减小的 map 的体积。</p>
</blockquote>
<p>3、在生产环境一般不会开启 sourcemap 功能，主要有两点原因：</p>
<ul>
<li><p>通过 bundle 和 sourcemap 文件，可以反编译出源码，也就是说，线上产物有 sourcemap 文件的话，就意味着有着暴露远嘛的风险。</p>
</li>
<li><p>sourcemap 文件的体积相对比较巨大，这跟我们生产环境的追求不同（更小更轻量的 bundle）。</p>
</li>
</ul>
<h4 id="在-webpack5-中使用-Web-Works"><a href="#在-webpack5-中使用-Web-Works" class="headerlink" title="在 webpack5 中使用 Web Works"></a>在 webpack5 中使用 Web Works</h4><p>1、Web Works 简介：</p>
<ul>
<li>Web Worker 为 Web 内容在后台线程中运行脚本提供了一种简单的方法。线程可以执行任务而不干扰用户界面。此外，他们可以使用 XMLHttpRequest 执行 I/O (尽管 responseXML 和 channel 属性总是为空)。一旦创建， 一个 worker 可以将消息发送到创建它的 JavaScript 代码， 通过将消息发布到该代码指定的事件处理程序（反之亦然）。</li>
</ul>
<p>2、创建 worker 的方式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> Worker(<span class="keyword">new</span> URL(<span class="string">&#x27;work.js&#x27;</span>, <span class="keyword">import</span>.mata.url));</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：第二个参数 <code>import.mata.url</code> 不能在 commonJs 中使用。</p>
</blockquote>
<p>3、结合 webpack5 使用 Web Worker 的方式：</p>
<ul>
<li>在 src 下创建 work.js 文件，内容如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">self.onmessage = <span class="function">(<span class="params">message</span>) =&gt;</span> &#123;</span><br><span class="line">  self.postMessage(&#123;</span><br><span class="line">    answer: <span class="string">&quot;dnhyxc&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>在入口 app.js 中引入 work.js 文件，具体如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> worker = <span class="keyword">new</span> Worker(<span class="keyword">new</span> URL(<span class="string">&quot;./work.js&quot;</span>, <span class="keyword">import</span>.meta.url));</span><br><span class="line"></span><br><span class="line">worker.postMessage(&#123;</span><br><span class="line">  name: <span class="string">&quot;What&#x27;s your name?&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">worker.onmessage = <span class="function">(<span class="params">message</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(message.data.answer);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>在 webpack.config.js 中不需要设置任何编译 Web Worker 的设置，因为 webpack5 默认就支持了 Web Worker。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&quot;./src/app.js&quot;</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&quot;[name].[ext]&quot;</span>,</span><br><span class="line">    clean: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [<span class="keyword">new</span> HtmlWebpackPlugin()],</span><br><span class="line">  mode: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>只需要在 webpack.config.js 中配置如上设置之后，使用 webpack 进行编译就会在 dist 文件夹中出现一个 <code>src_work_js.js</code> 文件，这就说明了 webpack 已经默认帮我们做了一个额外的打包。</li>
</ul>
<h4 id="打包多页面应用"><a href="#打包多页面应用" class="headerlink" title="打包多页面应用"></a>打包多页面应用</h4><p>1、打包多页面应用基本配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    main: &#123;</span><br><span class="line">      <span class="keyword">import</span>: [<span class="string">&quot;./src/app.js&quot;</span>, <span class="string">&quot;./src/app2.js&quot;</span>],</span><br><span class="line">      dependOn: <span class="string">&quot;lodash&quot;</span>,</span><br><span class="line">      filename: <span class="string">&quot;page1/[name].js&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    main2: &#123;</span><br><span class="line">      <span class="keyword">import</span>: [<span class="string">&quot;./src/app3.js&quot;</span>],</span><br><span class="line">      dependOn: <span class="string">&quot;lodash&quot;</span>,</span><br><span class="line">      filename: <span class="string">&quot;page2/[name].js&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    lodash: &#123;</span><br><span class="line">      <span class="keyword">import</span>: <span class="string">&quot;lodash&quot;</span>,</span><br><span class="line">      filename: <span class="string">&quot;commom/[name].js&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&quot;[name].js&quot;</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    clean: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  devtool: <span class="string">&quot;inline-source-map&quot;</span>,</span><br><span class="line"></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      title: <span class="string">&quot;多页面打包&quot;</span>,</span><br><span class="line">      template: <span class="string">&quot;./index.html&quot;</span>,</span><br><span class="line">      filename: <span class="string">&quot;page1/index.html&quot;</span>,</span><br><span class="line">      chunks: [<span class="string">&quot;main&quot;</span>, <span class="string">&quot;lodash&quot;</span>],</span><br><span class="line">    &#125;),</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      title: <span class="string">&quot;多页面打包&quot;</span>,</span><br><span class="line">      template: <span class="string">&quot;./index2.html&quot;</span>,</span><br><span class="line">      filename: <span class="string">&quot;page2/index2.html&quot;</span>,</span><br><span class="line">      chunks: [<span class="string">&quot;main2&quot;</span>, <span class="string">&quot;lodash&quot;</span>],</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  mode: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="pwa"><a href="#pwa" class="headerlink" title="pwa"></a>pwa</h4><p>1、我们可以通过搭建一个拥有更多基础特性的 server 来测试下离线体验，这里我们通过使用 <strong>http-server</strong> 这个第三方库来实现。</p>
<ul>
<li>首先需要安装 http-server：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i http-server -D</span><br></pre></td></tr></table></figure>
<ul>
<li>之后修改 package.json 的 scripts 脚本，修改如下：</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: <span class="string">&quot;http-server dist&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、注意：默认情况下，webpack devServer 会写入到内存中，我们需要启用 devserverdevmiddleware.writeToDisk 配置项，来让 http-server 处理 <code>./dist</code> 目录中的文件。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">  devMiddleware: &#123;</span><br><span class="line">    index: <span class="literal">true</span>;</span><br><span class="line">    writeToDisk: <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果之前没有操作过，首先需要运行命令 <code>npm run build</code> 来构建你的项目，然后运行命令 <code>npm start</code>。</p>
</blockquote>
<p>3、添加 Workbox：</p>
<ul>
<li>首先需要安装 workbox-webpack-plugin：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i workbox-webpack-plugin -D</span><br></pre></td></tr></table></figure>
<ul>
<li>之后修改 webpack.config.js 文件：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> WorkboxPlugin = <span class="built_in">require</span>(<span class="string">&quot;workbox-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&quot;[name].js&quot;</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    clean: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  devtool: <span class="string">&quot;inline-source-map&quot;</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(),</span><br><span class="line">    <span class="keyword">new</span> WorkboxPlugin.GenerateSW(&#123;</span><br><span class="line">      <span class="comment">// 这些选项帮助快速启用 ServiceWorkers</span></span><br><span class="line">      clientsClaim: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 不允许遗留任何旧的 ServiceWorkers</span></span><br><span class="line">      skipWaiting: <span class="literal">true</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  mode: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>4、注册 Service Worker：</p>
<ul>
<li>在 index.js 文件中通过如下代码进行注册 Service Worker：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">&quot;serviceWorker&quot;</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">  <span class="built_in">window</span>.addEventListener(<span class="string">&quot;load&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    navigator.serviceWorker</span><br><span class="line">      .register(<span class="string">&quot;/service-worker.js&quot;</span>)</span><br><span class="line">      .then(<span class="function">(<span class="params">registration</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;SW registered:&quot;</span>, registration);</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">registrationError</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;SW registered failed:&quot;</span>, registrationError);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>设置完以上配置之后，即使终止本地服务，照样能访问当前页面。现在你就可以愉快的进行离线访问了。这其实是在浏览器中缓存了当前页面，可以通过：<code>chrome://serviceworker-internals</code> 查看。当清除浏览器缓存时，就无法再访问了。</p>
</blockquote>
<h4 id="Shimming-预置依赖"><a href="#Shimming-预置依赖" class="headerlink" title="Shimming 预置依赖"></a>Shimming 预置依赖</h4><p>1、Shimming 预置依赖就是在没有手动安装如 lodash 时，也可以在页面中使用 lodash。</p>
<p>2、要实现预置全局变量，需要使用 <strong>ProvidePlugin</strong> 插件（该插件不需要安装），使用 ProvidePlugin 后，能够在 webpack 编译的每个模块中，通过访问一个变量来获取一个 package。如果 webpack 看到模块中用到这个变量，它将在最终 bundle 中引入给定的 package。具体使用如下：</p>
<ul>
<li>src/index.js：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(_.join(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;word&quot;</span>), <span class="string">&quot; &quot;</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>webpack.config.js：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&quot;[name].js&quot;</span>,</span><br><span class="line">    clean: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(),</span><br><span class="line">    <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">      _: <span class="string">&quot;lodash&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  mode: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>以上配置从本质上来说，就是告诉 webpack，如果遇到了至少一处用到 <code>_</code> 变量的模块实例，那就自动将 lodash package 引入进来（无需开发者手动 npm install lodash），并将其提供给需要用到它的模块。这其实就是 webpack 自动将 lodash 引入，并打包到 main.js 中了。</p>
</blockquote>
<h4 id="细粒度-Shimming"><a href="#细粒度-Shimming" class="headerlink" title="细粒度 Shimming"></a>细粒度 Shimming</h4><p>1、在一些遗留模块依赖中，this 指向的是 window 对象，我们可以调整 index.js 文件内容进行测试：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">this</span>.alert(<span class="string">&quot;hello webpack&quot;</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果不进行任何配置，使用 npx webpack serve 运行该模块时，将会报错。</p>
</blockquote>
<p>2、之所以上述 index.js 模块运行报错，是因为它运行在 CommonJS 上下文中时，此时的 this 指向的是 module.exports。因此运行代码时，就会出现 <code>this.alert is not a function</code> 的报错。在这种情况下，我们可以通过 <strong>imports-loader</strong> 覆盖 this 指向，注意：需要安装 imports-loader 这个插件：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i imports-loader -D</span><br></pre></td></tr></table></figure>
<ul>
<li>webpack.config.js 配置如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="built_in">require</span>.resolve(<span class="string">&quot;./src/index.js&quot;</span>),</span><br><span class="line">        use: <span class="string">&quot;imports-loader?wrapper=window&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  plugins: [<span class="keyword">new</span> HtmlWebpackPlugin()],</span><br><span class="line">  mode: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>通过上述配置之后就可以正常的访问 index.js 文件内容了。</p>
</blockquote>
<h4 id="全局-Exports"><a href="#全局-Exports" class="headerlink" title="全局 Exports"></a>全局 Exports</h4><p>1、假设某个 library 创建出一个全局变量，期望 consumer（使用者）使用这个变量。要实现这一需求，就需要借助 <code>exports-loader</code> 这个 loader 来实现：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i exports-loader -D</span><br></pre></td></tr></table></figure>
<ul>
<li>src/global.js：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> file = <span class="string">&quot;example.txt&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> helpers = &#123;</span><br><span class="line">  test: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;test something&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  parse: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;parse something&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>webpack.config.js：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="built_in">require</span>.resolve(<span class="string">&quot;./src/global.js&quot;</span>),</span><br><span class="line">        use: <span class="string">&quot;exports-loader?type=commonjs&amp;exports=file,multiple|helpers.parse|parse,multiple|helpers.test|test&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [<span class="keyword">new</span> HtmlWebpackPlugin()],</span><br><span class="line">  mode: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="加载-Polyfills"><a href="#加载-Polyfills" class="headerlink" title="加载 Polyfills"></a>加载 Polyfills</h4><p>1、要加载 polfill，例如可以直接引入 <strong>@babel/polyfill</strong>，但是首先需要安装 @babel/polyfill：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i @babel&#x2F;polyfill -D</span><br></pre></td></tr></table></figure>
<ul>
<li>@babel/polyfill 是一个垫片，说白了就是可以通过这个插件将代码转换为低版本浏览器可以识别的代码。</li>
</ul>
<p>2、@babel/polyfill 基本使用方式如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;@babel/polyfill&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Array</span>.from([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="function">(<span class="params">x</span>) =&gt;</span> x + x));</span><br></pre></td></tr></table></figure>
<ul>
<li>说明：这种方式优先考虑正确性，而不考虑 bundle 体积大小。为了安全和可靠，polyfill/shim 必须运行在所有其它代码之前，而且需要同步加载，或者说，需要在所有 polyfill/shim 加载之后，再去加载所有应用程序代码，社区中存在许多误解，即现代浏览器”不需要”polyfill，或者 polyfill/shim 仅用于添加缺失功能。实际上，它们通常用于<strong>修复损坏实现</strong>（repair broken implementation），即使是在现代浏览器中，也会出现这种情况。因此，最佳的实践仍然是：不加选择地和同步加载所有 polyfill/shim，尽管这会导致额外的 bundle 体积成本。</li>
</ul>
<h4 id="优化-Polyfills"><a href="#优化-Polyfills" class="headerlink" title="优化 Polyfills"></a>优化 Polyfills</h4><p>1、正常是不建议使用 <code>import @babel/polyfill</code> 导入的。因为这样做会在全局引入整个 polyfill 包，比如 Array.from 会全局引入，不但包的体积大，而且还会污染全局环境。</p>
<p>2、<strong>babel-preset-env</strong> 插件通过 <code>browserslist</code> 来转译那些浏览器中不支持的特性。这个 preset 使用 <strong>useBuiltIns</strong> 选项，默认值是 false，这种方式可以将全局 babel-polyfill 导入，改进为更细颗粒度的 import 格式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/modules/es7.string.pad-start&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/modules/es7.string.pad-end&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/modules/web.timers&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/modules/web.immediate&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/modules/web.dom.iterable&quot;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>安装 @babel/preset-env 及相关的包：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i babel-loader @babel&#x2F;core @babel&#x2F;preset-env core-js@3 -D</span><br></pre></td></tr></table></figure>
<ul>
<li>webpack.config.js 相关配置如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            presets: [</span><br><span class="line">              [</span><br><span class="line">                <span class="string">&quot;@babel/preset-env&quot;</span>,</span><br><span class="line">                &#123;</span><br><span class="line">                  targets: [<span class="string">&quot;last 1 version&quot;</span>, <span class="string">&quot;&gt; 1%&quot;</span>],</span><br><span class="line">                  useBuiltIns: <span class="string">&quot;usage&quot;</span>,</span><br><span class="line">                  corejs: <span class="number">3</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">              ],</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  plugins: [<span class="keyword">new</span> HtmlWebpackPlugin()],</span><br><span class="line">  mode: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="library"><a href="#library" class="headerlink" title="library"></a>library</h4><p>1、library 可以用于打包一个 JavaScript 库（如 lodash 就是一个函数库）。打包好的库可以发布到 npm 上作为一个通用的库，具体配置如下：</p>
<ul>
<li>src/index.js 内容如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> add = <span class="function">(<span class="params">x, y</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>webpack.config.js 配置如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    filename: <span class="string">&quot;mylib.js&quot;</span>,</span><br><span class="line">    <span class="comment">// library可以防止生产模式下，模块未使用而被tree shaking删除</span></span><br><span class="line">    library: <span class="string">&quot;mylib&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [<span class="keyword">new</span> HtmlWebpackPlugin()],</span><br><span class="line">  mode: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>上述配置打包出来的 mylib 只能在 html 中以 script 引入使用：</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Library<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../dist/mylib.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(mylib.add(<span class="number">9</span>, <span class="number">2</span>));</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3、如果希望打包出来的库能兼容不同的环境，即用户能够通过以下方式使用打包后的库：</p>
<ul>
<li>CommonJS module require：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; mylib &#125; = <span class="built_in">require</span>(<span class="string">&quot;../dist/mylib&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (mylib) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(mylib.add(<span class="number">9</span>, <span class="number">2</span>), <span class="string">&quot;commonjs&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>AMD module require：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span>([<span class="string">&quot;mylib&quot;</span>], <span class="function"><span class="keyword">function</span> (<span class="params">webpackNumbers</span>) </span>&#123;</span><br><span class="line">  mylib.add(<span class="number">9</span>, <span class="number">2</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>script tag：</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Library<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../dist/mylib.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(mylib.add(<span class="number">9</span>, <span class="number">2</span>));</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3、要实现上述要求，需要更改 library 配置项，将其中的 <strong>type</strong> 属性行设置为：<strong>umd</strong>。</p>
<ul>
<li><p>var/window：仅支持 script 标签引入使用。</p>
</li>
<li><p>commonjs：支持 commonjs 导入使用。</p>
</li>
<li><p>amd：支持 AMD 导入使用。</p>
</li>
<li><p>module：支持 ES6 import 导入使用。注意：webpack 5 中如果配置了 library.type 为 module 时，需要配置 <code>experiments.outputModule: true</code>，并且将 library.name 配置去除，否则将会报错。</p>
</li>
<li><p>umd：支持所有方式的导入使用。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    filename: <span class="string">&quot;mylib.js&quot;</span>,</span><br><span class="line">    <span class="comment">// library可以防止生产模式下，模块未使用而被tree shaking删除</span></span><br><span class="line">    library: &#123;</span><br><span class="line">      <span class="comment">// 当配置了experiments时，不能设置name属性，否则会报错</span></span><br><span class="line">      name: <span class="string">&quot;mylib&quot;</span>,</span><br><span class="line">      <span class="comment">// type 的值还可以是：var、window（等于var）、commonjs、module</span></span><br><span class="line">      type: <span class="string">&quot;umd&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 处理commonjs中self未定义而报错的情况</span></span><br><span class="line">    globalObject: <span class="string">&quot;globalThis&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 当library.type为module时需要配置如下属性，注意experiments属性现在为试运行阶段，慎用</span></span><br><span class="line">  <span class="comment">// experiments: &#123;</span></span><br><span class="line">  <span class="comment">//   outputModule: true,</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line">  mode: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>4、将打出来的 library 包发布到 npm：</p>
<ul>
<li>首选需要检查当前的 npm 是否是 npm 官方的源地址，如果是淘宝源的话是无法发布到 npm 上的。</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 检查当前npm源</span></span><br><span class="line">npm get registry</span><br><span class="line"></span><br><span class="line"><span class="comment">// 切换为默认的官方源</span></span><br><span class="line">npm config set registry https://registry.npmjs.org</span><br></pre></td></tr></table></figure>
<ul>
<li><p>如果没有 npm 账号的话，需要到 <a href="https://www.npmjs.com/signup">npm 官网</a> 进行注册。</p>
</li>
<li><p>如果已有账号，直接运行如下命令发布即可：</p>
</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">npm login // 输入 username =&gt; password =&gt; email =&gt; 邮箱收到的验证码</span><br><span class="line"></span><br><span class="line">npm publish // 登录成功后即可运行publish进行发布了</span><br></pre></td></tr></table></figure>
<p>5、将发布的包下载到本地使用：</p>
<ul>
<li>src/commonjs.js：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在webpack中配置了全局变量，所以不需要导入包即可使用</span></span><br><span class="line"><span class="built_in">console</span>.log(mylib.add(<span class="number">222</span>, <span class="number">999</span>), <span class="string">&quot;使用全局变量引入&quot;</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>src/index.js：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; add &#125; <span class="keyword">from</span> <span class="string">&quot;mylib_math_test&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./commonjs&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">9</span>, <span class="number">2</span>));</span><br></pre></td></tr></table></figure>
<ul>
<li>webpack.config.js：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    filename: <span class="string">&quot;[name].js&quot;</span>,</span><br><span class="line">    clean: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(),</span><br><span class="line">    <span class="comment">// 设置全局变量，在全局可以不导入mylib_math_test包的情况下，直接使用mylib访问到这个mylib_math_test包的内容</span></span><br><span class="line">    <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">      mylib: <span class="string">&quot;mylib_math_test&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  mode: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      <span class="comment">// minSize 默认值是20000，如果要分离的目标小于20000，则不会被分割，当前设置也就不生效了，因此需要指定minSize。</span></span><br><span class="line">      minSize: <span class="number">50</span>,</span><br><span class="line">      chunks: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">      name: <span class="string">&quot;vendor&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>package.json：</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;mylib_test&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;start&quot;</span>: <span class="string">&quot;webpack serve&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;build&quot;</span>: <span class="string">&quot;rimraf dist &amp;&amp; webpack&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;keywords&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;html-webpack-plugin&quot;</span>: <span class="string">&quot;^5.5.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;webpack&quot;</span>: <span class="string">&quot;^5.65.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;webpack-cli&quot;</span>: <span class="string">&quot;^4.9.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;webpack-dev-server&quot;</span>: <span class="string">&quot;^4.6.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;mylib_math_test&quot;</span>: <span class="string">&quot;^1.0.0&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="dll"><a href="#dll" class="headerlink" title="dll"></a>dll</h3><h4 id="dll-概述"><a href="#dll-概述" class="headerlink" title="dll 概述"></a>dll 概述</h4><p>1、dll 可以将不经常更改的第三方库（如：react、vue、jquery 等）单独进行打包，而且只会在项目第一次构建的时候打包一次，以后如果这些第三方库内容没有变更将不会再重新打包，从而提高了打包效率。</p>
<h4 id="DllPlugin"><a href="#DllPlugin" class="headerlink" title="DllPlugin"></a>DllPlugin</h4><p>1、DllPlugin 插件概述：</p>
<ul>
<li>该插件能把第三方库代码分离开，并且每次文件更改的时候，它只会打包该项目自身的代码，所以打包速度会更快。</li>
</ul>
<p>2、DllPlugin 插件参数说明：</p>
<ul>
<li><p>name：公开的 dll 函数的名称，和 output.library 保持一致。</p>
</li>
<li><p>path：manifest.json 生成文件的位置和文件名称。</p>
</li>
<li><p>context(可选)：manifest 文件中请求的上下文，默认为该 webpack 文件上下文。</p>
</li>
</ul>
<p>3、该插件的具体使用方式如下：</p>
<ul>
<li>webpack.dll.config.js：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  entry: [<span class="string">&quot;jquery&quot;</span>, <span class="string">&quot;lodash&quot;</span>],</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&quot;[name].js&quot;</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&quot;dll&quot;</span>),</span><br><span class="line">    library: <span class="string">&quot;[name]_[hash]&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.DllPlugin(&#123;</span><br><span class="line">      name: <span class="string">&quot;[name]_[hash]&quot;</span>,</span><br><span class="line">      path: path.resolve(__dirname, <span class="string">&quot;dll/manifest.json&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="DllReferencePlugin"><a href="#DllReferencePlugin" class="headerlink" title="DllReferencePlugin"></a>DllReferencePlugin</h4><p>1、DllReferencePlugin 插件概述：</p>
<ul>
<li>该插件的作用是把 dll 打包生成的文件引用到 webpack.config.js 打包出的 mian.js 中。</li>
</ul>
<blockquote>
<p>DllReferencePlugin 补充说明：在 webpack.dll.config.js 中打包后，会生成 main.js 文件和 manifest.json 文件，mian.js 文件包含所有的第三方库文件，manifest.json 文件会包含所有库代码的一个索引，当在使用 webpack.config.js 文件中使用 DllReferencePlugin 插件的时候，会使用该 DllReferencePlugin 插件读取 manifest.json 文件，看看是否有该第三方库。manifest.json 文件其实就是有一个第三方库的一个映射而已。</p>
</blockquote>
<p>2、DllReferencePlugin 参数说明：</p>
<ul>
<li><p>manifest: 编译时的一个用于加载的 JSON 的 manifest 的绝对路径。</p>
</li>
<li><p>name: dll 暴露的地方的名称（默认值为 manifest.name）。</p>
</li>
<li><p>scope: dll 中内容的前缀。</p>
</li>
<li><p>sourceType: dll 是如何暴露的 libraryTarget。</p>
</li>
<li><p>context: manifest 文件中请求的上下文。</p>
</li>
</ul>
<p>3、DllReferencePlugin 具体使用说明：</p>
<ul>
<li>webpack.config.js：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> AddAssetHtmlPlugin = <span class="built_in">require</span>(<span class="string">&quot;add-asset-html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&quot;[name][contenthash].js&quot;</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(),</span><br><span class="line">    <span class="keyword">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class="line">      manifest: path.resolve(__dirname, <span class="string">&quot;./dll/manifest.json&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> AddAssetHtmlPlugin(&#123;</span><br><span class="line">      filepath: path.resolve(__dirname, <span class="string">&quot;./dll/main.js&quot;</span>),</span><br><span class="line">      publicPath: <span class="string">&quot;./&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    port: <span class="number">9000</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  mode: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="AddAssetHtmlPlugin"><a href="#AddAssetHtmlPlugin" class="headerlink" title="AddAssetHtmlPlugin"></a>AddAssetHtmlPlugin</h4><p>1、AddAssetHtmlPlugin 插件概述：</p>
<ul>
<li>该插件可以将 dll 打包出的动态链接库自动的存放到 dist 文件夹，同时自动在打包出的 index.html 文件中引入 dll 打包出的动态链接库脚本。</li>
</ul>
<p>2、要使用 AddAssetHtmlPlugin 需要安装 <code>add-asset-html-webpack-plugin</code>：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i add-asset-html-webpack-plugin -D</span><br></pre></td></tr></table></figure>
<h4 id="dll-完整配置"><a href="#dll-完整配置" class="headerlink" title="dll 完整配置"></a>dll 完整配置</h4><p>1、webpack.dll.config.js：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  entry: [<span class="string">&quot;jquery&quot;</span>, <span class="string">&quot;lodash&quot;</span>],</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&quot;[name].js&quot;</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&quot;dll&quot;</span>),</span><br><span class="line">    library: <span class="string">&quot;[name]_[hash]&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.DllPlugin(&#123;</span><br><span class="line">      name: <span class="string">&quot;[name]_[hash]&quot;</span>,</span><br><span class="line">      path: path.resolve(__dirname, <span class="string">&quot;dll/manifest.json&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>2、webpack.config.js：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> AddAssetHtmlPlugin = <span class="built_in">require</span>(<span class="string">&quot;add-asset-html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&quot;[name][contenthash].js&quot;</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(),</span><br><span class="line">    <span class="keyword">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class="line">      manifest: path.resolve(__dirname, <span class="string">&quot;./dll/manifest.json&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> AddAssetHtmlPlugin(&#123;</span><br><span class="line">      filepath: path.resolve(__dirname, <span class="string">&quot;./dll/main.js&quot;</span>),</span><br><span class="line">      publicPath: <span class="string">&quot;./&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    port: <span class="number">9000</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  mode: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="模块联邦"><a href="#模块联邦" class="headerlink" title="模块联邦"></a>模块联邦</h3><h4 id="模块联邦概念"><a href="#模块联邦概念" class="headerlink" title="模块联邦概念"></a>模块联邦概念</h4><p>1、Webpack 5 增加了一个新的功能 “模块联邦”，它允许多个 webpack 构建一起工作。从运行时的角度来看，多个构建的模块将表现得像一个巨大的连接模块图。从开发者的角度来看，模块可以从指定的远程构建中导入，并以最小的限制来使用。即模块联邦可以将一个应用的包应用于另一个应用，同时具备整体应用一起打包的公共依赖抽取能力。</p>
<p>2、多个独立的构建可以组成一个应用程序，这些独立的构建之间不应该存在依赖关系，因此可以单独开发和部署它们。这通常被称作微前端，但并不仅限于此。</p>
<p>3、Webpack5 模块联邦让 Webpack 达到了线上 Runtime 的效果，让代码直接在项目间利用 CDN 直接共享，不再需要本地安装 Npm 包、构建再发布了。我们知道 Webpack 可以通过 DLL 或者 Externals 做代码共享时 Common Chunk，但不同应用和项目间这个任务就变得困难了，我们几乎无法在项目之间做到按需热插拔。</p>
<p>4、webpack 5 引入联邦模式是为了更好的共享代码。在此之前，我们共享代码一般用 npm 发包来解决。npm 发包需要经历构建，发布，引用三阶段，而联邦模块可以直接引用其他应用代码，实现热插拔效果。对比 npm 的方式更加简洁、快速、方便。</p>
<h4 id="模块联邦-API-说明"><a href="#模块联邦-API-说明" class="headerlink" title="模块联邦 API 说明"></a>模块联邦 API 说明</h4><p>1、ModuleFederationPlugin：该插件是 webpack 自带的插件，可以从 <code>webpack.container</code> 中获取到。</p>
<p>2、ModuleFederationPlugin 插件属性：</p>
<ul>
<li><p>name：必传，且唯一，不可冲突。作为被依赖的 key 标志，依赖方使用方式 ${name}/${expose}。</p>
</li>
<li><p>filename：构建后被依赖部分的入口文件名称。</p>
</li>
<li><p>remotes：声明需要引用的远程应用。</p>
</li>
<li><p>exposes：对外暴露 modules 模块，即当前应用对外暴露出的模块名。</p>
</li>
<li><p>shared：声明共享的第三方依赖，当配置了这个属性时，webpack 在加载的时候会先判断本地应用是否存在对应的包，如果不存在，则加载远程应用的依赖包。例如：app1，它是一个远程应用，配置了 <code>[&quot;react&quot;, &quot;react-dom&quot;]</code> ，而它被 app2 所消费，所以 webpack 会先查找 app2 是否存在这两个包，如果不存在就使用 app1 中的自带包。如果 app2 里面同样申明了这两个参数时，由于 app2 是本地应用，所以会直接用 app2 的依赖。</p>
</li>
</ul>
<h4 id="模块联邦的使用方式"><a href="#模块联邦的使用方式" class="headerlink" title="模块联邦的使用方式"></a>模块联邦的使用方式</h4><p>1、nav 应用：</p>
<ul>
<li>nav/src/Header.js：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Header = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> header = <span class="built_in">document</span>.createElement(<span class="string">&quot;h1&quot;</span>);</span><br><span class="line">  header.textContent = <span class="string">&quot;Header&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> header;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Header;</span><br></pre></td></tr></table></figure>
<ul>
<li>nav/src/index.js：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">&quot;./Header&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> div = <span class="built_in">document</span>.createElement(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">div.appendChild(Header());</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(div);</span><br></pre></td></tr></table></figure>
<ul>
<li>nav/webpack.config.js：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; ModuleFederationPlugin &#125; = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>).container;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line"></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(),</span><br><span class="line">    <span class="keyword">new</span> ModuleFederationPlugin(&#123;</span><br><span class="line">      name: <span class="string">&quot;nav&quot;</span>,</span><br><span class="line">      filename: <span class="string">&quot;remoteEntry.js&quot;</span>,</span><br><span class="line">      remotes: &#123;&#125;,</span><br><span class="line">      exposes: &#123;</span><br><span class="line">        <span class="string">&quot;./Header&quot;</span>: <span class="string">&quot;./src/Header.js&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      shared: &#123;&#125;, <span class="comment">// shared: [&quot;react&quot;, &quot;react-dom&quot;],</span></span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    port: <span class="number">9001</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  mode: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>2、home 应用：</p>
<ul>
<li>home/src/HomeList.js：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> HomeList = <span class="function">(<span class="params">num</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> str = <span class="string">&quot;&lt;ul&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; num; i++) &#123;</span><br><span class="line">    str += <span class="string">`&lt;li&gt;item<span class="subst">$&#123;i&#125;</span>&lt;/li&gt;`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  str += <span class="string">&quot;&lt;/ul&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> str;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> HomeList;</span><br></pre></td></tr></table></figure>
<ul>
<li>home/index.js：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> HomeList <span class="keyword">from</span> <span class="string">&quot;./HomeList&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span>(<span class="string">&quot;nav/Header&quot;</span>).then(<span class="function">(<span class="params">Header</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> div = <span class="built_in">document</span>.createElement(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">  div.appendChild(Header.default());</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(div);</span><br><span class="line">  <span class="built_in">document</span>.body.innerHTML += HomeList(<span class="number">5</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>home/webpack.config.js：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; ModuleFederationPlugin &#125; = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>).container;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(),</span><br><span class="line">    <span class="keyword">new</span> ModuleFederationPlugin(&#123;</span><br><span class="line">      name: <span class="string">&quot;home&quot;</span>,</span><br><span class="line">      filename: <span class="string">&quot;remoteEntry.js&quot;</span>,</span><br><span class="line">      remotes: &#123;</span><br><span class="line">        nav: <span class="string">&quot;nav@http://localhost:9001/remoteEntry.js&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      exposes: &#123;</span><br><span class="line">        <span class="string">&quot;./HomeList&quot;</span>: <span class="string">&quot;./src/HomeList.js&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      shared: &#123;&#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    port: <span class="number">9000</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  mode: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>3、search 应用：</p>
<ul>
<li>search/src/index.js：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.all([<span class="keyword">import</span>(<span class="string">&quot;nav/Header&quot;</span>), <span class="keyword">import</span>(<span class="string">&quot;home/HomeList&quot;</span>)]).then(</span><br><span class="line">  ([&#123; <span class="attr">default</span>: Header &#125;, &#123; <span class="attr">default</span>: HomeList &#125;]) =&gt; &#123;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(Header());</span><br><span class="line">    <span class="built_in">document</span>.body.innerHTML += HomeList(<span class="number">3</span>);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<ul>
<li>search/webpack.config.js：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; ModuleFederationPlugin &#125; = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>).container;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(),</span><br><span class="line">    <span class="keyword">new</span> ModuleFederationPlugin(&#123;</span><br><span class="line">      name: <span class="string">&quot;search&quot;</span>,</span><br><span class="line">      filename: <span class="string">&quot;remoteEntry.js&quot;</span>,</span><br><span class="line">      remotes: &#123;</span><br><span class="line">        nav: <span class="string">&quot;nav@http://localhost:9001/remoteEntry.js&quot;</span>,</span><br><span class="line">        home: <span class="string">&quot;home@http://localhost:9000/remoteEntry.js&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      exposes: &#123;&#125;,</span><br><span class="line">      shared: &#123;&#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    port: <span class="number">9002</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  mode: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="esLint"><a href="#esLint" class="headerlink" title="esLint"></a>esLint</h3><h4 id="配置-eslint"><a href="#配置-eslint" class="headerlink" title="配置 eslint"></a>配置 eslint</h4><p>1、首先需要安装 eslint：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i eslint -D</span><br></pre></td></tr></table></figure>
<p>2、在根目录下添加一个 <code>.eslintrc</code> 文件（或者 .eslintrc.json, .js 等）。或者使用 eslint 工具自动生成该文件：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npx eslint --init</span><br></pre></td></tr></table></figure>
<p>3、eslint 配置文件里的配置项含义说明：</p>
<ul>
<li><p>env：指定脚本的运行环境。每种环境都有一组特定的的预定义全局变量。此处使用的 browser 预定义了浏览器环境中的全局变量，es6 启用除了 modules 以外的所有 ECMAScript 6 特性（该选项会自动设置 ecmaVersion 解析器选项为 6）。</p>
</li>
<li><p>globals：脚本在执行期间访问的额外的全局变量。也就是 env 中未预定义，但我们又需要使用的全局变量。</p>
</li>
<li><p>extends：检测中使用的预定义的规则集合。</p>
</li>
<li><p>rules：启用的规则及其各自的语法级别，会合并 extends 中的同名规则，定义冲突时优先级更高。</p>
</li>
<li><p>parserOptions ESlint：允许你指定想要支持的 JS 语言选项，ecmaFeatures 是个对象，表示你想要使用的额外的语言特性，这里 jsx 代表启用 JSX。ecmaVersion 用来指定支持的 ECMAScript 版本。默认为 5，即仅支持 es5，你可以使用 6、7、8、9 或 10 来指定想要使用的 ECMAScript 版本。也可以使用年份命名的版本号指定为 2016（同 6），2016（同 7），2017（同 8），2018（同 9），2010（同 10）。上面的 env 中启用了 es6，自动设置了 ecmaVersion 解析器选项为 6，plugins 是一个 npm 包，通常输出 eslint 内部为定义的规则实现，rules 和 extends 中定义的规则，并不都在 eslint 内部中有实现，比如 extends 中的 <code>plugin: react/recommended</code>，其中定义了规则开关和等级，但是这些规则如何生效的逻辑实在其对应的插件 react/recommended 中实现的。</p>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;env&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;browser&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;es2021&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;extends&quot;</span>: [<span class="string">&quot;airbnb-base&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;parserOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;ecmaVersion&quot;</span>: <span class="number">12</span>,</span><br><span class="line">    <span class="attr">&quot;sourceType&quot;</span>: <span class="string">&quot;module&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;rules&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;no-console&quot;</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;globals&quot;</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="结合-webpack-使用"><a href="#结合-webpack-使用" class="headerlink" title="结合 webpack 使用"></a>结合 webpack 使用</h4><p>1、结合 webpack 使用，首先需要安装如下 loader：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i eslint-loader -D</span><br></pre></td></tr></table></figure>
<p>2、基本配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        use: [<span class="string">&quot;babel-loader&quot;</span>, <span class="string">&quot;eslint-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  devServer: &#123;</span><br><span class="line">    <span class="comment">// 关闭浏览器上出现的页面报错覆盖层</span></span><br><span class="line">    client: &#123;</span><br><span class="line">      overlay: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="husky"><a href="#husky" class="headerlink" title="husky"></a>husky</h4><p>1、使用 husky 可以在提交代码前进行 eslint 检查。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i husky -D</span><br></pre></td></tr></table></figure>
<p>2、husky 的使用方式：安装好 husky 之后，需要执行如下命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm set-script prepare &quot;husky install&quot;</span><br><span class="line"></span><br><span class="line">npm run prepare</span><br><span class="line"></span><br><span class="line">npx husky add .husky&#x2F;pre-commit &quot;npm test&quot;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：执行 <code>npm set-script prepare &quot;husky install&quot;</code> 之前，必须要先使用 <code>git init</code> 创建 <code>.git</code> 文件，否则将会执行失败。</p>
</blockquote>
<p>3、配置 package 脚本：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">+   &quot;prepare&quot;: &quot;husky install&quot;,</span><br><span class="line">+   &quot;test&quot;: &quot;npx eslint ./src&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4、进行完以上步骤之后，husky 就已经配置完成了，此时可以执行 git commit 进行测试了。</p>
<h3 id="webpack-性能优化"><a href="#webpack-性能优化" class="headerlink" title="webpack 性能优化"></a>webpack 性能优化</h3><h4 id="通用环境优化"><a href="#通用环境优化" class="headerlink" title="通用环境优化"></a>通用环境优化</h4><p>1、将 loader 应用与最少数量的必要模块，即在不需要用到的地方尽量不去使用，如下代码就限制了 loader 的作用范围，只解析 src 下的 js 文件，这就提升了效率：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        include: path.resolve(__dirname, <span class="string">&quot;src&quot;</span>),</span><br><span class="line">        loader: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>2、引导（bootstrap）：每个额外的 loader/plugin 都有其启动时间，尽量少的使用工具。</p>
<p>3、解析：通过以下步骤可以提高解析速度：</p>
<ul>
<li><p>减少 <code>resolve.modules</code>、<code>resolve.extensions</code>、<code>resolve.mainFiles</code>、<code>resolve.descriptionFiles</code> 中条数数量，因为它们会增加文件体统的调用次数。</p>
</li>
<li><p>如果不需要使用 symlinks（例如 npm link 或 yarn link），可以设置 <code>resolve.symlinks: false</code>。</p>
</li>
<li><p>如果使用自定义 resolve plugin 规则（正则），但不需要指定 context 上下文，可以设置 <code>resolve.cacheWithContext: false</code>。</p>
</li>
</ul>
<p>4、减小编译结果的整体大小，以提高构建性能。尽量保持 chunk 体积为最小状态，为实现这一目的，可以通过如下方法实现：</p>
<ul>
<li><p>使用数量更少/体积更小的 library。</p>
</li>
<li><p>在多页面应用程序中使用 SplitChunksPlugin。</p>
</li>
<li><p>在多页面用用程序中使用 SplitChunksPlugin，并开启 async 模式。</p>
</li>
<li><p>移除未引用代码。</p>
</li>
<li><p>只编译当前正在开发的那些代码。</p>
</li>
</ul>
<p>5、持久化缓存：</p>
<ul>
<li><p>在 webpack 配置中使用 cache 选项，使用 package.json 中的 <strong>postinstall</strong> 清除缓存目录。</p>
</li>
<li><p>将 cache 类型设置为内存或者文件系统。memory 选项很简单，它告诉 webpack 在内存中存储缓存，不允许额外的配置：</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  cache: &#123;</span><br><span class="line">    type: <span class="string">&quot;memory&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>6、使用 dll 为更改不频繁的代码生成单独的编译结果。这可以提高应用程序的编译速度，尽管它增加了构建过程的复杂度。</p>
<p>7、使用 worker 池（worker pool 多线程打包）。而要开启多线程打包，需要使用 <code>thread-loader</code>，该 loader 可以将非常消耗资源的 loader 分流给一个 worker pool，具体配置如下：</p>
<ul>
<li>为 babel-loader 开启多线程：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_module/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              presets: [<span class="string">&quot;@babel/preset-env&quot;</span>],</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">&quot;thread-loader&quot;</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              workers: <span class="number">2</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：不要使用过多的 worker，因为 Node.js 的 runtime 和 loader 都有启动开销，最小化 worker 和 main process（主进程）之间的模块传输。进程间通讯（IPC，inter process communication）是非常消耗资源的。因此只有当某个 loader 运算量很大，并且非常耗时的情况下，才去使用该 loader。</p>
</blockquote>
<h4 id="开发环境优化"><a href="#开发环境优化" class="headerlink" title="开发环境优化"></a>开发环境优化</h4><p>1、<a href="https://www.webpackjs.com/configuration/watch/">增量编译</a>：</p>
<ul>
<li><p>使用 webpack 的 watch mode（监听模式）。而不是使用其它工具来 watch 文件和调用 webpack。内置的 watch mode 会记录时间戳并将此信息传递给 compilation 以使缓存失效。</p>
</li>
<li><p>在某些配置环境中，watch mode 会回退到 poll mode（轮询模式）。监听许多文件会导致 CPU 大量负载。在这些情况下，可以使用 watchOptions.poll 来增加轮询的间隔时间。</p>
</li>
</ul>
<p>2、在内存中编译：下面几个工具通过在内存中（而不是写入磁盘）编译和 serve 资源来提高性能：</p>
<ul>
<li><p>webpack-dev-server。</p>
</li>
<li><p>webpack-hot-middleware。</p>
</li>
<li><p>webpack-dev-middleware。</p>
</li>
</ul>
<p>3、stats.toJson 加速：</p>
<ul>
<li><p>webpack 4 默认使用 stats.toJson() 输出大量数据，除非在增量步骤中做必要的统计，否则请避免获取 stats 对象的部分内容。</p>
</li>
<li><p>webpack-dev-server 在 v3.1.3 以后的版本，包含一个重要的性能修复，即最小化每个增量构建步骤中，从 stats 对象获取的数据量。</p>
</li>
</ul>
<p>4、devtool：需要注意的是，不同的 devtool 设置，会导致性能差异。</p>
<ul>
<li><p>evel：具有最好的性能，但是不能帮助你转义代码。</p>
</li>
<li><p>如果能接受稍差一些的 map 质量，可以使用 cheap-source-map 变体配置来提高性能。</p>
</li>
<li><p>使用 eval-source-map 变体配置进行增量编译。</p>
</li>
<li><p>在大多数情况下，最佳选择是 eval-cheap-module-source-map。</p>
</li>
</ul>
<p>5、避免使用在生产环境中才用到的工具。某些 utility，plugin 和 loader 都只用于生产环境。例如在开发环境下使用 TerserPlugin 来压缩和代码是没有意义的。通常在开发环境下，应该排除以下这些工具：</p>
<ul>
<li><p>TerserPlugin。</p>
</li>
<li><p>fullhash/chunkhash/contenthash。</p>
</li>
<li><p>AggressiveSplittingPlugin。</p>
</li>
<li><p>AggressiveMergingPlugin。</p>
</li>
<li><p>ModuleConcatenationPlugin。</p>
</li>
</ul>
<p>6、最小化 entry chunk：</p>
<ul>
<li><p>webpack 只会在文件系统中输出已经更新的 chunk，某些配置选项（HMR，output.chunkFilename 的 name/chunkhash/contenthash，fullhash）来说，除了对已经更新的 chunk 无效之外，对于 entry chunk 也不会失效。</p>
</li>
<li><p>确保在生成 extry chunk 时，尽量减少某体积以提高性能。下面的配置运行代码创建了一个额外的 chunk，所以它的生成代价较低：</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  optimization: &#123;</span><br><span class="line">    runtimeChunk: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>7、避免额外的优化步骤：</p>
<ul>
<li>webpack 通过执行额外的算法任务，来优化输出结果的体积和加载性能。这些优化适用于小型代码库，但是在大型代码库中且非常耗费性能：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  optimization: &#123;</span><br><span class="line">    removeAvailableModules: <span class="literal">false</span>,</span><br><span class="line">    removeEmptyChunks: <span class="literal">false</span>,</span><br><span class="line">    splitChunk: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>8、输出结果不携带路径信息：</p>
<ul>
<li>webpack 会在输出的 bundle 中生成路径信息。然而，在打包数千个模块的项目中，这回导致造成垃圾回收性能压力。在 option.output.pathinfo 设置中关闭：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  output: &#123;</span><br><span class="line">    pathinfo: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>9、node.js 版本 8.9.10-9.11.1：</p>
<ul>
<li><p>node.js 版本 8.9.10-9.11.1 中 ES2015 Map 和 Set 实现，存在性能回退。而 webpack 大量地使用这些数据结构，因此这次回退也会影响编译时间。</p>
</li>
<li><p>说明：在 8.9.10-9.11.1 之前和之后的 node.js 版本不受影响。</p>
</li>
</ul>
<p>9、typescript loader：</p>
<ul>
<li>可以为 loader 传入 transpileOnly 选项，以缩短使用 ts-loader 时的构建时间。使用此选项，会关闭类型检查。如果要再次开启类型检查，就需要使用 ForkTsCheckerWebpackPlugin。使用此插件将检查过程移至单独的进程，可以加快 TS 的类型检查和 ESLint 插入的速度：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.tsx$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">&quot;ts-loader&quot;</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              transpileOnly: <span class="literal">true</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="生产环境优化"><a href="#生产环境优化" class="headerlink" title="生产环境优化"></a>生产环境优化</h4><p>1、不启用 SourceMap：source map 相当消耗资源，开发环境模式下不要设置 source map。</p>
]]></content>
      <categories>
        <category>构建工具</category>
      </categories>
      <tags>
        <tag>webpack</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue</title>
    <url>/2019/05/16/vue/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Vue-基础"><a href="#Vue-基础" class="headerlink" title="Vue 基础"></a>Vue 基础</h3><h4 id="内置指令"><a href="#内置指令" class="headerlink" title="内置指令"></a>内置指令</h4><p>1、<strong>v-bind</strong>：单向绑定解析表达式，可简写为：<code>:xxx</code>。</p>
<p>2、<strong>v-model</strong>：双向数据绑定。</p>
<p>3、<strong>v-for</strong>：遍历数组、对象、字符串。</p>
<p>4、<strong>v-on</strong>：绑定事件监听，可简写为 <strong>@xxx</strong>（如：@click）。</p>
<p>5、<strong>v-if</strong>：条件渲染（动态控制节点是否存在）。</p>
<p>6、<strong>v-else</strong>：条件渲染（动态控制节点是否存在）。</p>
<p>7、<strong>v-show</strong>：条件渲染（动态控制节点是否展示）。</p>
<p>8、<strong>v-text</strong>：可向其所在的节点中渲染文本内容，它与插值语法的区别在于：v-text 会替换掉节点中的内容，而<code>&#123;&#123;xx&#125;&#125;</code>插值语法则不会替换。</p>
<a id="more"></a>

<p>9、<strong>v-html</strong>：用法及作用与 v-text 类似，只不过 v-model 可以解析标签，而 v-text 则不行。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>hello,&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-text</span>=<span class="string">&quot;str&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-html</span>=<span class="string">&quot;str&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：v-model 处在安全性问题，在网站上动态渲染任意 HTML 是非常危险的，容易导致 XSS 攻击。因此一定要在可信的内容上使用 v-html，不要用在用户提交的内容上。</p>
</blockquote>
<p>10、<strong>v-cloak</strong>：该指令没有值，本质上是一个特殊属性，Vue 实例创建完毕并接管容器后，会删除 v-cloak 属性。可以使用 css 配合 v-cloak 解决网速慢时页面展示出<code>&#123;&#123;xxx&#125;&#125;</code>的问题。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-attr">[v-cloak]</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="attribute">display</span>: none;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-cloak</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>11、<strong>v-once</strong>：该指令所在节点在初次动态渲染后，就视为静态内容了，以后数据的改变不会引起 v-once 所在结构的更新，可以用于优化性能。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-cloak</span>&gt;</span>初始化n的值是：&#123;&#123;n&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-cloak</span>&gt;</span>当前n的值是：&#123;&#123;n&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;n++&quot;</span>&gt;</span>n++<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">    el: <span class="string">&quot;#root&quot;</span>,</span></span><br><span class="line">    data: &#123;</span><br><span class="line">      n: 1,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>12、<strong>v-pre</strong>：该指令会跳过所在节点的编译过程。可以利用该指令跳过没有使用 vue 的指令语法，或没有使用 vue 插值语法的节点，加快编译。</p>
<h4 id="事件的基本使用"><a href="#事件的基本使用" class="headerlink" title="事件的基本使用"></a>事件的基本使用</h4><p>1、使用 v-on:xxx 或 @xxx 绑定事件，其中 xxx 是事件名。</p>
<p>2、事件的回调需要配置在 methods 对象中，最终会挂在 vm 上。</p>
<p>3、methods 中配置的函数，都是被 vue 所管理的函数，其中 this 的指向是 vm 或组件实例对象。</p>
<p>4、methods 中配置的函数，不要用箭头函数，否则 this 就会指向 window，不再指向 vm。</p>
<p>5、@click=”demo” 和 @click=”demo($event)” 效果一致，但后者可以传递其它参数。</p>
<p>6、示例代码如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>dnhyxc<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;showInfo1&quot;</span>&gt;</span>不可传参<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;showInfo2($event,&#x27;dnhyxc&#x27;)&quot;</span>&gt;</span>不可传参<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">    el: <span class="string">&quot;#root&quot;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        name: <span class="string">&quot;dnhyxc&quot;</span>,</span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">showInfo1</span>(<span class="params">event</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(event);</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">showInfo2</span>(<span class="params">event, name</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(event);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(name);</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="事件修饰符"><a href="#事件修饰符" class="headerlink" title="事件修饰符"></a>事件修饰符</h4><p>1、prevent：阻止默认事件。</p>
<p>2、stop：阻止事件冒泡。</p>
<p>3、once：事件只触发一次。</p>
<p>4、capture：使用事件的捕获模式，即事件会在捕获阶段触发，而不是在默认的冒泡阶段触发。</p>
<p>5、self：只有 event.target 是当前操作的元素时才触发事件。</p>
<p>6、passive：事件的默认行为立即执行，无需等待事件回调执行完毕。</p>
<p>7、具体使用方式如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;baidu.com&quot;</span> @<span class="attr">click.prevent</span>=<span class="string">&quot;showInfo1&quot;</span>&gt;</span>阻止默认事件<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> @<span class="attr">click</span>=<span class="string">&quot;showInfo2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click.stop</span>=<span class="string">&quot;showInfo3&quot;</span>&gt;</span>阻止事件冒泡<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> @<span class="attr">click</span>=<span class="string">&quot;showInfo2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;baidu.com&quot;</span> @<span class="attr">click.prevent.stop</span>=<span class="string">&quot;showInfo&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span>阻止默认事件再阻止事件冒泡&lt;/a</span><br><span class="line">    &gt;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click.once</span>=<span class="string">&quot;showInfo4&quot;</span>&gt;</span>事件只触发一次<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> @<span class="attr">click:capture</span>=<span class="string">&quot;showMsg(1)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> @<span class="attr">click</span>=<span class="string">&quot;showMsg(1)&quot;</span>&gt;</span>使用事件的捕获模式<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> @<span class="attr">click:self</span>=<span class="string">&quot;showInfo5&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;showInfo6&quot;</span>&gt;</span></span><br><span class="line">      只有 event.target 是当前操作的元素时才触发事件</span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 当使用wheel滚轮事件时，会先触发deme回调函数，再触发滚动事件。假如demo中有数量很庞大的计算，如10000次for循环，那么就需要等很长一段事件，滚动条才会动一下 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span> @<span class="attr">wheel.passive</span>=<span class="string">&quot;demo&quot;</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>4<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="键盘事件"><a href="#键盘事件" class="headerlink" title="键盘事件"></a>键盘事件</h4><p>1、vue 中常用的按键别名：</p>
<ul>
<li><p>回车：enter。</p>
</li>
<li><p>删除：delete（捕获”删除”和”退格”键）。</p>
</li>
<li><p>退出：esc。</p>
</li>
<li><p>空格：space。</p>
</li>
<li><p>换行：tab（特殊，必须配合 keydown 去使用）。</p>
</li>
<li><p>上：up。</p>
</li>
<li><p>下：down。</p>
</li>
<li><p>左：left。</p>
</li>
<li><p>右：right。</p>
</li>
</ul>
<p>2、vue 为提供别名的按键，可以使用按键原始的 key 值去判定，但注意要转为 kebab-case（短横线命名）。</p>
<p>3、系统修饰键（用法特殊）：ctrl、alt、shift、meta。</p>
<ul>
<li><p>配合 keyup 使用：按下修饰键的同时，再按下其它键，随后释放其它键，事件才被触发。</p>
</li>
<li><p>配合 keydown 使用：正常触发事件。</p>
</li>
</ul>
<p>4、可以使用 keyCode 去指定具体的按键（不推荐）。</p>
<p>5、Vue.config.keyCodes.自定义键名 = 键码，可以去定制按键别名。</p>
<h4 id="计算属性-computed"><a href="#计算属性-computed" class="headerlink" title="计算属性 computed"></a>计算属性 computed</h4><p>1、定义：要用的属性不存在，要通过<strong>已有属性</strong>计算得来。</p>
<p>2、原理：底层借助 Object.defineproperty 方法提供的 getter 和 setter 实现。</p>
<p>3、get 函数什么时候执行？</p>
<ul>
<li><p>初次读取时会执行一次。</p>
</li>
<li><p>当依赖的数据发生改变时会被再次调用。</p>
</li>
</ul>
<p>4、优势：与 methods 实现相比，内部有缓存机制（复用），效率更高，调试方便。</p>
<blockquote>
<ol>
<li>计算属性最终会出现在 vm 上，直接读取使用即可。</li>
<li>如果计算属性要被修改，那必须写 set 函数去响应修改，且 set 中要引起计算时依赖的数据发生改变。</li>
</ol>
</blockquote>
<p>5、具体代码示例如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>计算属性<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 使用methods实现计算属性 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        姓：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;firstName&quot;</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;lastName&quot;</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        全名：<span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;fullName()&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- 使用computed实现计算属性 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        姓：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;firstName&quot;</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;lastName&quot;</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        全名：<span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;fullName1&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- 使用computed简写形式实现计算属性 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        姓：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;firstName&quot;</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;lastName&quot;</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        全名：<span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;fullName2&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">    Vue.config.productionTip = <span class="literal">false</span>; <span class="comment">// 阻止vue在启动时生成生产提示警告</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">      el: <span class="string">&quot;#root&quot;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">          firstName: <span class="string">&quot;dnh&quot;</span>,</span></span><br><span class="line"><span class="javascript">          lastName: <span class="string">&quot;yxc&quot;</span>,</span></span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">fullName</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.firstName&#125;</span>-<span class="subst">$&#123;<span class="built_in">this</span>.lastName&#125;</span>`</span>;</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      computed: &#123;</span><br><span class="line"><span class="javascript">        <span class="comment">// 计算属性完整写法</span></span></span><br><span class="line">        fullName1: &#123;</span><br><span class="line">          /*</span><br><span class="line">            get 方法会在有人读取fullName1时被调用，且返回值就最为fullName1的值。</span><br><span class="line">            由于计算属性会做缓存，因此get会在初次读取fullName的时候调用一次，之后只会在所依赖的数据发生改变时才会被调用。</span><br><span class="line">          */</span><br><span class="line"><span class="javascript">          <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&quot;getter被调用了&quot;</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.firstName&#125;</span>-<span class="subst">$&#123;<span class="built_in">this</span>.lastName&#125;</span>`</span>;</span></span><br><span class="line">          &#125;,</span><br><span class="line"><span class="javascript">          <span class="comment">// set会在fullName1发生改变时调用</span></span></span><br><span class="line"><span class="javascript">          <span class="function"><span class="title">set</span>(<span class="params">value</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&quot;set&quot;</span>, value);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> arr = value.split(<span class="string">&quot;-&quot;</span>);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.firstName = arr[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.lastName = arr[<span class="number">1</span>];</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">// 计算属性简写（必须确定只需要读取属性不需要改变属性时才使用简写形式）</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">fullName2</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="string">&quot;getter被调用了&quot;</span>);</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.firstName&#125;</span>-<span class="subst">$&#123;<span class="built_in">this</span>.lastName&#125;</span>`</span>;</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="watch-与-computed-的差异"><a href="#watch-与-computed-的差异" class="headerlink" title="watch 与 computed 的差异"></a>watch 与 computed 的差异</h4><p>1、computed 能完成的功能，watch 都能完成。</p>
<p>2、watch 能完成的功能，computed 不一定能完成，例如：watch 可以进行异步操作。</p>
<blockquote>
<ol>
<li>所被 vue 管理的函数，最好写成普通函数，这样 this 的指向才是 vm 或组件实例对象。</li>
<li>所有不被 vue 所管理的函数（定时器的回调函数、ajax 的回调函数等），最好写成箭头函数，这样 this 的指向才是 vm 或组件实例对象。</li>
</ol>
</blockquote>
<p>3、使用 watch 实现计算属性：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>使用watch实现计算属性<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 使用methods实现计算属性 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        姓：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;firstName&quot;</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;lastName&quot;</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        全名：<span class="tag">&lt;<span class="name">span</span>&gt;</span>computed &#123;&#123;fullName1&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        全名：<span class="tag">&lt;<span class="name">span</span>&gt;</span>watch &#123;&#123;fullName&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">    Vue.config.productionTip = <span class="literal">false</span>; <span class="comment">// 阻止vue在启动时生成生产提示警告</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">      el: <span class="string">&quot;#root&quot;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">          firstName: <span class="string">&quot;dnh&quot;</span>,</span></span><br><span class="line"><span class="javascript">          lastName: <span class="string">&quot;yxc&quot;</span>,</span></span><br><span class="line"><span class="javascript">          fullName: <span class="string">&quot;dnh-yxc&quot;</span>,</span></span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;,</span><br><span class="line">      computed: &#123;</span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">fullName1</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.firstName&#125;</span>-<span class="subst">$&#123;<span class="built_in">this</span>.lastName&#125;</span>`</span>;</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      watch: &#123;</span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">firstName</span>(<span class="params">pre</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(pre);</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> (<span class="built_in">this</span>.fullName = <span class="string">`<span class="subst">$&#123;pre&#125;</span>-<span class="subst">$&#123;<span class="built_in">this</span>.lastName&#125;</span>`</span>);</span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">lastName</span>(<span class="params">pre</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> (<span class="built_in">this</span>.fullName = <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.firstName&#125;</span>-<span class="subst">$&#123;pre&#125;</span>`</span>);</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="监视属性-watch"><a href="#监视属性-watch" class="headerlink" title="监视属性 watch"></a>监视属性 watch</h4><p>1、当被监视的属性变化时，回调函数（handler）自动调用。</p>
<ul>
<li>注意：回调函数（handler）名称不能随意乱写，否则会报错。</li>
</ul>
<p>2、监视的属性必须存在，才能进行监视。</p>
<p>3、监视的两种写法：</p>
<ul>
<li><p>new Vue 时传入 watch 配置。</p>
</li>
<li><p>创建 vm 之后，通过 vm.$watch 实现监视。</p>
</li>
</ul>
<p>4、深度监测：</p>
<ul>
<li><p>vue 中的 watch 默认不监测对象内部值的变化（单层级对象）。</p>
</li>
<li><p>配置 deep:true 可以监测对象内部值的变化（多层级对象）。</p>
</li>
</ul>
<blockquote>
<ol>
<li>vue 自身可以监测对象内部值的改变，但 vue 提供的 watch 默认不可以。</li>
<li>使用 watch 时根据数据的具体结构，决定是否采用深度监测。</li>
</ol>
</blockquote>
<p>5、具体使用方式如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>监听属性<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>今天好&#123;&#123;info&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>今天好&#123;&#123;sadInfo&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 写法一 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeInfo&quot;</span>&gt;</span>改变心情happy&#123;&#123;x&#125;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 写法二：绑定事件(@xxx=&quot;yyy&quot; yyy可以是一些简单的逻辑语句 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;isSad = !isSad;x++&quot;</span>&gt;</span>切换心情sad&#123;&#123;x&#125;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>a的值是：&#123;&#123;num.a&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;num.a++&quot;</span>&gt;</span>a++<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>b的值是：&#123;&#123;num.b&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;num = &#123;a:666,b:999&#125;&quot;</span>&gt;</span>彻底替换num<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">    Vue.config.productionTip = <span class="literal">false</span>; <span class="comment">// 阻止vue在启动时生成生产提示警告</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">      el: <span class="string">&quot;#root&quot;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">          isHappy: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">          isSad: <span class="literal">true</span>,</span></span><br><span class="line">          x: 0,</span><br><span class="line">          num: &#123;</span><br><span class="line">            a: 0,</span><br><span class="line">            b: 0,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">changeInfo</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.isHappy = !<span class="built_in">this</span>.isHappy;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.x++;</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      computed: &#123;</span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">info</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> <span class="built_in">this</span>.isHappy ? <span class="string">&quot;开心呢&quot;</span> : <span class="string">&quot;伤心啊&quot;</span>;</span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">sadInfo</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> <span class="built_in">this</span>.isSad ? <span class="string">&quot;伤心啊&quot;</span> : <span class="string">&quot;开心呢&quot;</span>;</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">// 监测属性写法一</span></span></span><br><span class="line">      watch: &#123;</span><br><span class="line"><span class="javascript">        <span class="comment">// 监测计算属性</span></span></span><br><span class="line">        info: &#123;</span><br><span class="line"><span class="javascript">          <span class="function"><span class="title">handler</span>(<span class="params">pre, cur</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&quot;info改变了&quot;</span>, pre, cur);</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        <span class="comment">// 检测普通属性</span></span></span><br><span class="line">        isHappy: &#123;</span><br><span class="line"><span class="javascript">          <span class="comment">// immediate默认值为false，当为true时，会在初始化时让handler被调用一次。</span></span></span><br><span class="line"><span class="javascript">          immediate: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 当isHappy发生改变时，isHappyHandler会被调用</span></span></span><br><span class="line"><span class="javascript">          <span class="function"><span class="title">handler</span>(<span class="params">pre, cur</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&quot;isHappy改变了&quot;</span>, pre, cur);</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        num: &#123;</span><br><span class="line"><span class="javascript">          <span class="comment">// deep为true时，可以监视多级结构中所有属性的变化</span></span></span><br><span class="line"><span class="javascript">          deep: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">          <span class="function"><span class="title">handler</span>(<span class="params">pre, cur</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&quot;num中的a改变了&quot;</span>, pre, cur);</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">// 简写形式（不需要使用deep、immediate配置项时可以使用简写）</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">isSad</span>(<span class="params">pre, cur</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="string">&quot;watch中isSad改变了&quot;</span>, pre, cur);</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"><span class="javascript">    <span class="comment">// 监测属性写法二（完整写法）</span></span></span><br><span class="line"><span class="javascript">    vm.$watch(<span class="string">&quot;isSad&quot;</span>, &#123;</span></span><br><span class="line"><span class="javascript">      immediate: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">      deep: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">handler</span>(<span class="params">pre, cur</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;完整写法isSad改变了&quot;</span>, pre, cur);</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">// 简写写法</span></span></span><br><span class="line"><span class="javascript">    vm.$watch(<span class="string">&quot;isSad&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">pre, cur</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&quot;简写写法isSad改变了&quot;</span>, pre, cur);</span></span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="绑定样式"><a href="#绑定样式" class="headerlink" title="绑定样式"></a>绑定样式</h4><p>1、绑定 class 样式写法为：class=”xxx”，xxx 可以是字符串，对象，数组。</p>
<ul>
<li><p>字符串写法适用于类名不确定，个数不确定，名字不确定的情况。</p>
</li>
<li><p>对象写法适用于要绑定多个样式，个数不确定，名字也不确定的情况。</p>
</li>
<li><p>数组写法适用于要绑定多个样式，个数确定，名字也确定，但是不确定用不用的情况。</p>
</li>
</ul>
<p>2、绑定 style 样式写法为：</p>
<ul>
<li><p>:style=”{fontSize: xxx}” 其中 xxx 是动态的。</p>
</li>
<li><p>:style=”[a,b]” 其中 a、b 是样式对象。</p>
</li>
</ul>
<p>3、具体使用示例如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>绑定样式<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">      * &#123;</span><br><span class="line"><span class="css">        <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line">      .base &#123;</span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">background-color</span>: thistle;</span></span><br><span class="line"><span class="css">        <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="css">        <span class="attribute">line-height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .normal &#123;</span><br><span class="line"><span class="css">        <span class="attribute">background-color</span>: skyblue;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .pink &#123;</span><br><span class="line"><span class="css">        <span class="attribute">background-color</span>: pink;</span></span><br><span class="line"><span class="css">        <span class="attribute">font-weight</span>: <span class="number">700</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .yellow &#123;</span><br><span class="line"><span class="css">        <span class="attribute">background-color</span>: yellow;</span></span><br><span class="line"><span class="css">        <span class="attribute">color</span>: tomato;</span></span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 绑定class样式（字符串写法）适用于样式的类名不确定，需要动态指定的情况 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;base&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;color&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeColor&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 绑定class样式（数组写法）适用于样式个数不确定，名字也不确定的情况 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;base&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;colorArr&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeColor1&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 绑定class样式（对象写法）适用于样式个数确定，名字也也确定，但要动态决定是否使用的情况 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;base&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;colorObj&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeColor2&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 绑定style样式（对象写法） --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;base&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;styleObj&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeColor3&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 绑定style样式（数组写法） --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;base&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;styleArr&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeColor4&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">    Vue.config.productionTip = <span class="literal">false</span>; <span class="comment">// 阻止vue在启动时生成生产提示警告</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">      el: <span class="string">&quot;#root&quot;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">          name: <span class="string">&quot;dnhyxc&quot;</span>,</span></span><br><span class="line"><span class="javascript">          color: <span class="string">&quot;normal&quot;</span>,</span></span><br><span class="line"><span class="javascript">          colorArr: [<span class="string">&quot;normal&quot;</span>, <span class="string">&quot;pink&quot;</span>, <span class="string">&quot;yellow&quot;</span>],</span></span><br><span class="line">          colorObj: &#123;</span><br><span class="line"><span class="javascript">            pink: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">            yellow: <span class="literal">true</span>,</span></span><br><span class="line">          &#125;,</span><br><span class="line">          styleObj: &#123;</span><br><span class="line"><span class="javascript">            fontSize: <span class="string">&quot;40px&quot;</span>,</span></span><br><span class="line">          &#125;,</span><br><span class="line">          styleArr: [</span><br><span class="line">            &#123;</span><br><span class="line"><span class="javascript">              fontSize: <span class="string">&quot;40px&quot;</span>,</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line"><span class="javascript">              backgroundColor: <span class="string">&quot;green&quot;</span>,</span></span><br><span class="line">            &#125;,</span><br><span class="line">          ],</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">changeColor</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> arr = [<span class="string">&quot;pink&quot;</span>, <span class="string">&quot;yellow&quot;</span>, <span class="string">&quot;normal&quot;</span>];</span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> index = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * arr.length);</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.color = arr[index];</span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">changeColor1</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.colorArr = <span class="built_in">this</span>.colorArr.slice(<span class="number">1</span>);</span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">changeColor2</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.colorObj.pink = !<span class="built_in">this</span>.colorObj.pink;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.colorObj.yellow = !<span class="built_in">this</span>.colorObj.yellow;</span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">changeColor3</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">let</span> size = <span class="built_in">this</span>.styleObj.fontSize.slice(</span></span><br><span class="line">            0,</span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.styleObj.fontSize.length - <span class="number">2</span></span></span><br><span class="line">          );</span><br><span class="line">          size++;</span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.styleObj.fontSize = <span class="string">`<span class="subst">$&#123;size&#125;</span>px`</span>;</span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">changeColor4</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.styleArr.push(&#123;</span></span><br><span class="line"><span class="javascript">            color: <span class="string">&quot;yellow&quot;</span>,</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="条件渲染"><a href="#条件渲染" class="headerlink" title="条件渲染"></a>条件渲染</h4><h5 id="v-if"><a href="#v-if" class="headerlink" title="v-if"></a>v-if</h5><p>1，v-if 写法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">v-<span class="keyword">if</span> = <span class="string">&#x27;表达式&#x27;</span></span><br><span class="line"></span><br><span class="line">v-<span class="keyword">else</span>-<span class="keyword">if</span> = <span class="string">&#x27;表达式&#x27;</span></span><br><span class="line"></span><br><span class="line">v-<span class="keyword">else</span> = <span class="string">&#x27;表达式&#x27;</span></span><br></pre></td></tr></table></figure>
<p>2，v-if 适用于切换频率较低的场景，因为它会将隐藏的元素直接从元素所在位置删除。</p>
<p>3，v-if 可以和 v-else-if、v-else 一起使用，但是这三者之间必须紧紧挨在一起，中间不能插入其它元素，否则判断将会被打断，导致条件判断不生效。</p>
<h5 id="v-show"><a href="#v-show" class="headerlink" title="v-show"></a>v-show</h5><p>1，v-show 写法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">v-show = <span class="string">&#x27;表达式&#x27;</span></span><br></pre></td></tr></table></figure>
<p>2，v-show 适用于切换频率较高的场景，因为其特点就是隐藏的 DOM 元素是使用 <code>display：none</code> 进行隐藏的，元素依然存在。</p>
<blockquote>
<p>使用 v-show 时，该元素一定能获取到，但是使用 v-if 时，元素可能无法获取到。</p>
</blockquote>
<h5 id="条件渲染具体使用示例"><a href="#条件渲染具体使用示例" class="headerlink" title="条件渲染具体使用示例"></a>条件渲染具体使用示例</h5><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>当前n的值为：&#123;&#123;n&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;n++&quot;</span>&gt;</span>n + 1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 使用v-show进行条件渲染 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-show</span>=<span class="string">&quot;n === 1&quot;</span>&gt;</span>n是1我就出来<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 使用v-show进行条件渲染 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-if</span>=<span class="string">&quot;n === 1&quot;</span>&gt;</span>n是1我就出来<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 使用v-else-if和v-else进行条件渲染 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-if</span>=<span class="string">&quot;n === 1&quot;</span>&gt;</span>n是1就出来<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-else-if</span>=<span class="string">&quot;n === 2&quot;</span>&gt;</span>n是2就嘿嘿嘿<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-else-if</span>=<span class="string">&quot;n === 3&quot;</span>&gt;</span>n是3哈哈哈<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-else</span>&gt;</span>嘿哈嘿哈<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 使用v-if与template配合使用进行条件渲染 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">&quot;n === 1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>嘿嘿<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>哈哈<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>嘿哈<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>template 可以防止在 3 个 h2 元素外包一层父元素，从而导致破坏原有的 DOM 结构，但是 template 只能配合 v-if 进行使用，不能配合 v-show 进行使用。</p>
</blockquote>
<h4 id="列表渲染-v-for"><a href="#列表渲染-v-for" class="headerlink" title="列表渲染 v-for"></a>列表渲染 v-for</h4><p>1、v-for 用于展示列表数据。</p>
<p>2、语法：v-for=”(item, index) in xxx” :key=”唯一标识（如：id）”</p>
<p>3、v-for 可遍历：数组、对象、字符串、指定对象。</p>
<p>4、具体使用方式如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>列表渲染<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- v-for 遍历可以使用 in 也可以使用 of --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 遍历数组 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>遍历数组<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(p,index) in persons&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;p.id&quot;</span>&gt;</span>&#123;&#123;p.name&#125;&#125;:&#123;&#123;p.age&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 遍历对象 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>遍历对象<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(value,key) of car&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;key&quot;</span>&gt;</span>&#123;&#123;key&#125;&#125;:&#123;&#123;value&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 遍历字符串 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>遍历字符串<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(char,index) in chars&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;char&quot;</span>&gt;</span>&#123;&#123;char&#125;&#125;:&#123;&#123;index&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 遍历指定次数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>遍历指定次数<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(number,index) in 5&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span>&#123;&#123;number&#125;&#125;:&#123;&#123;index&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">    Vue.config.productionTip = <span class="literal">false</span>; <span class="comment">// 阻止vue在启动时生成生产提示警告</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">      el: <span class="string">&quot;#root&quot;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line">          persons: [</span><br><span class="line">            &#123;</span><br><span class="line">              id: 10,</span><br><span class="line"><span class="javascript">              name: <span class="string">&quot;snsn&quot;</span>,</span></span><br><span class="line">              age: 26,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              id: 20,</span><br><span class="line"><span class="javascript">              name: <span class="string">&quot;hmhm&quot;</span>,</span></span><br><span class="line">              age: 25,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              id: 30,</span><br><span class="line"><span class="javascript">              name: <span class="string">&quot;nhnh&quot;</span>,</span></span><br><span class="line">              age: 18,</span><br><span class="line">            &#125;,</span><br><span class="line">          ],</span><br><span class="line">          car: &#123;</span><br><span class="line"><span class="javascript">            name: <span class="string">&quot;宝马&quot;</span>,</span></span><br><span class="line"><span class="javascript">            price: <span class="string">&quot;70w&quot;</span>,</span></span><br><span class="line"><span class="javascript">            color: <span class="string">&quot;黑色&quot;</span>,</span></span><br><span class="line">          &#125;,</span><br><span class="line"><span class="javascript">          chars: <span class="string">&quot;dnhyxc&quot;</span>,</span></span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="key-的作用（原理）"><a href="#key-的作用（原理）" class="headerlink" title="key 的作用（原理）"></a>key 的作用（原理）</h4><p>1、虚拟 dom 中 key 的作用：</p>
<ul>
<li>key 是虚拟 dom 对象的标记，当数据发生变化时，vue 会根据「新数据」生成「新的虚拟 dom」，随后 vue 进行「新虚拟 dom」的差异比较。</li>
</ul>
<p>2、虚拟 dom 对比规则：</p>
<ul>
<li><p>当旧虚拟 dom 中找到了与新虚拟 dom 相同的 key 时：</p>
<ul>
<li><p>若虚拟 dom 中内容没变，直接使用之前的真实 dom。</p>
</li>
<li><p>若虚拟 dom 中内容变了，则生成新的真实 dom，随后替换掉页面上之前的真实 dom。</p>
</li>
</ul>
</li>
<li><p>当旧虚拟 dom 中未找到与新虚拟 dom 相同的 key 时：</p>
<ul>
<li>创建新的真实 dom，随后渲染到页面中。</li>
</ul>
</li>
</ul>
<p>3、用 index 最为 key 可能引发的问题：</p>
<ul>
<li><p>若对数据进行逆序添加、逆序删除等破坏顺序操作时，会产生没有必要的真实 dom 更新，虽然对界面没有什么影响，但是效率极低。</p>
</li>
<li><p>如果结构中还包含输入类的 dom 时，会产生错误 dom 更新，导致更新的界面出问题。</p>
</li>
</ul>
<p>4、开发中如何选择使用的 key：</p>
<ul>
<li><p>最好使用每条数据的唯一标识，比如：id。</p>
</li>
<li><p>如果不存在对数据的逆序添加，逆序删除等破坏顺序的操作，仅用于渲染列表用于展示时，使用 index 作为 key 是没有问题的。</p>
</li>
</ul>
<h4 id="列表过滤"><a href="#列表过滤" class="headerlink" title="列表过滤"></a>列表过滤</h4><p>1、可通过 watch 实现也可通过 computed 计算属性实现，具体实现方式如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>列表过滤<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- v-for 遍历可以使用 in 也可以使用 of --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>使用watch实现列表过滤<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入名字&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;inpValue&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(p,index) in filterName&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;p.id&quot;</span>&gt;</span></span><br><span class="line">          &#123;&#123;p.name&#125;&#125;:&#123;&#123;p.age&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>使用computed实现列表过滤<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入名字&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;keywords&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;type = 2&quot;</span>&gt;</span>升序<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;type = 1&quot;</span>&gt;</span>降序<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;type = 0&quot;</span>&gt;</span>原序<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(p,index) in filterNames&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;p.id&quot;</span>&gt;</span></span><br><span class="line">          &#123;&#123;p.name&#125;&#125;:&#123;&#123;p.age&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">    Vue.config.productionTip = <span class="literal">false</span>; <span class="comment">// 阻止vue在启动时生成生产提示警告</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">      el: <span class="string">&quot;#root&quot;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">          type: <span class="string">&quot;0&quot;</span>,</span></span><br><span class="line"><span class="javascript">          inpValue: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="javascript">          keywords: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line">          persons: [</span><br><span class="line">            &#123;</span><br><span class="line">              id: 1,</span><br><span class="line"><span class="javascript">              name: <span class="string">&quot;snsn&quot;</span>,</span></span><br><span class="line">              age: 26,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              id: 2,</span><br><span class="line"><span class="javascript">              name: <span class="string">&quot;hmhm&quot;</span>,</span></span><br><span class="line">              age: 25,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              id: 3,</span><br><span class="line"><span class="javascript">              name: <span class="string">&quot;nhnh&quot;</span>,</span></span><br><span class="line">              age: 27,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              id: 4,</span><br><span class="line"><span class="javascript">              name: <span class="string">&quot;yhyh&quot;</span>,</span></span><br><span class="line">              age: 18,</span><br><span class="line">            &#125;,</span><br><span class="line">          ],</span><br><span class="line">          filterName: [],</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">// 使用watch实现过滤</span></span></span><br><span class="line">      watch: &#123;</span><br><span class="line">        inpValue: &#123;</span><br><span class="line"><span class="javascript">          immediate: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">          <span class="function"><span class="title">handler</span>(<span class="params">val</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.filterName = <span class="built_in">this</span>.persons.filter(<span class="function">(<span class="params">i</span>) =&gt;</span> i.name.includes(val));</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 使用methods实现</span></span></span><br><span class="line">      computed: &#123;</span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">filterNames</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> res = <span class="built_in">this</span>.persons.filter(<span class="function">(<span class="params">i</span>) =&gt;</span></span></span><br><span class="line"><span class="javascript">            i.name.includes(<span class="built_in">this</span>.keywords)</span></span><br><span class="line">          );</span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (<span class="built_in">this</span>.type) &#123;</span></span><br><span class="line"><span class="javascript">            res.sort(<span class="function">(<span class="params">p1, p2</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">              <span class="keyword">return</span> <span class="built_in">this</span>.type === <span class="number">1</span> ? p2.age - p1.age : p1.age - p2.age;</span></span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;</span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> res;</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="Vue-数据监听的原理"><a href="#Vue-数据监听的原理" class="headerlink" title="Vue 数据监听的原理"></a>Vue 数据监听的原理</h4><p>1、vue 会监视 data 中所有层次的数据。</p>
<p>2、vue 中通过 setter 实现监视，但是要在 new Vue 时就传入要监视的数据。</p>
<ul>
<li><p>对象中一开始没有定义，在后来追加的属性，vue 默认不做响应式处理。</p>
</li>
<li><p>如果需要给后添加的属性做响应式，需要使用如下 API：</p>
<ul>
<li>Vue.set(target, key, value) 或 vm.$set(target, key, value)。</li>
</ul>
</li>
</ul>
<p>3、如果要检测数组中的数据，需要通过包裹数组更新元素的方法实现，本质就是：</p>
<ul>
<li><p>首先调用数组原生的方法对数组进行更新。</p>
</li>
<li><p>重新解析模版，进而更新页面。</p>
</li>
</ul>
<p>4、在 vue 修改数组中的某个元素一定要用如下方法：</p>
<ul>
<li><p>push、pop、shift、unshift、splice、sort、reverse。</p>
</li>
<li><p>Vue.set() 或 vm.$set()。</p>
</li>
</ul>
<blockquote>
<p>注意千万不能使用 set 给 vm 或 vm 的根数据对象中添加属性。</p>
</blockquote>
<p>5、具体使用实例如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 更新对象</span></span><br><span class="line"><span class="built_in">this</span>.$set(<span class="built_in">this</span>.student, <span class="string">&quot;set&quot;</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新数组</span></span><br><span class="line"><span class="built_in">this</span>.student.friends.unshift(&#123; <span class="attr">name</span>: <span class="string">&quot;snsn&quot;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新数组中的某个对象</span></span><br><span class="line"><span class="built_in">this</span>.student.friends[<span class="number">0</span>].name = <span class="string">&quot;hmhm&quot;</span>;</span><br></pre></td></tr></table></figure>
<h4 id="Vue-表单收集"><a href="#Vue-表单收集" class="headerlink" title="Vue 表单收集"></a>Vue 表单收集</h4><p>1、<code>&lt;input type=&quot;text&quot; /&gt;</code> 则 v-model 收集的是 input 中用户输入的 value 值。</p>
<p>2、<code>&lt;input type=&quot;radio&quot; /&gt;</code> 则 v-model 收集的是 input 中的 value 值，但是需要手动给 input 设置 value 值。</p>
<p>3、<code>&lt;input type=&quot;checkbox&quot; /&gt;</code> 的情况：</p>
<ul>
<li><p>没有配置 input 的 value 属性时，那么收集的就是 checked（勾选或为勾选，是个 boolen 值）。</p>
</li>
<li><p>当配置了 input 的 value 属性时：</p>
<ul>
<li><p>v-model 的初始值是非数组，那么收集的就是 checked（勾选或为勾选，是个 boolen 值）。</p>
</li>
<li><p>v-model 的初始值是数组，那么收集的就是 value 组成的数组。</p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>v-model 的三个<strong>修饰符</strong>：</p>
<ul>
<li>lazy: 失去焦点再收集数据。</li>
<li>number: 输入字符串转为有效的数字。</li>
<li>trim: 去除输入的首尾空格。</li>
</ul>
</blockquote>
<p>5、具体使用示例如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>表单收集<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- v-for 遍历可以使用 in 也可以使用 of --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">form</span> @<span class="attr">submit.prevent</span>=<span class="string">&quot;onSubmit&quot;</span>&gt;</span></span><br><span class="line">        账号：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model.trim</span>=<span class="string">&quot;userInfo.account&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;userInfo.password&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        年龄：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">v-model.number</span>=<span class="string">&quot;userInfo.age&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        性别： 男<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;userInfo.sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;male&quot;</span> /&gt;</span></span><br><span class="line">        女<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;userInfo.sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;female&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        爱好：学习&lt;input</span><br><span class="line">          type=&quot;checkbox&quot;</span><br><span class="line">          v-model=&quot;userInfo.hobby&quot;</span><br><span class="line">          value=&quot;study&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">        听歌<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;userInfo.hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;music&quot;</span> /&gt;</span></span><br><span class="line">        睡觉<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;userInfo.hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sleep&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        所在地</span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">v-model</span>=<span class="string">&quot;userInfo.city&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span>请选择校区<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;hangzhou&quot;</span>&gt;</span>杭州<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;shanghai&quot;</span>&gt;</span>上海<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;wuhan&quot;</span>&gt;</span>武汉<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;shenzhen&quot;</span>&gt;</span>深圳<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        其它信息：</span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">v-model.lazy</span>=<span class="string">&quot;userInfo.other&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;userInfo.agree&quot;</span> /&gt;</span>阅读并接受&lt;a</span><br><span class="line">          href=&quot;dnhyxc.github.io&quot;</span><br><span class="line">          &gt;《用户协议》&lt;/a</span><br><span class="line">        &gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">    Vue.config.productionTip = <span class="literal">false</span>; <span class="comment">// 阻止vue在启动时生成生产提示警告</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">      el: <span class="string">&quot;#root&quot;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line">          userInfo: &#123;</span><br><span class="line"><span class="javascript">            account: <span class="string">&quot;925419516@qq.com&quot;</span>,</span></span><br><span class="line"><span class="javascript">            password: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="javascript">            sex: <span class="string">&quot;male&quot;</span>,</span></span><br><span class="line"><span class="javascript">            hobby: [<span class="string">&quot;study&quot;</span>],</span></span><br><span class="line"><span class="javascript">            city: <span class="string">&quot;hangzhou&quot;</span>,</span></span><br><span class="line"><span class="javascript">            other: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="javascript">            agree: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">onSubmit</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="built_in">this</span>.userInfo);</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h4><p>1、过滤器的定义就是对要显示的数据进行特定格式化后再显示（适用于一些简单的逻辑处理）。</p>
<p>2、定时器语法：</p>
<ul>
<li><p>注册过滤器：<code>Vue.filter(name, callback)</code> 或 <code>new Vue(&#123;filters:&#123;...&#125;&#125;)</code>。</p>
</li>
<li><p>使用过滤器：<code>&#123;&#123;xxx | 过滤器名称&#125;&#125;</code> 或 v-bind: 属性 = ‘xxx | 过滤器名称’。</p>
</li>
</ul>
<blockquote>
<p>过滤器说明：</p>
<ol>
<li>过滤器也可以接受额外的参数，但第一个参数永远都是需要过滤的属性（即<code>&#123;&#123;xxx | 过滤器名称&#125;&#125;</code>中的 xxx），第二个参数才是额外传入的参数。</li>
<li>多个过滤器可以进行串联使用。</li>
<li>过滤器并没有改变原本的数据，而是产生新的对应的数据。</li>
</ol>
</blockquote>
<p>3、具体使用如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/dayjs/1.10.6/dayjs.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>过滤器<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- v-for 遍历可以使用 in 也可以使用 of --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>现在是： &#123;&#123;time | timeFormater(&quot;YYYY_MM_DD&quot;) | mySlice&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root2&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>现在是： &#123;&#123;msg | mySlice&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">    Vue.config.productionTip = <span class="literal">false</span>; <span class="comment">// 阻止vue在启动时生成生产提示警告</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">// 全局过滤器</span></span></span><br><span class="line"><span class="javascript">    Vue.filter(<span class="string">&quot;mySlice&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> value.slice(<span class="number">0</span>, <span class="number">6</span>);</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">      el: <span class="string">&quot;#root&quot;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line">          time: 1630519751000,</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">// 局部过滤器</span></span></span><br><span class="line">      filters: &#123;</span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">timeFormater</span>(<span class="params">value, str = <span class="string">&quot;YYYY-MM-DD HH:mm:ss&quot;</span></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> dayjs(value).format(str);</span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">mySlice</span>(<span class="params">value</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> value.slice(<span class="number">0</span>, <span class="number">4</span>);</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">      el: <span class="string">&quot;#root2&quot;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">          msg: <span class="string">&quot;dnhyxc.github.io&quot;</span>,</span></span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="自定义指令"><a href="#自定义指令" class="headerlink" title="自定义指令"></a>自定义指令</h4><p>1、局部指令定义语法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 写法一</span></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  directives: &#123;</span><br><span class="line">    指令名: <span class="string">&quot;配置对象&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写法二</span></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  指令名: <span class="string">&quot;回调函数&quot;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>2、全局指令：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 写法一</span></span><br><span class="line">Vue.directive(<span class="string">&quot;指令名&quot;</span>, <span class="string">&quot;配置对象&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写法二</span></span><br><span class="line">Vue.directive(<span class="string">&quot;指令名&quot;</span>, <span class="string">&quot;回调函数&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>3、配置对象中常用的 3 个回调：</p>
<ul>
<li><p>bind：在指令与元素成功绑定时调用。</p>
</li>
<li><p>inserted：在指令所在元素被插入页面时调用。</p>
</li>
<li><p>update：在指令所在模版结构被重新解析时调用。</p>
</li>
</ul>
<blockquote>
<p>指令定义时不加 v-，但使用时要加 v-。指令名如果是多个单词，要使用 kebab-case 命名方式，不要用 camelCase 命名。</p>
</blockquote>
<p>4、具体使用方式如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>自定义指令<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>放大10倍后n的值是：<span class="tag">&lt;<span class="name">span</span> <span class="attr">v-big</span>=<span class="string">&quot;n&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;n++&quot;</span>&gt;</span>现身吧input<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-fbind:value</span>=<span class="string">&quot;n&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-fbind-global:value</span>=<span class="string">&quot;n&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 全局指令</span></span></span><br><span class="line"><span class="javascript">    Vue.directive(<span class="string">&quot;fbind-global&quot;</span>, &#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 在指令与元素成功绑定时会被调用</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">bind</span>(<span class="params">element, binding</span>)</span> &#123;</span></span><br><span class="line">        element.value = binding.value;</span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">// 指令所在元素被插入页面时被动用</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">inserted</span>(<span class="params">element, binding</span>)</span> &#123;</span></span><br><span class="line">        element.focus();</span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">// 指令所在的模版被重新解析时被调用</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">update</span>(<span class="params">element, binding</span>)</span> &#123;</span></span><br><span class="line">        element.value = binding.value;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">// 全局指令</span></span></span><br><span class="line"><span class="javascript">    Vue.directive(<span class="string">&quot;big-global&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">element, binding</span>) </span>&#123;</span></span><br><span class="line">      element.innerText = binding.value * 10;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">      el: <span class="string">&quot;#root&quot;</span>,</span></span><br><span class="line">      data: &#123;</span><br><span class="line">        n: 1,</span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">// 注意：指令中的this都是指向window</span></span></span><br><span class="line">      directives: &#123;</span><br><span class="line"><span class="javascript">        <span class="comment">// v-big会在指令与元素成功绑定时会被调用一次（初始化）以及指令所在的模版重新被解析时也会调用</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">big</span>(<span class="params">element, binding</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(element, binding.value);</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="built_in">this</span>); <span class="comment">// window</span></span></span><br><span class="line">          element.innerText = binding.value * 10;</span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        <span class="comment">// 局部指令</span></span></span><br><span class="line">        fbind: &#123;</span><br><span class="line"><span class="javascript">          <span class="comment">// 在指令与元素成功绑定时会被调用</span></span></span><br><span class="line"><span class="javascript">          <span class="function"><span class="title">bind</span>(<span class="params">element, binding</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&quot;bind&quot;</span>);</span></span><br><span class="line">            element.value = binding.value;</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="built_in">this</span>); <span class="comment">// window</span></span></span><br><span class="line">          &#125;,</span><br><span class="line"><span class="javascript">          <span class="comment">// 指令所在元素被插入页面时被动用</span></span></span><br><span class="line"><span class="javascript">          <span class="function"><span class="title">inserted</span>(<span class="params">element, binding</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&quot;inserted&quot;</span>);</span></span><br><span class="line">            element.focus();</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="built_in">this</span>); <span class="comment">// window</span></span></span><br><span class="line">          &#125;,</span><br><span class="line"><span class="javascript">          <span class="comment">// 指令所在的模版被重新解析时被调用</span></span></span><br><span class="line"><span class="javascript">          <span class="function"><span class="title">update</span>(<span class="params">element, binding</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&quot;update&quot;</span>);</span></span><br><span class="line">            element.value = binding.value;</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="built_in">this</span>); <span class="comment">// window</span></span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h4><p>1、常用的生命周期钩子主要有以下两个：</p>
<ul>
<li><p>mounted：其中可发送 ajax 请求、启动定时器、绑定自定义事件、订阅消息等初始化操作。</p>
</li>
<li><p>berforeDestroy：清除定时器、解绑自定义事件、取消订阅消息等收尾工作。</p>
</li>
</ul>
<p>2、关于销毁 Vue 实例：</p>
<ul>
<li><p>销毁后借助 vue 开发者工具看不到任何消息。</p>
</li>
<li><p>销毁后自定义事件会失效，但原生 DOM 事件依然有效。</p>
</li>
<li><p>一般不会在 beforDestory 中操作数据、因为即使操作数据，也不会再触发更新流程了。</p>
</li>
</ul>
<h4 id="VueComponent"><a href="#VueComponent" class="headerlink" title="VueComponent"></a>VueComponent</h4><p>1、vue 中每个组件本质是一个名为 VueComponent 的构造函数，且不失程序员定义的，而是 Vue.extend 生成的。</p>
<p>2、如我们只需要写一个<code>&lt;demo /&gt; 或者 &lt;demo&gt;&lt;demo /&gt;</code>，Vue 解析时就会帮我们创建 school 组件的实例对象，即 Vue 帮我们执行：<code>new VueComponent(options)</code>。</p>
<p>3、特别注意：每次调用 Vue.extend，返回的都是一个全新的 VueComponent。</p>
<p>4、关于 this 的指向：</p>
<ul>
<li><p>组件配置中：data 函数、methods 中的函数、watch 中的函数、computed 中的函数它们的 this 都是 VueComponent 实例对象。</p>
</li>
<li><p>new Vue(options)配置中，data 函数、methods 中的函数、watch 中的函数、computed 中的函数都是指向 Vue 实例对象。</p>
</li>
</ul>
<h4 id="render-函数"><a href="#render-函数" class="headerlink" title="render 函数"></a>render 函数</h4><p>1、vue.js 与 vue.runtime.xxx.js 的区别：</p>
<ul>
<li><p>vue.js 是完整版的 vue，包含核心功能和模板解析器。</p>
</li>
<li><p>vue.runtime.xxx.js 是运行版的 vue，只包含核心功能，没有模板解析器。</p>
</li>
</ul>
<p>2、因为 vue.runtime.xxx.js 没有模板解析器，所以不能使用 template 配置项，需要使用 render 函数接收到的 createElement 函数去指定具体内容。</p>
<h4 id="混合-mixin"><a href="#混合-mixin" class="headerlink" title="混合 mixin"></a>混合 mixin</h4><p>1、混合功能：可以把多个组件共用的配置提取成一个混入对象。</p>
<p>2、混合的定义方式如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mixin = &#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>3、混合的使用，有如下两种方式：</p>
<ul>
<li><p>全局混入：Vue.mixin(xxx)。</p>
</li>
<li><p>局部混入：mixins:[‘mixin1’, ‘mixin2’]。</p>
</li>
</ul>
<p>4、混合具体使用方式：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; mixin1, mixin2 &#125; <span class="keyword">from</span> <span class="string">&quot;../mixin&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;xxx&quot;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">        ...,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mixins:[mixin1, mixin2],</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：在定义 state 属性时，如果组件自身上存在于混合中相同的属性，那么以自身的为准，如果在生命周期中如 mounted 中同时定义了某些方法，那么会将它们进行混合，两者并存，并且会先执行混合中的方法。</p>
</blockquote>
<h4 id="plugins（插件）"><a href="#plugins（插件）" class="headerlink" title="plugins（插件）"></a>plugins（插件）</h4><p>1、定义 plugins.js 文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">install</span>(<span class="params">Vue</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 全局过滤器</span></span><br><span class="line">    Vue.filter(<span class="string">&quot;mySlice&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> value.slice(<span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 定义全局指令</span></span><br><span class="line">    Vue.directive(<span class="string">&quot;fbind&quot;</span>, &#123;</span><br><span class="line">      <span class="function"><span class="title">bind</span>(<span class="params">element, binding</span>)</span> &#123;</span><br><span class="line">        element.value = binding.value;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="title">inserted</span>(<span class="params">element, binding</span>)</span> &#123;</span><br><span class="line">        element.focus();</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="title">update</span>(<span class="params">element, binding</span>)</span> &#123;</span><br><span class="line">        element.value = binding.value;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 定义混入</span></span><br><span class="line">    Vue.mixin(&#123;</span><br><span class="line">      <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          x: <span class="number">100</span>,</span><br><span class="line">          y: <span class="number">200</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在原型上定义方法</span></span><br><span class="line">    Vue.prototype.hello = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;我是Vue原型上的方法&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>2、应用 plugins：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> plugins <span class="keyword">from</span> <span class="string">&#x27;./plugins</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Vue.config.productionTip = false</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 应用 plugins</span></span><br><span class="line"><span class="string">Vue.use(plugins)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">new Vue(&#123;</span></span><br><span class="line"><span class="string">  el: &#x27;</span>#app<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">  render: h =&gt; h(App)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br></pre></td></tr></table></figure>
<p>3、在组件中使用 plugins 中定义的全局指令，过滤器等：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 应用全局过滤器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>名字：&#123;&#123;name | mySlice&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用mixin混合 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>x：&#123;&#123;x&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>y：&#123;&#123;y&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 应用全局指令 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-fbind:value</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;“test”&quot;</span>&gt;</span>测试hello方法<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;xxx&quot;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        name: <span class="string">&quot;xxx&quot;</span>,</span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">test</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 调用plugins中定义在原型上的方法</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.hello();</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="自定义事件"><a href="#自定义事件" class="headerlink" title="自定义事件"></a>自定义事件</h4><p>1、自定义事件说明：</p>
<ul>
<li><p>自定义事件是一种组件间通信的方式，适用于：<strong>子组件像父组件传递数据</strong>。</p>
</li>
<li><p>使用场景：A 是父组件，B 是子组件，B 想给 A 传递数据，那么就要在 A 中给 B 绑定自定义事件（事件的回调在 A 中）。</p>
</li>
<li><p>绑定自定义事件的方式：</p>
<ul>
<li><p>方式一：在父组件中：<code>&lt;Demo @demo=&quot;demo&quot; /&gt;</code> 或 <code>&lt;Demo v-on:demo=&quot;demo&quot; /&gt;</code></p>
</li>
<li><p>方式二：在父组件中：</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Demo</span> <span class="attr">ref</span>=<span class="string">&quot;demo&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line"></span><br><span class="line">mounted()&#123; this.$refs.demo.$on(&#x27;xxx&#x27;, () =&gt; &#123;</span><br><span class="line"><span class="comment">&lt;!-- do something... --&gt;</span></span><br><span class="line">&#125;) &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>如果想让自定义事件只能触发一次，可以使用 once 修饰符，或者 $once 方法。</li>
</ul>
</li>
<li><p>触发自定义事件：<code>this.$emit(&#39;xxx&#39;, data)</code>。</p>
</li>
<li><p>解绑自定义事件：<code>this.$off(&#39;xxx&#39;)</code>。</p>
</li>
<li><p>组件上也可以绑定原生 DOM 事件，需要使用 native 修饰符。</p>
</li>
<li><p>注意：通过 <code>this.$refs.xxx.$on(&#39;xxx&#39;, 回调)</code> 绑定自定义事件时，回调要么配置在 methods 中，要么就用箭头函数，否则 this 指向会出现问题。</p>
</li>
</ul>
<p>2、自定义事件具体写法：</p>
<ul>
<li>App 组件</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 通过父组件给子组件传递函数类型的的props实现：子给父传递数据 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">School</span> <span class="attr">:getSchoolName</span>=<span class="string">&quot;getSchoolName&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 通过父组件给子组建绑定一个自定义事件实现：子给父传递数据（第一种写法，使用@或者v-on） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Student</span> @<span class="attr">getName</span>=<span class="string">&quot;getStudentName&quot;</span> <span class="attr">v-on:demo</span>=<span class="string">&quot;demo&quot;</span> @<span class="attr">test</span>=<span class="string">&quot;test&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">      通过父组件给子组建绑定一个自定义事件实现：子给父传递数据（第二种写法，使用ref，该写法比第一种写法更加灵活），</span></span><br><span class="line"><span class="comment">      如果需要给组件绑定原生事件需要给事件加上native修饰符</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Teacher</span> <span class="attr">ref</span>=<span class="string">&quot;teacher&quot;</span> @<span class="attr">click.native</span>=<span class="string">&quot;show&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Student <span class="keyword">from</span> <span class="string">&quot;./components/Student&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> School <span class="keyword">from</span> <span class="string">&quot;./components/School&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Teacher <span class="keyword">from</span> <span class="string">&quot;./components/Teacher&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;app&quot;</span>,</span></span><br><span class="line">    components: &#123;</span><br><span class="line">      School,</span><br><span class="line">      Student,</span><br><span class="line">      Teacher</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        msg: <span class="string">&quot;hello&quot;</span>,</span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods:&#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">getSchoolName</span>(<span class="params">name</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&#x27;App收到了学校名：&#x27;</span>，name)</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">getStudentName</span>(<span class="params">name</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&#x27;App收到了学生名：&#x27;</span>，name)</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">demo</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&#x27;demo触发了&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#x27;</span>)</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">test</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&#x27;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;test触发了&#x27;</span>)</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">show</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        alert(<span class="string">&#x27;原生事件click触发了&#x27;</span>)</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 该写法可以规定事件绑定的时机，比如在组件渲染完成后延迟5秒再绑定该事件</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$refs.teacher.$on(<span class="string">&#x27;getName&#x27;</span>, <span class="built_in">this</span>.getTeacherName)</span></span><br><span class="line">      /*</span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$refs.teacher.$on(<span class="string">&#x27;getName&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="built_in">this</span>) <span class="comment">// 当前this指向Student实例对象，并不是指向App的实例对象，可以通过箭头函数接解决该this指向问题</span></span></span><br><span class="line">      &#125;)</span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$refs.teacher.$on(<span class="string">&#x27;getName&#x27;</span>, <span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="built_in">this</span>) <span class="comment">// 当前this指向App实例对象</span></span></span><br><span class="line">      &#125;)</span><br><span class="line">      */</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用 ref 实现自定义事件时，绑定的回调需要注意 this 指向问题，最好在 methods 中先定义好回调，或者使用箭头函数。<br>如果要给组件绑定原生事件（如：click），需要给事件加上 native 修饰符，否则将被视为自定义事件，需要在被绑定的组件中使用$emit 触发该事件。</p>
</blockquote>
<ul>
<li>School 组件</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;school&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>学校姓名：&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;sendStudentName&quot;</span>&gt;</span>把名字给App组件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;school&quot;</span>,</span></span><br><span class="line"><span class="javascript">    props: [<span class="string">&quot;getSchoolName&quot;</span>],</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        name: <span class="string">&quot;dnhyxc&quot;</span>,</span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">sendSchoolName</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 触发Student组件实例身上的getName事件</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.getSchoolName(<span class="built_in">this</span>.name);</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Student 组件</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>学生姓名：&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>学生数量：&#123;&#123;number&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>number++<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;sendStudentName&quot;</span>&gt;</span>把名字给App组件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;demo&quot;</span>&gt;</span>触发App组件demo方法<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;test&quot;</span>&gt;</span>触发App组件test方法<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;unbind&quot;</span>&gt;</span>解绑getName自定义事件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;unbindAll&quot;</span>&gt;</span>批量解绑自定义事件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;kill&quot;</span>&gt;</span>销毁当前Student组件的实例（vc）<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;student&quot;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        name: <span class="string">&quot;张三&quot;</span>,</span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">add</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&#x27;add 方法被调用&#x27;</span>)</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.numbner++</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">sendStudentName</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 触发Student组件实例身上的getName事件</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$emit(<span class="string">&quot;getName&quot;</span>, <span class="built_in">this</span>.name);</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">demo</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$emit(<span class="string">&quot;demo&quot;</span>);</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">test</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$emit(<span class="string">&quot;test&quot;</span>);</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">unbind</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 解绑单个事件</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$off(<span class="string">&#x27;getName&#x27;</span>)</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">unbindAll</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 解绑多个事件</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$off([<span class="string">&#x27;demo&#x27;</span>,<span class="string">&#x27;test&#x27;</span>])</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">kill</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 销毁了当前Student组件的实例，销毁后所有Student实例的自定义事件全部不奏效</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$destroy()</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Teacher 组件</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;teacher&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>学生姓名：&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;sendTeacherName&quot;</span>&gt;</span>把名字给App组件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;teacher&quot;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        name: <span class="string">&quot;snsn&quot;</span>,</span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">sendTeacherName</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 触发Student组件实例身上的getName事件</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$emit(<span class="string">&quot;getName&quot;</span>, <span class="built_in">this</span>.name);</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="全局事件总线"><a href="#全局事件总线" class="headerlink" title="全局事件总线"></a>全局事件总线</h4><p>1、全局事件总线是一种组件通信的方式，适用于任意组件间的通信。</p>
<p>2、安装全局事件总线：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="function"><span class="title">beforeCreate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 安装全局事件总线，$bus就是当前应用的vm</span></span><br><span class="line">    Vue.prototype.$bus = <span class="built_in">this</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>3、使用事件总线：</p>
<ul>
<li>接收数据：A 组件想接收数据，则在 A 组件中给 $bus 绑定自定义事件，事件的回调留在 A 组件自身。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">mothods</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="function"><span class="title">demo</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.$bus.$on(<span class="string">&#x27;xxx&#x27;</span>,<span class="built_in">this</span>.demo)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>提供数据：<code>this.$bus.$emit(&#39;xxx&#39;, data)</code></li>
</ul>
<p>4、最好在 <strong>beforeDestroy</strong> 生命周期钩子中，用 <code>$off</code> <strong>解绑当前组件所用到的</strong>事件。</p>
<p>5、事件总线具体使用：</p>
<ul>
<li>main.js</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;./App.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&quot;#app&quot;</span>,</span><br><span class="line">  render: <span class="function">(<span class="params">h</span>) =&gt;</span> h(App),</span><br><span class="line">  <span class="function"><span class="title">beforeCreate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 安装全局事件总线</span></span><br><span class="line">    Vue.prototype.$bus = <span class="built_in">this</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>Student.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>学生姓名：&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;sendStudentName&quot;</span>&gt;</span>把名字给App组件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;student&quot;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        name: <span class="string">&quot;张三&quot;</span>,</span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">sendStudentName</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$bus.$emit(<span class="string">&quot;test&quot;</span>, <span class="built_in">this</span>.name);</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>School.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;school&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>学校姓名：&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;sendStudentName&quot;</span>&gt;</span>把名字给App组件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;school&quot;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        name: <span class="string">&quot;dnhyxc&quot;</span>,</span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$bus.$on(<span class="string">&quot;test&quot;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;收到了Student组件中传递过来的数据&quot;</span>, data);</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">beforeDestory</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$bus.$off(<span class="string">&quot;test&quot;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="nextTick"><a href="#nextTick" class="headerlink" title="nextTick"></a>nextTick</h4><p>1、语法：<code>this.$nextTick(callback)</code>。</p>
<p>2、作用：在下一次 DOM 更新结束后再执行其指定的回调。</p>
<p>3、使用时机：当改变数据后，要基于更新后新的 DOM 元素进行某些操作时，要在 nextTick 所指定的回调函数中执行。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">methods () &#123;</span><br><span class="line">  handleEdit (todo) &#123;</span><br><span class="line">    <span class="keyword">if</span> (todo.hasOwnProperty(<span class="string">&#x27;isEdit&#x27;</span>)) &#123;</span><br><span class="line">      todo.isEdit = <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.$nextTick(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 必须要在组件挂在完毕获取焦点才能生效，所以需要放在nextTick中执行</span></span><br><span class="line">      <span class="built_in">this</span>.$refs.inputTitle.focus()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="slot-插槽"><a href="#slot-插槽" class="headerlink" title="slot 插槽"></a>slot 插槽</h4><p>1、slot 默认插槽的基本使用方式：</p>
<ul>
<li>App.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Category</span> <span class="attr">title</span>=<span class="string">&quot;美食&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;xxx&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Category</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Category</span> <span class="attr">title</span>=<span class="string">&quot;美食&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(i, index) in xxx&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span>&#123;&#123;i&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Category</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Category</span> <span class="attr">title</span>=<span class="string">&quot;美食&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">video</span> <span class="attr">controls</span> <span class="attr">src</span>=<span class="string">&quot;xxx&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Category</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Category.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;category&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123;title&#125;&#125;分类<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义一个插槽（挖坑，等使用者填坑） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span>我是默认值，使用者没传结构是，我就会出现，否则隐身<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2、具名插槽的基本使用：</p>
<ul>
<li>App.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Category</span> <span class="attr">title</span>=<span class="string">&quot;美食&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 使用slot属性表明需要往哪个插槽中追加结构 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">slot</span>=<span class="string">&quot;center&quot;</span> <span class="attr">src</span>=<span class="string">&quot;xxx&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">slot</span>=<span class="string">&quot;footer&quot;</span> <span class="attr">href</span>=<span class="string">&quot;xxx&quot;</span>&gt;</span>更多美食<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Category</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Category</span> <span class="attr">title</span>=<span class="string">&quot;美食&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">slot</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(i, index) in xxx&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span>&#123;&#123;i&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;xxx&quot;</span>&gt;</span>手机游戏<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;xxx&quot;</span>&gt;</span>网络游戏<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Category</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Category</span> <span class="attr">title</span>=<span class="string">&quot;美食&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">video</span> <span class="attr">slot</span>=<span class="string">&quot;center&quot;</span> <span class="attr">controls</span> <span class="attr">src</span>=<span class="string">&quot;xxx&quot;</span> /&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 注意：v-slot:slotNmae 只能配合template标签一起使用 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:footer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;foot&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;xxx&quot;</span>&gt;</span>经典<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;xxx&quot;</span>&gt;</span>热门<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;xxx&quot;</span>&gt;</span>推荐<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>欢迎前来观影<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Category</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Category.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;category&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123;title&#125;&#125;分类<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义一个插槽（挖坑，等使用者填坑） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">      我是默认值，使用者没传结构是，我就会出现，否则隐身1</span><br><span class="line">    <span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span><br><span class="line">      我是默认值，使用者没传结构是，我就会出现，否则隐身2</span><br><span class="line">    <span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3、作用域插槽理解：<strong>数据在组件自身，但根据数据生成的结构需要组件的使用者来决定</strong>（games 数据在 Category 组件中，但使用数据所遍历出来的结构由 App 组件决定）。具体使用如下：</p>
<ul>
<li>App.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Category</span> <span class="attr">title</span>=<span class="string">&quot;游戏&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">scope</span>=<span class="string">&quot;data&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(i, index) in data.games&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span>&#123;&#123;i&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Category</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Category</span> <span class="attr">title</span>=<span class="string">&quot;游戏&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 使用解构 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">scope</span>=<span class="string">&quot;&#123;games&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(i, index) in games&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span>&#123;&#123;i&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Category</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Category</span> <span class="attr">title</span>=<span class="string">&quot;游戏&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- slot-scope 等价于 scope --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;&#123;games&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span> <span class="attr">v-for</span>=<span class="string">&quot;(i, index) in games&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span>&#123;&#123;i&#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Category</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Category.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;category&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义一个插槽（挖坑，等使用者填坑） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">:games</span>=<span class="string">&quot;games&quot;</span>&gt;</span></span><br><span class="line">      我是默认值，使用者没传结构是，我就会出现，否则隐身1</span><br><span class="line">    <span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;Category&quot;</span>,</span></span><br><span class="line"><span class="javascript">    props: [<span class="string">&quot;title&quot;</span>],</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        games: [<span class="string">&quot;xx&quot;</span>, <span class="string">&quot;xxx&quot;</span>, <span class="string">&quot;xxxx&quot;</span>, <span class="string">&quot;xxxxx&quot;</span>],</span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Vuex"><a href="#Vuex" class="headerlink" title="Vuex"></a>Vuex</h3><h4 id="注册-store"><a href="#注册-store" class="headerlink" title="注册 store"></a>注册 store</h4><ul>
<li>main.js</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;./App.vue&quot;</span>;</span><br><span class="line"><span class="comment">// import Vuex from &quot;vuex&quot;;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;./store&quot;</span>;</span><br><span class="line"></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Vue规定，必须在创建store之前use Vuex，因此不能在此处use Vuex，否则会报错，因此需要在store/index中use vuex</span></span><br><span class="line"><span class="comment">// Vue.use(Vuex);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&quot;App&quot;</span>,</span><br><span class="line">  render: <span class="function">(<span class="params">h</span>) =&gt;</span> h(App),</span><br><span class="line">  store,</span><br><span class="line">  <span class="function"><span class="title">beforeCreate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    Vue.prototype.$bus = <span class="built_in">this</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="创建-store"><a href="#创建-store" class="headerlink" title="创建 store"></a>创建 store</h4><ul>
<li>store/index</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(Vuex);</span><br><span class="line"></span><br><span class="line"><span class="comment">// action：用于响应组件中的动作</span></span><br><span class="line"><span class="keyword">const</span> action = &#123;</span><br><span class="line">  <span class="function"><span class="title">increment</span>(<span class="params">context, value</span>)</span> &#123;</span><br><span class="line">    context.commit(<span class="string">&quot;INCREMENT&quot;</span>, value);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">decrement</span>(<span class="params">context, value</span>)</span> &#123;</span><br><span class="line">    context.commit(<span class="string">&quot;DECREMENT&quot;</span>, value);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">incrementOdd</span>(<span class="params">context, value</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (context.state.sum % <span class="number">2</span>) &#123;</span><br><span class="line">      context.commit(<span class="string">&quot;INCREMENT&quot;</span>, value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">incrementWait</span>(<span class="params">context, value</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      context.commit(<span class="string">&quot;INCREMENT&quot;</span>, value);</span><br><span class="line">    &#125;, <span class="number">500</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mutations：用于操作数据</span></span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  <span class="function"><span class="title">INCREMENT</span>(<span class="params">state, value</span>)</span> &#123;</span><br><span class="line">    state.sum += value;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">DECREMENT</span>(<span class="params">state, value</span>)</span> &#123;</span><br><span class="line">    state.sum -= value;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">ADD_PERSONS</span>(<span class="params">state, value</span>)</span> &#123;</span><br><span class="line">    state.personList.unshift(value);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// state：用于存储数据</span></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  sum: <span class="number">0</span>,</span><br><span class="line">  name: <span class="string">&quot;dnhyxc&quot;</span>,</span><br><span class="line">  age: <span class="string">&quot;18&quot;</span>,</span><br><span class="line">  personList: [&#123; <span class="attr">id</span>: <span class="string">&quot;001&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;snsn&quot;</span> &#125;],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getters: 用于将state中的数值进行加工</span></span><br><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">  <span class="function"><span class="title">bigSum</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> state.sum * <span class="number">10</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">smallSum</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> state.sum / <span class="number">10</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  action,</span><br><span class="line">  mutations,</span><br><span class="line">  state,</span><br><span class="line">  getters,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="使用-Vuex-中存储的-state"><a href="#使用-Vuex-中存储的-state" class="headerlink" title="使用 Vuex 中存储的 state"></a>使用 Vuex 中存储的 state</h4><ul>
<li>App.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Count</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Person</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Count <span class="keyword">from</span> <span class="string">&quot;./components/Count&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Person <span class="keyword">from</span> <span class="string">&quot;./components/Person&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;App&quot;</span>,</span></span><br><span class="line"><span class="javascript">    components: [<span class="string">&quot;Count&quot;</span>, <span class="string">&quot;Person&quot;</span>],</span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>count.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>当前求和为：&#123;&#123;$store.state.sum&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>当前求和放大10倍为：&#123;&#123;$store.getters.bigSum&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">v-model.number</span>=<span class="string">&quot;n&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;increment&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;decrement&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;incrementOdd&quot;</span>&gt;</span>当前求和为奇数在加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;incrementWait&quot;</span>&gt;</span>等一等再加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;Count&quot;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">        n: 1,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">increment</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 触发action写法</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$store.dispatch(<span class="string">&quot;increment&quot;</span>, <span class="built_in">this</span>.n);</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">decrement</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 不触发action，直接触发mutations写法：如果操作的数据不是异步的，可以直接触发mutations进行操作数据</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$store.commit(<span class="string">&quot;DECREMENT&quot;</span>, <span class="built_in">this</span>.n);</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">incrementOdd</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$store.dispatch(<span class="string">&quot;incrementOdd&quot;</span>, <span class="built_in">this</span>.n);</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">incrementWait</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$store.dispatch(<span class="string">&quot;incrementWait&quot;</span>, <span class="built_in">this</span>.n);</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="mapState、mapGetters、mapMutations、mapActions"><a href="#mapState、mapGetters、mapMutations、mapActions" class="headerlink" title="mapState、mapGetters、mapMutations、mapActions"></a>mapState、mapGetters、mapMutations、mapActions</h4><p>1、<strong>mapState</strong> 方法：用于映射 state 中的数据为计算属性。</p>
<p>2、<strong>mapGetters</strong> 方法：用于映射 getters 中的数据为计算属性。</p>
<p>3、<strong>mapMutations</strong> 方法：用于生成与 mutations 对话的方法，即：包含 $store.commit(xxx) 的函数。</p>
<p>4、<strong>mapActions</strong> 方法：用于生成与 actions 对话的方法，即：包含 $store.dispatch(xxx) 的函数。</p>
<p>5、具体使用方式如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>当前求和为：&#123;&#123;sum&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>当前求和放大10倍为：&#123;&#123;bigSum&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>当前求和缩小10倍为：&#123;&#123;smallSum&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h4</span>&gt;</span>姓名：&#123;&#123;name&#125;&#125;，年龄：&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">v-model.number</span>=<span class="string">&quot;n&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;increment(n)&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;DECREMENT(n)&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;incrementOdd(n)&quot;</span>&gt;</span>当前求和为奇数在加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;incrementWait(n)&quot;</span>&gt;</span>等一等再加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123;mapState, mapGetters, mapMutations, mapActions&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;Count&quot;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">        n: 1,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="comment">// 借助mapMutations（对象写法）生成对应的方法，方法中会调用commit去联系mutations。注意，需要在点击事件（increment(n)、decrement(n)）中手动传递需要相加的参数n</span></span></span><br><span class="line"><span class="javascript">      ...mapMutations(&#123;<span class="attr">increment</span>:<span class="string">&#x27;INCREMENT&#x27;</span>&#125;),</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 借助mapMutations（数组写法）生成对应的方法，注意：点击事件方法名需要改成与mutations中设定的相减的方法名一致，都为DECREMENT</span></span></span><br><span class="line"><span class="javascript">      ...mapMutations([<span class="string">&#x27;DECREMENT&#x27;</span>]),</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 使用mapActions（对象写法）生成对应的方法，方法中会调用dispatch去联系actions。注意，需要在点击事件（incrementOdd(n)、incrementWait(n)）中手动传递需要相加的参数n</span></span></span><br><span class="line"><span class="javascript">      ...mapActions(&#123;<span class="attr">incrementOdd</span>:<span class="string">&#x27;incrementOdd&#x27;</span>&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 使用mapActions（数组写法）生成对应的方法，注意：点击事件方法名需要改成与actions中设定的对应的方法名一致，都为incrementWait</span></span></span><br><span class="line"><span class="javascript">      ...mapActions([<span class="string">&#x27;incrementWait&#x27;</span>])</span></span><br><span class="line">    &#125;,</span><br><span class="line">    computed:&#123;</span><br><span class="line"><span class="javascript">      <span class="comment">// 使用mapState（对象写法）生成计算属性，从state中读取数据</span></span></span><br><span class="line"><span class="javascript">      ...mapState(&#123;<span class="attr">sum</span>:<span class="string">&quot;sum&quot;</span>, <span class="attr">name</span>:<span class="string">&quot;name&quot;</span>&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 使用mapState（数组写法）生成计算属性，从state中读取数据</span></span></span><br><span class="line"><span class="javascript">      ...mapState([<span class="string">&#x27;age&#x27;</span>])</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// mapGetters 对象写法</span></span></span><br><span class="line"><span class="javascript">      ...mapGetters(&#123;<span class="attr">bigSum</span>:<span class="string">&quot;bigSum&quot;</span>&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// mapGetters 数组写法</span></span></span><br><span class="line"><span class="javascript">      ...mapGetters([<span class="string">&quot;smallSum&quot;</span>])</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="使用-vuex-实现数据共享"><a href="#使用-vuex-实现数据共享" class="headerlink" title="使用 vuex 实现数据共享"></a>使用 vuex 实现数据共享</h4><ul>
<li>Count.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>当前求和为：&#123;&#123;sum&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>当前求和放大10倍为：&#123;&#123;bigSum&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>当前求和缩小10倍为：&#123;&#123;smallSum&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h4</span>&gt;</span>姓名：&#123;&#123;name&#125;&#125;，年龄：&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Person组件中人员列表总人数为：&#123;&#123;personList.length&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">v-model.number</span>=<span class="string">&quot;n&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;increment(n)&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;decrement(n)&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;incrementOdd(n)&quot;</span>&gt;</span>当前求和为奇数在加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;incrementWait(n)&quot;</span>&gt;</span>等一等再加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123;mapState, mapGetters, mapMutations, mapActions&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;Count&quot;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">        n: 1,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      ...mapMutations(&#123;<span class="attr">increment</span>:<span class="string">&#x27;INCREMENT&#x27;</span>,<span class="attr">decrement</span>:<span class="string">&#x27;DECREMENT&#x27;</span>&#125;),</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      ...mapActions(&#123;<span class="attr">incrementOdd</span>:<span class="string">&#x27;incrementOdd&#x27;</span>,<span class="attr">incrementWait</span>:<span class="string">&#x27;incrementWait&#x27;</span>&#125;)</span></span><br><span class="line">    &#125;,</span><br><span class="line">    computed:&#123;</span><br><span class="line"><span class="javascript">      ...mapState([<span class="string">&#x27;sum&#x27;</span>,<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;age&#x27;</span>,<span class="string">&#x27;personList&#x27;</span>])</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      ...mapGetters([<span class="string">&#x27;bigSum&#x27;</span>,<span class="string">&#x27;smallSum&#x27;</span>])</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Person.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;person&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>人员列表<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入名字&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addPerson&quot;</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;i in personList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i.id&quot;</span>&gt;</span>&#123;&#123;i.name&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Count组件求和为：&#123;&#123;sum&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;Person&quot;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        name: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="comment">// 不使用mapMutations写法，手动使用methods写法</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">addPerson</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> personObj = &#123; <span class="attr">id</span>: <span class="built_in">Math</span>.random(), <span class="attr">name</span>: <span class="built_in">this</span>.name &#125;;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$store.commit(<span class="string">&quot;ADD_PERSONS&quot;</span>, personObj);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.name = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    computed: &#123;</span><br><span class="line"><span class="javascript">      <span class="comment">// 不使用mapState，手动使用计算属性写法</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">personList</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="built_in">this</span>.$store.state.personList;</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">sum</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="built_in">this</span>.$store.state.sum;</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="store-模块化写法"><a href="#store-模块化写法" class="headerlink" title="store 模块化写法"></a>store 模块化写法</h4><ul>
<li>store/index</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> countOptions <span class="keyword">from</span> <span class="string">&quot;./count&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> personOptions <span class="keyword">from</span> <span class="string">&quot;./person&quot;</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(Vuex);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  modules: &#123;</span><br><span class="line">    countAbout: countOptions,</span><br><span class="line">    personAbout: personOptions,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>store/count</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 开启命名空间。使modules中声明的不同options名称能被mapState、mapMutations等识别</span></span><br><span class="line">  namespaced: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="function"><span class="title">incrementOdd</span>(<span class="params">context, value</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (context.state.sum % <span class="number">2</span>) &#123;</span><br><span class="line">        context.commit(<span class="string">&quot;INCREMENT&quot;</span>, value);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">incrementWait</span>(<span class="params">context, value</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        context.commit(<span class="string">&quot;INCREMENT&quot;</span>, value);</span><br><span class="line">      &#125;, <span class="number">500</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  mutations: &#123;</span><br><span class="line">    <span class="function"><span class="title">INCREMENT</span>(<span class="params">state, value</span>)</span> &#123;</span><br><span class="line">      state.sum += value;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">DECREMENT</span>(<span class="params">state, value</span>)</span> &#123;</span><br><span class="line">      state.sum -= value;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  state: &#123;</span><br><span class="line">    sum: <span class="number">0</span>,</span><br><span class="line">    name: <span class="string">&quot;dnhyxc&quot;</span>,</span><br><span class="line">    age: <span class="string">&quot;18&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  getters: &#123;</span><br><span class="line">    <span class="function"><span class="title">bigSum</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> state.sum * <span class="number">10</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">smallSum</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> state.sum / <span class="number">10</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>store/person</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 开启命名空间。使modules中声明的不同options名称能被mapState、mapMutations等识别</span></span><br><span class="line">  namespaced: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="function"><span class="title">addPersonZhu</span>(<span class="params">context, value</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (value.name.indexOf(<span class="string">&quot;诸&quot;</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">        context.commit(<span class="string">&quot;ADD_PERSONS&quot;</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        alert(<span class="string">&quot;添加的人必须姓诸&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">addPersonServer</span>(<span class="params">context</span>)</span> &#123;</span><br><span class="line">      axios.get(<span class="string">&quot;http://api.uixsj.cn/hitokoto/get?type=social&quot;</span>).then(</span><br><span class="line">        (response) =&gt; &#123;</span><br><span class="line">          context.commit(<span class="string">&quot;ADD_PERSON&quot;</span>, &#123;</span><br><span class="line">            id: <span class="built_in">Math</span>.random(),</span><br><span class="line">            name: response.data,</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        (error) =&gt; &#123;</span><br><span class="line">          alert(error.message);</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  mutations: &#123;</span><br><span class="line">    <span class="function"><span class="title">ADD_PERSONS</span>(<span class="params">state, value</span>)</span> &#123;</span><br><span class="line">      state.personList.unshift(value);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  state: &#123;</span><br><span class="line">    personList: [&#123; <span class="attr">id</span>: <span class="string">&quot;001&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;snsn&quot;</span> &#125;],</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  getters: &#123;</span><br><span class="line">    <span class="function"><span class="title">firstPersonName</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> state.personList[<span class="number">0</span>].name;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="组件中如何使用模块化的-store"><a href="#组件中如何使用模块化的-store" class="headerlink" title="组件中如何使用模块化的 store"></a>组件中如何使用模块化的 store</h4><p>1、借助 mapState、mapAction、mapMutations、mapGetters 实现模块化写法：</p>
<ul>
<li>Count.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>当前求和为：&#123;&#123;sum&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>当前求和放大10倍为：&#123;&#123;bigSum&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>当前求和缩小10倍为：&#123;&#123;smallSum&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h4</span>&gt;</span>姓名：&#123;&#123;name&#125;&#125;，年龄：&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Person组件中人员列表总人数为：&#123;&#123;personList.length&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">v-model.number</span>=<span class="string">&quot;n&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;increment(n)&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;decrement(n)&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;incrementOdd(n)&quot;</span>&gt;</span>当前求和为奇数在加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;incrementWait(n)&quot;</span>&gt;</span>等一等再加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123;mapState, mapGetters, mapMutations, mapActions&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;Count&quot;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">        n: 1,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="comment">// 只有在store对应的options中开启了命名空间（namespaced:true）之后，才能识别到countAbout</span></span></span><br><span class="line"><span class="javascript">      ...mapMutations(<span class="string">&#x27;countAbout&#x27;</span>,&#123;<span class="attr">increment</span>:<span class="string">&#x27;INCREMENT&#x27;</span>,<span class="attr">decrement</span>:<span class="string">&#x27;DECREMENT&#x27;</span>&#125;),</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      ...mapActions(<span class="string">&#x27;countAbout&#x27;</span>,&#123;<span class="attr">incrementOdd</span>:<span class="string">&#x27;incrementOdd&#x27;</span>,<span class="attr">incrementWait</span>:<span class="string">&#x27;incrementWait&#x27;</span>&#125;)</span></span><br><span class="line">    &#125;,</span><br><span class="line">    computed:&#123;</span><br><span class="line"><span class="javascript">      <span class="comment">// 只有在store对应的options中开启了命名空间（namespaced:true）之后，才能识别到countAbout</span></span></span><br><span class="line"><span class="javascript">      ...mapState(<span class="string">&#x27;countAbout&#x27;</span>,[<span class="string">&#x27;sum&#x27;</span>,<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;age&#x27;</span>])</span></span><br><span class="line"><span class="javascript">      ...mapState(<span class="string">&#x27;personAbout&#x27;</span>,[<span class="string">&#x27;personList&#x27;</span>])</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      ...mapGetters(<span class="string">&#x27;countAbout&#x27;</span>,[<span class="string">&#x27;bigSum&#x27;</span>,<span class="string">&#x27;smallSum&#x27;</span>])</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2、不借助 mapState、mapAction、mapMutations、mapGetters 手动实现模块化写法（调用 dispatch、mutations 等）：</p>
<ul>
<li>Person.vue 模块化写法</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;person&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>人员列表<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>列表中第一个人的名字是：&#123;&#123;firstPersonName&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入名字&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addPerson&quot;</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addPersonOfZhu&quot;</span>&gt;</span>添加名称为诸的人<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addPersonServer&quot;</span>&gt;</span>添加随机的人<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;i in personList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i.id&quot;</span>&gt;</span>&#123;&#123;i.name&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Count组件求和为：&#123;&#123;sum&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;Person&quot;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        name: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="comment">// 不使用mapMutations写法，手动使用methods写法</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">addPerson</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> personObj = &#123; <span class="attr">id</span>: <span class="built_in">Math</span>.random(), <span class="attr">name</span>: <span class="built_in">this</span>.name &#125;;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$store.commit(<span class="string">&quot;personAbout/ADD_PERSONS&quot;</span>, personObj);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.name = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 不适用mapAction，手动使用methods写法</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">addPersonOfZhu</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> personObj = &#123; <span class="attr">id</span>: <span class="built_in">Math</span>.random(), <span class="attr">name</span>: <span class="built_in">this</span>.name &#125;;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$store.dispatch(<span class="string">&quot;personAbout/addPersonZhu&quot;</span>, personObj);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.name = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">addPersonServer</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$store.dispatch(<span class="string">&quot;personAbout/addPersonServer&quot;</span>);</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    computed: &#123;</span><br><span class="line"><span class="javascript">      <span class="comment">// 不使用mapState，手动使用计算属性写法</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">personList</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="built_in">this</span>.$store.state.personAbout.personList;</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">sum</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="built_in">this</span>.$store.state.countAbout.sum;</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      <span class="comment">// 手动读取getters中的计算属性写法</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">firstPersonName</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="built_in">this</span>.$store.getters[<span class="string">&quot;personAbout/firstPersonName&quot;</span>];</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><h4 id="vue-router-的理解"><a href="#vue-router-的理解" class="headerlink" title="vue-router 的理解"></a>vue-router 的理解</h4><p>1、vue 中的一个插件库，专门用来实现 SPA 应用。</p>
<h4 id="路由的理解"><a href="#路由的理解" class="headerlink" title="路由的理解"></a>路由的理解</h4><p>1、什么是路由：</p>
<ul>
<li><p>一个路由就是一组映射关系（key-value）。</p>
</li>
<li><p>key 为路径、value 可能是 function 或 component。</p>
</li>
</ul>
<h4 id="路由分类"><a href="#路由分类" class="headerlink" title="路由分类"></a>路由分类</h4><h5 id="后端路由"><a href="#后端路由" class="headerlink" title="后端路由"></a>后端路由</h5><p>1、后端路由理解：value 是 function，用于处理客户端提交的请求。</p>
<p>2、工作过程：服务器收到一个请求时，根据请求路径找到匹配的函数来处理请求，返回响应数据。</p>
<h5 id="前端路由"><a href="#前端路由" class="headerlink" title="前端路由"></a>前端路由</h5><p>1、前端路由理解：value 是 component，用于展示页面内容。</p>
<p>2、工作过程：当浏览器的路径改变时，对应的组件就会显示。</p>
<h4 id="基本路由"><a href="#基本路由" class="headerlink" title="基本路由"></a>基本路由</h4><p>1、安装 vue-router，命令：<code>npm i vue-router -S</code>。</p>
<p>2、应用插件：<code>Vue.use(VueRouter)</code>。</p>
<p>3、编写 router 配置项：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./components/Home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> About <span class="keyword">from</span> <span class="string">&quot;./components/About&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&quot;/about&quot;</span>,</span><br><span class="line">      component: About,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">      component: Home,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure>
<p>4、实现切换（active-class 可配置高亮样式）：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">active-class</span>=<span class="string">&quot;active&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">active-class</span>=<span class="string">&quot;active&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span>&gt;</span>About<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>5、指定展示位置：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>6、基本使用方式如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Banner</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用router-link标签实现路由的切换 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">class</span>=<span class="string">&quot;link-item&quot;</span> <span class="attr">active-class</span>=<span class="string">&quot;active&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span>&gt;</span></span><br><span class="line">          Home</span><br><span class="line">        <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">class</span>=<span class="string">&quot;link-item&quot;</span> <span class="attr">active-class</span>=<span class="string">&quot;active&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span>&gt;</span></span><br><span class="line">          About</span><br><span class="line">        <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel-body&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 指定组件的呈现位置 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Banner <span class="keyword">from</span> <span class="string">&quot;./components/Banner&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;App&quot;</span>,</span></span><br><span class="line">    components: &#123;</span><br><span class="line">      Banner,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="嵌套（多级）路由"><a href="#嵌套（多级）路由" class="headerlink" title="嵌套（多级）路由"></a>嵌套（多级）路由</h4><p>1、配置路由规则，使用 children 配置项：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&quot;/about&quot;</span>,</span><br><span class="line">      component: About,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">      component: Home,</span><br><span class="line">      children: [</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">&quot;news&quot;</span>,</span><br><span class="line">          component: News,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">&quot;message&quot;</span>,</span><br><span class="line">          component: Message,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：二级路由 path 前面不需要再写 <code>/</code>。</p>
</blockquote>
<p>2、跳转（需要写完整路径）：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router</span> <span class="attr">to</span>=<span class="string">&quot;/home/news&quot;</span>&gt;</span>News<span class="tag">&lt;/<span class="name">router</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3、具体使用如下：</p>
<ul>
<li>router/index</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./pages/Home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> About <span class="keyword">from</span> <span class="string">&quot;./pages/About&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> News <span class="keyword">from</span> <span class="string">&quot;./pages/News&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Message <span class="keyword">from</span> <span class="string">&quot;./pages/Message&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&quot;/about&quot;</span>,</span><br><span class="line">      component: About,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">      component: Home,</span><br><span class="line">      children: [</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">&quot;news&quot;</span>,</span><br><span class="line">          component: News,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">&quot;message&quot;</span>,</span><br><span class="line">          component: Message,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure>
<ul>
<li>Home.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Home组件内容<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;home&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">active-class</span>=<span class="string">&quot;active&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/home/news&quot;</span></span></span><br><span class="line"><span class="tag">            &gt;</span>message001&lt;/router-link</span><br><span class="line">          &gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">active-class</span>=<span class="string">&quot;active&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/home/message&quot;</span></span></span><br><span class="line"><span class="tag">            &gt;</span>message002&lt;/router-link</span><br><span class="line">          &gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;Home&quot;</span>,</span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Message.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;message&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-link</span>&gt;</span>message001<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-link</span>&gt;</span>message001<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-link</span>&gt;</span>message001<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;Message&quot;</span>,</span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>News.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;news&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>news001<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>news002<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>news003<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;News&quot;</span>,</span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="命名路由"><a href="#命名路由" class="headerlink" title="命名路由"></a>命名路由</h4><p>1、作用：可以简化路由的跳转。</p>
<p>2、具体使用：</p>
<ul>
<li>给路由命名：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: <span class="string">&quot;/demo&quot;</span>,</span><br><span class="line">  component: demo,</span><br><span class="line">  children: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">      component: Test,</span><br><span class="line">      children:[</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// 给路由命名</span></span><br><span class="line">          name:<span class="string">&quot;welcome&quot;</span>,</span><br><span class="line">          path: <span class="string">&quot;welcome&quot;</span>,</span><br><span class="line">          component: Welcome,</span><br><span class="line">        &#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>简化跳转：</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 简化前，需要写完整的路径 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/demo/test/welcome&quot;</span>&gt;</span>跳转<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 简化后，直接通过名字跳转 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;&#123;name: &quot;</span><span class="attr">welcome</span>&quot;&#125;&quot;&gt;</span>跳转<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 简化写法配合传递参数 --&gt;</span></span><br><span class="line">&lt;router-link</span><br><span class="line">  :to=&quot;&#123;</span><br><span class="line">    name: &quot;welcome&quot;,</span><br><span class="line">    query:&#123;</span><br><span class="line">      id: &#x27;xxx&#x27;,</span><br><span class="line">      title: &#x27;xxx&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;&quot;</span><br><span class="line">&gt;</span><br><span class="line">  跳转</span><br><span class="line"><span class="tag">&lt;/<span class="name">router-link</span>&gt;&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="路由传参"><a href="#路由传参" class="headerlink" title="路由传参"></a>路由传参</h4><h5 id="传递-query-参数"><a href="#传递-query-参数" class="headerlink" title="传递 query 参数"></a>传递 query 参数</h5><p>1、传递 query 参数的两种方式：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用模板字符串写法传递query参数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;`/about/message/detail?id=$&#123;i.id&#125;&amp;title=$&#123;i.title&#125;`&quot;</span>&gt;</span></span><br><span class="line">  &#123;&#123;i.title&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 使用对象的写法传递query参数 --&gt;</span></span><br><span class="line">&lt;router-link</span><br><span class="line">  :to=&quot;&#123;</span><br><span class="line">    path:&quot;/home/message/detail&quot;,</span><br><span class="line">    query: &#123;</span><br><span class="line">      id: m.id,</span><br><span class="line">      title: m.title</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;&quot;</span><br><span class="line">&gt;</span><br><span class="line">  &#123;&#123;i.title&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2、接受 query 参数的方式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$route.query.id;</span><br><span class="line">$route.query.title;</span><br></pre></td></tr></table></figure>
<p>3、query 参数具体使用方式如下：</p>
<ul>
<li>router/index</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./pages/Home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> About <span class="keyword">from</span> <span class="string">&quot;./pages/About&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> News <span class="keyword">from</span> <span class="string">&quot;./pages/News&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Message <span class="keyword">from</span> <span class="string">&quot;./pages/Message&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Detail <span class="keyword">from</span> <span class="string">&quot;./pages/Detail&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&quot;/about&quot;</span>,</span><br><span class="line">      component: About,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">      component: Home,</span><br><span class="line">      children: [</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">&quot;news&quot;</span>,</span><br><span class="line">          component: News,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">&quot;message&quot;</span>,</span><br><span class="line">          component: Message,</span><br><span class="line">          children: [</span><br><span class="line">            &#123;</span><br><span class="line">              path: <span class="string">&quot;detail&quot;</span>,</span><br><span class="line">              component: Detail,</span><br><span class="line">            &#125;,</span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure>
<ul>
<li>Message.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;message&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;i in messageList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i.id&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 跳转路由并携带query参数，to的字符串写法 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;router-link :to=&quot;`/about/message/detail?id=$&#123;i.id&#125;&amp;title=$&#123;i.title&#125;`&quot;&gt;</span></span><br><span class="line"><span class="comment">          &#123;&#123;i.title&#125;&#125;</span></span><br><span class="line"><span class="comment">        &lt;/router-link&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 跳转路由并携带query参数，to的对象写法 --&gt;</span></span><br><span class="line">        &lt;router-link</span><br><span class="line">          :to=&quot;&#123;</span><br><span class="line">            path:&quot;/home/message/detail&quot;,</span><br><span class="line">            query: &#123;</span><br><span class="line">              id: m.id,</span><br><span class="line">              title: m.title</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &#123;&#123;i.title&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;Message&quot;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">        messageList: [</span><br><span class="line"><span class="javascript">          &#123; <span class="attr">id</span>: <span class="string">&quot;001&quot;</span>, <span class="attr">title</span>: <span class="string">&quot;消息001&quot;</span> &#125;,</span></span><br><span class="line"><span class="javascript">          &#123; <span class="attr">id</span>: <span class="string">&quot;002&quot;</span>, <span class="attr">title</span>: <span class="string">&quot;消息002&quot;</span> &#125;,</span></span><br><span class="line"><span class="javascript">          &#123; <span class="attr">id</span>: <span class="string">&quot;003&quot;</span>, <span class="attr">title</span>: <span class="string">&quot;消息003&quot;</span> &#125;,</span></span><br><span class="line">        ],</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Detail.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;detail&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>消息编号：&#123;&#123;$route.query.id&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>消息标题：&#123;&#123;$route.query.title&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;Detail&quot;</span>,</span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="传递-params-参数"><a href="#传递-params-参数" class="headerlink" title="传递 params 参数"></a>传递 params 参数</h5><p>1、配置路由，声明接受 params 参数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">  component: Home,</span><br><span class="line">  children: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&quot;news&quot;</span>,</span><br><span class="line">      component: News,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&quot;message&quot;</span>,</span><br><span class="line">      component: Message,</span><br><span class="line">      children: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// 使用占位符声明接受params参数</span></span><br><span class="line">          name: <span class="string">&quot;detail&quot;</span>,</span><br><span class="line">          path: <span class="string">&quot;detail/:id/:title&quot;</span>,</span><br><span class="line">          component: Detail,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、传递参数：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 跳转并携带params参数，to的字符串写法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;/home/message/detail/xxx/yyy&quot;</span>&gt;</span>跳转<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 跳转并携带params参数，to的对象写法 --&gt;</span></span><br><span class="line">&lt;router-link</span><br><span class="line">  :to=&quot;&#123;</span><br><span class="line">    name:&quot;detail&quot;,</span><br><span class="line">    params: &#123;</span><br><span class="line">      id: m.id,</span><br><span class="line">      title: m.title</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;&quot;</span><br><span class="line">&gt;</span><br><span class="line">  &#123;&#123;i.title&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong>：路由携带 params 参数时，如果使用 to 的对象写法，则不能使用 path 配置项，必须使用 name 配置。</p>
</blockquote>
<p>3、接收 params 参数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$route.params.id;</span><br><span class="line">$route.params.title;</span><br></pre></td></tr></table></figure>
<p>4、params 参数具体使用方式如下：</p>
<ul>
<li>router/index</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./pages/Home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> About <span class="keyword">from</span> <span class="string">&quot;./pages/About&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> News <span class="keyword">from</span> <span class="string">&quot;./pages/News&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Message <span class="keyword">from</span> <span class="string">&quot;./pages/Message&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Detail <span class="keyword">from</span> <span class="string">&quot;./pages/Detail&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&quot;/about&quot;</span>,</span><br><span class="line">      component: About,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">      component: Home,</span><br><span class="line">      children: [</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">&quot;news&quot;</span>,</span><br><span class="line">          component: News,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">&quot;message&quot;</span>,</span><br><span class="line">          component: Message,</span><br><span class="line">          children: [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="comment">// 配置params传参的占位符</span></span><br><span class="line">              name: <span class="string">&quot;detail&quot;</span>,</span><br><span class="line">              path: <span class="string">&quot;detail/:id/:title&quot;</span>,</span><br><span class="line">              component: Detail,</span><br><span class="line">            &#125;,</span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure>
<ul>
<li>Message.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;message&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;i in messageList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i.id&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 跳转路由并携带query参数，to的字符串写法 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;`/about/message/detail/$&#123;i.id&#125;/$&#123;i.title&#125;`&quot;</span>&gt;</span></span><br><span class="line">          &#123;&#123;i.title&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 跳转路由并携带params参数，to的对象写法， 注意：to 不能使用path指定路径，必须使用name--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;router-link</span></span><br><span class="line"><span class="comment">          :to=&quot;&#123;</span></span><br><span class="line"><span class="comment">            name:&quot;detail&quot;,</span></span><br><span class="line"><span class="comment">            params: &#123;</span></span><br><span class="line"><span class="comment">              id: m.id,</span></span><br><span class="line"><span class="comment">              title: m.title</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">          &#125;&quot;</span></span><br><span class="line"><span class="comment">        &gt;</span></span><br><span class="line"><span class="comment">          &#123;&#123;i.title&#125;&#125;</span></span><br><span class="line"><span class="comment">        &lt;/router-link&gt; --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;Message&quot;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">        messageList: [</span><br><span class="line"><span class="javascript">          &#123; <span class="attr">id</span>: <span class="string">&quot;001&quot;</span>, <span class="attr">title</span>: <span class="string">&quot;消息001&quot;</span> &#125;,</span></span><br><span class="line"><span class="javascript">          &#123; <span class="attr">id</span>: <span class="string">&quot;002&quot;</span>, <span class="attr">title</span>: <span class="string">&quot;消息002&quot;</span> &#125;,</span></span><br><span class="line"><span class="javascript">          &#123; <span class="attr">id</span>: <span class="string">&quot;003&quot;</span>, <span class="attr">title</span>: <span class="string">&quot;消息003&quot;</span> &#125;,</span></span><br><span class="line">        ],</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Detail.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;detail&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>消息编号：&#123;&#123;$route.params.id&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>消息标题：&#123;&#123;$route.params.title&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;Detail&quot;</span>,</span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="路由的-props-配置"><a href="#路由的-props-配置" class="headerlink" title="路由的 props 配置"></a>路由的 props 配置</h4><p>1、路由的 props 配置能让路由组件更方便的收到参数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 配置params传参的占位符</span></span><br><span class="line">  name: <span class="string">&quot;detail&quot;</span>,</span><br><span class="line">  path: <span class="string">&quot;detail/:id/:title&quot;</span>,</span><br><span class="line">  component: Detail,</span><br><span class="line">  <span class="comment">// props的第一种写法，值为对象，该对象中所有key-value都会以propDetail组件</span></span><br><span class="line">  props:&#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>: <span class="string">&quot;dnhyxc&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// props的第二种写法，值为布尔值，如果props为真，就会把该路由收到的所有params参数通过props传给Detail组件，该写法只适用于params传参方式，对query参数无效</span></span><br><span class="line">  props: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// props的第三种写法，值为函数，该函数返回的对象中所有key-value都会以propDetail组件同时适用于params与query传参</span></span><br><span class="line">  <span class="function"><span class="title">props</span>(<span class="params">$route</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      id: $route.query.id,</span><br><span class="line">      title: $route.query.title,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong>：props 作为布尔值的写法不适用于 query 参数，只适用于 params 参数。</p>
</blockquote>
<p>2、具体使用方式如下：</p>
<ul>
<li>router/index</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./pages/Home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> About <span class="keyword">from</span> <span class="string">&quot;./pages/About&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> News <span class="keyword">from</span> <span class="string">&quot;./pages/News&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Message <span class="keyword">from</span> <span class="string">&quot;./pages/Message&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Detail <span class="keyword">from</span> <span class="string">&quot;./pages/Detail&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&quot;/about&quot;</span>,</span><br><span class="line">      component: About,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">      component: Home,</span><br><span class="line">      children: [</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">&quot;news&quot;</span>,</span><br><span class="line">          component: News,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">&quot;message&quot;</span>,</span><br><span class="line">          component: Message,</span><br><span class="line">          children: [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="comment">// 配置params传参的占位符</span></span><br><span class="line">              name: <span class="string">&quot;detail&quot;</span>,</span><br><span class="line">              path: <span class="string">&quot;detail/:id/:title&quot;</span>,</span><br><span class="line">              component: Detail,</span><br><span class="line">              <span class="comment">// props的第一种写法，值为对象，该对象中所有key-value都会以props的形式传给Detail组件</span></span><br><span class="line">              <span class="comment">// props:&#123;a:1, b: &quot;dnhyxc&quot;&#125;</span></span><br><span class="line"></span><br><span class="line">              <span class="comment">// props的第二种写法，值为布尔值，如果props为真，就会把该路由组件接收到的所有props参数，以props的形式传给Detail组件。该写法只适用于params，对query参数无效</span></span><br><span class="line">              <span class="comment">// props: true,</span></span><br><span class="line"></span><br><span class="line">              <span class="comment">// props的第三种写法，值为函数,同时适用于params与query传参</span></span><br><span class="line">              <span class="function"><span class="title">props</span>(<span class="params">$route</span>)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                  id: $route.query.id,</span><br><span class="line">                  title: $route.query.title,</span><br><span class="line">                &#125;;</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure>
<ul>
<li>Detail.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;detail&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>消息编号：&#123;&#123;id&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>消息标题：&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;Detail&quot;</span>,</span></span><br><span class="line"><span class="javascript">    props: [<span class="string">&quot;id&quot;</span>, <span class="string">&quot;title&quot;</span>],</span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="router-link-标签的-replace-属性"><a href="#router-link-标签的-replace-属性" class="headerlink" title="router-link 标签的 replace 属性"></a>router-link 标签的 replace 属性</h4><p>1、作用：控制路由跳转时操作浏览器历史记录的模式。</p>
<p>2、浏览器的历史记录有两种写入方式：分别为 push 和 replace，push 是追加历史记录，replace 是替换当前记录，路由跳转时默认为 push。</p>
<p>3、开启 replace 模式的方式：<code>&lt;router-link replace to=&quot;/xxx&quot;&gt;xxx&lt;/router-link&gt;</code></p>
<h4 id="编程式路由导航"><a href="#编程式路由导航" class="headerlink" title="编程式路由导航"></a>编程式路由导航</h4><p>1、作用：不借助 router-link 标签实现路由跳转，让路由跳转更加灵活。</p>
<p>2、具体使用方式如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">this</span>.$router.push(&#123;</span><br><span class="line">  name: <span class="string">&quot;detail&quot;</span>,</span><br><span class="line">  params: &#123;</span><br><span class="line">    id: <span class="number">001</span>,</span><br><span class="line">    title: <span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">this</span>.$router.replace(&#123;</span><br><span class="line">  name: <span class="string">&quot;detail&quot;</span>,</span><br><span class="line">  params: &#123;</span><br><span class="line">    id: <span class="number">002</span>,</span><br><span class="line">    title: <span class="string">&quot;xxxxx&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 前进</span></span><br><span class="line"><span class="built_in">this</span>.$router.forward();</span><br><span class="line"><span class="comment">// 后退</span></span><br><span class="line"><span class="built_in">this</span>.$router.back();</span><br><span class="line"><span class="comment">// 传递参数为正数时为前进，为负数时则为后退，前进后退步数有传递的参数决定</span></span><br><span class="line"><span class="built_in">this</span>.$router.go(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<h4 id="缓存路由组件"><a href="#缓存路由组件" class="headerlink" title="缓存路由组件"></a>缓存路由组件</h4><p>1、作用：让不展示的路由组件保持挂载，不被销毁。</p>
<p>2、具体使用方式：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 缓存一个的写法，注意：include包含的是组件名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">include</span>=<span class="string">&quot;News&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 缓存多个的写法，注意：include包含的是组件名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">include</span>=<span class="string">&quot;[&#x27;News&#x27;, &#x27;Message&#x27;]&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>keep-alive 包裹的 router-view 必须是当前组件所展示的位置。其中 include 包含的是组件的组件名。如果不写 include，则表示缓存所有未展示的组件。</p>
</blockquote>
<h4 id="activeted、deactivated"><a href="#activeted、deactivated" class="headerlink" title="activeted、deactivated"></a>activeted、deactivated</h4><p>1、作用：路由组件所独有的两个钩子，用于捕获路由组件的激活状态。</p>
<ul>
<li><p><strong>activeted</strong>：当路由组件被激活时触发。</p>
</li>
<li><p><strong>deactivated</strong>：当路由组件失活时触发。</p>
</li>
</ul>
<p>2、activeted、deactivated 配合 keep-alive 具体使用方式如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;news&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;opacity&#125;&quot;</span>&gt;</span>activeted、deactivated<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>news001<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>news002<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>news003<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;News&quot;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">        opacity: 1,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">activated</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.opacity -= <span class="number">0.01</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (<span class="built_in">this</span>.opacity &lt;= <span class="number">0</span>) <span class="built_in">this</span>.opacity = <span class="number">1</span>;</span></span><br><span class="line">      &#125;, 16);</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">deactivated</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">clearInterval</span>(<span class="built_in">this</span>.timer);</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="路由守卫"><a href="#路由守卫" class="headerlink" title="路由守卫"></a>路由守卫</h4><p>1、作用：对路由进行权限控制。</p>
<p>2、分类：<strong>全局路由守卫</strong>、<strong>独享守卫</strong>、<strong>组件内守卫</strong>。</p>
<p>3、全局路由守卫：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 全局前置路由守卫，会在初始化的时候被调用，以及每次路由切换之前被调用</span></span><br><span class="line">router.beforeEatch(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (to.path === <span class="string">&quot;/home/news&quot;</span> || to.path === <span class="string">&quot;/home/message&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;name&quot;</span>) === <span class="string">&quot;dnhyxc&quot;</span>) &#123;</span><br><span class="line">      next();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      alert(<span class="string">&quot;暂无权限，请联系商务人员添加&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局后置路由守卫，会在初始化的时候被调用，以及每次路由切换之后被调用</span></span><br><span class="line">router.afterEatch(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (to.meta.title) &#123;</span><br><span class="line">    <span class="built_in">document</span>.title = to.meta.title;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.title = <span class="string">&quot;dnhyxc管理系统&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>4、独享路由守卫：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">beforeEnter: <span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (to.meta.isAuth) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;name&quot;</span>) === <span class="string">&quot;dnhyxc&quot;</span>) &#123;</span><br><span class="line">      next();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      alert(<span class="string">&quot;暂无权限，请联系商务人员添加&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<blockquote>
<p>独享路由守卫只有前置守卫，没有后置守卫，但是可以配合全局后置守卫一起使用实现具体功能。</p>
</blockquote>
<p>5、组件内路由守卫：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 进入守卫，通过路由规则点击router-link或者使用$route.push()），进入该组件时被调用</span></span><br><span class="line"><span class="function"><span class="title">beforeRouteEnter</span>(<span class="params">to, <span class="keyword">from</span>, next</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 离开守卫，通过路由规则点击router-link或者使用$route.push()），离开该组件时被调用</span></span><br><span class="line"><span class="function"><span class="title">beforeRouteLeave</span>(<span class="params">to, <span class="keyword">from</span>, next</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>6、beforeEatch 前置路由守卫具体使用：</p>
<ul>
<li>router/index</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./pages/Home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> About <span class="keyword">from</span> <span class="string">&quot;./pages/About&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> News <span class="keyword">from</span> <span class="string">&quot;./pages/News&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Message <span class="keyword">from</span> <span class="string">&quot;./pages/Message&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Detail <span class="keyword">from</span> <span class="string">&quot;./pages/Detail&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&quot;about&quot;</span>,</span><br><span class="line">      path: <span class="string">&quot;/about&quot;</span>,</span><br><span class="line">      component: About,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&quot;home&quot;</span>,</span><br><span class="line">      path: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">      component: Home,</span><br><span class="line">      children: [</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">&quot;news&quot;</span>,</span><br><span class="line">          path: <span class="string">&quot;news&quot;</span>,</span><br><span class="line">          component: News,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">&quot;message&quot;</span>,</span><br><span class="line">          path: <span class="string">&quot;message&quot;</span>,</span><br><span class="line">          component: Message,</span><br><span class="line">          children: [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="comment">// 配置params传参的占位符</span></span><br><span class="line">              name: <span class="string">&quot;detail&quot;</span>,</span><br><span class="line">              path: <span class="string">&quot;detail/:id/:title&quot;</span>,</span><br><span class="line">              component: Detail,</span><br><span class="line">              <span class="comment">// props值为函数的写法，同时适用于params与query传参</span></span><br><span class="line">              <span class="function"><span class="title">props</span>(<span class="params">$route</span>)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                  id: $route.query.id,</span><br><span class="line">                  title: $route.query.title,</span><br><span class="line">                &#125;;</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置前置路由守卫，会在初始化的时候被调用，以及每次路由切换之前被调用</span></span><br><span class="line">router.beforeEatch(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (to.path === <span class="string">&quot;/home/news&quot;</span> || to.path === <span class="string">&quot;/home/message&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;name&quot;</span>) === <span class="string">&quot;dnhyxc&quot;</span>) &#123;</span><br><span class="line">      next();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      alert(<span class="string">&quot;暂无权限，请联系商务人员添加&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure>
<ul>
<li>借助 meta 属性进行权限校验</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./pages/Home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> About <span class="keyword">from</span> <span class="string">&quot;./pages/About&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> News <span class="keyword">from</span> <span class="string">&quot;./pages/News&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Message <span class="keyword">from</span> <span class="string">&quot;./pages/Message&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Detail <span class="keyword">from</span> <span class="string">&quot;./pages/Detail&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&quot;about&quot;</span>,</span><br><span class="line">      path: <span class="string">&quot;/about&quot;</span>,</span><br><span class="line">      component: About,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&quot;home&quot;</span>,</span><br><span class="line">      path: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">      component: Home,</span><br><span class="line">      children: [</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">&quot;news&quot;</span>,</span><br><span class="line">          path: <span class="string">&quot;news&quot;</span>,</span><br><span class="line">          component: News,</span><br><span class="line">          <span class="comment">// meta用于配置是否需要进行权限校验</span></span><br><span class="line">          meta: &#123;</span><br><span class="line">            isAuth: <span class="literal">true</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">&quot;message&quot;</span>,</span><br><span class="line">          path: <span class="string">&quot;message&quot;</span>,</span><br><span class="line">          component: Message,</span><br><span class="line">          <span class="comment">// meta用于配置是否需要进行权限校验</span></span><br><span class="line">          meta: &#123;</span><br><span class="line">            isAuth: <span class="literal">true</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          children: [</span><br><span class="line">            &#123;</span><br><span class="line">              name: <span class="string">&quot;detail&quot;</span>,</span><br><span class="line">              path: <span class="string">&quot;detail/:id/:title&quot;</span>,</span><br><span class="line">              component: Detail,</span><br><span class="line">              <span class="function"><span class="title">props</span>(<span class="params">$route</span>)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                  id: $route.query.id,</span><br><span class="line">                  title: $route.query.title,</span><br><span class="line">                &#125;;</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置前置路由守卫，会在初始化的时候被调用，以及每次路由切换之前被调用</span></span><br><span class="line">router.beforeEatch(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 判断是否需要鉴权</span></span><br><span class="line">  <span class="keyword">if</span> (to.meta.isAuth) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;name&quot;</span>) === <span class="string">&quot;dnhyxc&quot;</span>) &#123;</span><br><span class="line">      next();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      alert(<span class="string">&quot;暂无权限，请联系商务人员添加&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure>
<p>7、afterEatch 后置路由守卫具体使用：</p>
<ul>
<li>使用后置路由守卫实现 document.title 的实时更改</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./pages/Home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> About <span class="keyword">from</span> <span class="string">&quot;./pages/About&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> News <span class="keyword">from</span> <span class="string">&quot;./pages/News&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Message <span class="keyword">from</span> <span class="string">&quot;./pages/Message&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Detail <span class="keyword">from</span> <span class="string">&quot;./pages/Detail&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&quot;about&quot;</span>,</span><br><span class="line">      path: <span class="string">&quot;/about&quot;</span>,</span><br><span class="line">      component: About,</span><br><span class="line">      meta: &#123;</span><br><span class="line">        title: <span class="string">&quot;关于&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&quot;home&quot;</span>,</span><br><span class="line">      path: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">      component: Home,</span><br><span class="line">      meta: &#123;</span><br><span class="line">        title: <span class="string">&quot;首页&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      children: [</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">&quot;news&quot;</span>,</span><br><span class="line">          path: <span class="string">&quot;news&quot;</span>,</span><br><span class="line">          component: News,</span><br><span class="line">          <span class="comment">// meta用于配置是否需要进行权限校验</span></span><br><span class="line">          meta: &#123;</span><br><span class="line">            isAuth: <span class="literal">true</span>,</span><br><span class="line">            title: <span class="string">&quot;新闻&quot;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">&quot;message&quot;</span>,</span><br><span class="line">          path: <span class="string">&quot;message&quot;</span>,</span><br><span class="line">          component: Message,</span><br><span class="line">          <span class="comment">// meta用于配置是否需要进行权限校验</span></span><br><span class="line">          meta: &#123;</span><br><span class="line">            isAuth: <span class="literal">true</span>,</span><br><span class="line">            title: <span class="string">&quot;消息&quot;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          children: [</span><br><span class="line">            &#123;</span><br><span class="line">              name: <span class="string">&quot;detail&quot;</span>,</span><br><span class="line">              path: <span class="string">&quot;detail/:id/:title&quot;</span>,</span><br><span class="line">              component: Detail,</span><br><span class="line">              meta: &#123;</span><br><span class="line">                isAuth: <span class="literal">true</span>,</span><br><span class="line">                title: <span class="string">&quot;详情&quot;</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="function"><span class="title">props</span>(<span class="params">$route</span>)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                  id: $route.query.id,</span><br><span class="line">                  title: $route.query.title,</span><br><span class="line">                &#125;;</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置前置路由守卫，会在初始化的时候被调用，以及每次路由切换之后被调用</span></span><br><span class="line">router.afterEatch(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">document</span>.title = to.meta.title || <span class="string">&quot;dnhyxc管理系统&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure>
<p>8、beforeEnter 独享路由守卫具体使用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./pages/Home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> About <span class="keyword">from</span> <span class="string">&quot;./pages/About&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> News <span class="keyword">from</span> <span class="string">&quot;./pages/News&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Message <span class="keyword">from</span> <span class="string">&quot;./pages/Message&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Detail <span class="keyword">from</span> <span class="string">&quot;./pages/Detail&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&quot;about&quot;</span>,</span><br><span class="line">      path: <span class="string">&quot;/about&quot;</span>,</span><br><span class="line">      component: About,</span><br><span class="line">      meta: &#123;</span><br><span class="line">        title: <span class="string">&quot;关于&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&quot;home&quot;</span>,</span><br><span class="line">      path: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">      component: Home,</span><br><span class="line">      meta: &#123;</span><br><span class="line">        title: <span class="string">&quot;首页&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      children: [</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">&quot;news&quot;</span>,</span><br><span class="line">          path: <span class="string">&quot;news&quot;</span>,</span><br><span class="line">          component: News,</span><br><span class="line">          <span class="comment">// meta用于配置是否需要进行权限校验</span></span><br><span class="line">          meta: &#123;</span><br><span class="line">            isAuth: <span class="literal">true</span>,</span><br><span class="line">            title: <span class="string">&quot;新闻&quot;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="comment">// 配置独享路由守卫，注意：独享路由守卫没有后置守卫，但可以配合全局后置守卫一起使用</span></span><br><span class="line">          beforeEnter: <span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (to.meta.isAuth) &#123;</span><br><span class="line">              <span class="keyword">if</span> (<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;name&quot;</span>) === <span class="string">&quot;dnhyxc&quot;</span>) &#123;</span><br><span class="line">                next();</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                alert(<span class="string">&quot;暂无权限，请联系商务人员添加&quot;</span>);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              next();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">&quot;message&quot;</span>,</span><br><span class="line">          path: <span class="string">&quot;message&quot;</span>,</span><br><span class="line">          component: Message,</span><br><span class="line">          <span class="comment">// meta用于配置是否需要进行权限校验</span></span><br><span class="line">          meta: &#123;</span><br><span class="line">            isAuth: <span class="literal">true</span>,</span><br><span class="line">            title: <span class="string">&quot;消息&quot;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          children: [</span><br><span class="line">            &#123;</span><br><span class="line">              name: <span class="string">&quot;detail&quot;</span>,</span><br><span class="line">              path: <span class="string">&quot;detail/:id/:title&quot;</span>,</span><br><span class="line">              component: Detail,</span><br><span class="line">              meta: &#123;</span><br><span class="line">                isAuth: <span class="literal">true</span>,</span><br><span class="line">                title: <span class="string">&quot;详情&quot;</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="function"><span class="title">props</span>(<span class="params">$route</span>)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                  id: $route.query.id,</span><br><span class="line">                  title: $route.query.title,</span><br><span class="line">                &#125;;</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置前置路由守卫，会在初始化的时候被调用，以及每次路由切换之后被调用</span></span><br><span class="line">router.afterEatch(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">document</span>.title = to.meta.title || <span class="string">&quot;dnhyxc管理系统&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure>
<p>9、组件内路由守卫具体使用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;about&quot;</span>&gt;</span><br><span class="line">    &lt;h2&gt;About&lt;/h2&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: <span class="string">&quot;About&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过路由规则（点击router-link或者使用$route.push()），进入该组件时被调用</span></span><br><span class="line">    <span class="function"><span class="title">beforeRouteEnter</span>(<span class="params">to,<span class="keyword">from</span> ,next</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(to.meta.isAuth)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">localStorage</span>.gitItem(<span class="string">&quot;name&quot;</span>) === <span class="string">&#x27;dnhyxc&#x27;</span>)&#123;</span><br><span class="line">          next()</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          alert(<span class="string">&#x27;没有权限&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        next()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过路由规则（点击router-link或者使用$route.push()），离开该组件时被调用</span></span><br><span class="line">    <span class="function"><span class="title">beforeRouteLeave</span>(<span class="params">to,<span class="keyword">from</span> ,next</span>)</span>&#123;</span><br><span class="line">      next()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="路由器的两种工作模式"><a href="#路由器的两种工作模式" class="headerlink" title="路由器的两种工作模式"></a>路由器的两种工作模式</h4><p>1、对于一个 url 来说，什么是 hash 值？#及其后面的内容就是 hash 值。</p>
<p>2、hash 值不会包含在 HTTP 请求中，即 hash 值不会带给服务器。</p>
<p>3、hash 模式：</p>
<ul>
<li><p>地址中永远带着#号，不美观。</p>
</li>
<li><p>若以后将地址通过第三方手机 App 分享，若 App 校验严格，则地址会被标记为不合法。</p>
</li>
<li><p>兼容性较好。</p>
</li>
</ul>
<p>4、history 模式：</p>
<ul>
<li><p>地址干净，美观。</p>
</li>
<li><p>兼容性和 hash 模式相比略差。</p>
</li>
<li><p>应用部署上线时需要后端人员支持，解决刷新页面服务端出现 404 的问题。</p>
</li>
</ul>
<p>5、更改路由工作方式的方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./pages/Home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> About <span class="keyword">from</span> <span class="string">&quot;./pages/About&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  <span class="comment">// 更改路由为history模式，不配置mode，默认为hash模式</span></span><br><span class="line">  mode: <span class="string">&quot;history&quot;</span>,</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&quot;about&quot;</span>,</span><br><span class="line">      path: <span class="string">&quot;/about&quot;</span>,</span><br><span class="line">      component: About,</span><br><span class="line">      meta: &#123;</span><br><span class="line">        title: <span class="string">&quot;关于&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&quot;home&quot;</span>,</span><br><span class="line">      path: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">      component: Home,</span><br><span class="line">      meta: &#123;</span><br><span class="line">        title: <span class="string">&quot;首页&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure>
<h3 id="Vue-高级"><a href="#Vue-高级" class="headerlink" title="Vue 高级"></a>Vue 高级</h3><h4 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h4><h5 id="setup-方法说明"><a href="#setup-方法说明" class="headerlink" title="setup 方法说明"></a>setup 方法说明</h5><p>1，setup 是 Vue3.x 新增的一个选项，它是组件内使用 Composition API 的入口。</p>
<h5 id="setup-执行时机"><a href="#setup-执行时机" class="headerlink" title="setup 执行时机"></a>setup 执行时机</h5><p>2，setup 会在 beforeCreate 之前执行，而不是在 beforeCreate 和 created 之间执行。</p>
<h5 id="setup-参数说明"><a href="#setup-参数说明" class="headerlink" title="setup 参数说明"></a>setup 参数说明</h5><p>1，setup 接受两个参数，分别为：</p>
<ul>
<li><p>props: 组件传入的属性。</p>
</li>
<li><p>context：是一个对象，由于 <strong>setup 中不能访问 Vue2 中最常用的 this 对象</strong>，所以 context 中就提供了 this 中最常用的三个属性：attrs、slot 和 emit，分别对应 Vue2.x 中的 $attr属性、slot插槽 和$emit 发射事件。并且这几个属性都是自动同步最新的值，所以我们每次使用拿到的都是最新值。</p>
</li>
</ul>
<p>2，setup 中接受的 props 是响应式的， 当传入新的 props 时，会及时被更新。由于是响应式的， 所以不可以使用 ES6 解构，解构会消除它的响应式。如下写法就会消除响应式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// demo.vue</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="function"><span class="title">setup</span>(<span class="params">props, context</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; name &#125; = props;</span><br><span class="line">    <span class="built_in">console</span>.log(name);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>3，如果在开发中即想使用解构，又不消除 props 的响应式，就可以使用 toRefs 解决，因为 toRefs 能将 reactive 对象转化为属性全部为 ref 对象的普通对象。具体使用方式如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;homePage&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>第 &#123;&#123; year &#125;&#125; 年<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>姓名： &#123;&#123; nickname &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄： &#123;&#123; age &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; defineComponent, reactive, ref, toRefs &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> year = ref(<span class="number">0</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> user = reactive(&#123; <span class="attr">nickname</span>: <span class="string">&quot;snsn&quot;</span>, <span class="attr">age</span>: <span class="number">26</span>, <span class="attr">gender</span>: <span class="string">&quot;女&quot;</span> &#125;);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line">        year.value++;</span><br><span class="line">        user.age++;</span><br><span class="line">      &#125;, 1000);</span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">        year,</span><br><span class="line"><span class="javascript">        <span class="comment">// 使用reRefs</span></span></span><br><span class="line">        ...toRefs(user),</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="reactive、ref-与-toRefs"><a href="#reactive、ref-与-toRefs" class="headerlink" title="reactive、ref 与 toRefs"></a>reactive、ref 与 toRefs</h4><p>1，在 vue2.x 中， 定义数据都是在 data 中，但是 Vue3.x 可以使用 reactive 和 ref 来进行<strong>数据定义</strong>。</p>
<h5 id="reactive-与-ref-的区别"><a href="#reactive-与-ref-的区别" class="headerlink" title="reactive 与 ref 的区别"></a>reactive 与 ref 的区别</h5><p>1，reactive 主要用于<strong>处理对象</strong>的双向绑定，但是不能处理基本类型，例如 string、number、boolean 等。</p>
<p>2，ref 主要用于处理 js <strong>基础类型</strong>的双向绑定，但也能处理对象的数据绑定，如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">setup</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> obj = ref(&#123;<span class="attr">count</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;hmhm&quot;</span>&#125;)</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span>&#123;</span><br><span class="line">    obj.value.count = obj.value.count + <span class="number">1</span></span><br><span class="line">    obj.value.name = <span class="string">&quot;snsn&quot;</span></span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    obj</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4，toRefs 用于将一个 reactive 对象转化为属性全部为 ref 对象的普通对象。</p>
<ul>
<li>不使用 toRefs 的书写方式如下：</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;homePage&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>第 &#123;&#123; year &#125;&#125; 年<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>姓名： &#123;&#123; user.nickname &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄： &#123;&#123; user.age &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; defineComponent, reactive, ref, toRefs &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// ref 使用方式</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> year = ref(<span class="number">0</span>);</span></span><br><span class="line"><span class="javascript">      <span class="comment">// reactive 使用方式</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> user = reactive(&#123; <span class="attr">nickname</span>: <span class="string">&quot;snsn&quot;</span>, <span class="attr">age</span>: <span class="number">26</span>, <span class="attr">gender</span>: <span class="string">&quot;女&quot;</span> &#125;);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line">        year.value++;</span><br><span class="line">        user.age++;</span><br><span class="line">      &#125;, 1000);</span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">        year,</span><br><span class="line">        user,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>使用 toRefs 的书写方式如下：</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;homePage&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>第 &#123;&#123; year &#125;&#125; 年<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>姓名： &#123;&#123; nickname &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄： &#123;&#123; age &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; defineComponent, reactive, ref, toRefs &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// ref 使用方式</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> year = ref(<span class="number">0</span>);</span></span><br><span class="line"><span class="javascript">      <span class="comment">// reactive 使用方式</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> user = reactive(&#123; <span class="attr">nickname</span>: <span class="string">&quot;snsn&quot;</span>, <span class="attr">age</span>: <span class="number">26</span>, <span class="attr">gender</span>: <span class="string">&quot;女&quot;</span> &#125;);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line">        year.value++;</span><br><span class="line">        user.age++;</span><br><span class="line">      &#125;, 1000);</span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">        year,</span><br><span class="line"><span class="javascript">        <span class="comment">// reRefs使用方式</span></span></span><br><span class="line">        ...toRefs(user),</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>使不使用 toRefs 的主要区别在于不使用 toRefs 时，姓名与年龄绑定到页面上时，需要使用 user.nickname，user.age，而使用 toRefs 时，绑定姓名与年龄到页面上只需要使用 nickname，age 即可。</p>
</blockquote>
<h4 id="vue3-x-生命周期"><a href="#vue3-x-生命周期" class="headerlink" title="vue3.x 生命周期"></a>vue3.x 生命周期</h4><h5 id="vue3-x-生命周期图谱"><a href="#vue3-x-生命周期图谱" class="headerlink" title="vue3.x 生命周期图谱"></a>vue3.x 生命周期图谱</h5><p><img src="/2019/05/16/vue/vue-live.webp" alt="生命周期"></p>
<blockquote>
<p>vue3.x 生命周期写在 setup 方法中，同时声明周期钩子都是以 onXxx 开头的，如：onMounted、onUpdated 等等。</p>
</blockquote>
<h4 id="watch-与-watchEffect"><a href="#watch-与-watchEffect" class="headerlink" title="watch 与 watchEffect"></a>watch 与 watchEffect</h4><h5 id="watch-方法说明"><a href="#watch-方法说明" class="headerlink" title="watch 方法说明"></a>watch 方法说明</h5><p>1，watch 函数用来侦听特定的数据源，并在回调函数中执行副作用。默认情况是惰性的，也就是说<strong>仅在侦听的源数据变更时才执行回调</strong>。</p>
<p>2，使用语法如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">watch(source, callback, [options]);</span><br></pre></td></tr></table></figure>
<h5 id="watch-参数说明"><a href="#watch-参数说明" class="headerlink" title="watch 参数说明"></a>watch 参数说明</h5><p>1，source：可以支持 string、Object、Function、Array，用于指定要侦听的响应式变量。</p>
<p>2，callback：执行的回调函数。</p>
<p>3，options：支持 deep、immediate 和 flush 选项。</p>
<h5 id="watch-具体使用"><a href="#watch-具体使用" class="headerlink" title="watch 具体使用"></a>watch 具体使用</h5><p>1，监听 reactive 定义的数据：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent, ref, reactive, toRefs, watch &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> state = reactive(&#123; <span class="attr">nickname</span>: <span class="string">&quot;xiaofan&quot;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      state.age++;</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改age值时会触发 watch的回调</span></span><br><span class="line">    watch(</span><br><span class="line">      () =&gt; state.age,</span><br><span class="line">      (curAge, preAge) =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;newValue:&quot;</span>, curAge, <span class="string">&quot;oldValue:&quot;</span>, preAge);</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      ...toRefs(state),</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>2，监听 ref 定义的数据：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> year = ref(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  year.value++;</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">watch(year, <span class="function">(<span class="params">newVal, oldVal</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;newVal:&quot;</span>, newVal, <span class="string">&quot;oldVal:&quot;</span>, oldVal);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>3，侦听多个数据：</p>
<ul>
<li>当我们需要侦听多个数据源时，可以进行合并，同时侦听多个数据，如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">watch([<span class="function">() =&gt;</span> state.age, year], <span class="function">(<span class="params">[newAge, newYear], [oldAge, oldYear]</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;newVal:&quot;</span>, newAge, <span class="string">&quot;oldVal:&quot;</span>, oldAge);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;newVal:&quot;</span>, newYear, <span class="string">&quot;oldVal:&quot;</span>, oldYear);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>4，侦听复杂的嵌套对象：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> state = reactive(&#123;</span><br><span class="line">  room: &#123;</span><br><span class="line">    id: <span class="number">100</span>,</span><br><span class="line">    attrs: &#123;</span><br><span class="line">      size: <span class="string">&quot;300平方米&quot;</span>,</span><br><span class="line">      type: <span class="string">&quot;8室2厅&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">watch(</span><br><span class="line">  () =&gt; state.room,</span><br><span class="line">  (newType, oldType) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;newType:&quot;</span>, newType, <span class="string">&quot;oldType:&quot;</span>, oldType);</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">deep</span>: <span class="literal">true</span> &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果不使用第三个参数 <strong>deep:true</strong>，是无法监听到数据变化的。前面我们提到，<strong>默认情况下，watch 是惰性的</strong>，那什么情况下不是惰性的，可以立即执行回调函数呢？只需要设置第三个参数 <strong>immediate: true</strong> 即可。</p>
</blockquote>
<p>5，stop 停止监听：</p>
<ul>
<li>我们在组件中创建的 watch 监听，会<strong>在组件被销毁时自动停止</strong>。如果在组件销毁之前我们想要停止掉某个监听，可以调用 watch() 函数的返回值，操作如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> stopWatchRoom = watch(</span><br><span class="line">  () =&gt; state.room,</span><br><span class="line">  (newType, oldType) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;newType:&quot;</span>, newType, <span class="string">&quot;oldType:&quot;</span>, oldType);</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">deep</span>: <span class="literal">true</span> &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 停止监听</span></span><br><span class="line">  stopWatchRoom();</span><br><span class="line">&#125;, <span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<h5 id="watchEffect-方法说明"><a href="#watchEffect-方法说明" class="headerlink" title="watchEffect 方法说明"></a>watchEffect 方法说明</h5><p>1，watchEffect 与 watch 使用上的区别：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent, ref, reactive, toRefs, watchEffect &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> state = reactive(&#123; <span class="attr">nickname</span>: <span class="string">&quot;snsn&quot;</span>, <span class="attr">age</span>: <span class="number">26</span> &#125;);</span><br><span class="line">    <span class="keyword">let</span> year = ref(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      state.age++;</span><br><span class="line">      year.value++;</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    watchEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(state);</span><br><span class="line">      <span class="built_in">console</span>.log(year);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      ...toRefs(state),</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上述代码执行结果首先打印一次 state 和 year 值，然后每隔一秒，打印 state 和 year 值。从上面的代码可以看出，并没有像 watch 一样需要先传入依赖，watchEffect 会自动收集依赖, 只要指定一个回调函数。<strong>在组件初始化时，会先执行一次来收集依赖</strong>，然后当收集到的依赖中数据发生变化时，就会再次执行回调函数。</p>
</blockquote>
<h5 id="watchEffect-与-watch-的区别"><a href="#watchEffect-与-watch-的区别" class="headerlink" title="watchEffect 与 watch 的区别"></a>watchEffect 与 watch 的区别</h5><p>1，watchEffect 不需要手动传入依赖。</p>
<p>2，watchEffect 会在组件初始化时先执行一次用来自动收集依赖。</p>
<p>3，watchEffect 无法获取到变化前的值，只能获取变化后的值。</p>
<h4 id="slot-具名插槽语法"><a href="#slot-具名插槽语法" class="headerlink" title="slot 具名插槽语法"></a>slot 具名插槽语法</h4><h5 id="vue2-x-具名插槽写法"><a href="#vue2-x-具名插槽写法" class="headerlink" title="vue2.x 具名插槽写法"></a>vue2.x 具名插槽写法</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 子组件中</span></span><br><span class="line">&lt;slot name=<span class="string">&quot;title&quot;</span>&gt;&lt;/slot&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在父组件中使用</span></span><br><span class="line">&lt;template slot=<span class="string">&quot;title&quot;</span>&gt;</span><br><span class="line">  &lt;h1&gt;歌曲：成都&lt;/h1&gt;</span><br><span class="line">&lt;template&gt;</span><br></pre></td></tr></table></figure>
<h5 id="vue2-x-作用域插槽写法"><a href="#vue2-x-作用域插槽写法" class="headerlink" title="vue2.x 作用域插槽写法"></a>vue2.x 作用域插槽写法</h5><p>1，如果需要在 slot 上面绑定数据，可以使用作用域插槽，实现如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 子组件</span></span><br><span class="line">&lt;slot name=<span class="string">&quot;content&quot;</span> :data=<span class="string">&quot;data&quot;</span>&gt;&lt;/slot&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">      data:[<span class="string">&quot;走过来人来人往&quot;</span>,<span class="string">&quot;不喜欢也得欣赏&quot;</span>,<span class="string">&quot;陪伴是最长情的告白&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在父组件中使用</span></span><br><span class="line">&lt;template slot=<span class="string">&quot;content&quot;</span> slot-scope=<span class="string">&quot;scoped&quot;</span>&gt;</span><br><span class="line">  &lt;div v-<span class="keyword">for</span>=<span class="string">&quot;item in scoped.data&quot;</span>&gt;&#123;&#123;item&#125;&#125;&lt;/div&gt;</span><br><span class="line">&lt;template&gt;</span><br></pre></td></tr></table></figure>
<h5 id="vue3-x-中使用插槽"><a href="#vue3-x-中使用插槽" class="headerlink" title="vue3.x 中使用插槽"></a>vue3.x 中使用插槽</h5><p>1，在 Vue2.x 中具名插槽和作用域插槽分别使用 slot 和 slot-scope 来实现，在 Vue3.0 中将 slot 和 slot-scope 进行了合并统一使用。Vue3.0 中 使用 v-slot 实现：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 父组件中使用</span></span><br><span class="line">&lt;template v-slot:content=<span class="string">&quot;scoped&quot;</span>&gt;</span><br><span class="line">  &lt;div v-<span class="keyword">for</span>=<span class="string">&quot;item in scoped.data&quot;</span>&gt;&#123;&#123;item&#125;&#125;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以简写成</span></span><br><span class="line">&lt;template #content=<span class="string">&quot;&#123;data&#125;&quot;</span>&gt;</span><br><span class="line">    &lt;div v-<span class="keyword">for</span>=<span class="string">&quot;item in data&quot;</span>&gt;&#123;&#123;item&#125;&#125;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<h4 id="自定义指令-1"><a href="#自定义指令-1" class="headerlink" title="自定义指令"></a>自定义指令</h4><h5 id="vue2-x-实现自定义指令"><a href="#vue2-x-实现自定义指令" class="headerlink" title="vue2.x 实现自定义指令"></a>vue2.x 实现自定义指令</h5><p>1，实现实例代码如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 注册一个全局自定义指令 `v-focus`</span></span><br><span class="line">Vue.directive(<span class="string">&quot;focus&quot;</span>, &#123;</span><br><span class="line">  <span class="comment">// 当被绑定的元素插入到 DOM 中时……</span></span><br><span class="line">  inserted: <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 聚焦元素</span></span><br><span class="line">    el.focus();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>2，在 Vue 2 中，自定义指令通过以下几个可选钩子创建：</p>
<ul>
<li><p>bind：只调用一次，指令第一次绑定到元素时调用。在这里可以进行一次性的初始化设置。</p>
</li>
<li><p>inserted：被绑定元素插入父节点时调用 (仅保证父节点存在，但不一定已被插入文档中)。</p>
</li>
<li><p>update：所在组件的 VNode 更新时调用，但是可能发生在其子 VNode 更新之前。指令的值可能发生了改变，也可能没有。但是你可以通过比较更新前后的值来忽略不必要的模板更新。</p>
</li>
<li><p>componentUpdated：指令所在组件的 VNode 及其子 VNode 全部更新后调用。</p>
</li>
<li><p>unbind：只调用一次，指令与元素解绑时调用。</p>
</li>
</ul>
<h5 id="vue3-x-对自定义指令-API-的变更"><a href="#vue3-x-对自定义指令-API-的变更" class="headerlink" title="vue3.x 对自定义指令 API 的变更"></a>vue3.x 对自定义指令 API 的变更</h5><p>1，vue2.x 与 vue3.x 自定义指令 API 的区别：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bind                 --------&gt;    beforeMount</span><br><span class="line"></span><br><span class="line">inserted             --------&gt;    mounted</span><br><span class="line"></span><br><span class="line">                     --------&gt;    beforeUpdate 新增钩子，会在元素自身更新前触发</span><br><span class="line"></span><br><span class="line">update               --------&gt;    vue3.x 移除了update</span><br><span class="line"></span><br><span class="line">componentUpdated     --------&gt;    updated</span><br><span class="line"></span><br><span class="line">                     --------&gt;    beforeUnmount 新增钩子，会在元素自身被卸载前触发</span><br><span class="line"></span><br><span class="line">unbind               --------&gt;    unmounted</span><br></pre></td></tr></table></figure>
<p>2，在 vue3.x 中，可以使用如下方式实现自定义指令：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = createApp(&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义自定义指令</span></span><br><span class="line">app.directive(<span class="string">&#x27;focus&#x27;</span>, &#123;</span><br><span class="line">    <span class="function"><span class="title">mounted</span>(<span class="params">el</span>)</span> &#123;</span><br><span class="line">        el.focus()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用自定义指令</span></span><br><span class="line">&lt;input v-focus /&gt;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>前端框架</category>
        <category>vue</category>
      </categories>
      <tags>
        <tag>Vue2</tag>
        <tag>Vue3</tag>
      </tags>
  </entry>
  <entry>
    <title>WebSocket</title>
    <url>/2021/04/01/websocket/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="websocket-简介"><a href="#websocket-简介" class="headerlink" title="websocket 简介"></a>websocket 简介</h3><h4 id="websocket-是什么"><a href="#websocket-是什么" class="headerlink" title="websocket 是什么"></a>websocket 是什么</h4><p>1，websocket 是一种网络通信协议。RFC6455 定义了它的通信标准。</p>
<p>2，websocket 是 HTML5 开始提供的一种在单个 TCP 连接上进行全双工通信的协议。</p>
<h4 id="websocket-协议的特点"><a href="#websocket-协议的特点" class="headerlink" title="websocket 协议的特点"></a>websocket 协议的特点</h4><p>1，其最大的特点就是服务器可以主动的向客户端推送消息，客户端也可以主动向服务器发送消息，是真正的双向平等对话，属于服务器推送技术的一种。</p>
<p>2，它建立在 TCP 协议之上，服务端的实现比较容易。</p>
<a id="more"></a>

<p>3，与 HTTP 协议有着良好的兼容性。默认端口也是 80 和 443，并且握手阶段采用 HTTP 协议，因此握手时不容易屏蔽，能通过各种 HTTP 代理服务器。</p>
<p>4，可以发送文本，也可以发送二进制数据。</p>
<p>5，没有同源限制，客户端可以与任意服务器通信。</p>
<p>6，协议标识符是 ws（如果加密则为 wss），服务器网址就是 URL。</p>
<ul>
<li>如：ws://example.com:80/some/path</li>
</ul>
<h4 id="http-协议"><a href="#http-协议" class="headerlink" title="http 协议"></a>http 协议</h4><p>1，http 协议是一种无状态的、无连接的、单向的应用层协议。它采用了请求/响应模型。通信请求只能有客户端发起，服务端对请求做出应答处理。</p>
<h4 id="对比双工通信协议-http-协议的弊端"><a href="#对比双工通信协议-http-协议的弊端" class="headerlink" title="对比双工通信协议 http 协议的弊端"></a>对比双工通信协议 http 协议的弊端</h4><p>1，http 协议无法实现服务器主动向客户端发起消息。</p>
<p>2，这种单向请求的特点注定了如果服务器有连续的状态变化，客户端要获知就非常麻烦，大多数 web 应用程序将通过频繁的异步 ajax 请求实现长轮询。轮询的效率低，非常浪费资源（因为必须不停连接，或者 HTTP 连接始终打开）。</p>
<p>3，http 协议与 websocket 协议对比：</p>
<p><img src="/2021/04/01/websocket/websocket.png" alt="http 协议与 websocket 协议对比图"></p>
<p>4，websocket 协议分为两部分，分别为：握手（基于 http 协议）和数据传输。</p>
<ul>
<li>来自客户端的握手看起来像如下形式：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GET ws:&#x2F;&#x2F;localhost&#x2F;chat HTTP&#x2F;1.1</span><br><span class="line">Host: localhost</span><br><span class="line">Upgrade: websocket</span><br><span class="line">Connection: Upgrade</span><br><span class="line">Sec-webSocket-Key: dGh1IHNhbxBsZSBub25jZQ&#x3D;&#x3D;</span><br><span class="line">Sec-webSocket-Extensions: permessage-deflate</span><br><span class="line">Sec-webSocket-Version: 13</span><br></pre></td></tr></table></figure>
<ul>
<li>来自服务器的握手看起来像如下形式：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP&#x2F;1.1 101 Switching Protocols</span><br><span class="line">Upgrade: websocket</span><br><span class="line">Connection: Upgrade</span><br><span class="line">Sec-webSocket-Accept: s3pPLMBiTxaQ9KYGzzhZRbK+xOo&#x3D;</span><br><span class="line">Sec-webSocket-Extensions: permessage-deflate</span><br></pre></td></tr></table></figure>
<ul>
<li>字段说明：</li>
</ul>
<p>Connection: Upgrade：标识该 HTTP 请求是一个协议升级请求。</p>
<p>Upgrade: websocket：协议升级为 websocket 协议。</p>
<p>Sec-webSocket-Version: 13：客户端支持 websocket 的版本。</p>
<p>Sec-webSocket-Key：客户端采用 base64 编码的 24 位随机字符序列，服务器接受客户端 HTTP 协议升级的证明。要求服务端响应一个对应加密的 Sec-webSocket-Accept 头信息作为应答。</p>
<p>Sec-webSocket-Extensions：标识协议扩展类型。</p>
<h4 id="websocket-对象"><a href="#websocket-对象" class="headerlink" title="websocket 对象"></a>websocket 对象</h4><p>1，实现 websocket 的 web 浏览器将通过 websocket 对象公开所有必需的客户端功能（主要指支持 Html5 的浏览器）。</p>
<p>2，以下 API 用于创建 websocket 对象：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> websocket(url);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>参数 url 格式说明：ws://ip 地址:端口号/资源名称</p>
</blockquote>
<h4 id="websocket-属性"><a href="#websocket-属性" class="headerlink" title="websocket 属性"></a>websocket 属性</h4><p>1，<strong>webSocket.readyState</strong>：属性返回实例对象的当前状态，共有四种。</p>
<ul>
<li><p>CONNECTING：值为 0，表示正在连接。</p>
</li>
<li><p>OPEN：值为 1，表示连接成功，可以通信了。</p>
</li>
<li><p>CLOSING：值为 2，表示连接正在关闭。</p>
</li>
<li><p>CLOSED：值为 3，表示连接已关闭，或者打开连接失败。</p>
</li>
</ul>
<blockquote>
<p>相关示例如下：</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">switch</span> (ws.readyState) &#123;</span><br><span class="line">  <span class="keyword">case</span> WebSocket.CONNECTING:</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> WebSocket.OPEN:</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> WebSocket.CLOSING:</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> WebSocket.CLOSED:</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    <span class="comment">// this never happens</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2，<strong>webSocket.bufferedAmount</strong>：实例对象的 bufferedAmount 属性，表示还有多少字节的二进制数据没有发送出去。它可以用来判断发送是否结束。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> data = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">10000000</span>);</span><br><span class="line">socket.send(data);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (socket.bufferedAmount === <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="comment">// 发送完毕</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// 发送还没结束</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="websocket-事件"><a href="#websocket-事件" class="headerlink" title="websocket 事件"></a>websocket 事件</h4><p>1，<strong>open</strong>：在连接建立时触发。</p>
<ul>
<li>对应事件处理程序：ws.onopen。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ws.onopen = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  ws.send(<span class="string">&quot;来了老弟！&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果要指定多个回调函数，可以使用 addEventListener 方法。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ws.addEventListener(<span class="string">&quot;open&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  ws.send(<span class="string">&quot;来了老弟！&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>2，<strong>message</strong>：客户端接收服务端数据时触发。</p>
<ul>
<li>对应事件处理程序：ws.onmessage。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ws.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> data = event.data;</span><br><span class="line">  <span class="comment">// 处理数据</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ws.addEventListener(<span class="string">&quot;message&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> data = event.data;</span><br><span class="line">  <span class="comment">// 处理数据</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>注意</strong>：服务端数据可能是文本，也可能是二进制数据（blob 对象或 Arraybuffer 对象）。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ws.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> event.data === string) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Received data string&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (event.data <span class="keyword">instanceof</span> <span class="built_in">ArrayBuffer</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> buffer = event.data;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Received arraybuffer&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>除了动态判断收到的数据类型，也可以使用 <strong>binaryType</strong> 属性，显示指定收到的二进制数据类型。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 收到的是 blob 数据</span></span><br><span class="line">ws.binaryType = <span class="string">&quot;blob&quot;</span>;</span><br><span class="line">ws.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e.data.size);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 收到的是 ArrayBuffer 数据</span></span><br><span class="line">ws.binaryType = <span class="string">&quot;arraybuffer&quot;</span>;</span><br><span class="line">ws.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e.data.byteLength);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>3，<strong>error</strong>：通行发生错误时触发。</p>
<ul>
<li>对应事件处理程序：ws.onerror。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">socket.onerror = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// handle error event</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">socket.addEventListener(<span class="string">&quot;error&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// handle error event</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>4，<strong>close</strong>：连接关闭时触发。</p>
<ul>
<li>对应事件处理程序：ws.onclose。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ws.onclose = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> code = event.code;</span><br><span class="line">  <span class="keyword">const</span> reason = event.reason;</span><br><span class="line">  <span class="keyword">const</span> wasClean = event.wasClean;</span><br><span class="line">  <span class="comment">// handle close event</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ws.addEventListener(<span class="string">&quot;close&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> code = event.code;</span><br><span class="line">  <span class="keyword">const</span> reason = event.reason;</span><br><span class="line">  <span class="keyword">const</span> wasClean = event.wasClean;</span><br><span class="line">  <span class="comment">// handle close event</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="websocket-方法"><a href="#websocket-方法" class="headerlink" title="websocket 方法"></a>websocket 方法</h4><p>1，<strong>send</strong>()：该方法用于在与服务器连接成功时向服务器发送数据。</p>
<ul>
<li>发送文本的示例如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ws.send(<span class="string">&quot;message&quot;</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>发送 Blob 对象的示例如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> file = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;input[type = &quot;file&quot;]&#x27;</span>).files[<span class="number">0</span>];</span><br><span class="line">ws.send(file);</span><br></pre></td></tr></table></figure>
<ul>
<li>发送 ArrayBuffer 对象的示例如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Sending canvas ImageData as ArrayBuffer</span></span><br><span class="line"><span class="keyword">var</span> img = canvas_context.getImageData(<span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">320</span>);</span><br><span class="line"><span class="keyword">var</span> binary = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(img.data.length);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; img.data.length; i++) &#123;</span><br><span class="line">  binary[i] = img.data[i];</span><br><span class="line">&#125;</span><br><span class="line">ws.send(binary.buffer);</span><br></pre></td></tr></table></figure>
<h4 id="服务端相关"><a href="#服务端相关" class="headerlink" title="服务端相关"></a>服务端相关</h4><p>1，Tomcat 的 7.0.5 版本开始支持 websocket，并且实现了 Java WebSocket 规范（JSR356）。</p>
<p>2，Java WebSocket 应用由一系列的 WebSocketEndpoint 组成。Endpoint 是一个 Java 对象，代表 websocket 链接的一端，对于服务器，我们可以视为处理具体 WebSocket 消息的接口，就像 Servlet 与 http 请求一样。</p>
<p>3，我们可以通过两种方式定义 Endpoint：</p>
<ul>
<li><p>第一种是编程式，即继承类 javax.websocket.Endpoint 并实现其方法。</p>
</li>
<li><p>第二种是注解式，即定义一个 POJO，并添加 @ServerEndpoint 相关注解。</p>
</li>
</ul>
<p>4，Endpoint 实例在 WebSocket 握手时创建，并在客户端与服务端连接过程中有效，最后在连接关闭时结束。在 Endpoint 接口中明确定义了与其声明周期相关的方法，规范实现者确保声明周期的各个阶段调用实例的相关方法，声明周期方法如下：</p>
<ul>
<li><p>onClose：当会话关闭时调用。对应注解为：@OnClose。</p>
</li>
<li><p>onOpen：当开启一个新的会话时调用，该方法是<code>客户端与服务端握手成功后调用</code>的方法。对应注解为：@OnOpen。</p>
</li>
<li><p>onError：当连接过程中异常时调用。对应注解为：@OnError。</p>
</li>
</ul>
<p>5，服务端如何接收客户端发送的数据？</p>
<ul>
<li>通过为 Session 添加 MessageHandler 消息处理器来接收消息。而当采用注解方式定义 Endpoint 时，我们可以通过 @OnMessage 注解指定接收消息的方法。</li>
</ul>
<p>6，服务端如何推送数据给客户端？</p>
<ul>
<li>发送消息则由 RemoteEndpoint 完成，其实例由 Session 维护，根据数据使用情况，我们可以通过 <strong>Session.getBasicRemote</strong> 获取同步消息发送的实例，然后调用其 sendXxx() 方法就可以发送消息，可以通过 <strong>Session.getAsyncRemote</strong> 获取异步消息发送实例。</li>
</ul>
<p>7，服务端相关代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ServerEndpoint(&quot;/robin&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChatEndPoint</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Set&lt;ChatEndPoint&gt; webSocket = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Session session;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@OnMessage</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(String message, Session session)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&#x27;接收的消息时：&#x27;</span> + message);</span><br><span class="line">    System.out.println(session);</span><br><span class="line">    <span class="comment">// 将消息发送给其他的用户</span></span><br><span class="line">    <span class="keyword">for</span> (Chat chat: websocketSet) &#123;</span><br><span class="line">      <span class="keyword">if</span> (chat != <span class="keyword">this</span>) &#123;</span><br><span class="line">        chat.session.getBasicRemote().sendText(message);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@OnOpen</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOpen</span><span class="params">(Session session)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.session = session;</span><br><span class="line">    websocketSet.add(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@OnClose</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Session session)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&#x27;连接关闭了...&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@OnError</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Session session.Throwable error)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&#x27;出错误了...&#x27;</span> + error.getMessage());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="前端建立-websocket-相关代码"><a href="#前端建立-websocket-相关代码" class="headerlink" title="前端建立 websocket 相关代码"></a>前端建立 websocket 相关代码</h4><p>1，心跳检测相关思路与说明：</p>
<ul>
<li><p>每隔一段指定的时间（计时器），向服务器发送一个数据，服务器收到数据后再发送给客户端，正常情况下客户端通过 onmessage 事件是能监听到服务器返回的数据的，说明请求正常。</p>
</li>
<li><p>如果再这个指定时间内，客户端没有收到服务器端返回的响应消息，就判定连接断开了，使用 websocket.close 关闭连接。</p>
</li>
<li><p>这个关闭连接的动作可以通过 onclose 事件监听到，因此在 onclose 事件内，我们可以调用 websocketReconnect 事件进行重连操作。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> ws;</span><br><span class="line"><span class="comment">// lockReconnect用于避免重复连接</span></span><br><span class="line"><span class="keyword">let</span> lockReconnect = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">// 连接ws的url</span></span><br><span class="line"><span class="keyword">const</span> wsUrl = <span class="string">&quot;ws://127.0.0.1:8000&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> QUERY_ALL_FRAME = &#123;</span><br><span class="line">  action: <span class="string">&#x27;queryMessage&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 心跳检测</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> HEARTBEAT_FRAME = &#123;</span><br><span class="line">  action: <span class="string">&#x27;heartBeat&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除消息</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> DELETE_FRAME = &#123;</span><br><span class="line">  action: <span class="string">&#x27;deleteMessageAll&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建websocket</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createWebSocket</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 创建前先关闭创建好的ws</span></span><br><span class="line">    closeSocket();</span><br><span class="line">    ws = <span class="keyword">new</span> WebScoket(wsUrl);</span><br><span class="line">    websocketInit();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;catch&quot;</span>);</span><br><span class="line">    <span class="comment">// 出现异常时，重新连接ws</span></span><br><span class="line">    websocketReconnect(wsUrl);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化ws事件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">websocketInit</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ws.onopen = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    onOpen(event);</span><br><span class="line">  &#125;;</span><br><span class="line">  ws.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    onMessage(event);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// 断开连接时重新连接ws</span></span><br><span class="line">  ws.onclose = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    onClose(event);</span><br><span class="line">    websocketReconnect(event);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// 连接出现异常时重新连接ws</span></span><br><span class="line">  ws.onerror = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    onError(event);</span><br><span class="line">    websocketReconnect(event);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭ws连接</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">closeSocket</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (ws) &#123;</span><br><span class="line">    ws.onclose = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">    ws.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重新连接ws</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">websocketReconnect</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (lockReconnect) <span class="keyword">return</span>;</span><br><span class="line">  lockReconnect = <span class="literal">true</span>;</span><br><span class="line">  wstime &amp;&amp; <span class="built_in">clearTimeout</span>(wstime);</span><br><span class="line">  <span class="comment">// 连接断开时每个5s再次连接</span></span><br><span class="line">  <span class="keyword">const</span> wstime = <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    createWebSocket(url);</span><br><span class="line">    lockReconnect = <span class="literal">false</span>;</span><br><span class="line">  &#125;, <span class="number">5000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置心跳检测</span></span><br><span class="line"><span class="keyword">const</span> heartCheck = &#123;</span><br><span class="line">  timeout: <span class="number">50000</span>;</span><br><span class="line">  timeoutObj: <span class="literal">null</span>;</span><br><span class="line">  serverTimeoutObj: <span class="literal">null</span>;</span><br><span class="line">  start: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> self = <span class="built_in">this</span>;</span><br><span class="line">    <span class="built_in">this</span>.timeoutObj &amp;&amp; <span class="built_in">clearTimeout</span>(<span class="built_in">this</span>.timeoutObj);</span><br><span class="line">    <span class="built_in">this</span>.serverTimeoutObj &amp;&amp; <span class="built_in">clearTimeout</span>(<span class="built_in">this</span>.serverTimeoutObj);</span><br><span class="line">    <span class="comment">// 每隔50000进行心跳检测</span></span><br><span class="line">    <span class="built_in">this</span>.timeoutObj = <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      sendMessage(<span class="built_in">JSON</span>.stringify(HEARTBEAT_FRAME));</span><br><span class="line">      <span class="comment">// 如果50000之内没有操作关闭ws连接</span></span><br><span class="line">      self.serverTimeoutObj = <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        ws.close();</span><br><span class="line">      &#125;, self.timeout);</span><br><span class="line">    &#125;, <span class="built_in">this</span>.timeout);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送消息</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">sendMessage</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (ws &amp;&amp; ws.readyState === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      ws.send(msg);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ws连接成功</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onOpen</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  sendMessage(<span class="built_in">JSON</span>.stringify(QUERY_ALL_FRAME));</span><br><span class="line">  <span class="comment">// 发送消息之后重新进行心跳检测</span></span><br><span class="line">  heartCheck.start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 收到服务端数据</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onMessage</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="built_in">JSON</span>.parse(event.data);</span><br><span class="line">    <span class="keyword">if</span> (data.code === <span class="number">200</span>) &#123; <span class="comment">// 心跳数据不处理</span></span><br><span class="line">      <span class="comment">// 所需的正常操作</span></span><br><span class="line">      <span class="keyword">if</span> (data.action === <span class="string">&#x27;heartBeat&#x27;</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(event.data);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 解析处理数据</span></span><br><span class="line">        <span class="keyword">if</span> (data.action === <span class="string">&#x27;queryMessage&#x27;</span>) &#123;</span><br><span class="line">          initTaskList(data.data || []);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data.action === <span class="string">&#x27;saveMessage&#x27;</span>) &#123;</span><br><span class="line">          addTask(data.data || <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;收到非格式化数据&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 拿到任何消息都说明当前连接是正常的，此时从新进行心跳检测</span></span><br><span class="line">  heartCheck.start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭连接</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onClose</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(event);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接出错</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onError</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>通信协议</category>
        <category>websocket</category>
      </categories>
      <tags>
        <tag>websocket</tag>
      </tags>
  </entry>
  <entry>
    <title>React</title>
    <url>/2019/02/20/react/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="React-的定义方式"><a href="#React-的定义方式" class="headerlink" title="React 的定义方式"></a>React 的定义方式</h3><h4 id="定义方式一"><a href="#定义方式一" class="headerlink" title="定义方式一"></a>定义方式一</h4><p>1，使用函数定义的方式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">App</span>（<span class="title">props</span>）</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>(</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            <span class="comment">/* return中只能存在一个div包裹的情况，</span></span><br><span class="line"><span class="comment">            不能存在两个div同等级的情况。*/</span></span><br><span class="line">            &lt;h1&gt;&#123;props.xxx&#125;&lt;/h1&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<a id="more"></a>

<h4 id="定义方式二"><a href="#定义方式二" class="headerlink" title="定义方式二"></a>定义方式二</h4><p>1，使用类定义的方式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;&#123;<span class="built_in">this</span>.state.xxx&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="React-的渲染方式"><a href="#React-的渲染方式" class="headerlink" title="React 的渲染方式"></a>React 的渲染方式</h3><h4 id="函数式或类"><a href="#函数式或类" class="headerlink" title="函数式或类"></a>函数式或类</h4><p>1，不管是函数定义的方式，还是类定义的方式，都是使用同一种渲染方式:</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span>/&gt;</span></span>,<span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="react-PureComponent"><a href="#react-PureComponent" class="headerlink" title="react.PureComponent"></a>react.PureComponent</h3><h4 id="PureComponent-与-shouldComponentUpdate"><a href="#PureComponent-与-shouldComponentUpdate" class="headerlink" title="PureComponent 与 shouldComponentUpdate"></a>PureComponent 与 shouldComponentUpdate</h4><p>1，<strong>PureComponent</strong> 会对数据进行浅比较，即可对其他组件传递过来的状态（props）进行浅比较，如果前后状态相同，则不会触发 render 进行状态更新，也就不会更新视图。否则反之。</p>
<p>2，可使用 <strong>shouldComponentUpdate()</strong> 生命周期函数代替 PureComponent。</p>
<p>3，具体用法示例如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">PureComponent</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;前后状态不一样，我更新了~~~&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h3&gt;Child1:&#123;<span class="built_in">this</span>.props.count&#125;&lt;/h3&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="react-Component"><a href="#react-Component" class="headerlink" title="react.Component"></a>react.Component</h3><h4 id="Component-说明："><a href="#Component-说明：" class="headerlink" title="Component 说明："></a>Component 说明：</h4><p>1，Component 不会对数据进行比较。不管前后状态是否相同，都会触发 render 进行状态更新。</p>
<h3 id="React-memo"><a href="#React-memo" class="headerlink" title="React.memo()"></a>React.memo()</h3><h4 id="memo-说明"><a href="#memo-说明" class="headerlink" title="memo 说明"></a>memo 说明</h4><p>1，React.memo() 和 PureComponent 很相似，他可以控制组件是否进行渲染。</p>
<p>2，组件仅在它的 props 发生改变的时候进行重新渲染。通常来说，在组件树中 React 组件，只要有变化就会走一遍渲染流程。但是通过 PureComponent 和 React.memo()，我们可以仅仅让某些组件进行渲染。</p>
<p>3，PureComponent 要依靠 class 才能使用。而 React.memo() 可以和 function component 一起使用。</p>
<p>4，React.memo() 基本使用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;ChildRender&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Child:&#123;this.props.count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 只有当this.props.count与前一次不一样才触发render进行状态更新。</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> React.memo(Child);</span><br></pre></td></tr></table></figure>
<h3 id="Fragment"><a href="#Fragment" class="headerlink" title="Fragment"></a>Fragment</h3><h4 id="Fragment-说明"><a href="#Fragment-说明" class="headerlink" title="Fragment 说明"></a>Fragment 说明</h4><p>1，Fragment 组件可以防止产生无意义标签，从而影响 HTML 页面结构。或者直接使用空标签：&lt;&gt;&lt;/&gt;（空标签）也能达到 Fragment 的效果。但官方推荐使用 Fragment。</p>
<h3 id="React-中-props-属性"><a href="#React-中-props-属性" class="headerlink" title="React 中 props 属性"></a>React 中 props 属性</h3><h4 id="props-理解"><a href="#props-理解" class="headerlink" title="props 理解"></a>props 理解</h4><p>1，每个组件对象都会有 props 属性。</p>
<p>2，组件标签的所有属性都保存在 props 属性中。</p>
<p>3，props 中保存的属性是从外部传递过来的。</p>
<h4 id="props-作用"><a href="#props-作用" class="headerlink" title="props 作用"></a>props 作用</h4><p>1，通过标签属性从组件外向组件内传递变化的数据。</p>
<p>2，<strong>注意</strong>：组件内部不要修改 props 数据。</p>
<p>3，编码操作：</p>
<ul>
<li><p>内部读取某个属性值：<strong>this.props.propsTypeName</strong>。</p>
</li>
<li><p>对 props 中的属性值进行类型限制和必要性限制（即对属性的类型进行检测并且可对属性进行必要性限制）。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 设置传递过来的属性需要时字符串类型，且是必要的</span></span><br><span class="line">App.propType = &#123;</span><br><span class="line">  name: PropType.string.isRequired,</span><br><span class="line">  age: PropType.string.isRequired,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>设置默认属性值：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 如果没有传递设定的name属性，则默认使用snsn</span></span><br><span class="line">App.defaultProps = &#123;</span><br><span class="line">  name: <span class="string">&quot;snsn&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>4，propsTypes 使用示例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">&quot;prop-types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./index.css&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">TodoHeader</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// console.log(props)</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;header&quot;</span>&gt;</span><br><span class="line">      &lt;h1 className=<span class="string">&quot;logo&quot;</span>&gt;</span><br><span class="line">        &lt;a href=<span class="string">&quot;https://react.docschina.org/&quot;</span> title=<span class="string">&quot;React官网&quot;</span>&gt;</span><br><span class="line">          React官网</span><br><span class="line">        &lt;/a&gt;</span><br><span class="line">      &lt;/h1&gt;</span><br><span class="line">      &lt;h1&gt;&#123;props.children&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;h3&gt;&#123;props.desc&#125;&lt;/h3&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TodoHeader.propTypes = &#123;</span><br><span class="line">  desc: PropTypes.string.isRequired,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置desc默认值</span></span><br><span class="line">TodoHeader.defaultProps = &#123;</span><br><span class="line">  desc: <span class="string">&quot;踏足山巅&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>5，组件类的构造函数：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">constroutor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props)</span><br><span class="line">    <span class="comment">// 查看props中所有的属性</span></span><br><span class="line">    <span class="built_in">console</span>.log(props)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="React-中-state-属性"><a href="#React-中-state-属性" class="headerlink" title="React 中 state 属性"></a>React 中 state 属性</h3><h4 id="state-说明"><a href="#state-说明" class="headerlink" title="state 说明"></a>state 说明</h4><p>1，state 属性理解：</p>
<ul>
<li>state 是组件对象最重要的属性，值是对象（可包含多个数据）。组件被称为“状态肌”，通过更新组件的 state 属性来更新对应的页面显示（重新渲染组件）。</li>
</ul>
<p>2，state 属性使用：</p>
<ul>
<li><p>读取属性：<code>this.state.stateName</code>。</p>
</li>
<li><p>更新属性：this.setState()。</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="built_in">this</span>.setState(&#123;</span><br><span class="line">  stateName: newValue,</span><br><span class="line">  stateName1: newValue1,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="setState-方法说明："><a href="#setState-方法说明：" class="headerlink" title="setState() 方法说明："></a>setState() 方法说明：</h4><p>1，关于 setState 是同步还是异步的问题：</p>
<ul>
<li>setState 是 react 控制的就是异步的，不属于 react 控制的就是同步的，比如在定时器中执行时就是同步的。而在 componentDidMount 生命周期中执行时就是异步的。</li>
</ul>
<p>2，setState 在生命周期中执行时为异步操作，setState 会合并所有异步执行，直到异步执行完毕以后，才会执行 setState 中的异步回调函数。</p>
<p>3，具体代码示例如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">SetState</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">   state = &#123;</span><br><span class="line">      count:<span class="number">0</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 在此执行setState为异步，会将异步操作合并一起，只更新一次状态</span></span><br><span class="line">   <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">         count:<span class="built_in">this</span>.state.count+<span class="number">1</span></span><br><span class="line">      &#125;,<span class="function">() =&gt;</span> &#123;</span><br><span class="line">         <span class="built_in">console</span>.log(<span class="built_in">this</span>.state.count) <span class="comment">// 1</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="built_in">this</span>.state.count,<span class="string">&#x27;1515151515&#x27;</span>)  <span class="comment">// 0</span></span><br><span class="line">      <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">         count:<span class="built_in">this</span>.state.count+<span class="number">1</span></span><br><span class="line">      &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">         <span class="built_in">console</span>.log(<span class="built_in">this</span>.state.count) <span class="comment">// 1</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="built_in">this</span>.state.count,<span class="string">&#x27;1919191919&#x27;</span>)  <span class="comment">// 0</span></span><br><span class="line">      <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">         count:<span class="built_in">this</span>.state.count+<span class="number">1</span></span><br><span class="line">      &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">         <span class="built_in">console</span>.log(<span class="built_in">this</span>.state.count,<span class="string">&quot;25252525&quot;</span>) <span class="comment">// 1</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="built_in">this</span>.state.count, <span class="string">&#x27;2727272727&#x27;</span>)  <span class="comment">// 0</span></span><br><span class="line">      &lt;!--三次更新合并成了一次更新，此时count为<span class="number">1</span>--&gt;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 在此执行setState为同步</span></span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">         <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">            count:<span class="built_in">this</span>.state.count+<span class="number">1</span></span><br><span class="line">         &#125;)</span><br><span class="line">         <span class="built_in">console</span>.log(<span class="built_in">this</span>.state.count) <span class="comment">// 2</span></span><br><span class="line">         <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">            count:<span class="built_in">this</span>.state.count+<span class="number">1</span></span><br><span class="line">         &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="built_in">this</span>.state.count, <span class="string">&quot;37373737&quot;</span>) <span class="comment">// 3</span></span><br><span class="line">         &#125;)</span><br><span class="line">         <span class="built_in">console</span>.log(<span class="built_in">this</span>.state.count, <span class="string">&quot;39393939&quot;</span>) <span class="comment">// 3</span></span><br><span class="line">      &#125;, <span class="number">0</span>);</span><br><span class="line">   &#125; <span class="comment">// count最终为3</span></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">         &lt;div&gt;</span><br><span class="line">            &lt;!--最终输出结果为<span class="number">3</span>--&gt;</span><br><span class="line">            &lt;h1&gt;&#123;<span class="built_in">this</span>.state.count&#125;&lt;/h1&gt;</span><br><span class="line">         &lt;/div&gt;</span><br><span class="line">      )</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4，使用 prevState (上一次 state 的状态)可实时在 setState() 方法中更新 state 的状态，不管 setState 是同步或是异步都可以。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">SetState</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用prevState实时更新状态</span></span><br><span class="line">  <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(</span><br><span class="line">      (prevState, props) =&gt; (&#123;</span><br><span class="line">        count: prevState.count + <span class="number">1</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.state.count); <span class="comment">// 1</span></span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">    <span class="built_in">this</span>.setState(</span><br><span class="line">      (prevState, props) =&gt; (&#123;</span><br><span class="line">        count: prevState.count + <span class="number">1</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.state.count); <span class="comment">// 2</span></span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">    <span class="built_in">this</span>.setState(</span><br><span class="line">      (prevState, props) =&gt; (&#123;</span><br><span class="line">        count: prevState.count + <span class="number">1</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.state.count); <span class="comment">// 3</span></span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.setState(</span><br><span class="line">        (prevState, props) =&gt; (&#123;</span><br><span class="line">          count: prevState.count + <span class="number">1</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">        () =&gt; &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="built_in">this</span>.state.count); <span class="comment">// 4</span></span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">      <span class="built_in">this</span>.setState(</span><br><span class="line">        (prevState, props) =&gt; (&#123;</span><br><span class="line">          count: prevState.count + <span class="number">1</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">        () =&gt; &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="built_in">this</span>.state.count); <span class="comment">// 5</span></span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        输出为0是因为setTimeout是异步的，</span></span><br><span class="line"><span class="comment">        而componentDidMount中setState也是异步的。</span></span><br><span class="line"><span class="comment">        所以最先输出0</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.state.count); <span class="comment">// 0</span></span><br><span class="line">  &#125; <span class="comment">// 最终输出结果为5</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;&#123;<span class="built_in">this</span>.state.count&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5，类组件中更新状态注意点：</p>
<ul>
<li>如果需要在类组件中更新状态，必须调用 setState 方法。</li>
</ul>
<p>6，setState()方法参数说明：</p>
<ul>
<li><p>setState()方法可以有两个参数：第一个参数又有两种情况：可以是一个<code>对象</code>，也可以是一个<code>回调函数</code>。第二个参数为一个回调函数。<strong>如果需要得到最新更改的状态，需要在此回调函数中获取</strong>。</p>
</li>
<li><p><strong>提示</strong>：当 setState() 使用<code>回调函数</code>作为第一个参数时，可以使用 prevState 属性（上一次的状态）来实时的更新状态。</p>
</li>
</ul>
<h3 id="state-与-props-的区别"><a href="#state-与-props-的区别" class="headerlink" title="state 与 props 的区别"></a>state 与 props 的区别</h3><h4 id="state"><a href="#state" class="headerlink" title="state"></a>state</h4><p>1，state 属性为自身组件内部的属性。</p>
<p>2，该属性是保存组件内部状态的最重要的属性。当需要获取组件内部的属性时，需写成：this.state.innerState。</p>
<h4 id="props"><a href="#props" class="headerlink" title="props"></a>props</h4><p>1，props 属性为组件外部的属性。</p>
<p>2，该属性在自身组件内部是没有的。当一个组件需要获取外部传入的属性的时候就需要使用 props 属性。并且在类组件中需要使用 this 这个属性。即当需要获取自身组件外部传入的属性时，需写成：this.props.exteriorState。</p>
<h3 id="React-受控组件与非受控组件"><a href="#React-受控组件与非受控组件" class="headerlink" title="React 受控组件与非受控组件"></a>React 受控组件与非受控组件</h3><h4 id="受控组件"><a href="#受控组件" class="headerlink" title="受控组件"></a>受控组件</h4><p>1，受控组件概述：组件自身状态受到 react 控制，需要触发 onChange 事件对自身状态进行更新。</p>
<p>2，受控组件使用环境：常用于收集表单数据，例如 <code>&lt;input&gt;&lt;select&gt;&lt;textearea&gt;</code> 等元素都要绑定一个 change 事件，当表单的状态发生变化，就会触发 onChange 事件，更新组件的 state。</p>
<!-- - 表单元素具体属性及方法回调中的新值说明：

|            元素             |         属性         |   方法   |   方法回调中的新值   |
| :-------------------------: | :------------------: | :------: | :------------------: |
|   `<input type="text" />`   |    value="string"    | onChange |  event.target.value  |
| `<input type="checkbox" />` |  checked={boolean}   | onChange | event.target.checked |
|   `<input type="radio"/>`   |  checked={boolean}   | onChange | event.target.checked |
|       `<textarea />`        |    value="string"    | onChange |  event.target.value  |
|        `<select />`         | value="option value" | onChange |  event.target.value  | -->

<p>3，具体代码说明：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Controlled</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  satte = &#123;</span><br><span class="line">    value: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  handleChange = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      content: e.target.value,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          type=<span class="string">&quot;text&quot;</span></span><br><span class="line">          value=&#123;<span class="built_in">this</span>.state.value&#125;</span><br><span class="line">          onChange=&#123;<span class="built_in">this</span>.handleChange&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="非受控组件"><a href="#非受控组件" class="headerlink" title="非受控组件"></a>非受控组件</h4><p>1，非受控组件概述：数据由 DOM 本身控制，即不受 react 控制，它使用一个 ref 来从 DOM 获得表单值。</p>
<p>2，非受控组件具体使用场景：需要操作 DOM 时使用，比如需要获取输入框焦点，或者失去焦点。</p>
<p>3，具体代码说明：</p>
<p>4，函数式组件中使用 ref：</p>
<blockquote>
<p>函数式组件中使用 ref</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NameForm</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.handleSubmit = <span class="built_in">this</span>.handleSubmit.bind(<span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">handleSubmit</span>(<span class="params">event</span>)</span> &#123;</span><br><span class="line">    event.preventDefault();</span><br><span class="line">    alert(<span class="string">&quot;value is: &quot;</span> + <span class="built_in">this</span>.input.value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;form onSubmit=&#123;<span class="built_in">this</span>.handleSubmit&#125;&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">          Name:</span><br><span class="line">          &lt;input type=<span class="string">&quot;text&quot;</span> ref=&#123;<span class="function">(<span class="params">input</span>) =&gt;</span> (<span class="built_in">this</span>.input = input)&#125; /&gt;</span><br><span class="line">        &lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Submit&quot;</span> /&gt;</span><br><span class="line">      &lt;/form&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>react 类 (class) 组件中 ref 容器</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Uncontrolled</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123; <span class="attr">context</span>: <span class="string">&quot;&quot;</span> &#125;;</span><br><span class="line">  inpRef = React.createRef();</span><br><span class="line">  handleClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(</span><br><span class="line">      &#123;</span><br><span class="line">        context: <span class="built_in">this</span>.inpRef.current.value,</span><br><span class="line">      &#125;,</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        <span class="built_in">this</span>.inpRef.current.focus();</span><br><span class="line">        <span class="built_in">this</span>.inpRef.current.value = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;text&quot;</span> ref=&#123;<span class="built_in">this</span>.inpRef&#125; /&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="built_in">this</span>.handleClick&#125;&gt;submit&lt;/button&gt;</span><br><span class="line">        &lt;h1&gt;&#123;<span class="built_in">this</span>.state.context&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="React-生命周期"><a href="#React-生命周期" class="headerlink" title="React 生命周期"></a>React 生命周期</h3><h4 id="生命周期概述"><a href="#生命周期概述" class="headerlink" title="生命周期概述"></a>生命周期概述</h4><p>1，React 生命周期（组件从创建到消失的整个过程）分为三个阶段，分别为：<code>mounting(实例化期)</code>、<code>updating(存在期)</code>、<code>unmounting(销毁期)</code>。</p>
<h4 id="生命周期图谱"><a href="#生命周期图谱" class="headerlink" title="生命周期图谱"></a>生命周期图谱</h4><p><img src="/2019/02/20/react/reactLife.png" alt="reactLife"></p>
<p><img src="/2019/02/20/react/reactLife1.png" alt="reactLife1"></p>
<p><img src="/2019/02/20/react/reactLife2.webp" alt="reactLife2"></p>
<h4 id="mounting-阶段（实例化时期）："><a href="#mounting-阶段（实例化时期）：" class="headerlink" title="mounting 阶段（实例化时期）："></a>mounting 阶段（实例化时期）：</h4><p>1，mounting 阶段概述：就是 component（组件）被 render（）方法解析成对应的 DOM 节点，并被插入到浏览器的 DOM 结构的一个过程（组件从无到有的过程）。</p>
<p>2，<strong>注意</strong>：<code>constructor()</code>只会在初始化时执行一次。以后都不再执行。所以需要改变状态不能写在 constructor()方法中。</p>
<blockquote>
<p>mounting 阶段生命周期函数解析：</p>
</blockquote>
<p>1，UNSAFE_componentWillMount()：</p>
<ul>
<li><p>该方法在首次渲染（调用 render 方法）之前用，在这一阶段组件还未始实例化，类似于 Vue 生命周期中的 created。</p>
</li>
<li><p>项目应用：用于做一些组件初始化需要调用的数据处理，也可以在这一阶段触发 loading 事件。</p>
</li>
</ul>
<p>2，componentDidMount()：</p>
<ul>
<li><p>该方法在首次渲染（调用 render 方法）之后调用，在这一阶段组件已经实例化完成，类似于 Vue 生命周期中的 mounted。</p>
</li>
<li><p>componentDidMount() 会在组件挂载后（插入 DOM 树中）立即调用。依赖于 DOM 节点的初始化应该放在这里。</p>
</li>
<li><p>项目应用：dom 加载完成后，发起 axios 请求，拿回数据，结束 loading 事件。</p>
</li>
</ul>
<p>3，static getDerivedStateFromProps()：</p>
<ul>
<li><p>static getDerivedStateFromProps(props, state)。</p>
</li>
<li><p>getDerivedStateFromProps 在初始安装和后续更新上都在调用 render 方法之前立即调用。</p>
</li>
<li><p>该方法应该返回一个对象以更新状态，或者返回 null 则不更新任何内容。</p>
</li>
<li><p>即使自身 props 没有任何变化，而是父组件 state 发生了变化，导致子组件发生了 re-render，该生命周期函数依然会被调用。</p>
</li>
<li><p>该生命周期函数是为了替代<code>componentWillReceiveProps</code>存在的，所以在你需要使用 componentWillReceiveProps 的时候，就可以考虑使用<code>getDerivedStateFromProps</code>来进行替代了。</p>
</li>
<li><p>该方法参数与<code>componentWillReceiveProps</code>不同，getDerivedStateFromProps 是一个静态函数，也就是这个函数不能通过 this 访问到 class 的属性，也并不推荐直接访问属性。而是应该通过参数提供的<strong>nextProps</strong>以及<strong>prevState</strong>来进行判断，根据新传入的 props 来映射到 state。</p>
</li>
<li><p><strong>注意</strong>：如果 props 传入的内容不需要影响到你的 state ，那么就需要返回一个 null ，这个返回值是必须的，所以尽量将其写到函数的末尾。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="function"><span class="title">getDerivedStateFromProps</span>(<span class="params">nextProps, prevState</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;type&#125; = nextProps;</span><br><span class="line">    <span class="comment">// 当传入的type发生变化的时候，更新state</span></span><br><span class="line">    <span class="keyword">if</span> (type !== prevState.type) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            type,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 否则，对于state不进行任何操作</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="updating-阶段（存在期）"><a href="#updating-阶段（存在期）" class="headerlink" title="updating 阶段（存在期）"></a>updating 阶段（存在期）</h4><p>1，updating 阶段概述：一个 mounted 的 React Component 被重新 render 的过程（只有 state（内部状态），props（外部状态）确实改变了），react 才会改变对应的 DOM 结构。</p>
<blockquote>
<p>updating 阶段生命周期函数解析：</p>
</blockquote>
<p>2，UNSAFE_componentWillReceiveProps()：</p>
<ul>
<li><p>UNSAFE_componentWillReceiveProps(nextProps)。</p>
</li>
<li><p>该方法用于：当一个 mounted 要接收新的 props 时才会被调用，函数参数就是将要接收的 props。（即用于接收外部状态（props）的方法）。</p>
</li>
<li><p>项目应用：子组件表格从父组件获取 props，并在每次 props 更新后随之更新表格的数据。</p>
</li>
</ul>
<p>3，shouldComponentUpdate()：</p>
<ul>
<li><p>shouldComponentUpdate(nextProps, nextState)。</p>
</li>
<li><p>该组件在 render 方法之前调用。</p>
</li>
<li><p>该方法用于确定是否有必要更新 DOM 结构，参数是新的 nextProps 对象，和新的 nextState 对象，分别对比 this.props 和 this.state ，返回 true 为更新，返回 false 为不更新。</p>
</li>
<li><p>当<code>nextProps</code> === <code>this.props.xxx</code>时，说明前后状态相同，此时可以<code>return false</code>，告诉 render 不需要更新状态。否则返回 true，告诉 render 需要更新状态。</p>
</li>
</ul>
<p>4，UNSAFE_componentWillUpdate()：</p>
<ul>
<li><p>UNSAFE_componentWillUpdate(nextProps, nextState)。</p>
</li>
<li><p>该方法用于：如果 shouldComponentUpdata 返回为 true 则调用，在组件更新（re-render）前调用，首次 render（初始化时）不调用。</p>
</li>
</ul>
<p>5，getSnapshotBeforeUpdate()：</p>
<ul>
<li><p>getSnapshotBeforeUpdate(prevProps, prevState)。</p>
</li>
<li><p>该方法在 render 之前调用，此时 state 已更新，但页面上 state 还未更新。</p>
</li>
<li><p>该方法主要用于获取 render 之前的 DOM 状态（如 render 之前的某 DOM 元素的 scrollHeight（滚动条可滚动高度））。</p>
</li>
<li><p>该方法让组件可以在 DOM 可能发生更改之前捕获某些信息（例如，滚动位置）。此生命周期返回的任何值都将作为参数传递<code>componentDidUpdate()</code>。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取当前rootNode的scrollHeight，传到componentDidUpdate的参数perScrollHeight</span></span><br><span class="line"><span class="function"><span class="title">getSnapshotBeforeUpdate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.rootNode.scrollHeight;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">componentDidUpdate</span>(<span class="params">perProps, perState, perScrollHeight</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> curScrollTop = <span class="built_in">this</span>.rootNode.scrollTop;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (curScrollTop &lt; <span class="number">5</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="comment">// perScrollHeight：为更新前的可滚动距离</span></span><br><span class="line">  <span class="comment">// this.rootNode.scrollHeight：为更新后的可滚动距离</span></span><br><span class="line">  <span class="built_in">this</span>.rootNode.scrollTop = curScrollTop + (<span class="built_in">this</span>.rootNode.scrollHeight  - perScrollHeight);</span><br><span class="line">  <span class="comment">/*使用当前滚动条的位置加上每次增加的可滚动距离。</span></span><br><span class="line"><span class="comment">  相当于使滚动条自动向下滑动一个div增加的可滚动距离，这样看起来内容就没有滚动。*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>6，componentDidUpdate()：</p>
<ul>
<li><p>componentDidUpdate(prevProps, prevState, snapshot)。</p>
</li>
<li><p>该方法在 componentWillUpdate() 方法之后执行，组件重新 render 后立即调用，首次 render（初始化时）不调用。此时组件中与页面中的 state 都是最新的。</p>
</li>
<li><p>当组件已更新时，可借此机会在 DOM 上进行操作。只要将当前道具与以前的道具进行比较，这也是执行网络请求的好地方（例如，如果道具未更改，则可能不需要网络请求）。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">componentDidUpdate</span>(<span class="params">prevProps</span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 对新的userID与上一次的userID进行比较</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.props.userID !== prevProps.userID) &#123;</span><br><span class="line">    <span class="comment">// 前后userID不一致，则发送异步请求</span></span><br><span class="line">    <span class="built_in">this</span>.fetchData(<span class="built_in">this</span>.props.userID);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="unmounted-阶段（销毁期）："><a href="#unmounted-阶段（销毁期）：" class="headerlink" title="unmounted 阶段（销毁期）："></a>unmounted 阶段（销毁期）：</h4><p>1，unmounted 阶段概述：一个 mounted 的 React Component 对应的 DOM 节点被从 DOM 节点移除的过程。</p>
<blockquote>
<p>unmounted 阶段生命周期函数解析：</p>
</blockquote>
<p>1，componentWillUnmount()：</p>
<ul>
<li><p>该方法用于：当需要销毁挂载的副作用组件时，在此方法中销毁。该方法会在组件卸载即销毁之前直接调用。在此方法中执行必要的清理操作，例如，清除定时器，取消网络请求或清除在 componentDidMount() 方法中创建的订阅等。</p>
</li>
<li><p>componentWillUnmount() 方法中不应调用 setState() 方法，因为该组件将永远不会重新渲染。组件实例卸载后，将永远不会再挂载它。</p>
</li>
</ul>
<h3 id="组件的组合"><a href="#组件的组合" class="headerlink" title="组件的组合"></a>组件的组合</h3><h4 id="功能界面的组件化编流程"><a href="#功能界面的组件化编流程" class="headerlink" title="功能界面的组件化编流程"></a>功能界面的组件化编流程</h4><p>1，拆分组件：拆分界面，抽取组件。</p>
<p>2，实现静态组件：使用组件实现静态页面效果。</p>
<p>3，实现动态组件：</p>
<ul>
<li><p>动态显示初始化数据。</p>
</li>
<li><p>交互功能（从绑定监听开始）。</p>
</li>
</ul>
<h4 id="状态数据的保存"><a href="#状态数据的保存" class="headerlink" title="状态数据的保存"></a>状态数据的保存</h4><p>1，看状态数据是某个组件需要（即给某个），还是某些组件需要（给共同的父组件）。</p>
<h4 id="处理在子组件中改变父组件状态的情况"><a href="#处理在子组件中改变父组件状态的情况" class="headerlink" title="处理在子组件中改变父组件状态的情况"></a>处理在子组件中改变父组件状态的情况</h4><p>1，子组件中不能直接改变父组件的状态。即：状态在哪个组件，更新状态的行为就应该定义在哪个组件。</p>
<p>2，父组件定义函数，通过在 return 的 <code>&lt;div&gt;&lt;子组件 XXX =&#123;this.XXX &#125;/&gt;&lt;/div&gt;</code><br>标签当中传递给子组件，再由子组件通过：<code>this.props.XXX</code>调用。</p>
<h3 id="组件间通信的方式"><a href="#组件间通信的方式" class="headerlink" title="组件间通信的方式"></a>组件间通信的方式</h3><h4 id="使用-props-传递"><a href="#使用-props-传递" class="headerlink" title="使用 props 传递"></a>使用 props 传递</h4><p>1，共同的数据放在父组件中，特有的数据放在自己的组件内部（state）。</p>
<p>2，通过 props 可以传递一般数据和函数数据，但只能逐层传递。</p>
<ul>
<li><p>一般数据 =&gt; 父组件传递数据给子组件 =&gt; 子组件读取数据。</p>
</li>
<li><p>函数数据 =&gt; 子组件传递数据给父组件 =&gt; 子组件调用函数。</p>
</li>
</ul>
<h4 id="使用-PubSub-发布订阅机制"><a href="#使用-PubSub-发布订阅机制" class="headerlink" title="使用 PubSub 发布订阅机制"></a>使用 PubSub 发布订阅机制</h4><p>1，参考官网：<a href="https://www.npmjs.com/package/pubsub-js">PubSubJS</a></p>
<p>2，下载：npm install pubsub-js –save</p>
<p>3，使用步骤：</p>
<ul>
<li><p>引入：import Pubsub from ‘pubsub-js’。</p>
</li>
<li><p>订阅消息：PubSub.subscribe(‘delete(主题名)’, function(msg, data){…})</p>
<ul>
<li>一般定义在父组件中订阅消息。</li>
</ul>
</li>
<li><p>发布消息：PubSub.publish(‘delete(主题名)’, ‘data(需要发布的数据)’)</p>
<ul>
<li>一般定义在子组件中发布消息。</li>
</ul>
</li>
<li><p>PubSub.subscribe() 参数说明：</p>
<ul>
<li><p>第一个为事件主题名称，该名称必须与 PubSub.publish() 中发布的事件主题名称保持一致。</p>
</li>
<li><p>第二个为回调函数，该回调函数也接受两个参数：</p>
<ul>
<li><p>第一个为发布的事件主题名称。</p>
</li>
<li><p>第二个为发布的对象数据。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>PubSub.publish() 参数说明：</p>
<ul>
<li><p>第一个为事件主题名称，该名称需要与 PubSub.subscribe() 中订阅的事件主题名称保持一致。</p>
</li>
<li><p>第二个为需要发布的状态数据。</p>
</li>
</ul>
</li>
</ul>
<p>4，如何取消订阅：</p>
<ul>
<li><p>PubSub.unsubscribe(msgId)：用于取消指定事件主题名称的订阅。</p>
</li>
<li><p>PubSub.unsubscribe(this.pubSub_token)：用于取消指定功能的所有订阅。</p>
</li>
<li><p>PubSub.clearAllSubscriptions()：用于取消全部订阅。</p>
</li>
</ul>
<p>5，具体使用案例：</p>
<ul>
<li>子组件发布消息：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> PubSub <span class="keyword">from</span> <span class="string">&quot;pubsub-js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> msgId = <span class="string">&quot;pubsubName&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> msgId1 = <span class="string">&quot;pubsubAge&quot;</span>;</span><br><span class="line"><span class="comment">// 在有数据的地方进行发布</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123; <span class="attr">name</span>: <span class="string">&quot;snsn&quot;</span>, <span class="attr">age</span>: <span class="number">25</span> &#125;;</span><br><span class="line">  pubSubhandleClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    PubSub.publish(msgId, <span class="built_in">this</span>.state.name);</span><br><span class="line">    PubSub.publish(msgId1, <span class="built_in">this</span>.state.age);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;button onClick=&#123;<span class="built_in">this</span>.pubSubhandleClick&#125;&gt;Child PubSub.publish&lt;/button&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>父组件订阅消息：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> PubSub <span class="keyword">from</span> <span class="string">&quot;pubsub-js&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">&quot;./Child&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; msgId &#125; <span class="keyword">from</span> <span class="string">&quot;./Child&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; msgId1 &#125; <span class="keyword">from</span> <span class="string">&quot;./Child&quot;</span>;</span><br><span class="line"><span class="comment">// 订阅</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Parent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 组件将要被渲染的时候进行订阅</span></span><br><span class="line">  <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// msgId：发布与订阅的事件名称</span></span><br><span class="line">    <span class="comment">// 订阅的事件名称必须与发布的事件名称保持一致</span></span><br><span class="line">    <span class="built_in">this</span>.token = PubSub.subscribe(msgId, <span class="function">(<span class="params">msg, data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(msgId); <span class="comment">// pubsubId</span></span><br><span class="line">      <span class="built_in">console</span>.log(msg, data); <span class="comment">// pubsubId snsn</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">this</span>.token1 = PubSub.subscribe(msgId1, <span class="function">(<span class="params">msg, data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(msgId1); <span class="comment">// pubsubId</span></span><br><span class="line">      <span class="built_in">console</span>.log(msg, data); <span class="comment">// pubsubId snsn</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">componentWillUnmount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 取消事件主题为msgId的订阅</span></span><br><span class="line">    PubSub.unsubscribe(msgId);</span><br><span class="line">    <span class="comment">// 取消指定功能的所有订阅</span></span><br><span class="line">    PubSub.unsubscribe(<span class="built_in">this</span>.token);</span><br><span class="line">    <span class="comment">// 取消全部订阅</span></span><br><span class="line">    PubSub.clearAllSubscriptions();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">&quot;Parent&quot;</span>&gt;</span><br><span class="line">        &lt;Child /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="使用-React-createContext"><a href="#使用-React-createContext" class="headerlink" title="使用 React.createContext"></a>使用 React.createContext</h4><p>1，语法：</p>
<ul>
<li>const { Provider, Consumer } = React.createContext()</li>
</ul>
<p>2，Provider 解析：</p>
<ul>
<li><p>React 组件允许 Consumers 订阅 context 的改变。</p>
</li>
<li><p>接收一个 value 属性传递给 Provider 的后代 Consumers 。一个 Provider 可以联系到多个 Consumers 。Providers 可以被嵌套以覆盖组件树内更深层次的值。</p>
</li>
</ul>
<p>3，Consumer 解析：</p>
<ul>
<li><p>一个可以订阅 context 变化的 React 组件。当 context 值发生改变时，Consumer 值也会改变。</p>
</li>
<li><p>接收一个函数作为子节点。该函数接收当前 context 的值并返回一个 React 节点。传递给函数的 value ，将等于组件树中上层 context 的最近的 Provider 的 value 属性。如果 context 没有 Provider ，那么 value 参数将等于被传递给 createContext (initValie)的 initValie (默认值)。</p>
</li>
</ul>
<p>4，使用注意点：</p>
<ul>
<li><strong>每当 Provider 的值发生改变时, 作为 Provider 后代的所有 Consumers 都会重新渲染</strong>。 从 Provider 到其后代的 Consumers 传播不受 shouldComponentUpdate 方法的约束，因此即使祖先组件退出更新时，后代 Consumer 也会被更新。</li>
</ul>
<p>5，具体使用示例：</p>
<ul>
<li>index 代码</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Parent <span class="keyword">from</span> <span class="string">&quot;./Parent&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">&quot;./Child&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Grandchild <span class="keyword">from</span> <span class="string">&quot;./Grandchild&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">index</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Parent&gt;</span><br><span class="line">          &lt;Child&gt;</span><br><span class="line">            &lt;Grandchild /&gt;</span><br><span class="line">          &lt;/Child&gt;</span><br><span class="line">        &lt;/Parent&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Parent 代码</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; Provider, Consumer &#125; = React.createContext();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Parent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    childName: <span class="string">&quot;nnn&quot;</span>,</span><br><span class="line">    childAge: <span class="number">25</span>,</span><br><span class="line">    grandchildName: <span class="string">&quot;mmm&quot;</span>,</span><br><span class="line">    grandchildAge: <span class="number">3</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  changeChildAge = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      childAge: <span class="built_in">this</span>.state.childAge + <span class="number">1</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  changeGrandchildAge = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      grandchildAge: <span class="built_in">this</span>.state.grandchildAge + <span class="number">1</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; childName, childAge, grandchildName, grandchildAge &#125; = <span class="built_in">this</span>.state;</span><br><span class="line">    <span class="keyword">const</span> data = &#123; childName, childAge, grandchildName, grandchildAge &#125;;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Provider value=&#123;data&#125;&gt;</span><br><span class="line">          &#123;<span class="built_in">this</span>.props.children&#125;</span><br><span class="line">          &#123;<span class="built_in">console</span>.log(<span class="built_in">this</span>.props.children)&#125;</span><br><span class="line">        &lt;/Provider&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="built_in">this</span>.changeChildAge&#125;&gt;ChildAge&lt;/button&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="built_in">this</span>.changeGrandchildAge&#125;&gt;GrandchildAge&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Child 代码</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Consumer &#125; <span class="keyword">from</span> <span class="string">&quot;./Parent&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Grandchild <span class="keyword">from</span> <span class="string">&quot;./Grandchild&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;Child&lt;/h1&gt;</span><br><span class="line">        &lt;Consumer&gt;</span><br><span class="line">          &#123;<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (</span><br><span class="line">              &lt;div&gt;</span><br><span class="line">                &lt;p&gt;Child姓名:&#123;value.childName&#125;&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;Child年龄:&#123;value.childAge&#125;&lt;/p&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            );</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        &lt;/Consumer&gt;</span><br><span class="line">        &lt;Grandchild /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Grandchild 代码</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Consumer &#125; <span class="keyword">from</span> <span class="string">&quot;./Parent&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Grandchild</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h2&gt;Grandchild&lt;/h2&gt;</span><br><span class="line">        &lt;Consumer&gt;</span><br><span class="line">          &#123;<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (</span><br><span class="line">              &lt;div&gt;</span><br><span class="line">                &lt;p&gt;Grandchild姓名:&#123;value.grandchildName&#125;&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;Grandchild年龄:&#123;value.grandchildAge&#125;&lt;/p&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            );</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        &lt;/Consumer&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="使用-React-createContext-与-contextType-结合"><a href="#使用-React-createContext-与-contextType-结合" class="headerlink" title="使用 React.createContext 与 contextType 结合"></a>使用 React.createContext 与 contextType 结合</h4><p>1，contextType 概述：</p>
<ul>
<li>contextType 可以简化 context 的使用，不使用 consumer 也可以共享变量。</li>
</ul>
<p>2，语法：static contextType = themeContext（创建好的 createContext()）。</p>
<p>3，<strong>说明</strong>：使用 contextType 后，在 render 函数中可以直接访问 this.context 获取共享变量，这样就可以不使用 consumer。</p>
<ul>
<li>const theme = this.context。</li>
</ul>
<p>4，contextType 注意点：</p>
<ul>
<li><p>contextType 只能在类组件中使用。</p>
</li>
<li><p>一个组件如果有多个 consumer，contextType 只对其中一个有效，因此在一个组件中 contextType 只能有存在一个。</p>
</li>
</ul>
<p>5，基本使用案例：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component, createContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> colorContext = createContext();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">ContextType</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    color: <span class="string">&quot;pink&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; color &#125; = <span class="built_in">this</span>.state;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;colorContext.Provider value=&#123;color&#125;&gt;</span><br><span class="line">          &lt;Middle /&gt;</span><br><span class="line">        &lt;/colorContext.Provider&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Middle</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Bottom /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bottom</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> contextType = colorContext;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> color = <span class="built_in">this</span>.context;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;snsn:&#123;color&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h3><h4 id="使用-Refs-的场景"><a href="#使用-Refs-的场景" class="headerlink" title="使用 Refs 的场景"></a>使用 Refs 的场景</h4><p>1，管理焦点，文本选择或媒体播放。</p>
<p>2，触发强制动画。</p>
<p>3，集成第三方 DOM 库。</p>
<h4 id="如何创建-Refs"><a href="#如何创建-Refs" class="headerlink" title="如何创建 Refs"></a>如何创建 Refs</h4><p>1，使用 <strong>React.createRef()</strong> 创建。</p>
<h4 id="如何访问-refs"><a href="#如何访问-refs" class="headerlink" title="如何访问 refs"></a>如何访问 refs</h4><p>1，使用 const node = this.myRef.current 访问引用的节点。</p>
<ul>
<li>this.textInput.current.focus() 可使元素自动获取焦点。</li>
</ul>
<h4 id="refs-说明"><a href="#refs-说明" class="headerlink" title="refs 说明"></a>refs 说明</h4><p>1，不能在函数式组件上使用 React.createRef() 方法，因为函数式组件没有实例。</p>
<p>2，虽然不能在函数式组件中使用，但是可以<strong>在函数式组件内部使用 ref 来引用一个 DOM 元素或者类 (class) 组件</strong>，具体如下：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CustomTextInput</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// textInput在这里声明了，所以 ref 回调可以引用它</span></span><br><span class="line">  <span class="keyword">let</span> textInput = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleClick</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    textInput.focus();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;input</span><br><span class="line">        type=<span class="string">&quot;text&quot;</span></span><br><span class="line">        ref=&#123;<span class="function">(<span class="params">input</span>) =&gt;</span> &#123;</span><br><span class="line">          textInput = input;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      /&gt;</span><br><span class="line"></span><br><span class="line">      &#123;<span class="comment">/* 可以不在上面声明，使用以下简写方式 */</span>&#125;</span><br><span class="line">      &#123;<span class="comment">/* ref = &#123;input =&gt; this.textInput = input&#125; */</span>&#125;</span><br><span class="line"></span><br><span class="line">      &lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;Focus the text input&quot;</span> onClick=&#123;handleClick&#125; /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="转发-refs"><a href="#转发-refs" class="headerlink" title="转发 refs"></a>转发 refs</h4><p>1，转发 refs 概述：</p>
<ul>
<li>转发 refs 可让某些组件使用收到的 ref，并将其向下传递给子组件。</li>
</ul>
<p>2，如何获取传递过来的 ref：</p>
<ul>
<li>使用 <strong>React.forwardRef()</strong> 可以获取传递过来的 ref。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> FancyButton = React.forwardRef(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> (</span><br><span class="line">  &lt;button ref=&#123;ref&#125; className=<span class="string">&quot;FancyButton&quot;</span>&gt;</span><br><span class="line">    &#123;props.children&#125;</span><br><span class="line">  &lt;/button&gt;</span><br><span class="line">));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ref = React.createRef();</span><br><span class="line">&lt;FancyButton ref=&#123;ref&#125;&gt;Click me!&lt;/FancyButton&gt;;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>注意</strong>：第二个 ref 参数仅在使用 React.forwardRef() 调用定义组件时才存在。常规函数或类组件不接收 ref 参数，而且 props 也不提供 ref 。</li>
</ul>
<p>3，转发 refs 的使用场景：</p>
<ul>
<li><p>这种特性适用于高可复用“叶”组件，这些组件倾向于在整个应用中以一种类似常规 DOM button 和 input 的方式被使用，利用 ref 转发特性可以方便的访问其 DOM 节点，用来实现：</p>
<ul>
<li><p><strong>管理焦点（focus）</strong>。</p>
</li>
<li><p><strong>选择（selection）</strong>。</p>
</li>
<li><p><strong>动画（animations）</strong> 等。</p>
</li>
</ul>
</li>
</ul>
<p>4，转发 Refs 到 DOM：</p>
<ul>
<li>转发 refs 到 DOM 组件以自动获取焦点：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可复用性强的“叶”组件FancyInput</span></span><br><span class="line"><span class="keyword">const</span> FancyInput = React.forwardRef(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">butClick</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 利用传送过来的ref进行自动获取焦点的操作</span></span><br><span class="line">    ref.current.focus();</span><br><span class="line">    ref.current.value = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;RefsName:&#123;props.name&#125;&lt;/p&gt;</span><br><span class="line">      &lt;input type=<span class="string">&quot;text&quot;</span> ref=&#123;ref&#125; className=<span class="string">&quot;FancyInput&quot;</span> /&gt;</span><br><span class="line">      &lt;button onClick=&#123;butClick&#125;&gt;submit&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Refs</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    name: <span class="string">&quot;nnn&quot;</span>,</span><br><span class="line">    msg: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  inpRef = React.createRef();</span><br><span class="line"></span><br><span class="line">  RefsClickhandler = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.inpRef.current.value.trim()) &#123;</span><br><span class="line">      <span class="built_in">this</span>.setState(</span><br><span class="line">        &#123;</span><br><span class="line">          msg: <span class="built_in">this</span>.inpRef.current.value,</span><br><span class="line">        &#125;,</span><br><span class="line">        () =&gt; &#123;</span><br><span class="line">          <span class="built_in">this</span>.inpRef.current.focus();</span><br><span class="line">          <span class="built_in">this</span>.inpRef.current.value = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;FancyInput ref=&#123;<span class="built_in">this</span>.inpRef&#125; name=&#123;<span class="built_in">this</span>.state.name&#125; /&gt;</span><br><span class="line">        &lt;h3&gt;RefsComponent&lt;/h3&gt;</span><br><span class="line">        &lt;p&gt;msg:&#123;<span class="built_in">this</span>.state.msg&#125;&lt;/p&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="built_in">this</span>.RefsClickhandler&#125;&gt;RefsClickhandler&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5，在高阶组件中转发 Refs</p>
<ul>
<li>高阶组件内容：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Input = <span class="function">(<span class="params">InputComponent</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> NewInpComponent = React.forwardRef(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> onChange = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      props.setMsg(ref.current.value);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">InputComponent</span> <span class="attr">forwardedRef</span>=<span class="string">&#123;ref&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;onChange&#125;</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span>;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">InpCom</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">      name: <span class="string">&quot;未提交...&quot;</span>,</span><br><span class="line">      msg: <span class="string">&quot;等待输入...&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    inputRef = React.createRef();</span><br><span class="line">    setName = <span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">        name,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">    setMsg = <span class="function">(<span class="params">msg</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">        msg,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; name, msg &#125; = <span class="built_in">this</span>.state;</span><br><span class="line">      <span class="keyword">const</span> data = &#123; name, msg &#125;;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;NewInpComponent</span><br><span class="line">          ref=&#123;<span class="built_in">this</span>.inputRef&#125;</span><br><span class="line">          data=&#123;data&#125;</span><br><span class="line">          setName=&#123;<span class="built_in">this</span>.setName&#125;</span><br><span class="line">          setMsg=&#123;<span class="built_in">this</span>.setMsg&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>被包装组件内容：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Input &#125; <span class="keyword">from</span> <span class="string">&quot;./HOCRef&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TextInput = <span class="function">(<span class="params">&#123; forwardedRef, setName, setMsg, ...rest &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handlerClick</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    setName(forwardedRef.current.value);</span><br><span class="line">    forwardedRef.current.focus();</span><br><span class="line">    forwardedRef.current.value = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h2&gt;InpComponent&lt;/h2&gt;</span><br><span class="line">      &lt;p&gt;name:&#123;rest.data.name&#125;&lt;/p&gt;</span><br><span class="line">      &lt;p&gt;msg:&#123;rest.data.msg&#125;&lt;/p&gt;</span><br><span class="line">      &lt;input ref=&#123;forwardedRef&#125; &#123;...rest&#125; /&gt;</span><br><span class="line">      &lt;button onClick=&#123;handlerClick&#125;&gt;submit&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Input(TextInput);</span><br></pre></td></tr></table></figure>
<h3 id="高阶组件-HOC"><a href="#高阶组件-HOC" class="headerlink" title="高阶组件(HOC)"></a>高阶组件(HOC)</h3><h4 id="高阶组件概述"><a href="#高阶组件概述" class="headerlink" title="高阶组件概述"></a>高阶组件概述</h4><p>1，高阶组件具体描述：</p>
<ul>
<li><p>高阶组件（HOC）是 React 中用于复用组件逻辑的一种高级技巧。</p>
</li>
<li><p>一个高阶组件只是一个包装了另外一个 React 组件的 React 组件。</p>
</li>
<li><p>简而言之，高阶组件是参数为组件，返回值为新组件的函数。</p>
</li>
<li><p>HOC 是纯函数，没有副作用。</p>
</li>
<li><p>组件是将 props 转换为 UI，而高阶组件是将组件转换为另一个组件。</p>
</li>
</ul>
<h4 id="高阶组件的作用"><a href="#高阶组件的作用" class="headerlink" title="高阶组件的作用"></a>高阶组件的作用</h4><p>1，代码复用，逻辑抽象。</p>
<p>2，渲染劫持。</p>
<p>3，state 抽象和更改。</p>
<p>4，props 更改。</p>
<h4 id="高阶组件实现"><a href="#高阶组件实现" class="headerlink" title="高阶组件实现"></a>高阶组件实现</h4><p>1，属性代理：</p>
<ul>
<li><p>属性代理理解：</p>
<ul>
<li>HOC 对传给被包裹组件的 props 进行操作。</li>
</ul>
</li>
<li><p>属性代理的作用：</p>
<ul>
<li><p>操作 props。</p>
</li>
<li><p>通过 refs 访问到组件实例。</p>
</li>
<li><p>提取 state。</p>
</li>
<li><p>用其他元素包裹 WrappedComponent。</p>
</li>
</ul>
</li>
</ul>
<p>2，反向继承：</p>
<ul>
<li><p>反向继承理解：</p>
<ul>
<li><p>返回的组件没有继承 React.Component，而是<strong>继承作为参数传入的被包装组件</strong>。</p>
</li>
<li><p>反向继承允许高阶组件通过 this 获取被包装组件，意味着可以获取到 state，props，组件生命周期，以及渲染方法。</p>
</li>
<li><p>reconciliation（协调过程）：React Element 在执行它的协调过程时描述什么将被渲染。</p>
</li>
<li><p>React Element 可以是 string 或者 function ，string 的 reactElement 代表原生 DOM 节点，function 代表通过 React.Component 创建的组件。</p>
</li>
<li><p>function 类型的 ReactElement 将在 reconciliation 阶段被解析成 DOM 类型的 ReactElement，这意味着反向继承的高阶组件不保证一定解析整个子元素树。</p>
</li>
<li><p>反向继承可以渲染劫持，操作 state。</p>
</li>
</ul>
</li>
<li><p>渲染劫持说明：</p>
<ul>
<li>渲染指 wrappedComponent 的 render 方法。被叫做渲染劫持是因为高阶组件控制了 WrappedComponent 生成的渲染结果，并且可以做各种操作（增删改将被渲染的 Reactelement 的 props)。</li>
</ul>
</li>
<li><p>反向继承基本案例：</p>
</li>
</ul>
<blockquote>
<p>HOC 内容：</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">iiHoc</span>(<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">Enhance</span> <span class="keyword">extends</span> <span class="title">WrappedComponent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="comment">//super指向WrappedComponent</span></span><br><span class="line">      <span class="keyword">const</span> elementsTree = <span class="built_in">super</span>.render();</span><br><span class="line">      <span class="built_in">console</span>.log(elementsTree.props);</span><br><span class="line">      <span class="comment">//增加WrappedComponent的props</span></span><br><span class="line">      <span class="keyword">let</span> addProp = &#123; <span class="attr">style</span>: &#123; <span class="attr">color</span>: <span class="string">&quot;green&quot;</span> &#125; &#125;;</span><br><span class="line">      <span class="comment">//修改WrappedComponent的props</span></span><br><span class="line">      <span class="keyword">let</span> newProp = &#123; <span class="attr">value</span>: <span class="string">&quot;反向继承修改继承的state&quot;</span> &#125;;</span><br><span class="line">      <span class="keyword">const</span> props = <span class="built_in">Object</span>.assign(&#123;&#125;, elementsTree.props, newProp, addProp);</span><br><span class="line">      <span class="keyword">const</span> newElement = React.cloneElement(</span><br><span class="line">        elementsTree,</span><br><span class="line">        props,</span><br><span class="line">        elementsTree.props.children</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">return</span> newElement;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>wrappedComponent 内容：</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> iiHoc <span class="keyword">from</span> <span class="string">&quot;./inversionHOC&quot;</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WrappedComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    msg: <span class="string">&quot;反向继承&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  handlerChange = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e.target.value);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;input type=<span class="string">&quot;text&quot;</span> value=&#123;<span class="built_in">this</span>.state.msg&#125; onChange=&#123;<span class="built_in">this</span>.handlerChange&#125; /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> iiHoc(WrappedComponent);</span><br></pre></td></tr></table></figure>
<p>3，HOC 缺陷:</p>
<ul>
<li><p>扩展性限制：HOC 无法从外部访问子组件的 state，因此无法通过 shouldComponentUpdate 过滤掉不必要的更新，不过 react 之后提供了 PureComponent 来解决。</p>
</li>
<li><p>ref 传值问题：ref 被隔断。但可使用 react.forwardRef() 解决。</p>
</li>
<li><p>wrapper hell：HOC 可能出现多层包裹组件的情况，多层抽象增加复杂度和理解成本。</p>
</li>
<li><p>命名冲突：若 HOC 多次嵌套，没有使用命名空间会产生冲突，覆盖老属性。</p>
</li>
<li><p>不可见性：HOC 相当于在原始组件外层包裹一个组件，你不知道里面是啥对于你是黑盒。</p>
</li>
</ul>
<p>4，HOC 基本使用案例：</p>
<ul>
<li>逻辑复用的 HOC：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// HOC</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">stateHOC</span>(<span class="params">WrappedComponent, method</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">super</span>(props);</span><br><span class="line">      <span class="built_in">this</span>.state = &#123;</span><br><span class="line">        value: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="built_in">this</span>.handleChange = <span class="built_in">this</span>.handleChange.bind(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">handleChange</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">        value: e.target.value,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> newProp = &#123;</span><br><span class="line">        value: <span class="built_in">this</span>.state.value,</span><br><span class="line">        onChange: <span class="built_in">this</span>.handleChange,</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...this.props</span>&#125; &#123;<span class="attr">...newProp</span>&#125; /&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MyInput</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> StateHOC <span class="keyword">from</span> <span class="string">&quot;./StateHOC&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyInput</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h2&gt;MyInput&lt;/h2&gt;</span><br><span class="line">        &lt;p&gt;value:&#123;<span class="built_in">this</span>.props.value&#125;&lt;/p&gt;</span><br><span class="line">        &lt;input value=&#123;<span class="built_in">this</span>.props.value&#125; onChange=&#123;<span class="built_in">this</span>.props.onChange&#125; /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> StateHOC(MyInput);</span><br><span class="line"></span><br><span class="line"><span class="comment">// MyTextarea</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> StateHOC <span class="keyword">from</span> <span class="string">&quot;./StateHOC&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTextarea</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h2&gt;MyTextarea&lt;/h2&gt;</span><br><span class="line">        &lt;p&gt;value:&#123;<span class="built_in">this</span>.props.value&#125;&lt;/p&gt;</span><br><span class="line">        &lt;textarea value=&#123;<span class="built_in">this</span>.props.value&#125; onChange=&#123;<span class="built_in">this</span>.props.onChange&#125; /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> TextComponent = StateHOC(MyTextarea);</span><br><span class="line"></span><br><span class="line"><span class="comment">// index</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TextComponent &#125; <span class="keyword">from</span> <span class="string">&quot;./MyTextarea&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> InputComponent <span class="keyword">from</span> <span class="string">&quot;./MyInput&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;TextComponent /&gt;</span><br><span class="line">        &lt;InputComponent /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>通过 refs 访问到组件实例：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// HOC</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">refsHoc</span>(<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">PP</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">      msg: <span class="string">&quot;你好啊&quot;</span>,</span><br><span class="line">      name: <span class="string">&quot;snsn&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">refFun</span>(<span class="params">instance</span>)</span> &#123;</span><br><span class="line">      instance.say();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...this.state</span>&#125; <span class="attr">ref</span>=<span class="string">&#123;this.refFun&#125;</span> /&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MyComponent</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> RefHOC <span class="keyword">from</span> <span class="string">&quot;./RefHOC&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    data: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function"><span class="title">say</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      data: <span class="built_in">this</span>.props.msg + <span class="built_in">this</span>.props.name,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;msg:&#123;<span class="built_in">this</span>.props.msg&#125;&lt;/h1&gt;</span><br><span class="line">        &lt;h1&gt;name:&#123;<span class="built_in">this</span>.props.name&#125;&lt;/h1&gt;</span><br><span class="line">        &lt;h2&gt;data:&#123;<span class="built_in">this</span>.state.data&#125;&lt;/h2&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> RefHOC(MyComponent);</span><br></pre></td></tr></table></figure>
<ul>
<li>为 WrappedComponent 包装颜色样式</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// HOC</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//被包装组件本身没有样式红色，可以包装一个</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">withColorRed</span>(<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;div style=&#123;&#123; <span class="attr">color</span>: <span class="string">&quot;red&quot;</span> &#125;&#125;&gt;</span><br><span class="line">          &lt;WrappedComponent /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// WrappedComponent MyCon</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> WithColorRed <span class="keyword">from</span> <span class="string">&quot;./WithColorRed&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCon</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> WithColorRed(MyCon);</span><br></pre></td></tr></table></figure>
<h3 id="React-Router-概述"><a href="#React-Router-概述" class="headerlink" title="React Router 概述"></a><a href="http://react-guide.github.io/react-router-cn/">React Router</a> 概述</h3><h4 id="相关理解"><a href="#相关理解" class="headerlink" title="相关理解"></a>相关理解</h4><p>1，react-router 是 react 的一个插件库。</p>
<p>2，它可以让你向应用中快速地添加视图和数据流，同时保持页面与 URL 间的同步。</p>
<p>3，专门用来实现一个 SPA 应用。</p>
<p>4，基于 react 的项目基本都会用到此库。</p>
<h4 id="SPA-简介"><a href="#SPA-简介" class="headerlink" title="SPA 简介"></a>SPA 简介</h4><p>1，SPA 是单页 web 应用（single page web application SPA）。</p>
<p>2，整个应用只有一个完整的页面。</p>
<p>3，点击页面中的链接不会刷新页面，本身也不会向服务器发请求。</p>
<p>4，点击（路由）链接时，只会做页面的局部更新。</p>
<p>5，数据都需要通过 ajax 请求获取，并在前端异步展现。</p>
<h4 id="路由的理解"><a href="#路由的理解" class="headerlink" title="路由的理解"></a>路由的理解</h4><p>1，什么是路由？</p>
<ul>
<li><p>一个路由就是一个映射关系（key =&gt; value）。</p>
<ul>
<li>key：路由路径，value：前端路由 value 是 component(组件)，后端路由 value 是 callback。</li>
</ul>
</li>
</ul>
<p>2，路由的分类：</p>
<ul>
<li><p>前端路由：</p>
<ul>
<li><p>浏览器端路由，value 是 component，当请求的是路由 path 时，浏览器端没有发送 http 请求，但是界面会更新显示对应的组件。</p>
</li>
<li><p>注册路由：<Router path="/about" component="{About}">。</Router></p>
</li>
<li><p>当浏览器的 hash 变为 #about 时，当前路由组件就会变为 About 组件。</p>
</li>
</ul>
</li>
<li><p>后端路由：</p>
<ul>
<li><p>node 服务器路由，value 是 function ，用来处理客户端提交的请求并返回响应数据。</p>
</li>
<li><p>注册路由：router.get( “/path”, function(req，res){ …… })。</p>
</li>
<li><p>注意：req 为请求，res 是返回的响应，即 key 为 path，value 为 callback（回调函数）。</p>
</li>
<li><p>当 node 接收到请求时，根据请求路径找到匹配的路由，调用路由中函数来处理请求，返回响应数据。</p>
</li>
</ul>
</li>
</ul>
<h3 id="React-Router-常用组件"><a href="#React-Router-常用组件" class="headerlink" title="React Router 常用组件"></a>React Router 常用组件</h3><h4 id="React-Router-的三大组件"><a href="#React-Router-的三大组件" class="headerlink" title="React Router 的三大组件"></a>React Router 的三大组件</h4><p>1，Router：是所有路由组件共用的底层接口组件，它是路由规则制定的最外层的容器。</p>
<p>2，Route：路由规则匹配，并显示当前的规则对应的组件。</p>
<p>3，Link：路由跳转的组件。</p>
<h3 id="React-Router-各组件解析"><a href="#React-Router-各组件解析" class="headerlink" title="React Router 各组件解析"></a>React Router 各组件解析</h3><h4 id="Router"><a href="#Router" class="headerlink" title="Router"></a>Router</h4><p>1，Router 是 React Router 的重要组件。它能保持 UI 和 URL 的同步。</p>
<p>2，是所有路由组件共用的底层接口组件，也是路由规则制定的最外层的容器。</p>
<p>3，Router 组件对不同的功能和平台对应可使用如下类型的组件：</p>
<ul>
<li><p>BrowserRouter：浏览器的路由组建。</p>
<ul>
<li>BrowserRouter 使用 HTML5 提供的 history API(pushState, replaceState 和 popstate 事件) 来保持 UI 和 URL 的同步。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; BrowserRouter &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line">&lt;BrowserRouter</span><br><span class="line">  basename=&#123;string&#125;</span><br><span class="line">  forceRefresh=&#123;bool&#125;</span><br><span class="line">  getUserConfirmation=&#123;func&#125;</span><br><span class="line">  keyLength=&#123;number&#125;</span><br><span class="line">&gt;</span><br><span class="line">  &lt;App /&gt;</span><br><span class="line">&lt;/BrowserRouter&gt;;</span><br></pre></td></tr></table></figure></li>
<li><p>BrowserRouter 属性<strong>basename</strong>解析：</p>
<ul>
<li><p>其类型为 string。</p>
</li>
<li><p>是所有位置的基准 URL。如果应用程序部署在服务器的子目录，<br>则需将其设置为某某子目录。</p>
</li>
<li><p>basename 的正确格式是前面有一个前导斜杠，但不能有尾部斜杠。</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;BrowserRouter basename=<span class="string">&quot;/calendar&quot;</span>&gt;</span><br><span class="line">  &lt;Link to=<span class="string">&quot;/today&quot;</span> /&gt;</span><br><span class="line">&lt;/BrowserRouter&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>输出 link 最终被呈现为：<code>&lt;a href=&quot;/calendar/today&quot; /&gt;</code>。</li>
</ul>
</li>
<li><p>HashRouter：URL 格式为 Hash 的路由组件。</p>
<ul>
<li><p>HashRouter 使用 URL 的 hash 部分（即 window.location.hash）来保持 UI 和 URL 的同步。</p>
</li>
<li><p>hashType：类型为 string，主要有以下几种 hash 类型：</p>
<ul>
<li><p><code>slash</code>：后面跟一个斜杠，例如 #/ 和 #/sunshine/lollipops。</p>
</li>
<li><p><code>noslash</code>：后面没有斜杠，例如 # 和 #sunshine/lollipops。</p>
</li>
<li><p><code>hashbang</code>：Google 风格的 ajax crawlable，例如 #!/ 和 #!/sunshine/lollipops</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; HashRouter &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line">&lt;HashRouter&gt;</span><br><span class="line">  &lt;App /&gt;</span><br><span class="line">&lt;/HashRouter&gt;;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>注意</strong>：使用 hash 记录导航历史不支持 location.key 和 location.state。</p>
</li>
<li><p>HashRouter 属性<strong>basename</strong>解析：</p>
<ul>
<li><p>basename 类型为 string。</p>
</li>
<li><p>其作用与 BrowserRouter 中的 basename 一致。</p>
</li>
</ul>
</li>
<li><p>NattiveRouter：Native 的路由组件。</p>
</li>
<li><p>MemoryRouter：内存路由组件。</p>
</li>
<li><p>StaticRouter：地址不改变的静态路由组件。</p>
</li>
</ul>
<p>4，Router 属性介绍：</p>
<ul>
<li><p><code>children</code> (required)：一个或多个的 Route 或 PlainRoute。当 history 改变时，<Router> 会匹配出 Route 的一个分支，并且渲染这个分支中配置的组件，渲染时保持父 route 组件嵌套子 route 组件。</Router></p>
</li>
<li><p><code>routes</code>：children 的别名。</p>
</li>
<li><p><code>history</code>：Router 监听的 history 对象，由 history 包提供。</p>
</li>
</ul>
<h4 id="Link"><a href="#Link" class="headerlink" title="Link"></a>Link</h4><p>1，Link 组件就像是一个个路牌，为我们指明组件的位置，link 使用声明式的方式为应用程序提供导航功能。</p>
<p>2，定义的 Link 标签最终会被渲染成一个 a 标签，Link 使用<strong>to</strong>这个属性来指明目标组件的路径，可以直接使用一个字符串，也可以传入一个对象。</p>
<ul>
<li><p>to：string</p>
<ul>
<li><p>一个字符串形式的链接地址，通过 pathname、search 和 hash 属性创建。</p>
</li>
<li><Link to="/About?news=snsn">
</Link></li>
</ul>
</li>
<li><p>to：Object</p>
<ul>
<li><p>一个对象形式的链接地址，可以具有以下任何属性：</p>
<ul>
<li><p>pathname：要链接到的路径。</p>
</li>
<li><p>search：查询参数。</p>
</li>
<li><p>hash：URL 中的 hash，例如 #hash。</p>
</li>
<li><p>state：存储到 location 中的额外状态数据</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="comment">// 字符串参数</span></span><br><span class="line">&lt;Link to=<span class="string">&quot;/query&quot;</span>&gt;查询&lt;/Link&gt;</span><br><span class="line"><span class="comment">// 对象参数</span></span><br><span class="line">&lt;Link to=&#123;&#123;</span><br><span class="line">  pathname: <span class="string">&#x27;/query&#x27;</span>,</span><br><span class="line">  search: <span class="string">&#x27;?key=name&#x27;</span>,</span><br><span class="line">  hash: <span class="string">&#x27;#hash&#x27;</span>,</span><br><span class="line">  state: &#123; <span class="attr">fromDashboard</span>: <span class="literal">true</span> &#125;</span><br><span class="line">&#125;&#125;&gt;查询&lt;/Link&gt;</span><br></pre></td></tr></table></figure>
<p>3，Link 组件属性介绍：</p>
</li>
<li><p><code>to</code>：需要跳转到的路径(pathname)或地址（location）。</p>
<font size="4">

<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;Link to=<span class="string">&quot;/home/news&quot;</span>&gt; news &lt;/Link&gt;</span><br></pre></td></tr></table></figure></font></li>
<li><p><code>replace</code>：bool（布尔值）：为 true 时，点击链接后将使用新地址替换掉访问历史记录。<br>为 false 时，点击链接后将在原有的访问历史记录的基础上添加一个新的记录。replace 默认为 false。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;Link to=<span class="string">&quot;/courses&quot;</span> replace /&gt;</span><br></pre></td></tr></table></figure></li>
<li><p><code>query</code>：已经转化成字符串的键值对的对象。</p>
</li>
<li><p><code>hash</code>：URL 的 hash 值，如：#a-hash。</p>
</li>
<li><p><code>innerRef</code>：func，允许访问组件的底层引用。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> refCallback = <span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// node 指向最终挂载的 DOM 元素，在卸载时为 null</span></span><br><span class="line">&#125;;</span><br><span class="line">&lt;Link to=<span class="string">&quot;/&quot;</span> innerRef=&#123;refCallback&#125; /&gt;;</span><br></pre></td></tr></table></figure></li>
<li><p><code>others</code>：你还可以传递一些其它属性，例如 title、id 或 className 等。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;Link to=<span class="string">&quot;/&quot;</span> className=<span class="string">&quot;nav&quot;</span> title=<span class="string">&quot;a title&quot;</span>&gt;</span><br><span class="line">  About</span><br><span class="line">&lt;/Link&gt;</span><br></pre></td></tr></table></figure>
<h4 id="NavLink"><a href="#NavLink" class="headerlink" title="NavLink"></a>NavLink</h4></li>
</ul>
<p>1，NavLink 概述：</p>
<ul>
<li><p>NavLink 是一个特殊版本的 Link。</p>
</li>
<li><p>NavLink 可以使用 activeClassName 来设置 link 被选中时的被附 class，使用 activeStyle 来设置被选中时的应用样式。</p>
</li>
<li><p>NavLink 中有一个 exact 属性，此属性要求只有地址栏中的 URL 和这个 link 的 to 指定的 location 相匹配时才会附加 class 和 style。</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 该路径被选中后会添加selected类属性值</span></span><br><span class="line">&lt;NavLink to=&#123;<span class="string">&#x27;/&#x27;</span>&#125; exact activeClassName=<span class="string">&#x27;selected&#x27;</span>&gt;Home&lt;/NavLink&gt;</span><br><span class="line"><span class="comment">// 该路径被选中后会附加样式 color:red</span></span><br><span class="line">&lt;NavLink to=&#123;<span class="string">&#x27;/about&#x27;</span>&#125; activeStyle=&#123;&#123;<span class="attr">color</span>:red&#125;&#125;&gt;About&lt;/NavLink&gt;</span><br></pre></td></tr></table></figure>
<p>3，NavLink 属性介绍：</p>
<ul>
<li><p><code>to</code>：可以是字符串或者对象，同 Link 组件。</p>
</li>
<li><p><code>exact</code>：bool 类型。</p>
<ul>
<li>完全匹配时才会被附件 class 和 style。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;NavLink exact to=<span class="string">&quot;/profile&quot;</span>&gt;</span><br><span class="line">  Profile</span><br><span class="line">&lt;/NavLink&gt;</span><br></pre></td></tr></table></figure></li>
<li><p><code>activeStyle</code>：Object 类型。</p>
<ul>
<li>当元素处于激活状态时应用的样式。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> activeStyle = &#123;</span><br><span class="line">  fontWeight: <span class="string">&quot;bold&quot;</span>,</span><br><span class="line">  color: <span class="string">&quot;pink&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&lt;NavLink to=<span class="string">&quot;/faq&quot;</span> activeStyle=&#123;activeStyle&#125;&gt;</span><br><span class="line">  isActiveStyle</span><br><span class="line">&lt;/NavLink&gt;;</span><br></pre></td></tr></table></figure></li>
<li><p><code>activeClassName</code>：string 类型。</p>
<ul>
<li>当元素处于激活状态时应用的类，默认为 active。它将与 className 属性一起使用。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;NavLink to=<span class="string">&quot;/faq&quot;</span> activeClassName=<span class="string">&quot;selected&quot;</span>&gt;</span><br><span class="line">  isSelected</span><br><span class="line">&lt;/NavLink&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>strict: bool 类型。</p>
<ul>
<li>如果为 true，则具有尾部斜杠的 path 仅与具有尾部斜杠的 location.pathname 匹配。当 location.pathname 中有附加的 URL 片段时，strict 就没有效果了。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;NavLink strict to=<span class="string">&quot;/events/&quot;</span>&gt;</span><br><span class="line">  Events</span><br><span class="line">&lt;/NavLink&gt;</span><br></pre></td></tr></table></figure></li>
<li><p><code>isActive</code>: func 类型。</p>
<ul>
<li>添加额外逻辑以确定链接是否处于激活状态的函数。如果你需要验证链接的路径名与当前 URL 的路径名是否相匹配，那么应该使用它。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 只有当事件 id 为奇数时才考虑激活</span></span><br><span class="line"><span class="keyword">const</span> oddEvent = <span class="function">(<span class="params">match, location</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!match) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> eventID = <span class="built_in">parseInt</span>(match.params.eventID);</span><br><span class="line">  <span class="keyword">return</span> !<span class="built_in">isNaN</span>(eventID) &amp;&amp; eventID % <span class="number">2</span> === <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&lt;NavLink to=<span class="string">&quot;/events/123&quot;</span> isActive=&#123;oddEvent&#125;&gt;</span><br><span class="line">  Event <span class="number">123</span></span><br><span class="line">&lt;/NavLink&gt;;</span><br></pre></td></tr></table></figure></li>
<li><p><code>location</code>: object 类型。</p>
<ul>
<li>isActive 默认比较当前历史位置（通常是当前的浏览器 URL）。你也可以传递一个不同的位置进行比较。</li>
</ul>
</li>
</ul>
<h4 id="Route"><a href="#Route" class="headerlink" title="Route"></a>Route</h4><p>1，Route 组件概述：</p>
<ul>
<li><p>当 location 与 Route 的 path 匹配时渲染 Route 中的 Component。</p>
</li>
<li><p>如果有多个 Route 匹配，那么这些 Route 的 Component 都会被渲染。</p>
</li>
<li><p>与 Link 类似，Route 也有一个<code>exact</code>属性，作用也是要求 location 与 Route 的 path 绝对匹配。</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 当location形如 http://location/时，Home就会被渲染。</span></span><br><span class="line"><span class="comment">// 因为 &quot;/&quot; 会匹配所有的URL，所以这里设置一个exact来强制绝对匹配。</span></span><br><span class="line">&lt;Route exact path=<span class="string">&quot;/&quot;</span> component=&#123;Home&#125;/&gt;</span><br><span class="line">&lt;Route path=<span class="string">&quot;/about&quot;</span> component=&#123;About&#125;/&gt;</span><br></pre></td></tr></table></figure>
<p>2，Route 参数介绍：</p>
<ul>
<li><p><code>path</code>: string。</p>
<ul>
<li>可以是 <a href="https://www.npmjs.com/package/path-to-regexp">path-to-regexp</a> 能够理解的任何有效的 URL 路径。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// path=&quot;/users/:id&quot;设置动态路由</span></span><br><span class="line">&lt;Route path=<span class="string">&quot;/users/:id&quot;</span> component=&#123;User&#125; /&gt;</span><br></pre></td></tr></table></figure></li>
<li><p><code>strict</code>: bool。</p>
<ul>
<li>表示严格匹配。如果为 true，则具有尾部斜杠的 path 仅与具有尾部斜杠的 location.pathname 匹配。当 location.pathname 中有附加的 URL 片段时，strict 就没有效果了。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;Route strict path=<span class="string">&quot;/one/&quot;</span> component=&#123;OneComponent&#125; /&gt;</span><br></pre></td></tr></table></figure>
<p>3，路由三大属性介绍：</p>
</li>
<li><p><strong>match</strong>：</p>
<ul>
<li><p>获取 match 对象的方式：</p>
<ul>
<li><p>在 Route component 中，以 this.props.match 方式获取。</p>
</li>
<li><p>在 Route render 中，以 ({ match }) =&gt; () 方式获取。</p>
</li>
<li><p>在 Route children 中，以 ({ match }) =&gt; () 方式获取。</p>
</li>
</ul>
</li>
<li><p>常用属性说明：</p>
<ul>
<li><code>this.props.match.params.xxx</code> 获取路由路径参数。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>location</strong>：</p>
<ul>
<li><p>获取 location 对象的方式：</p>
<ul>
<li><p>在 Route component 中，以 this.props.location 的方式获取。</p>
</li>
<li><p>在 Route render 中，以 ({ location }) =&gt; () 的方式获取。</p>
</li>
<li><p>在 Route children 中，以 ({ location }) =&gt; () 的方式获取。</p>
</li>
<li><p>在 withRouter 中，以 this.props.location 的方式获取。</p>
</li>
</ul>
</li>
<li><p>常用属性说明：</p>
<ul>
<li><code>this.props.location.pathname</code> 获取 URL 路径。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>history</strong>：</p>
<ul>
<li><p>常用属性说明：</p>
<ul>
<li><p><code>this.history.push(&#39;/xxx&#39;)</code> 跳转路由到指定的路径。会保留前一个路由路径。</p>
</li>
<li><p><code>this.history.replace(&#39;./xxx&#39;)</code> 跳转路由到指定路径，但会替换前一个历史路径。</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>4，Route 的三种渲染方式：</p>
<ul>
<li><p>Route component：</p>
<ul>
<li>指定只有当位置匹配时才会渲染的 React 组件，该组件会接收 route props 作为属性。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> User = <span class="function">(<span class="params">&#123; match &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello &#123;match.params.username&#125;!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&lt;Route path=<span class="string">&quot;/user/:username&quot;</span> component=&#123;User&#125; /&gt;;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>解析</strong>：当你使用 component 时，Router 将根据指定的组件，使用 React.createElement 创建一个新的 React 元素。这意味着，如果你向 component 提供一个内联函数，那么每次渲染都会创建一个新组件。这将导致现有组件的卸载和新组件的安装，而不是仅仅更新现有组件。当使用内联函数进行内联渲染时，请使用 render 或 children 。</li>
</ul>
</li>
<li><p>Route render：</p>
<ul>
<li><p>render：是 func 类型。Route 会渲染这个 function 的返回值，其作用是可以附加一些额外的逻辑。</p>
</li>
<li><p>使用 render 可以方便地进行内联渲染和包装，而无需进行上文解释的不必要的组件重装。</p>
</li>
<li><p>可以传入一个函数，以在位置匹配时调用，而不是使用 component 创建一个新的 React 元素。render 渲染方式接收所有与 component 方式相同的 route props。</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 方便的内联渲染</span></span><br><span class="line">&lt;Route path=<span class="string">&quot;/home&quot;</span> render=&#123;<span class="function">() =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&#125; /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 包装</span></span><br><span class="line"><span class="keyword">const</span> FadingRoute = <span class="function">(<span class="params">&#123; component: Component, ...rest &#125;</span>) =&gt;</span> (</span><br><span class="line">  &lt;Route &#123;...rest&#125; render=&#123;<span class="function"><span class="params">props</span> =&gt;</span> (</span><br><span class="line">    &lt;FadeIn&gt;</span><br><span class="line">      &lt;Component &#123;...props&#125; /&gt;</span><br><span class="line">    &lt;/FadeIn&gt;</span><br><span class="line">  )&#125; /&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">&lt;FadingRoute path=<span class="string">&quot;/cool&quot;</span> component=&#123;Something&#125; /&gt;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>注意</strong>：<Route component> 和 <Route render> 优先于 <Route children>，因此不要在同一个 <Route> 中同时使用 <Route component> 与 <Route render> 。</Route></Route></Route></Route></Route></Route></p>
</li>
<li><p>Route render 基本使用案例：</p>
<ul>
<li>index 内容：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  BrowserRouter,</span><br><span class="line">  Route,</span><br><span class="line">  NavLink,</span><br><span class="line">  Link,</span><br><span class="line">  Switch,</span><br><span class="line">  Redirect,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./Home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> About <span class="keyword">from</span> <span class="string">&quot;./About&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">index</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    name: <span class="string">&quot;snsn&quot;</span>,</span><br><span class="line">    age: <span class="number">10</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; name, age &#125; = <span class="built_in">this</span>.state;</span><br><span class="line">    <span class="keyword">const</span> data = &#123; name, age &#125;;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;BrowserRouter&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;Link to=<span class="string">&quot;/home&quot;</span>&gt;Home&lt;/Link&gt;&amp;nbsp;</span><br><span class="line">          &lt;NavLink to=<span class="string">&quot;/about&quot;</span> activeStyle=&#123;&#123; <span class="attr">color</span>: <span class="string">&quot;pink&quot;</span> &#125;&#125;&gt;</span><br><span class="line">            About</span><br><span class="line">          &lt;/NavLink&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;Switch&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/home&quot;</span> component=&#123;Home&#125;&gt;&lt;/Route&gt;</span><br><span class="line">          &#123;<span class="comment">/* 使用render渲染方式需要将路由三大属性传递给需要渲染的组件 */</span>&#125;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/about&quot;</span></span><br><span class="line">            render=&#123;<span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="comment">// console.log(props) // location history match</span></span><br><span class="line">              <span class="comment">// context将location history match这三个路由属性传给About组件</span></span><br><span class="line">              <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">About</span> <span class="attr">data</span>=<span class="string">&#123;data&#125;</span> <span class="attr">context</span>=<span class="string">&#123;props&#125;</span> /&gt;</span></span>;</span><br><span class="line">            &#125;&#125;</span><br><span class="line">          &gt;&lt;/Route&gt;</span><br><span class="line">          &lt;Redirect to=<span class="string">&quot;/about&quot;</span> /&gt;</span><br><span class="line">        &lt;/Switch&gt;</span><br><span class="line">      &lt;/BrowserRouter&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>About 内容：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">About</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.props);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;About&lt;/h1&gt;</span><br><span class="line">        &#123;<span class="comment">/* name:snsn */</span>&#125;</span><br><span class="line">        &lt;p&gt;name:&#123;<span class="built_in">this</span>.props.data.name&#125;&lt;/p&gt;</span><br><span class="line">        &#123;<span class="comment">/* age:10 */</span>&#125;</span><br><span class="line">        &lt;p&gt;age:&#123;<span class="built_in">this</span>.props.data.age&#125;&lt;/p&gt;</span><br><span class="line">        &#123;<span class="comment">/* pathname:/about */</span>&#125;</span><br><span class="line">        &lt;p&gt;pathname:&#123;<span class="built_in">this</span>.props.context.location.pathname&#125;&lt;/p&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Home 内容：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Home</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;Home&lt;/h1&gt;</span><br><span class="line">        &#123;<span class="comment">/* pathname:/home */</span>&#125;</span><br><span class="line">        &lt;p&gt;pathname:&#123;<span class="built_in">this</span>.props.location.pathname&#125;&lt;/p&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Route children：</p>
<ul>
<li><p>children: 为 func 类型。</p>
</li>
<li><p>有时候不论 path 是否匹配位置，你都想渲染一些内容。在这种情况下，你可以使用 children 属性。除了不论是否匹配它都会被调用以外，它的工作原理与 render 完全一样。</p>
</li>
<li><p>children 渲染方式接收所有与 component 和 render 方式相同的 route props，除非路由与 URL 不匹配，不匹配时 match 为 null。这允许你可以根据路由是否匹配动态地调整用户界面。如下所示，如果路由匹配，我们将添加一个激活类：</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ListItemLink = <span class="function">(<span class="params">&#123; to, ...rest &#125;</span>) =&gt;</span> (</span><br><span class="line">  &lt;Route path=&#123;to&#125; children=&#123;<span class="function">(<span class="params">&#123; match &#125;</span>) =&gt;</span> (</span><br><span class="line">    &lt;li className=&#123;match ? <span class="string">&#x27;active&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;&gt;</span><br><span class="line">      &lt;Link to=&#123;to&#125; &#123;...rest&#125; /&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  )&#125; /&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">&lt;ul&gt;</span><br><span class="line">  &lt;ListItemLink to=<span class="string">&quot;/somewhere&quot;</span> /&gt;</span><br><span class="line">  &lt;ListItemLink to=<span class="string">&quot;/somewhere-else&quot;</span> /&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>提示</strong>：以上三种渲染方式都将提供相同的三个路由属性：</p>
<ul>
<li><p>match。</p>
</li>
<li><p>location。</p>
</li>
<li><p>history。</p>
</li>
</ul>
</li>
</ul>
<h4 id="Redirect"><a href="#Redirect" class="headerlink" title="Redirect"></a>Redirect</h4><p>1，Redirect 概述：</p>
<ul>
<li>当这个组件被渲染是，location 会被重写为 Redirect 的 to 指定的新 location。它的一个用途是<strong>登录重定向</strong>，比如在用户点了登录并验证通过之后，将页面跳转到个人主页。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Route, Redirect &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line">&lt;Route</span><br><span class="line">  exact</span><br><span class="line">  path=<span class="string">&quot;/&quot;</span></span><br><span class="line">  render=&#123;<span class="function">() =&gt;</span> (loggedIn ? <span class="xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">&quot;/dashboard&quot;</span> /&gt;</span></span> : <span class="xml"><span class="tag">&lt;<span class="name">PublicHomePage</span> /&gt;</span></span>)&#125;</span><br><span class="line">/&gt;;</span><br></pre></td></tr></table></figure>
<p>2，Redirect 属性介绍：</p>
<ul>
<li><p><code>to</code>: string。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;Redirect to=<span class="string">&quot;/somewhere/else&quot;</span> /&gt;</span><br></pre></td></tr></table></figure></li>
<li><p><code>to</code>: object。</p>
<ul>
<li><p>属性说明：</p>
<ul>
<li><p><code>pathname</code>：要链接到的路径。</p>
</li>
<li><p><code>search</code>：查询参数。</p>
</li>
<li><p><code>hash</code>：URL 中的 hash，例如 #the-hash。</p>
</li>
<li><p><code>state</code>：存储到 location 中的额外状态数据。</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;Redirect</span><br><span class="line">  to=&#123;&#123;</span><br><span class="line">    pathname: <span class="string">&quot;/login&quot;</span>,</span><br><span class="line">    search: <span class="string">&quot;?name=snsn&quot;</span>,</span><br><span class="line">    state: &#123;</span><br><span class="line">      fromDashboard: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>上述代码中，state 对象可以在<code>重定向跳转到的组件中</code>通过 this.props.location.state 进行访问。而 fromDashboard 可通过路径名 /login 指向的登录组件中的 this.props.location.state.fromDashboard 进行访问。</li>
</ul>
</li>
<li><p><code>push</code>：bool</p>
<ul>
<li>如果为 true，重定向会将新的位置推入历史记录，而不是替换当前条目。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;Redirect push to=<span class="string">&quot;/somewhere/else&quot;</span> /&gt;</span><br></pre></td></tr></table></figure></li>
<li><p><code>from</code>: string</p>
<ul>
<li><p>要从中进行重定向的路径名。</p>
</li>
<li><p>只能在 <Switch> 组件内使用 <Redirect from>，以匹配一个位置。</Redirect></Switch></p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;Switch&gt;</span><br><span class="line">  &lt;Redirect <span class="keyword">from</span>=<span class="string">&quot;/old-path&quot;</span> to=<span class="string">&quot;/new-path&quot;</span> /&gt;</span><br><span class="line">  &lt;Route path=<span class="string">&quot;/new-path&quot;</span> component=&#123;Place&#125; /&gt;</span><br><span class="line">&lt;/Switch&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 根据匹配参数进行重定向</span></span><br><span class="line">&lt;Switch&gt;</span><br><span class="line">  &lt;Redirect <span class="keyword">from</span>=<span class="string">&quot;/users/:id&quot;</span> to=<span class="string">&quot;/users/profile/:id&quot;</span> /&gt;</span><br><span class="line">  &lt;Route path=<span class="string">&quot;/users/profile/:id&quot;</span> component=&#123;Profile&#125; /&gt;</span><br><span class="line">&lt;/Switch&gt;</span><br></pre></td></tr></table></figure></li>
<li><p><code>exact</code>: bool</p>
<ul>
<li>完全匹配，相当于 Route.exact。</li>
</ul>
</li>
<li><p><code>strict</code>: bool</p>
<ul>
<li>严格匹配，相当于 Route.strict。</li>
</ul>
</li>
<li><p><code>sensitive</code>: bool</p>
<ul>
<li>如果为 true，进行匹配时将区分大小写。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;Route sensitive path=<span class="string">&quot;/one&quot;</span> component=&#123;OneComponent&#125; /&gt;</span><br></pre></td></tr></table></figure>
<h4 id="Switch"><a href="#Switch" class="headerlink" title="Switch"></a>Switch</h4></li>
</ul>
<p>1，用于渲染与路径匹配的第一个子 <Route> 或 <Redirect>。</Redirect></Route></p>
<p>2，与<Route>不同，<Switch> 只会渲染一个路由。</Switch></Route></p>
<p>3，如果现在处于 /about 路由界面，不希望匹配 /:user （或者显示 “404” 页面 ）。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Switch, Route &#125; <span class="keyword">from</span> <span class="string">&quot;react-router&quot;</span>;</span><br><span class="line"></span><br><span class="line">&lt;Switch&gt;</span><br><span class="line">  &lt;Route exact path=<span class="string">&quot;/&quot;</span> component=&#123;Home&#125; /&gt;</span><br><span class="line">  &lt;Route path=<span class="string">&quot;/about&quot;</span> component=&#123;About&#125; /&gt;</span><br><span class="line">  &lt;Route path=<span class="string">&quot;/:user&quot;</span> component=&#123;User&#125; /&gt;</span><br><span class="line">  &lt;Route component=&#123;NoMatch&#125; /&gt;</span><br><span class="line">&lt;/Switch&gt;;</span><br></pre></td></tr></table></figure>
<h4 id="Prompt"><a href="#Prompt" class="headerlink" title="Prompt"></a>Prompt</h4><p>1，该组件用于在位置跳转之前给予用户一些确认信息。当你的应用程序进入一个应该阻止用户导航的状态时（比如表单只填写了一半），弹出一个提示。</p>
<p>2，Prompt 属性说明：</p>
<ul>
<li><p><code>message</code>: string</p>
<ul>
<li>当用户试图离开某个位置时弹出的提示信息。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;Prompt message=<span class="string">&quot;你确定要离开当前页面吗？&quot;</span> /&gt;</span><br></pre></td></tr></table></figure></li>
<li><p><code>message</code>: func</p>
<ul>
<li>将在用户试图导航到下一个位置时调用。需要返回一个字符串以向用户显示提示，或者返回 true 以允许直接跳转。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;Prompt</span><br><span class="line">  message=&#123;<span class="function">(<span class="params">location</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> isApp = location.pathname.startsWith(<span class="string">&quot;/app&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> isApp ? <span class="string">`你确定要跳转到<span class="subst">$&#123;location.pathname&#125;</span>吗？`</span> : <span class="literal">true</span>;</span><br><span class="line">  &#125;&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>说明</strong>：上例中的 location 对象指的是下一个位置（即用户想要跳转到的位置）。你可以基于它包含的一些信息，判断是否阻止导航，或者允许直接跳转。</li>
</ul>
</li>
<li><p><code>when</code>: bool</p>
<ul>
<li><p>在应用程序中，你可以始终渲染 <Prompt> 组件，并通过设置 when={true} 或 when={false} 以阻止或允许相应的导航，而不是根据某些条件来决定是否渲染 <Prompt> 组件。</Prompt></Prompt></p>
</li>
<li><p><strong>说明</strong>：when 只有两种情况，当它的值为 true 时，会弹出提示信息。如果为 false 则不会弹出。</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;Prompt when=&#123;<span class="literal">true</span>&#125; message=<span class="string">&quot;你确定要离开当前页面吗？&quot;</span> /&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>基本使用如下：</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Prompt &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line">&lt;Prompt when=&#123;<span class="literal">true</span> - or - <span class="literal">false</span>&#125; message=<span class="string">&quot;你确定要离开当前页面吗？&quot;</span> /&gt;;</span><br></pre></td></tr></table></figure>
<h3 id="React-Hooks-概述"><a href="#React-Hooks-概述" class="headerlink" title="React Hooks 概述"></a><a href="https://react.docschina.org/docs/hooks-reference.html">React Hooks</a> 概述</h3><h4 id="React-Hooks-的发行版本"><a href="#React-Hooks-的发行版本" class="headerlink" title="React Hooks 的发行版本"></a>React Hooks 的发行版本</h4><p>1，Hook 是 React 16.8 的新增特性。</p>
<h4 id="React-Hooks-的作用"><a href="#React-Hooks-的作用" class="headerlink" title="React Hooks 的作用"></a>React Hooks 的作用</h4><p>1，它可以让你在不编写 class 的情况下使用 state 以及其他的 React 特性。</p>
<ul>
<li>即 Hook 可以在使用函数式组件时拥有状态（state）及生命周期，还有其他的 React 特性。</li>
</ul>
<h3 id="常用的-Hook"><a href="#常用的-Hook" class="headerlink" title="常用的 Hook"></a>常用的 Hook</h3><h4 id="State-Hook"><a href="#State-Hook" class="headerlink" title="State Hook"></a>State Hook</h4><p>1，State Hook API：useState()。</p>
<h4 id="Effect-Hook"><a href="#Effect-Hook" class="headerlink" title="Effect Hook"></a>Effect Hook</h4><p>1，Effect Hook API：useEffect()。</p>
<h4 id="Ref-Hook"><a href="#Ref-Hook" class="headerlink" title="Ref Hook"></a>Ref Hook</h4><p>1，Ref Hook API：useRef()。</p>
<h3 id="Hooks-API-具体解析"><a href="#Hooks-API-具体解析" class="headerlink" title="Hooks API 具体解析"></a>Hooks API 具体解析</h3><h4 id="State-Hook-1"><a href="#State-Hook-1" class="headerlink" title="State Hook"></a>State Hook</h4><p>1，State Hook 让函数组件也拥有 state 状态，并进行状态数据的读写操作。</p>
<p>2，语法：</p>
<ul>
<li>const [xxx,setXxx] = useState(ininValue)。</li>
</ul>
<p>3，useState 说明：</p>
<ul>
<li><p>参数：第一次作为初始化状态值在内部缓存。</p>
</li>
<li><p>返回值：2 个元素的数组，第一个为内部当前状态值，第二个为设置保存新状态值的函数。</p>
</li>
</ul>
<p>4，useState 返回值 setXxx 说明：</p>
<ul>
<li>setXxx(newValue):参数为非函数值，直接指定新的状态值，内部用其覆盖原来的状态值。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;button onClick = &#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    setCount(count+<span class="number">1</span>) <span class="comment">// 参数为非函数类型</span></span><br><span class="line">&#125;&#125; click me &lt;/button&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>setXxx(newValue):参数为函数，接收原本的旧状态值，返回新的状态值，内部用其覆盖原来的状态值。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;button onClick = &#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    setCount(<span class="function"><span class="params">name</span> =&gt;</span> name + <span class="string">&#x27;snsn&#x27;</span>) <span class="comment">// 参数为函数类型</span></span><br><span class="line">&#125;&#125; click me &lt;/button&gt;</span><br></pre></td></tr></table></figure>
<p>5，多次调用 useState 的理解：</p>
<ul>
<li><p>内部按第一次执行的顺序依次保存状态数据及其对应的更新函数。</p>
</li>
<li><p>这个顺序/个数在后面更新时不能改变，否则会抛出异常。</p>
</li>
</ul>
<p>6，<strong>注意</strong>：</p>
<ul>
<li><p>const [xxx,setXxx] = useState(ininValue) 不能写在<strong>if 语句，for 循环语句</strong><br>等判断及其他语句中，这会改变返回的数组的顺次，会报错，<strong>必须写在外部函数的最顶层</strong>。</p>
</li>
<li><p>在同一个点击事件中返回一个箭头函数，其中箭头函数中可包含多个 setState()（更新函数）。</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;button onClick = &#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    setCount(count+<span class="number">1</span>) <span class="comment">// 参数为非函数类型</span></span><br><span class="line">    setCount(<span class="function"><span class="params">name</span> =&gt;</span> name + <span class="string">&#x27;snsn&#x27;</span>) <span class="comment">// 参数为函数类型</span></span><br><span class="line">&#125;&#125; click me &lt;/button&gt;</span><br></pre></td></tr></table></figure>
<p>7，基本使用案例：</p>
<ul>
<li>TodoList 内容：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> TodoForm <span class="keyword">from</span> <span class="string">&quot;./TodoForm&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">TodoList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [todos, setTodos] = useState([]);</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setValue</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (text) setTodos([...todos, text]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;TodoForm listOnSubmit=&#123;setValue&#125; /&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &#123;todos.map(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>&#123;item&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>;</span><br><span class="line">        &#125;)&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;button</span><br><span class="line">        onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          setTodos([]);</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        清除内容</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>TodoItem 内容：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">// 定义逻辑复用的hook</span></span><br><span class="line"><span class="keyword">const</span> useInputValue = <span class="function">(<span class="params">inputValue</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState(inputValue);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    value,</span><br><span class="line">    onChange: <span class="function">(<span class="params">e</span>) =&gt;</span> (e.target.value.trim() ? setValue(e.target.value) : <span class="literal">null</span>),</span><br><span class="line">    reSetValue: <span class="function">() =&gt;</span> setValue(<span class="string">&quot;&quot;</span>),</span><br><span class="line">    onFocus: <span class="function">() =&gt;</span> inpRef.current.focus(),</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> inpRef = React.createRef();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">TodoForm</span>(<span class="params">&#123; listOnSubmit &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; reSetValue, onFocus, ...text &#125; = useInputValue(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onSubmitHeader</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    <span class="comment">// 调用父组件方法将新的value加入到todos中</span></span><br><span class="line">    listOnSubmit(text.value);</span><br><span class="line">    reSetValue(); <span class="comment">// 清空输入框</span></span><br><span class="line">    onFocus(); <span class="comment">// 获取焦点</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;form onSubmit=&#123;onSubmitHeader&#125;&gt;</span><br><span class="line">      &#123;<span class="comment">/* 受控组件</span></span><br><span class="line"><span class="comment">         &lt;input type=&quot;text&quot; value=&#123;value&#125;</span></span><br><span class="line"><span class="comment">            onChange=&#123;e =&gt; setValue(e.target.value)&#125;</span></span><br><span class="line"><span class="comment">         /&gt; */</span>&#125;</span><br><span class="line">      &lt;input type=<span class="string">&quot;text&quot;</span> &#123;...text&#125; ref=&#123;inpRef&#125; /&gt;</span><br><span class="line">      &lt;input type=<span class="string">&quot;submit&quot;</span> /&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Effect-Hook-1"><a href="#Effect-Hook-1" class="headerlink" title="Effect Hook"></a>Effect Hook</h4><p>1，Effect Hook 可以让函数式组件执行副作用操作。</p>
<p>2，React 副作用说明：</p>
<ul>
<li><p>发送 ajax 请求数据获取。</p>
</li>
<li><p>设置订阅/启动定时器。</p>
</li>
<li><p>手动更新真实 DOM 。</p>
</li>
</ul>
<p>3，语法解析：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在每次render( )后执行</span></span><br><span class="line">useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  effect<span class="string">`// 此处写副作用`</span>;</span><br><span class="line">  <span class="comment">// 在组件卸载前执行</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cleanup<span class="string">`// 此处写清除副作用代码`</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;, [<span class="string">&quot;此处写依赖项&quot;</span>]);</span><br></pre></td></tr></table></figure>
<p>4，useEffect() 参数说明：</p>
<ul>
<li><p>useEffect() 方法接收两个参数，分别为：</p>
<ul>
<li><p>第一个为回调函数（即箭头函数）。</p>
</li>
<li><p>第二个为依赖项（是一个数组）。</p>
</li>
</ul>
</li>
</ul>
<p>5，useEffect 相当于 class 类组件中的三个组件，分别是：</p>
<ul>
<li><p><strong>componentDidMount</strong>。</p>
</li>
<li><p><strong>componentDidUpdate</strong>。</p>
</li>
<li><p><strong>componentWillUnmount</strong>。</p>
</li>
</ul>
<p>6，useEffect() 第二个参数——<strong>依赖项</strong>说明：</p>
<ul>
<li><p>如果数组依赖性为空，回调函数只会在初始化渲染一次，后面的所有 render 将不再执行。</p>
<ul>
<li>依赖项为空数组：相当与 class 类组件中的<strong>componentDidMount</strong>，并且只会在初始化的时候执行一次，之后就不再执行。</li>
<li>没有依赖项时：相当于生命周期的<strong>componentDidMount</strong>和<strong>componentDidUpdate</strong>，并且每次渲染都会执行。</li>
<li>依赖项数组不为空时：即代表只有当依赖项数组中的值改变时，才会触发<strong>componentDidMount</strong>。</li>
</ul>
</li>
</ul>
<p>7，<strong>注意</strong>：useEffect 每次都在 render() 执行之后（即渲染完成后）才执行。</p>
<p>8，基本使用案例：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useEffectDepend</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> names = [<span class="string">&quot;zzz&quot;</span>, <span class="string">&quot;mmm&quot;</span>, <span class="string">&quot;sss&quot;</span>, <span class="string">&quot;nnn&quot;</span>];</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [name, setName] = useState([]);</span><br><span class="line">  <span class="keyword">const</span> [msg, setMsg] = useState(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (index &gt; <span class="number">3</span>) &#123;</span><br><span class="line">    index = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.title = count + name;</span><br><span class="line">    <span class="keyword">const</span> timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;执行了&quot;</span>);</span><br><span class="line">      setMsg(<span class="function">(<span class="params">msg</span>) =&gt;</span> (count !== <span class="number">0</span> ? msg + count + name : <span class="string">&quot;&quot;</span>));</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [count]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;count:&#123;count !== <span class="number">0</span> ? count : <span class="string">&quot;&quot;</span>&#125;&lt;/p&gt;</span><br><span class="line">      &lt;button</span><br><span class="line">        onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          setCount(count + <span class="number">1</span>);</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        changeCount</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;p&gt;name:&#123;name&#125;&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;<span class="function">() =&gt;</span> setName(name.concat(names[index++]))&#125;&gt;</span><br><span class="line">        changeName</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;p&gt;msg:&#123;msg&#125;&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Ref-Hooks-容器组件"><a href="#Ref-Hooks-容器组件" class="headerlink" title="Ref Hooks(容器组件)"></a>Ref Hooks(容器组件)</h4><p>1，Ref Hook 可以在函数中，组件中储存/查找组件内的标签或任意其他数据。</p>
<p>2，语法：const RefContainer = useRef(initialValue)。</p>
<p>3，作用：</p>
<ul>
<li><p>保存标签对象：功能与**React.createRef()**一样。</p>
</li>
<li><p>保存任意数据：</p>
<ul>
<li>保存：<code>RefContainer.current=XXX</code>。</li>
<li>读取：<code>RefContainer.current.XXX</code>。</li>
</ul>
</li>
</ul>
<p>4，useRef 说明：</p>
<ul>
<li><p>useRef 返回一个可变的 ref 对象，其 .current 属性被初始化为传入的参数（initialValue）。<br>返回的 ref 对象在组件的整个生命周期内保持不变。</p>
</li>
<li><p>useRef 中 current 属性，用来保存或读取 ref 对象中保存的数据。<br>只要经过 current 保存进入 ref 容器中的值，将在整个生命周期内保持不变。</p>
</li>
<li><p>每次创建一类 Ref 容器，只要是同一类的容器，就不会在每次更新时，<br>都重新创建一个容器，而是使用第一次创建的那个 Ref 容器，然后每次都向该容器中保存数据。</p>
</li>
</ul>
<p>5，基本使用案例：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect, useMemo, useRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> timerID = useRef();</span><br><span class="line">  <span class="keyword">const</span> doubleCount = useMemo(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span> * count;</span><br><span class="line">  &#125;, [count]);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 使用timerID.current保存定时器标识，使该标识在组件内任何地方都能使用</span></span><br><span class="line">    timerID.current = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      setCount(<span class="function">(<span class="params">count</span>) =&gt;</span> count + <span class="number">1</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (count &gt;= <span class="number">20</span>) &#123;</span><br><span class="line">      <span class="built_in">clearInterval</span>(timerID.current);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">clearTimer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">clearInterval</span>(timerID.current);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;p ref=&#123;timerID&#125;&gt;</span><br><span class="line">        Count: &#123;count&#125;, <span class="attr">double</span>: &#123;doubleCount&#125;</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;clearTimer&#125;&gt;clearTimer&lt;/button&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Context-Hook"><a href="#Context-Hook" class="headerlink" title="Context Hook"></a>Context Hook</h4><p>1，使用 Context Hook 可以使函数式组件进行跨组件通信。</p>
<p>2，语法：const value = useContext(MyContext)。</p>
<p>3，useContext()方法说明：</p>
<ul>
<li><p>接收一个 context 对象（React.createContext 的返回值，<br>即 const MyContext=React.createContext(null)）并返回该 context 的当前值。当前的 context 值由上层组件中距离当前组件最近的 &lt;MyContext.Provider&gt; 的 value prop 决定。</p>
</li>
<li><p>当组件上层最近的 &lt;MyContext.Provider&gt; 更新时，该 Hook 会触发重新渲染，<br>并使用最新传递给 MyContext provider 的 context value 值。</p>
</li>
<li><p>在同一个组件中，可以使用多个 useContext()，接收不同组件中传递的数据。</p>
</li>
</ul>
<p>4，基本使用案例：</p>
<ul>
<li>UseContext 组件内容：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Parent <span class="keyword">from</span> <span class="string">&quot;./Parent&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> MyContext = React.createContext();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">UseContext</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;MyContext.Provider value=&#123;count&#125;&gt;</span><br><span class="line">      &lt;Parent /&gt;</span><br><span class="line">      &lt;button</span><br><span class="line">        onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          setCount(count + <span class="number">1</span>);</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        changeCount</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/MyContext.Provider&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Parent 组件内容：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Children <span class="keyword">from</span> <span class="string">&quot;./Children&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> nameContext = React.createContext();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">UseContext</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> names = [<span class="string">&quot;s&quot;</span>, <span class="string">&quot;n&quot;</span>, <span class="string">&quot;x&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;h&quot;</span>, <span class="string">&quot;m&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;w&quot;</span>];</span><br><span class="line">  <span class="keyword">if</span> (index &gt; names.length - <span class="number">1</span>) index = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> [name, setName] = useState([<span class="string">&quot;f&quot;</span>]);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;nameContext.Provider value=&#123;name&#125;&gt;</span><br><span class="line">      &lt;Children /&gt;</span><br><span class="line">      &lt;button</span><br><span class="line">        onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          setName(name.concat(names[index++]));</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        changeName</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/nameContext.Provider&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Children 组件内容：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; MyContext &#125; <span class="keyword">from</span> <span class="string">&quot;./UseContext&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; nameContext &#125; <span class="keyword">from</span> <span class="string">&quot;./Parent&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Children</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> count = useContext(MyContext);</span><br><span class="line">  <span class="keyword">const</span> name = useContext(nameContext);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;Count:&#123;count * <span class="number">2</span>&#125;&lt;/p&gt;</span><br><span class="line">      &lt;p&gt;Name:&#123;name&#125;&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Reducer-Hook"><a href="#Reducer-Hook" class="headerlink" title="Reducer Hook"></a>Reducer Hook</h4><p>1，useReducer() 类似于 redux 中的 reducer，可以根据触发事件的不同得到对应的状态。</p>
<p>2，语法：const [state, dispatch] = useReducer(reducer, initialArg, init)。</p>
<p>3，useReducer()方法说明：</p>
<ul>
<li><p>useState 的代替方案。它接收一个形如（state，action）=&gt; newState 的 reducer，<br>并返回当前的 state 以及与其配套的 dispatch 方法。</p>
</li>
<li><p>在某些场景下，useReducer 会比 useState 更适用，例如 state 逻辑较复杂且包含多个子值，或者下一个 state 依赖于之前的 state 等。并且，使用 useReducer 还能给那些会触发深更新的组件做性能优化，因为你可以向子组件传递 dispatch 而不是回调函数。</p>
</li>
</ul>
<p>4，基本使用示例:</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;increment&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.count + <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;decrement&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.count - <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = useReducer(reducer, initialState);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      Count: &#123;state.count&#125;</span><br><span class="line">      &lt;button onClick=&#123;<span class="function">() =&gt;</span> dispatch(&#123; <span class="attr">type</span>: <span class="string">&quot;decrement&quot;</span> &#125;)&#125;&gt;-&lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;<span class="function">() =&gt;</span> dispatch(&#123; <span class="attr">type</span>: <span class="string">&quot;increment&quot;</span> &#125;)&#125;&gt;+&lt;/button&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Callback-Hook"><a href="#Callback-Hook" class="headerlink" title="Callback Hook"></a>Callback Hook</h4><p>1，语法：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> memoizedCallback = useCallback(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  doSomething(a, b);</span><br><span class="line">&#125;, [a, b]);</span><br></pre></td></tr></table></figure>
<p>2，useCallback()方法说明：</p>
<ul>
<li><p>类似于 class 类组件中的 componentShouldUpDate()。</p>
</li>
<li><p>该方法返回一个 memoized 回调函数。</p>
</li>
<li><p>把内联回调函数及依赖项数组作为参数传入 useCallback ，它将返回该回调函数的 memoized 版本，该回调函数仅在某个依赖项改变时才会更新。</p>
</li>
<li><p>并不是说依赖项没有改变，useCallback 就不会执行，不管依赖项变没变，useCallback Hook 都会执行。依赖项的改变只是决定 useCallback Hook 中的回调函数是否需要更新。</p>
</li>
<li><p>依赖项改变，useCallback Hook 返回的 memoized 回调函数就会更新。<br>即 useCallback 中保存的回调函数才会更新。</p>
</li>
<li><p>useCallback（fn，deps）相当于 useMemo（( ) =&gt; fn , deps）。</p>
</li>
</ul>
<p>3，使用场景是：</p>
<ul>
<li><p>有一个父组件，其中包含子组件，子组件接收一个函数作为 props ；通常而言，如果父组件更新了，子组件也会执行更新；但是大多数场景下，更新是没有必要的，我们可以借助 useCallback 来返回函数，然后把这个函数作为 props 传递给子组件；这样，子组件就能避免不必要的更新。</p>
</li>
<li><p><strong>说明</strong>：所有依赖本地状态或 props 来创建函数，需要使用到缓存函数的地方，都是 useCallback 的应用场景。</p>
</li>
</ul>
<p>4，<strong>注意</strong>：依赖项数组不会作为参数传给回调函数。</p>
<p>5，特别说明：</p>
<ul>
<li>useEffect、useMemo、useCallback 都是自带闭包的。也就是说，每一次组件的渲染，其都会捕获当前组件函数上下文中的状态(state, props)，所以每一次这三种 hooks 的执行，<br>反映的也都是当前的状态，你无法使用它们来捕获上一次的状态。对于这种情况，我们应该使用 ref 来访问。</li>
</ul>
<p>6，基本使用案例：</p>
<ul>
<li>案例一：查看 useCallback 返回的函数是否变化：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, useCallback &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*我们可以看到，每次修改count，set.size就会+1，</span></span><br><span class="line"><span class="comment">这说明useCallback依赖变量count，count变更时会返回新的函数。</span></span><br><span class="line"><span class="comment">而val变更时，set.size不会变，说明返回的是缓存的旧版本函数。*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Callback</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">const</span> [val, setVal] = useState(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> callback = useCallback(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(count);</span><br><span class="line">  &#125;, [count]);</span><br><span class="line">  callback();</span><br><span class="line"></span><br><span class="line">  set.add(callback);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h4&gt;count:&#123;count&#125;&lt;/h4&gt;</span><br><span class="line">      &lt;h4&gt;setLength:&#123;set.size&#125;&lt;/h4&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          value=&#123;val&#125;</span><br><span class="line">          placeholder=<span class="string">&quot;UCB缓存的函数不受val影响&quot;</span></span><br><span class="line">          onChange=&#123;<span class="function">(<span class="params">event</span>) =&gt;</span> setVal(event.target.value)&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="function">() =&gt;</span> setCount(count + <span class="number">1</span>)&#125;&gt;count++&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;h4&gt;&#123;val&#125;&lt;/h4&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>案例二：防止子组件产生不必要的更新：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 父组件内容</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState, useCallback &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">&quot;./Child-update&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Parent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">const</span> [val, setVal] = useState(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> callback = useCallback(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">  &#125;, [count]);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h3&gt;Parent-count：&#123;count&#125;&lt;/h3&gt;</span><br><span class="line">      &lt;p&gt;Parent-val:&#123;val&#125;&lt;/p&gt;</span><br><span class="line">      &lt;Child callback=&#123;callback&#125; msg=&#123;count&#125; /&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          value=&#123;val&#125;</span><br><span class="line">          placeholder=<span class="string">&quot;count改变子组件才会刷新&quot;</span></span><br><span class="line">          onChange=&#123;<span class="function">(<span class="params">event</span>) =&gt;</span> setVal(event.target.value)&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="function">() =&gt;</span> setCount(count + <span class="number">1</span>)&#125;&gt;ParentCount++&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子组件内容</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Child</span>(<span class="params">&#123; callback &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> pRef = useRef();</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="function">() =&gt;</span> callback());</span><br><span class="line">  <span class="keyword">const</span> result = (pRef.current = <span class="string">&quot;组件更新&quot;</span> + count + <span class="string">&quot;次了&quot;</span>);</span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;更新了&quot;</span>);</span><br><span class="line">    setCount(callback());</span><br><span class="line">  &#125;, [callback]);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h3 ref=&#123;pRef&#125;&gt;Child&#123;result&#125;&lt;/h3&gt;</span><br><span class="line">      &lt;h3&gt;Child-count:&#123;count&#125;&lt;/h3&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="useMemo-Hook"><a href="#useMemo-Hook" class="headerlink" title="useMemo Hook"></a>useMemo Hook</h4><p>1，语法：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> memoizedvalue = useMemo(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  calculateValue(a, b);</span><br><span class="line">&#125;, [a, b]);</span><br></pre></td></tr></table></figure>
<p>2，useMemo()方法说明：</p>
<ul>
<li><p>useMemo()方法返回一个 memoized 值。</p>
</li>
<li><p>把创建函数和依赖项数组作为参数传入 useMemo ，它仅会在某个依赖项改变时才会重新计算 memoized 值。这种优化有助于避免在每次渲染时都进行高开消的计算。</p>
</li>
</ul>
<p>3，<strong>useMemo 注意点</strong>：</p>
<ul>
<li><p>传入 useMemo 的函数会在渲染器件执行。不要在这个函数内部执行与渲染无关的操作，诸如副作用这类的操作属于 useEffect 的适用范畴，无不是 useMemo。</p>
</li>
<li><p>如果没有依赖项数组，useMemo 在每次渲染是都会计算新的值。</p>
</li>
<li><p>你可以把 useMemo 作为性能优化的手段，但不要把它当成语义上的保证。</p>
</li>
</ul>
<p>4，基本使用案例：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, useMemo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">WithMemo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">const</span> [val, setValue] = useState(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> expensive = useMemo(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;该函数中的计算执行了&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; count * <span class="number">100</span>; i++) &#123;</span><br><span class="line">      sum += i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">  &#125;, [count]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h4&gt;</span><br><span class="line">        count-expensive:&#123;count&#125;-&#123;expensive&#125;</span><br><span class="line">      &lt;/h4&gt;</span><br><span class="line">      &lt;p&gt;val:&#123;val ? val : <span class="string">&quot;请输入内容&quot;</span>&#125;&lt;/p&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          value=&#123;val&#125;</span><br><span class="line">          placeholder=<span class="string">&quot;val改变不会重新计算sum&quot;</span></span><br><span class="line">          onChange=&#123;<span class="function">(<span class="params">event</span>) =&gt;</span> setValue(event.target.value)&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="function">() =&gt;</span> setCount(count + <span class="number">1</span>)&#125;&gt;Computed&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="useSelector-Hook-与-useDispatch-Hook"><a href="#useSelector-Hook-与-useDispatch-Hook" class="headerlink" title="useSelector Hook 与 useDispatch Hook"></a>useSelector Hook 与 useDispatch Hook</h4><p>1，useSelect：</p>
<ul>
<li><p>语法：const todo = useSelector(state =&gt; state.todo)。</p>
</li>
<li><p>作用：useSelector 是从 redux 的 store 对象中提取数据（state）。</p>
</li>
<li><p>使用 useSelector 在默认情况下，如果每次返回一个新对象，将始终进行强制 re-reder ，如果要从 store 中获取多个值，可以向以下这样做：</p>
<ul>
<li><p>useSelector() 调用多次，每次返回一个字段值。</p>
</li>
<li><p>使用 useSelector 或类似的库创建一个记忆（memorized）Selector ，它在一个对象中返回多个值，但只能在其中一个值发生更改时才返回一个新对象。</p>
</li>
<li><p>使用 react-redux 提供的 shallowEqul 函数作为 useSelector 的 equailtyFn 参数。</p>
</li>
</ul>
</li>
</ul>
<p>2，useDispatch：</p>
<ul>
<li><p>语法：const dispatch = useDispatch()。</p>
</li>
<li><p>作用：该 Hook 返回 Redux store 中对 dispatch 函数的引用。</p>
</li>
<li><p>当使用 dispatch 将回调函数传递给子组件时，建议使用 useCallback 对其进行记忆，否则子组件可能由于引用的改变而进行不必要的渲染，如下：</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 父组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> CounterComponent = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> dispatch = useDispatch();</span><br><span class="line">  <span class="keyword">const</span> incrementCounter = useCallback(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    dispatch(&#123; <span class="attr">type</span>: <span class="string">&quot;increment- Counter&quot;</span> &#125;);</span><br><span class="line">  &#125;, [dispatch]);</span><br><span class="line">  Return(</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;&#123;value&#125;&lt;/p&gt;</span><br><span class="line">      &lt;MyIncrementButton onIncrement=&#123;incrementCounter&#125; /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> MyIncrementButton = React.memo(<span class="function">(<span class="params">onIncrement</span>) =&gt;</span> &#123;</span><br><span class="line">  &lt;button onClick=&#123;onIncrement&#125;&gt;Increment counter&lt;/button&gt;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>3，useSelect/useDispatch 基本使用案例：</p>
<ul>
<li>Parent 内容：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">&quot;./child&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;使用useSelector和UseDispatch&lt;/h1&gt;</span><br><span class="line">      &lt;Child /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<ul>
<li>Child 内容：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useSelector, useDispatch &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Child</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> num = useSelector(<span class="function">(<span class="params">state</span>) =&gt;</span> state.num);</span><br><span class="line">  <span class="keyword">const</span> dispatch = useDispatch();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;&#123;num&#125;&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;<span class="function">() =&gt;</span> dispatch(&#123; <span class="attr">type</span>: <span class="string">&quot;increment&quot;</span> &#125;)&#125;&gt;+&lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;<span class="function">() =&gt;</span> dispatch(&#123; <span class="attr">type</span>: <span class="string">&quot;decrement&quot;</span> &#125;)&#125;&gt;-&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Child;</span><br></pre></td></tr></table></figure>
<ul>
<li>Redux/reducer 内容：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;increment&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">num</span>: state.num + <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;decrement&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">num</span>: state.num - <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Redux/store 内容：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&quot;redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; reducer &#125; <span class="keyword">from</span> <span class="string">&quot;./reducer&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">num</span>: <span class="number">0</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer, initialState);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>
<h4 id="自定义-Hooks"><a href="#自定义-Hooks" class="headerlink" title="自定义 Hooks"></a>自定义 Hooks</h4><p>1，自定义 Hook 说明：</p>
<ul>
<li><p>自定义 Hook 其实就是把 useXxx 方法执行以后，把方法体里面的内容平铺到组件内部。</p>
</li>
<li><p>一般自定义 Hook 只负责逻辑，不负责渲染。</p>
</li>
<li><p>公共逻辑的 Hook 尽量细分，按照组件的单一原则划分，单一 Hook 只负责单一的职责。</p>
</li>
<li><p>复杂的计算可以尽量考虑用 useCallback/useMemo 去优化。</p>
</li>
</ul>
<p>2，自定义 hooks 基本使用案例：</p>
<ul>
<li>定义自定义 hook 内容</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useWindowSize = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [width, setWidth] = useState(<span class="string">&quot;0px&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> [height, setHeight] = useState(<span class="string">&quot;0px&quot;</span>);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;snsnsnsn&quot;</span>); <span class="comment">// 初始化执行一次</span></span><br><span class="line">    setWidth(<span class="built_in">document</span>.documentElement.clientWidth + <span class="string">&quot;px&quot;</span>);</span><br><span class="line">    setHeight(<span class="built_in">document</span>.documentElement.clientHeight + <span class="string">&quot;px&quot;</span>);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> handleResize = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      setWidth(<span class="built_in">document</span>.documentElement.clientWidth + <span class="string">&quot;px&quot;</span>);</span><br><span class="line">      setHeight(<span class="built_in">document</span>.documentElement.clientHeight + <span class="string">&quot;px&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">&quot;resize&quot;</span>, handleResize, <span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//使用false是为了取消副作用</span></span><br><span class="line">      <span class="built_in">window</span>.removeEventListener(<span class="string">&quot;resize&quot;</span>, handleResize, <span class="literal">false</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [width, height]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [width, height];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用自定义 hook 组件内容</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useWindowSize &#125; <span class="keyword">from</span> <span class="string">&quot;./index&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> Parent = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [width, height] = useWindowSize();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      size:&#123;width&#125;*&#123;height&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;Parent /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<p>3，自定义 hook 使用说明：</p>
<ul>
<li><p>创建自定义 Hook 必须以 use 开头。</p>
</li>
<li><p>必须要有返回值，把更新的状态以数组的形式返回。</p>
</li>
<li><p>在自定义 Hook 时，如果有副作用操作需要将其放在 useEffect() 方法中。比如：发起监听，设置定时器，发送 ajax 请求等。</p>
</li>
<li><p>当需要对性能进行优化时，比如要进行复杂运算，还有防止不必要的渲染时，可以将其写在 useCallback 和 useMemo 方法中。</p>
</li>
<li><p>useEffect、useCallback、useMemo 三者都有第二个参数，即依赖项，都可以根据依赖项确定是否执行回调函数，进行渲染。但是三者的使用场景不一样。</p>
</li>
<li><p>useEffect 主要用于操作副作用。useCallback 主要用于避免不必要渲染，既返回的 memoized 回调函数不需要每次渲染时都执行以更新状态。便于提升性能。useMemo 主要用于进行复杂的运算。使复杂运算不需要每次渲染时都要重新计算 memoized 值。</p>
</li>
</ul>
<h3 id="redux-基本简介"><a href="#redux-基本简介" class="headerlink" title="redux 基本简介"></a>redux 基本简介</h3><h4 id="redux-概述"><a href="#redux-概述" class="headerlink" title="redux 概述"></a>redux 概述</h4><p>1，redux 是一个独立专门用于做状态管理的 JS 库（不是 react 插件库）。</p>
<p>2，它可以用在 react，angular，vue 等项目中，但基本是与 react 配合使用。</p>
<h4 id="redux-的作用"><a href="#redux-的作用" class="headerlink" title="redux 的作用"></a>redux 的作用</h4><p>1，管理 react 应用中多个组件共享的状态。</p>
<h4 id="redux-工作流程图"><a href="#redux-工作流程图" class="headerlink" title="redux 工作流程图"></a>redux 工作流程图</h4><p><img src="/2019/02/20/react/redux1.jpg" alt="redux 工作流程图"></p>
<h4 id="为什么要用-redux"><a href="#为什么要用-redux" class="headerlink" title="为什么要用 redux"></a>为什么要用 redux</h4><p>1，在 react 中，数据在组件中是单向流动的，数据从一个方向父组件流向子组件（通过 props），所以，两个父子组件之间通信相对麻烦，redux 的出现就是为了解决 state 里面的数据问题。</p>
<p><img src="/2019/02/20/react/redux2.webp" alt="redux 通信"></p>
<h4 id="redux-的设计理念"><a href="#redux-的设计理念" class="headerlink" title="redux 的设计理念"></a>redux 的设计理念</h4><p>1，redux 将整个应用状态储存到一个地方上，称为 store，里面保存着一个状态树——store tree，组件可以派发（dispatch）行为（action）给 store ，而不是直接通知其他组件，组件内部通过订阅 store 中的状态 state 来刷新自己的视图（view）。</p>
<h4 id="redux-的三大原则"><a href="#redux-的三大原则" class="headerlink" title="redux 的三大原则"></a>redux 的三大原则</h4><p>1，唯一数据源：</p>
<ul>
<li>整个应用的 state 都被存储到一个状态树里面，并且这个状态树，只存在于唯一的 store 中。</li>
</ul>
<p>2，保持只读状态：</p>
<ul>
<li>State 是只读的，唯一改变 state 的方法就是触发 action ，action 是一个用于描述已发生事件的普通对象。</li>
</ul>
<p>3，数据改变只能通过纯函数来执行：</p>
<ul>
<li>使用纯函数来执行修改，为了描述 action 如何改变 state 的，你需要编写 reducers。</li>
</ul>
<h3 id="redux-概念解析"><a href="#redux-概念解析" class="headerlink" title="redux 概念解析"></a><a href="https://www.redux.org.cn/">redux</a> 概念解析</h3><h4 id="store"><a href="#store" class="headerlink" title="store"></a>store</h4><p>1，store 是保存数据的地方，可以把它看成一个数据，整个应用只能有一个 store 。redux 提供 createStore 这个函数，用来生成 store。</p>
<p>2，store 对象的作用：redux 库最核心的管理对象。</p>
<p>3，它内部维护者：reducer（根据老状态更新出新状态的函数）。</p>
<p>4，核心方法：</p>
<ul>
<li><p>getState()：获取状态 state。</p>
</li>
<li><p>dispatch(action)：分发事件，最终触发 reducer 调用产生新的状态。</p>
</li>
<li><p>subscribe(listencer)：订阅监听，当产生了新的 state 时，自动调用。</p>
<ul>
<li>通过 subscribe(listener) 返回的函数注销监听器。</li>
</ul>
</li>
</ul>
<p>5，语法：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">store.getState();</span><br><span class="line">store.dispatch(&#123; <span class="attr">type</span>: <span class="string">&quot;INCREMENT&quot;</span>, number &#125;);</span><br><span class="line">store.subscrible(render);</span><br></pre></td></tr></table></figure>
<h4 id="state-1"><a href="#state-1" class="headerlink" title="state"></a>state</h4><p>2.1，state 就是 store 里面储存的数据， store 里面可以拥有多个 state ，<strong>redux 规定一个 state 对应一个 View</strong>，只要 state 相同，view 就是一样的，反过来也是一样的，可以通过 store.getState() 来获取 state。</p>
<h4 id="action"><a href="#action" class="headerlink" title="action"></a>action</h4><p>1，state 的改变会导致 View 的变化，但是在 redux 中不能直接操作 state ，也就是说不能使用 this.setState 来操作，用户只能接触到 View 。在 redux 中提供了一个 action 对象来告诉 store 需要改变 state 。</p>
<p>2，action 是一个对象，用来标识要执行的行为对象。其中 type 属性是必须的，表示 action<br>的名称，其他的可以根据需求自由设置。</p>
<p>3，action 对象属性介绍:</p>
<ul>
<li><p><code>type</code>：标识属性，值为字符串，唯一，必要属性。</p>
</li>
<li><p><code>data</code>：自定义数据属性，值类型任意，可选属性。</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> INCREMENT = <span class="string">&quot;INCREMENT&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> addAction = &#123; <span class="attr">type</span>: INCREMENT, <span class="attr">count</span>: <span class="number">1</span> &#125;;</span><br></pre></td></tr></table></figure>
<h4 id="dispatch"><a href="#dispatch" class="headerlink" title="dispatch"></a>dispatch</h4><p>1，store.dispatch() 是组件发出 action 的唯一方法。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">store.dispatch(addAction);</span><br></pre></td></tr></table></figure>
<p>2，dispatch 会分发 action ，触发 reducer 自动调用，产生新的 state。</p>
<p>3，dispatch 参数是一个 action ，而 action 是一个对象，而且 action 里面有两个属性:</p>
<ul>
<li><p>type：标识要执行行为的对象。</p>
</li>
<li><p>data：是类型任意的数据属性，这个属性是可选的。</p>
</li>
</ul>
<h4 id="reducer"><a href="#reducer" class="headerlink" title="reducer"></a>reducer</h4><p>1，store 收到 action 以后，必须给出一个新的 state ，这样 view 才会发生变化。这种 state 的计算过程就叫做 reducer 。</p>
<p>2，reducer 是一个纯函数，会根据老的 state 和 action 产生新的 state。</p>
<p>3，纯函数是函数或编程的概念，必须遵守以下一些约束。</p>
<ul>
<li><p>只要是同样的输入，必定得到同样的输出。</p>
</li>
<li><p>不得改写参数。</p>
</li>
<li><p>不能调用系统 i/O 的 API。</p>
</li>
<li><p>不能调用 Data.now() 或者 Math.random() 等不纯的方法，因为每次会得到不一样的结果。</p>
</li>
</ul>
<p>4，reducer 函数不用像其他函数一样，需要手动调用，store.dispatch() 方法会触发 reducer 自动执行。为此 store 需要知道 reducer 函数，做法就是 再生成 store 的时候，将 reducer 传入 createStore（reducer）方法中作为参数。</p>
<p>5，<strong>注意</strong>：reducer 必须是一个纯函数，也就是说函数返回的结果必须由参数 state 和 action 决定，而且不产生任何副作用也不能修改 state 和 action 对象。</p>
<h3 id="redux-核心-API-解析"><a href="#redux-核心-API-解析" class="headerlink" title="redux 核心 API 解析"></a>redux 核心 API 解析</h3><h4 id="createStore"><a href="#createStore" class="headerlink" title="createStore()"></a>createStore()</h4><p>1，作用：创建包含指定 reducer 的 store 对象。</p>
<p>2，语法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import &#123;createStore&#125; from &#39;redux&#39;</span><br><span class="line">import counter from &quot;.&#x2F;reducer&#x2F;counter&quot;</span><br><span class="line">const store &#x3D; createStore&#123;counter&#125;</span><br></pre></td></tr></table></figure>
<h4 id="applyMiddleware"><a href="#applyMiddleware" class="headerlink" title="applyMiddleware()"></a>applyMiddleware()</h4><p>1，该方法是基于 redux 的一个中间件（插件库）。</p>
<p>2，语法：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createStore,applyMiddleware&#125; <span class="keyword">from</span> “redux”</span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> “redux-thunk”<span class="comment">//redux异步中间件thunk</span></span><br><span class="line"><span class="keyword">const</span> store = createStore&#123;</span><br><span class="line">  counter，</span><br><span class="line">  applyMiddleware(thunk)    <span class="comment">// 传入异步中间件</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="combineReducers"><a href="#combineReducers" class="headerlink" title="combineReducers()"></a>combineReducers()</h4><p>1，作用：合并多个 reducer 函数。</p>
<p>2，语法：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> combineReducers(&#123; reducer1, reducer2, reducer3 &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="渲染方式"><a href="#渲染方式" class="headerlink" title="渲染方式"></a>渲染方式</h3><h4 id="具体编码方式"><a href="#具体编码方式" class="headerlink" title="具体编码方式"></a>具体编码方式</h4><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//将store属性赋值给App</span></span><br><span class="line">  ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化渲染</span></span><br><span class="line">render();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*订阅监听(store中的状态变化了，就会自动调用进行重绘,</span></span><br><span class="line"><span class="comment">  将新的state(状态显示出来。不写就不会显示))*/</span></span><br><span class="line">store.subscribe(render);</span><br></pre></td></tr></table></figure>
<h3 id="react-redux-基本介绍"><a href="#react-redux-基本介绍" class="headerlink" title="react-redux 基本介绍"></a><a href="https://react-redux.js.org/">react-redux</a> 基本介绍</h3><h4 id="react-redux-理解"><a href="#react-redux-理解" class="headerlink" title="react-redux 理解"></a>react-redux 理解</h4><p>1，react-redux 是一个 react 插件库。</p>
<p>2，其专门用来简化 react 应用中使用 redux。</p>
<h4 id="react-redux-对组件的分类"><a href="#react-redux-对组件的分类" class="headerlink" title="react-redux 对组件的分类"></a>react-redux 对组件的分类</h4><p>1，UI 组件：</p>
<ul>
<li>只负责 UI 的呈现，不带有任何业务逻辑，通过 props 接收数 据（一般数据和函数数据）。不使用任何 Redux 的 API。一般保存在 components 文件夹下。没有状态（即不使用 this.state 这个变量）。</li>
</ul>
<p>2，容器组件：</p>
<ul>
<li>负责管理数据和业务逻辑，不负责 UI 的呈现。使用 Redux 的 API ，一般保存在 containers 文件夹下。</li>
</ul>
<h3 id="react-redux-API"><a href="#react-redux-API" class="headerlink" title="react-redux API"></a>react-redux API</h3><h4 id="Provider"><a href="#Provider" class="headerlink" title="Provider"></a>Provider</h4><p>1，Provider 可让所有组件都可以得到 state 数据。</p>
<p>2，语法：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;Provider store = &#123;store&#125;&gt;</span><br><span class="line">  &lt;App /&gt;</span><br><span class="line">&lt;Provider /&gt;</span><br></pre></td></tr></table></figure>
<h4 id="connect"><a href="#connect" class="headerlink" title="connect()"></a>connect()</h4><p>1，该方法用于包装 UI 组件生成容器组件。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; increment, decrement, reset &#125; <span class="keyword">from</span> <span class="string">&#x27;./actions&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state <span class="comment">/*ownProps*/</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    counter: state.counter</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = &#123; increment, decrement, reset &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(</span><br><span class="line">  mapStateToProps,</span><br><span class="line">  mapDispatchToProps</span><br><span class="line">)(Counter)</span><br></pre></td></tr></table></figure>
<h4 id="mapStateToprops-说明"><a href="#mapStateToprops-说明" class="headerlink" title="mapStateToprops 说明"></a>mapStateToprops 说明</h4><p>1，mapStateToprops 是一个函数，它的作用就是用来建立一个从（外部的）state 对象到（UI 组件）props 对象的映射关系。</p>
<p>2，mapStateToprops 函数执行后，应该返回一个对象，里面的每一个键值对就是一个映射。</p>
<p>3，mapStateToprops 会订阅 store ，每当 state 更新的时候，就会自动执行，重新计算 UI 组件的参数，从而触发 UI 组件的重新渲染。</p>
<h4 id="mapDispatchToprops-说明"><a href="#mapDispatchToprops-说明" class="headerlink" title="mapDispatchToprops 说明"></a>mapDispatchToprops 说明</h4><p>1，mapDispatchToprops 是 connect 函数的第二个参数，用来建立 UI 组件的参数到 store.dispatch 方法的映射，也就是说，它定义了哪些用户的操作应该当做 action 传给 store ，它可以是函数也可以是对象。</p>
<h4 id="redux-thunk"><a href="#redux-thunk" class="headerlink" title="redux-thunk"></a>redux-thunk</h4><p>1，redux-thunk 是 redux 中的一个中间件。</p>
<p>2，作用：当组件中有复杂的异步请求时，为了减少组件的复杂程度，把异步请求使用中间件放在 actionCreator.js 中。</p>
<p>3，使用：在创建 store 时，需要从 redux 中引入 appMiddleware 这个方法（注意：appMiddleware 方法是专门用来管理中间件的。）而引入该方法的目的在于可以使用中间件。然后从 redux-thunk 这个库中引入 thunk 这个模块。</p>
<ul>
<li><p>import thunk from ‘redux-thunk’。</p>
</li>
<li><p>在创建 store 时，将 appMiddleware 这个方法作为参数传入。</p>
<ul>
<li>consts store = createStore(reducer, appMiddleware(thunk))。</li>
</ul>
</li>
<li><p>将组件中异步代码写在 action 中。当使用了 redux-thunk 中间件之后，这个 action 就会返回一个函数，在这个函数中可以做异步操作。（注意：必须由 dispatch 调用，然后再由 dispatch 分发 action 给一个同步的 action）。</p>
</li>
<li><p><strong>提示</strong>：每当有一个异步 action 时，就必定会有一个相对应的同步 action。</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义同步action</span></span><br><span class="line"><span class="keyword">const</span> incrementAsyn = <span class="function">(<span class="params">number</span>) =&gt;</span> (&#123; <span class="attr">type</span>: ASYNC, <span class="attr">data</span>: number &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义异步action</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> incrementAsync = <span class="function">(<span class="params">number</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      dispatch(incrementAsyn(number));</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="react-redux-具体使用"><a href="#react-redux-具体使用" class="headerlink" title="react-redux 具体使用"></a>react-redux 具体使用</h3><h4 id="创建-action-types"><a href="#创建-action-types" class="headerlink" title="创建 action-types"></a>创建 action-types</h4><p>1，创建的所有 action-types 都是与 action 中的 type 属性及 reducer 中 switch 中的 case 相对应的。这样就减少了出现错误的可能。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ASYN-TYPE1 = <span class="string">&#x27;ASYN-TYPE1&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ASYNC-TYPE1 = <span class="string">&#x27;ASYNC-TYPE1&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="创建同步或异步-action"><a href="#创建同步或异步-action" class="headerlink" title="创建同步或异步 action"></a>创建同步或异步 action</h4><p>1，每个异步 action 都需要对应一个同步 action ，即在异步 action 中分发一个同步 action 以供 reducer 纯函数进行状态更改。</p>
<p>2，在异步 action 中分发同步 action 时，每个 action 都必须有 despatch 方法进行分发。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 对应asyncFunc2</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="keyword">async</span>-type2 = <span class="function">(<span class="params">state</span>) =&gt;</span> &#123; <span class="attr">type</span>: ASYNC - TYPE2, <span class="attr">data</span>: state &#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="keyword">async</span>-type3 = <span class="function">(<span class="params">state</span>) =&gt;</span> &#123; <span class="attr">type</span>: ASYNC - TYPE3, <span class="attr">data</span>: state &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建异步action2</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> asyncFunc2 = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">dispatch</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 该action会在等待请求返回数据的时候触发</span></span><br><span class="line">    dispatch(<span class="keyword">async</span>-type3())</span><br><span class="line">    <span class="comment">// 发送fetch请求</span></span><br><span class="line">    fetch(<span class="string">&quot;http://localhost:3000/xxx&quot;</span>)</span><br><span class="line">      .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</span><br><span class="line">      .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        dispatch(<span class="keyword">async</span>-type2(data))</span><br><span class="line">      &#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(error)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="创建-reducer-纯函数"><a href="#创建-reducer-纯函数" class="headerlink" title="创建 reducer 纯函数"></a>创建 reducer 纯函数</h4><p>1，redux 中 state 是只读的，不能直接修改 state 的状态，必须使用 action 行为进行触发，再经过 reducer 纯函数进行修改。</p>
<p>2，当有多个 reducer 时，需要使用 combineReducers() 方法拼接多个 reducer。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reducers = combineReducers(&#123;</span><br><span class="line">  reducer1,</span><br><span class="line">  reducer2,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="创建-store-对象"><a href="#创建-store-对象" class="headerlink" title="创建 store 对象"></a>创建 store 对象</h4><p>1，store 是连接 reducer 、action 及 view 的桥梁。</p>
<p>2，其中 store 三个参数，常用参数是<code>reduder纯函数</code>，<code>applyMiddleware</code>中间件管理方法。 applyMiddleware 方法中就收的就是各种中间件，如<code>thunk中间件</code>(用于处理异步请求的中间件)。只要有异步操作就需要配置<code>redex-thunk</code>异步中间件。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">&quot;redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> reducers <span class="keyword">from</span> <span class="string">&quot;../reducers/index&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">&quot;redux-thunk&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建store对象</span></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducers, applyMiddleware(thunk));</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>
<h4 id="基本使用案例"><a href="#基本使用案例" class="headerlink" title="基本使用案例"></a>基本使用案例</h4><p>1，App 内容：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; increment, decrement, <span class="keyword">async</span>, suc &#125; <span class="keyword">from</span> <span class="string">&quot;./redux/actions/action&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  increment = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.props.increment(<span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  decrement = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.props.decrement(<span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  asyncHandler = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.props.async(<span class="number">5</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  success = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.props.suc();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; count &#125; = <span class="built_in">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> &#123; name, age, isfetch &#125; = <span class="built_in">this</span>.props.users;</span><br><span class="line">    <span class="keyword">let</span> data;</span><br><span class="line">    <span class="keyword">if</span> (isfetch) &#123;</span><br><span class="line">      data = <span class="string">&quot;Loading...&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      data = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;&#123;count&#125;&lt;/h1&gt;</span><br><span class="line">        &lt;h1&gt;&#123;data&#125;&lt;/h1&gt;</span><br><span class="line">        &lt;h1&gt;&#123;age&#125;&lt;/h1&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="built_in">this</span>.increment&#125;&gt;点我加<span class="number">1</span>&lt;/button&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="built_in">this</span>.decrement&#125;&gt;点我减<span class="number">1</span>&lt;/button&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="built_in">this</span>.asyncHandler&#125;&gt;点我加<span class="number">5</span>&lt;/button&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="built_in">this</span>.success&#125;&gt;发送请求&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(</span><br><span class="line">  (state) =&gt; (&#123; <span class="attr">count</span>: state.current, <span class="attr">users</span>: state.fetch &#125;),</span><br><span class="line">  &#123; increment, decrement, <span class="keyword">async</span>, suc &#125;</span><br><span class="line">)(App);</span><br></pre></td></tr></table></figure>
<p>2，store 内容：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">&quot;redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> reducers <span class="keyword">from</span> <span class="string">&quot;../reducers/index&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">&quot;redux-thunk&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducers, applyMiddleware(thunk));</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>
<p>3，reducers 内容：</p>
<ul>
<li>current 内容：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// reducer组件：用于定义状态更改的组件。其中state的值是只读的。</span></span><br><span class="line"><span class="keyword">import</span> &#123; INCREMENT, DECREMENT &#125; <span class="keyword">from</span> <span class="string">&quot;../action-types/action-types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initial = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">current</span>(<span class="params">state = initial, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> INCREMENT:</span><br><span class="line">      <span class="keyword">return</span> (state += action.data);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> DECREMENT:</span><br><span class="line">      <span class="keyword">return</span> (state -= action.data);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>fetch 内容：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; SUCCESS, ISFETCHING &#125; <span class="keyword">from</span> <span class="string">&quot;../action-types/action-types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initial = &#123;</span><br><span class="line">  user: &#123;</span><br><span class="line">    name: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    age: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    isfetch: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">fetch</span>(<span class="params">state = initial, action</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(&#123; ...state.user, ...action.data &#125;);</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> ISFETCHING:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state.user,</span><br><span class="line">        isfetch: <span class="literal">true</span>,</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> SUCCESS:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state.user,</span><br><span class="line">        ...action.data,</span><br><span class="line">        isfetch: <span class="literal">false</span>,</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>index 内容：</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">&quot;redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> current <span class="keyword">from</span> <span class="string">&quot;./reducers&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> fetch <span class="keyword">from</span> <span class="string">&quot;./fetch&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reducers = combineReducers(&#123;</span><br><span class="line">  current,</span><br><span class="line">  fetch,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> reducers;</span><br></pre></td></tr></table></figure>
<p>4，actions 内容：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  INCREMENT,</span><br><span class="line">  DECREMENT,</span><br><span class="line">  SUCCESS,</span><br><span class="line">  ISFETCHING,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;../action-types/action-types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> increment = <span class="function">(<span class="params">count</span>) =&gt;</span> (&#123; <span class="attr">type</span>: INCREMENT, <span class="attr">data</span>: count &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> decrement = <span class="function">(<span class="params">count</span>) =&gt;</span> (&#123; <span class="attr">type</span>: DECREMENT, <span class="attr">data</span>: count &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="keyword">async</span> = <span class="function">(<span class="params">count</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      dispatch(increment(count));</span><br><span class="line">    &#125;, <span class="number">500</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> success = <span class="function">(<span class="params">user</span>) =&gt;</span> (&#123; <span class="attr">type</span>: SUCCESS, <span class="attr">data</span>: user &#125;);</span><br><span class="line"><span class="keyword">const</span> isfetching = <span class="function">() =&gt;</span> (&#123; <span class="attr">type</span>: ISFETCHING &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> suc = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 该action会在等待请求返回数据的时候触发</span></span><br><span class="line">    dispatch(isfetching());</span><br><span class="line">    <span class="comment">// 发送fetch请求</span></span><br><span class="line">    fetch(<span class="string">&quot;http://localhost:3100/getuser&quot;</span>)</span><br><span class="line">      .then(<span class="function">(<span class="params">res</span>) =&gt;</span> res.json())</span><br><span class="line">      .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        dispatch(success(data));</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(error);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>5，action-types 内容：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> INCREMENT = <span class="string">&quot;INCREMENT&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> DECREMENT = <span class="string">&quot;DECREMENT&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SUCCESS = <span class="string">&quot;SUCCESS&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> DEFEATED = <span class="string">&quot;DEFEATED&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ISFETCHING = <span class="string">&quot;ISFETCHING&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ERROR = <span class="string">&quot;ERROR&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>6，入口文件 index 内容：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;./App&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;./redux/store/store&quot;</span>;</span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;App /&gt;</span><br><span class="line">  &lt;/Provider&gt;,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>前端框架</category>
        <category>react</category>
      </categories>
      <tags>
        <tag>react</tag>
      </tags>
  </entry>
  <entry>
    <title>Interview</title>
    <url>/2021/03/18/writtenTest/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="JS-概念相关"><a href="#JS-概念相关" class="headerlink" title="JS 概念相关"></a>JS 概念相关</h3><h4 id="js-数据类型"><a href="#js-数据类型" class="headerlink" title="js 数据类型"></a>js 数据类型</h4><p>1，基本数据类型：</p>
<ul>
<li>string、number、boolean、null、undefined、symbol。</li>
</ul>
<p>2，引用数据类型：</p>
<ul>
<li>object、array、function 等。</li>
</ul>
<h4 id="js-类型转换"><a href="#js-类型转换" class="headerlink" title="js 类型转换"></a>js 类型转换</h4><p>1，转换为字符串：使用 <strong>String()/toString()</strong> 方法，也可以使用引号或加法运算符进行隐式转换。</p>
<p>2，转换为数据类型：使用 <strong>Number()</strong> 方法，或 <strong>parseInt()/parseFloat()</strong> 方法。</p>
<a id="more"></a>

<ul>
<li><p>使用 Number() 方法对<strong>引用数据</strong>类型进行转换时，首先会将其<strong>转换为字符串类型</strong>，再将其转为数字类型，而在转换的过程中，只要字符串中出现了非数字字符，其转换结果就是 NaN。</p>
</li>
<li><p>使用 parseInt()/parseFloat() 方法进行转换时，也会先将其转换为字符串，然后从左往右依次寻找数字字符，遇到非数字字符就停止寻找，然后将找到的数据字符传为数字类型，如果一个都没找到，就会返回 NaN。</p>
</li>
</ul>
<p>3，将基本数据类型转为数字时：布尔值 true 为 1，false 为 0，null 为 0，undefined 为 NaN，空数组为 0，空对象为 NaN，symbol 不允许转换。</p>
<h4 id="数据类型判断"><a href="#数据类型判断" class="headerlink" title="数据类型判断"></a>数据类型判断</h4><h5 id="typeof"><a href="#typeof" class="headerlink" title="typeof"></a>typeof</h5><p>1，typeof 检测对象，除了函数是 function 类型之外。像常见的数组，对象或者是正则，日期等等都是 object。</p>
<p>2，typeof 检测对象的特殊场景如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typeof</span> <span class="built_in">Symbol</span>(); <span class="comment">// &#x27;symbol&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">null</span>; <span class="comment">// object</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">undefined</span>; <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>typeof null 检测输出 object 因为 js 最初版本，使用的是 32 位系统，类型的标签存储在每个单元的低位中 000 是 object 类型。null 全是 0，所以当我们使用 typeof 进行检测的时候 js 错误的判断位 object。</p>
</blockquote>
<h5 id="instanceof"><a href="#instanceof" class="headerlink" title="instanceof"></a>instanceof</h5><p>1，instanceof 主要用于对对象进行判断，可判断出左边是否是右边的实例。但它<strong>不能检测 null 和 undefined</strong>。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[] <span class="keyword">instanceof</span> <span class="built_in">Array</span>; <span class="comment">//true</span></span><br><span class="line">&#123;&#125; <span class="keyword">instanceof</span> <span class="built_in">Object</span>; <span class="comment">//true</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>() <span class="keyword">instanceof</span> <span class="built_in">Date</span>; <span class="comment">//true</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">RegExp</span>() <span class="keyword">instanceof</span> <span class="built_in">RegExp</span>; <span class="comment">//true</span></span><br><span class="line"><span class="literal">null</span> <span class="keyword">instanceof</span> Null; <span class="comment">//报错</span></span><br><span class="line"><span class="literal">undefined</span> <span class="keyword">instanceof</span> <span class="literal">undefined</span>; <span class="comment">//报错</span></span><br></pre></td></tr></table></figure>
<h5 id="Object-prototype-toString-call"><a href="#Object-prototype-toString-call" class="headerlink" title="Object.prototype.toString.call()"></a>Object.prototype.toString.call()</h5><p>1，该方法可精准判断所有类型。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Object</span>.prototype.toString.call(<span class="string">&quot;&quot;</span>); <span class="comment">// [object String]</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(<span class="number">1</span>); <span class="comment">// [object Number]</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(<span class="literal">true</span>); <span class="comment">// [object Boolean]</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(<span class="literal">undefined</span>); <span class="comment">// [object Undefined]</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(<span class="literal">null</span>); <span class="comment">// [object Null]</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(<span class="keyword">new</span> <span class="built_in">Function</span>()); <span class="comment">// [object Function]</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(<span class="keyword">new</span> <span class="built_in">Date</span>()); <span class="comment">// [object Date]</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call([]); <span class="comment">// [object Array]</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(<span class="keyword">new</span> <span class="built_in">RegExp</span>()); <span class="comment">// [object RegExp]</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(<span class="keyword">new</span> <span class="built_in">Error</span>()); <span class="comment">// [object Error]</span></span><br></pre></td></tr></table></figure>
<h4 id="发生类型转换的情况"><a href="#发生类型转换的情况" class="headerlink" title="发生类型转换的情况"></a>发生类型转换的情况</h4><p>1，使用加法运算符、== 运算符、逻辑运算符、if 条件判断等都会发生类型转换。</p>
<h4 id="箭头函数和普通函数的区别是什么"><a href="#箭头函数和普通函数的区别是什么" class="headerlink" title="箭头函数和普通函数的区别是什么"></a>箭头函数和普通函数的区别是什么</h4><p>1，普通函数 this：this 总是指向它的直接调用者。</p>
<ul>
<li><p>在默认情况下，没找到直接调用者，this 指的是 window。</p>
</li>
<li><p>在严格模式下，没有直接调用者的函数中的 this 是 undefined。</p>
</li>
<li><p>使用 call,apply,bind 绑定，this 指的是绑定的对象。</p>
</li>
</ul>
<p>2，箭头函数 this：在使用<code>=&gt;</code>定义函数的时候，this 的指向是<code>定义时所在的对象</code>，而不是使用时所在的对象。</p>
<ul>
<li><p>不能够用作构造函数，这就是说，不能够使用 new 命令，否则就会抛出一个错误。</p>
</li>
<li><p>不能够使用 arguments 对象。</p>
</li>
<li><p>不能使用 yield 命令。</p>
</li>
</ul>
<h4 id="let、var、const-的区别"><a href="#let、var、const-的区别" class="headerlink" title="let、var、const 的区别"></a>let、var、const 的区别</h4><p>1，var：var 没有块级作用域，支持变量提升。</p>
<p>2，let 有块级作用域，不支持变量提升。不允许重复声明，暂存性死区。不能通过 window.变量名进行访问。</p>
<p>3，const 有块级作用域，不支持变量提升，不允许重复声明，暂存性死区。声明一个变量一旦声明就不能改变，改变报错。</p>
<ul>
<li>如果声明的变量是一个数组或者对象，则可以改变其中的属性或属性值。</li>
</ul>
<h4 id="深度优先和广度优先"><a href="#深度优先和广度优先" class="headerlink" title="深度优先和广度优先"></a>深度优先和广度优先</h4><p>1，广度优先：尝试访问尽可能靠近它的目标节点，然后逐层向下遍历，直至最远的节点层级。</p>
<p>2，深度优先：从起始节点开始，一直向下找到最后一个节点，然后返回，又继续下一条路径。直到找遍所有的节点。</p>
<h4 id="setTimeout-与-setInterval-的区别"><a href="#setTimeout-与-setInterval-的区别" class="headerlink" title="setTimeout 与 setInterval 的区别"></a>setTimeout 与 setInterval 的区别</h4><p>1，setTimeout 表示间隔一段时间之后执行一次调用，而 setInterval 是每隔一段时间循环调用，直至清除。</p>
<p>2，内存方面，setTimeout 只需要进入一次宏队列，setInterval 不计算代码执行时间，有可能多次执行多次代码。</p>
<h4 id="原型、原型链"><a href="#原型、原型链" class="headerlink" title="原型、原型链"></a>原型、原型链</h4><h5 id="什么是原型"><a href="#什么是原型" class="headerlink" title="什么是原型"></a>什么是原型</h5><p>1，js 中每一个函数都自带的属性，它的值是一个对象，就好比(prototype:{……})，叫做原型对象。</p>
<p>2，对于构造函数来讲，每通过构造函数实例化一个对象,都有一个隐藏的属性，指向该构造函数的原型对象。他们两个是全等的关系，实例化对象.__proto__ === 构造函数.prototype。</p>
<p>3，原型对象就好像是一个公共区域，他可以被每一个实例化对象所访问(当然构造函数要相同，因为后面要往原型里添加方法，用别的构造函数实例化的对象的原型里是没有新增的方法的)。</p>
<p>4，在创建函数的时候，我们如果将方法写在原型对象中，不但不会造成全局变量的污染，还可以被每一个用这个构造函数实例化的对象所共享。</p>
<p>5，原型的作用：为实例化对象提供共享的属性和方法。</p>
<h5 id="怎么使用原型添加共享的属性和方法"><a href="#怎么使用原型添加共享的属性和方法" class="headerlink" title="怎么使用原型添加共享的属性和方法"></a>怎么使用原型添加共享的属性和方法</h5><p>1，我们一般用 Fn.prototype.FunName = function(){…}，的方法为这个构造函数添加方法，如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.sayHi = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;我是&quot;</span> + <span class="built_in">this</span>.name + <span class="string">&quot;今年&quot;</span> + <span class="built_in">this</span>.age + <span class="string">&quot;岁了&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> person01 = <span class="keyword">new</span> Person(<span class="string">&quot;大威天龙&quot;</span>, <span class="number">12</span>);</span><br><span class="line"><span class="comment">// console.log(person01.constructor.prototype.__proto__.__proto__)</span></span><br><span class="line"><span class="built_in">console</span>.log(person01.sayHi());</span><br></pre></td></tr></table></figure>
<h5 id="原型里常用的几个属性："><a href="#原型里常用的几个属性：" class="headerlink" title="原型里常用的几个属性："></a>原型里常用的几个属性：</h5><p>1，prototype 属性：</p>
<ul>
<li><p>js 中的每个函数都默认有一个 prototype 属性，随着函数的声明自动生成。</p>
</li>
<li><p>构造函数调用 prototype 可以得到构造函数的原型对象。</p>
</li>
<li><p>通过这个原型对象可以自定义共享属性供构造函数的实例化对象使用。</p>
</li>
</ul>
<p>2，constructor 属性：</p>
<ul>
<li><p>constructor 属性的作用：</p>
<ul>
<li><p>constructor 的作用是获取一个(实例化对象/构造函数)的构造函数。</p>
</li>
<li><p>构造函数的最上级是 Function，Function 的构造函数依旧是它本身。</p>
</li>
</ul>
</li>
</ul>
<p>3，instanceof 运算符：</p>
<ul>
<li><p>用于测试构造函数的 prototype(原型对象) 属性是否出现在原型链中的任何位置。</p>
</li>
<li><p>这个方法可以用来判断一个数据是否是对象也可以判断一个数据是否是数组。</p>
</li>
<li><p>语法：实例化对象 instanceof Object/Array 返回布尔值。</p>
</li>
</ul>
<p>4，hasOwnProperty()方法：</p>
<ul>
<li><p>每一个实例化对象都有一个 hasOwnProperty() 方法，用来判断某个属性到底是本地属性还是来自原型的属性。</p>
</li>
<li><p>通过构造函数添加的属性或方法叫做本地属性或方法。</p>
</li>
<li><p>语法: 实例化对象.hasOwnProperty()，参数是字符串类型，返回布尔值。</p>
</li>
</ul>
<blockquote>
<p>in 运算符用来判断某个实例是否含有某个属性，不管是不是本地属性。语法：<code>&#39;属性&#39; in 实例化对象</code>返回布尔值。</p>
</blockquote>
<h5 id="什么是原型链"><a href="#什么是原型链" class="headerlink" title="什么是原型链"></a>什么是原型链</h5><p>1，每一个对象都有原型对象。一个原型对象也是对象，所以它也有原型对象。</p>
<p>2，当一个对象去调用某个属性或者方法的时候，先从自身开始查找，如果有则使用；如果没有则到对象的原型中去查找。如果有则使用；如果原型中也没有，则会到原型的原型中去查找，这样就形成了一条链，叫做原型链。原型链的终点是 Object 的原型，如果该对象中依然没有找到，则返回 undefined。</p>
<p><img src="/2021/03/18/writtenTest/prototype.png" alt="原型链结构图"></p>
<h4 id="JS-作用域"><a href="#JS-作用域" class="headerlink" title="JS 作用域"></a>JS 作用域</h4><h5 id="全局作用域"><a href="#全局作用域" class="headerlink" title="全局作用域"></a>全局作用域</h5><p>1，全局作用域在页面打开时被创建，页面关闭时被销毁。</p>
<p>2，编写在 script 标签中的变量和函数，作用域为全局，在页面的任意位置都可以访问到。</p>
<p>3，在全局作用域中有全局对象 window，代表一个浏览器窗口，由浏览器创建，可以直接调用。</p>
<p>4，全局作用域中声明的变量和函数会作为 window 对象的属性和方法。</p>
<p>5，作用域的作用就是<strong>隔离变量</strong>，是不同作用域中的同名变量不会产生冲突。</p>
<h5 id="函数作用域"><a href="#函数作用域" class="headerlink" title="函数作用域"></a>函数作用域</h5><p>1，函数作用域在函数定义时就已创建。</p>
<p>2，每调用一次函数就会创建一个新的函数作用域，他们之间是相互独立的。</p>
<p>3，在函数作用域中可以访问到全局作用域的变量，在函数外无法访问到函数作用域内的变量。</p>
<p>4，在函数作用域中访问变量，函数时，会先在自身作用域中寻找，若没有找到，则会到函数的上一级作用域中寻找，一直到全局作用域。</p>
<h4 id="作用域深层理解"><a href="#作用域深层理解" class="headerlink" title="作用域深层理解"></a>作用域深层理解</h4><h5 id="执行期的上下文"><a href="#执行期的上下文" class="headerlink" title="执行期的上下文"></a>执行期的上下文</h5><p>1，当函数代码执行的前期，会创建一个执行期上下文的内部对象 AO（作用域）。</p>
<p>2，这个内部的对象是预编译时候创建出来的，因为当函数被调用的时候，会先进行预编译。</p>
<p>3，在全局代码执行的前期，会创建一个执行期的上下文对象 GO。</p>
<h5 id="函数作用域预编译"><a href="#函数作用域预编译" class="headerlink" title="函数作用域预编译"></a>函数作用域预编译</h5><p>1，创建 AO 对象 AO{}。</p>
<p>2，找形参和变量声明，将变量和形参名当作 AO 对象的属性名，且值为 undefined。</p>
<p>3，形参和实参相统一，形参被赋值为实参。</p>
<p>4，在函数体里面找函数声明，值赋予函数体（即同名的变量声明会被同名的函数声明覆盖）。</p>
<h5 id="作用域与执行上下文区别"><a href="#作用域与执行上下文区别" class="headerlink" title="作用域与执行上下文区别"></a>作用域与执行上下文区别</h5><p>1，它们最大的区别就是：执行上下文在运行时确定，随时可能改变，但作用域在定义时就确定，并且不会改变。</p>
<ul>
<li>面试题示例如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">a, c</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a); <span class="comment">// f a()&#123;&#125;</span></span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">123</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(a); <span class="comment">// 123</span></span><br><span class="line">  <span class="built_in">console</span>.log(c); <span class="comment">// f c()&#123;&#125;</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> d = <span class="number">678</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(d); <span class="comment">// undefined</span></span><br><span class="line">  <span class="built_in">console</span>.log(b); <span class="comment">// undefined</span></span><br><span class="line">  <span class="keyword">var</span> b = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">  <span class="built_in">console</span>.log(b); <span class="comment">// f()&#123;&#125;</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>) </span>&#123;&#125; <span class="comment">// f c()&#123;&#125;</span></span><br><span class="line">  <span class="built_in">console</span>.log(c);</span><br><span class="line">&#125;</span><br><span class="line">fn(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解题过程如下：</span></span><br><span class="line"><span class="comment">// AO &#123;</span></span><br><span class="line"><span class="comment">//   a: undefined =&gt; 1 =&gt; function a()&#123;&#125;</span></span><br><span class="line"><span class="comment">//   b: undefined =&gt; 2 =&gt; function c()&#123;&#125;</span></span><br><span class="line"><span class="comment">//   d: undefined</span></span><br><span class="line"><span class="comment">//   b: undefined</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<h5 id="全局作用域预编译"><a href="#全局作用域预编译" class="headerlink" title="全局作用域预编译"></a>全局作用域预编译</h5><p>1，创建 GO 对象。</p>
<p>2，找变量声明，将变量名作为 GO 对象的属性名，值为 undefined。</p>
<p>3，找函数声明，值赋予函数体（即同名的变量声明会被同名的函数声明覆盖）。</p>
<h4 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h4><p>1，什么是闭包？</p>
<ul>
<li>闭包就是有权访问一个函数内部变量的函数，也就是常说的函数内部嵌套函数，内部函数访问外部函数变量，从而导致垃圾回收机制没有将当前变量回收掉。这样的操作，有可能会带来内存泄漏。好处就是可以设计私有的方法和变量。</li>
</ul>
<p>2，闭包形成的条件：</p>
<ul>
<li><p>函数嵌套。</p>
</li>
<li><p>内部函数引用外部函数的局部变量。</p>
</li>
</ul>
<h4 id="垃圾回收机制（闭包的延伸）"><a href="#垃圾回收机制（闭包的延伸）" class="headerlink" title="垃圾回收机制（闭包的延伸）"></a>垃圾回收机制（闭包的延伸）</h4><p>1，js 拥有特殊的垃圾回收机制，当一个变量在内存中失去引用，js 会通过特殊的算法将其回收，并释放内存。分为以下两个阶段：</p>
<ul>
<li><p>标记阶段：垃圾回收器，从根对象开始遍历，访问到的每一个对象都会被标示为可到达对象。</p>
</li>
<li><p>清除阶段：垃圾回收器在对内存当中进行线性遍历，如果发现该对象没有被标记为可到达对象，那么就会被垃圾回收机制回收。这里面牵扯到了引用计数法，每次引用都被会<code>+1</code> 如果标记清零，那么就会被回收掉。</p>
</li>
</ul>
<h4 id="Set-和-Map-的区别"><a href="#Set-和-Map-的区别" class="headerlink" title="Set 和 Map 的区别"></a>Set 和 Map 的区别</h4><p>1，Set 是类似数字的数据结构，其中值都是唯一的，可以用来对数组进行去重。使用 new Set() 进行创建。</p>
<ul>
<li><p>Set 包含的方法：</p>
<ul>
<li><p>add()：用于添加值。</p>
</li>
<li><p>delete()：用于删除值。</p>
</li>
<li><p>has()：用于检查受否存在该值。</p>
</li>
<li><p>clear()：用来清除所有成员。</p>
</li>
</ul>
</li>
</ul>
<p>2，Map 是类似对象的数据结构，成员键是任意类型的值，使用 new Map() 进行声明。</p>
<ul>
<li><p>Map 包含的方法：</p>
<ul>
<li><p>get()：用于返回键值对。</p>
</li>
<li><p>set()：用于添加键值对。</p>
</li>
<li><p>delete()：用于删除键值对，返回布尔值。</p>
</li>
<li><p>has()：用于检查键值对，返回布尔值。</p>
</li>
<li><p>clear()：用于清除所有成员。</p>
</li>
</ul>
</li>
</ul>
<h4 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h4><p>1，Promise 是用于解决异步编程的一种法案。</p>
<p>2，Promise 有三种状态：pending、resolved、rejected，而状态一旦变更就不能逆转。</p>
<ul>
<li><p>其中成功的时候会调用 resolved，失败则是调用 rejected，都会返回一个新的 Promise，可以通过 .then() 中获取到成功或者失败的结果，或者也可以使用 <strong>.catch()</strong> 捕获异常的结果。</p>
</li>
<li><p>当要同时执行多个异步操作的时候，且需要这多个异步操作同时成功的情况下再进行下一步操作的时候就可以用 <strong>Promise.all()</strong> 方法将这些异步操作同时执行。如果都成功了，就会以数组的形式返回结果，但只要其中有一个失败了就会返回失败的结果。</p>
</li>
<li><p>当有多个任务同时执行，需要获取最先执行完毕的任务时，就可以使用 <strong>Promise.race()</strong> 方法获取，该方法只获取最先执行完成的任务，不管是成功还是失败的任务，只关注最先返回结果的任务。</p>
</li>
</ul>
<p>3，Promise 的优点：支持链式调用，能够解决回调地狱的问题。</p>
<p>4，Promise 的缺点：</p>
<ul>
<li><p>一旦创建就会立即执行，无法中途取消。</p>
</li>
<li><p>如果不设置回调函数，Promise 内部抛出的错误，不会反应到外部。</p>
</li>
<li><p>当处于 pending 状态时，无法得知目前进展到哪一阶段。</p>
</li>
</ul>
<h3 id="DOM-相关"><a href="#DOM-相关" class="headerlink" title="DOM 相关"></a>DOM 相关</h3><h4 id="css-的重绘与回流"><a href="#css-的重绘与回流" class="headerlink" title="css 的重绘与回流"></a>css 的重绘与回流</h4><p>1，重绘：当节点需要更改外观而不会影响布局。</p>
<ul>
<li>如更改背景颜色，字体颜色等。</li>
</ul>
<p>2，DOM 结构的修改引发 DOM 几何尺寸变化的时候，发生回流。</p>
<ul>
<li>常见的几何属性有 width、height、padding、margin、left、top、border 或者是 DOM 节点发生增减移动。</li>
</ul>
<p>3，减少重绘和回流的办法：</p>
<ul>
<li><p>使用 css3 新增属性：translate 替代 top 等方向值。</p>
</li>
<li><p>避免频繁使用 style，而是采用 class。</p>
</li>
</ul>
<h4 id="innerHTML-与-innerText-的区别"><a href="#innerHTML-与-innerText-的区别" class="headerlink" title="innerHTML 与 innerText 的区别"></a>innerHTML 与 innerText 的区别</h4><p>1，innerHTML 会获取到 html 标签、空格和换行，而 innerText 只会获取文本内容，不包括空格和换行。</p>
<h4 id="DOM-事件流"><a href="#DOM-事件流" class="headerlink" title="DOM 事件流"></a>DOM 事件流</h4><p>1，DOM 事件流包括：捕获阶段、目标阶段、冒泡阶段。</p>
<ul>
<li><p>事件冒泡是从最具体的元素逐级向上传播的过程。事件委托就是利用冒泡的原理，将事件绑定在父节点上，通过冒泡原理，使子节点也能触发该事件。</p>
<ul>
<li>事件委托可以减少对 DOM 的操作，提高程序性能，无需对每个元素都单独绑定一次事件。</li>
</ul>
</li>
<li><p>事件捕获是从最顶层元素逐级向下传播的过程。</p>
</li>
</ul>
<h4 id="mouseover-与-mouseenter-的区别"><a href="#mouseover-与-mouseenter-的区别" class="headerlink" title="mouseover 与 mouseenter 的区别"></a>mouseover 与 mouseenter 的区别</h4><p>1，mouseover 在鼠标移入元素或者其子元素中时都会触发，会重复触发冒泡的过程。对应的移出事件为 mouseout。</p>
<p>2，mouseenter 只有当鼠标移到元素本身上时才会触发，移动到其子元素上并不会触发。不会有冒泡的过程。对应的移出事件为 mouseleave。</p>
<h3 id="CSS-相关"><a href="#CSS-相关" class="headerlink" title="CSS 相关"></a>CSS 相关</h3><h4 id="css-盒子模型"><a href="#css-盒子模型" class="headerlink" title="css 盒子模型"></a>css 盒子模型</h4><p>1，盒子模型分为 <strong>IE 盒模型</strong>和<strong>标准盒模型</strong>。</p>
<ul>
<li><p>标准盒模型内容区大小不包括 border 和 panding，而 IE 盒模型则包括 border 和 padding。</p>
</li>
<li><p>可以使用 box-sizzing 将标准和模型转换为 IE 盒模型。</p>
</li>
</ul>
<h4 id="响应式布局"><a href="#响应式布局" class="headerlink" title="响应式布局"></a>响应式布局</h4><p>1，响应式布局可以使用 @media 媒体查询，rem 适配，vm/vh，或者 flex 布局。</p>
<h4 id="mate-标签解决移动端适配"><a href="#mate-标签解决移动端适配" class="headerlink" title="mate 标签解决移动端适配"></a>mate 标签解决移动端适配</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;meta name&#x3D;”viewport” content&#x3D;”initial-scale&#x3D;1, maximum-scale&#x3D;3, minimum-scale&#x3D;1, user-scalable&#x3D;no”&gt;</span><br></pre></td></tr></table></figure>
<h4 id="元素垂直居中的方法"><a href="#元素垂直居中的方法" class="headerlink" title="元素垂直居中的方法"></a>元素垂直居中的方法</h4><p>1，知道宽高的情况下使用：absolute + margin、absolute + calc。</p>
<p>2，不知道宽高的情况下使用：flex、absolute + transform(translate: -50%, -50%)、网格布局。</p>
<h4 id="opacity、display、visibility-的区别"><a href="#opacity、display、visibility-的区别" class="headerlink" title="opacity、display、visibility 的区别"></a>opacity、display、visibility 的区别</h4><p>1，display: none 会让元素完全从渲染树中消失，不占据任何空间，不能触发绑定的事件。</p>
<p>2，opacity: 0 不会让元素从渲染树中消失，会占据空间，只是内容不可见，能触发绑定的事件。</p>
<p>3，visibility: hidden 不会从渲染树消失，也会占据空间，但是不会触发绑定的事件。</p>
<h3 id="浏览器及-http-相关"><a href="#浏览器及-http-相关" class="headerlink" title="浏览器及 http 相关"></a>浏览器及 http 相关</h3><h4 id="get-和-post-的区别"><a href="#get-和-post-的区别" class="headerlink" title="get 和 post 的区别"></a>get 和 post 的区别</h4><p>1，get 和 post 最主要的区别就在于携带参数的位置不同，get 是将参数放在 url 中，而 post 则是将参数放在 body 中。</p>
<p>2，get 发送请求时，只会发送一个包，而 post 是发送两个包，第一个包会先发送 herder，用于确认服务器是否有处理能力，当服务器返回 100 后，再发送 data 数据。</p>
<h4 id="cookie、localstorage、seesionstorage"><a href="#cookie、localstorage、seesionstorage" class="headerlink" title="cookie、localstorage、seesionstorage"></a>cookie、localstorage、seesionstorage</h4><p>1，cookie：存储大小为 4kb 左右，每次都会携带在 HTTP 头中，如果使用 cookie 保存过多数据会带来性能问题，默认是关闭浏览器后失效，但是也可以设置过期时间。</p>
<p>2，localstorage：存储大小为 5M，仅在浏览器中保存，不参与和服务器的通信，除非手动被清除，否则永久保存。</p>
<p>3，seesionstorage：存储大小 5M，仅在浏览器中保存，不参与和服务器的通信，仅在当前会话(窗口)下有效，关闭窗口或浏览器后被清除，不能设置过期时间。</p>
<h4 id="浏览器禁用-cookie-该如何处理"><a href="#浏览器禁用-cookie-该如何处理" class="headerlink" title="浏览器禁用 cookie 该如何处理"></a>浏览器禁用 cookie 该如何处理</h4><p>1，一般会用到 url 重写的技术来进行会话跟踪，每一次的交互，都会在 url 后面加上 sid=xxx 类似的参数。服务端根据这种方式来识别用户。</p>
<h4 id="进程与线程"><a href="#进程与线程" class="headerlink" title="进程与线程"></a>进程与线程</h4><h5 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h5><p>1，进程：进程是 CPU 资源分配的最小单位，进程包括运行中的程序和程序所使用到的内存和系统资源。</p>
<p>2，CPU 可以有很多进程，我们的电脑每打开一个软件就会产生一个或多个进程，为什么电脑运行的软件多就会卡，是因为 CPU 给每个进程分配资源空间，但是一个 CPU 一共就那么多资源，分出去越多，越卡，每个进程之间是相互独立的，CPU 在运行一个进程时，其他的进程处于非运行状态，CPU 使用<strong>时间片轮转调度算法</strong>（想深入了解可自行百度，这里不做赘述）来实现同时运行多个进程。</p>
<h5 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h5><p>1，线程是 CPU 调度的最小单位。</p>
<p>2，线程是建立在进程的基础上的一次程序运行单位，通俗点解释线程就是程序中的一个执行流，一个进程可以有多个线程。</p>
<p>3，一个进程中只有一个执行流称作单线程，即程序执行时，所走的程序路径按照连续顺序排下来，前面的必须处理好，后面的才会执行。</p>
<p>4，一个进程中有多个执行流称作多线程，即在一个程序中可以同时运行多个不同的线程来执行不同的任务，也就是说允许单个程序创建多个并行执行的线程来完成各自的任务。</p>
<h5 id="进程和线程的区别"><a href="#进程和线程的区别" class="headerlink" title="进程和线程的区别"></a>进程和线程的区别</h5><p>1，进程是操作系统分配资源的最小单位，线程是程序执行的最小单位。</p>
<p>2，一个进程由一个或多个线程组成，线程可以理解为是一个进程中代码的不同执行路线。</p>
<p>3，进程之间相互独立，但同一进程下的各个线程间共享程序的内存空间(包括代码段、数据集、堆等)及一些进程级的资源(如打开文件和信号)。</p>
<p>4，调度和切换：线程上下文切换比进程上下文切换要快得多。</p>
<h5 id="多进程和多线程"><a href="#多进程和多线程" class="headerlink" title="多进程和多线程"></a>多进程和多线程</h5><p>1，多进程指的是在同一个时间里，同一个计算机系统中允许存在两个或两个以上的进程处于运行状态。多进程带来的好处是明显的，比如大家可以在网易云听歌的同时打开编辑器敲代码，编辑器和网易云的进程之间不会相互干扰。</p>
<p>2，多线程是指程序中包含多个执行流，即在一个程序中可以同时运行多个不同的线程来执行不同的任务，也就是说允许单个程序创建多个并行执行的线程来完成各自的任务。</p>
<h5 id="浏览器包含的进程"><a href="#浏览器包含的进程" class="headerlink" title="浏览器包含的进程"></a>浏览器包含的进程</h5><p>1，Browser 进程：</p>
<ul>
<li><p>浏览器的主进程（负责协调、主控），该进程只有一个。</p>
</li>
<li><p>负责浏览器界面显示，与用户交互。如前进，后退等。</p>
</li>
<li><p>负责各个页面的管理，创建和销毁其他进程。</p>
</li>
<li><p>将渲染（Renderer）进程得到的内存中的 Bitmap（位图），绘制到用户界面上。</p>
</li>
<li><p>网络资源的管理，下载等。</p>
</li>
</ul>
<p>2，第三方插件进程：</p>
<ul>
<li>每种类型的插件对应一个进程，当使用该插件时才创建。</li>
</ul>
<p>3，GPU 进程：</p>
<ul>
<li>该进程也只有一个，用于 3D 绘制等等。</li>
</ul>
<p>4，渲染进程：</p>
<ul>
<li><p>即通常所说的浏览器内核（Renderer 进程，内部是多线程）。</p>
</li>
<li><p>每个 Tab 页面都有一个渲染进程，互不影响。</p>
</li>
<li><p>主要作用为页面渲染，脚本执行，事件处理等。</p>
</li>
<li><p>页面的渲染，JS 的执行，事件的循环，都在渲染进程内执行。</p>
</li>
</ul>
<h5 id="为什么浏览器要多进程"><a href="#为什么浏览器要多进程" class="headerlink" title="为什么浏览器要多进程"></a>为什么浏览器要多进程</h5><p>1，假设浏览器是单进程，那么某个 Tab 页崩溃了，就影响了整个浏览器，体验极差。同理如果插件崩溃了也会影响整个浏览器。</p>
<h5 id="渲染进程-Renderer-的主要线程"><a href="#渲染进程-Renderer-的主要线程" class="headerlink" title="渲染进程 Renderer 的主要线程"></a>渲染进程 Renderer 的主要线程</h5><p>1，GUI 渲染线程：</p>
<ul>
<li><p>负责渲染浏览器界面，解析 HTML，CSS，构建 DOM 树和 RenderObject 树，布局和绘制等。</p>
<ul>
<li><p>解析 html 代码(HTML 代码本质是字符串)转化为浏览器认识的节点，生成 DOM 树，也就是 DOM Tree。</p>
</li>
<li><p>解析 css，生成 CSSOM(CSS 规则树)。</p>
</li>
<li><p>把 DOM Tree 和 CSSOM 结合，生成 Rendering Tree(渲染树)。</p>
</li>
</ul>
</li>
<li><p>当我们修改了一些元素的颜色或者背景色，页面就会重绘(Repaint)。</p>
</li>
<li><p>当我们修改元素的尺寸，页面就会回流(Reflow)。</p>
</li>
<li><p>当页面需要 Repaing 和 Reflow 时 GUI 线程执行，绘制页面。</p>
</li>
<li><p>回流(Reflow)比重绘(Repaint)的成本要高，我们要尽量避免 Reflow 和 Repaint。</p>
</li>
<li><p>GUI 渲染线程与 JS 引擎线程是互斥的：</p>
<ul>
<li><p>当 JS 引擎执行时 GUI 线程会被挂起(相当于被冻结了)。</p>
</li>
<li><p>GUI 更新会被保存在一个队列中等到 JS 引擎空闲时立即被执行。</p>
</li>
</ul>
</li>
</ul>
<p>2，JS 引擎线程：</p>
<ul>
<li><p>JS 引擎线程就是 JS 内核，负责处理 Javascript 脚本程序(例如 V8 引擎)。</p>
</li>
<li><p>JS 引擎线程负责解析 Javascript 脚本，运行代码。</p>
</li>
<li><p>JS 引擎一直等待着任务队列中任务的到来，然后加以处理：</p>
<ul>
<li><p>浏览器同时只能有一个 JS 引擎线程在运行 JS 程序，所以 JS 是单线程运行的。</p>
</li>
<li><p>一个 Tab 页(renderer 进程)中无论什么时候都只有一个 JS 线程在运行 JS 程序。</p>
</li>
</ul>
</li>
<li><p>GUI 渲染线程与 JS 引擎线程是互斥的，JS 引擎线程会阻塞 GUI 渲染线程：</p>
<ul>
<li><p>就是我们常遇到的 JS 执行时间过长，造成页面的渲染不连贯，导致页面渲染加载阻塞(就是加载慢)。</p>
</li>
<li><p>例如浏览器渲染的时候遇到 script 标签，就会停止 GUI 的渲染，然后 JS 引擎线程开始工作，执行里面的 JS 代码，等 JS 执行完毕，JS 引擎线程停止工作，GUI 继续渲染下面的内容。所以如果 JS 执行时间太长就会造成页面卡顿的情况。</p>
</li>
</ul>
</li>
</ul>
<p>3，事件触发线程：</p>
<ul>
<li><p>属于浏览器而不是 JS 引擎，用来控制事件循环，并且管理着一个事件队列(task queue)。</p>
</li>
<li><p>当 JS 执行碰到事件绑定和一些异步操作(如 setTimeout，也可来自浏览器内核的其他线程，如鼠标点击、AJAX 异步请求等)，会走事件触发线程将对应的事件添加到对应的线程中(比如定时器操作，便把定时器事件添加到定时器线程)，等异步事件有了结果，便把他们的回调操作添加到事件队列，等待 JS 引擎线程空闲时来处理。</p>
</li>
<li><p>当对应的事件符合触发条件被触发时，该线程会把事件添加到待处理队列的队尾，等待 JS 引擎的处理。</p>
</li>
<li><p>因为 JS 是单线程，所以这些待处理队列中的事件都得排队等待 JS 引擎处理。</p>
</li>
</ul>
<p>4，定时触发器线程：</p>
<ul>
<li><p>setInterval 与 setTimeout 所在线程。</p>
</li>
<li><p>浏览器定时计数器并不是由 JavaScript 引擎计数的(因为 JavaScript 引擎是单线程的，如果处于阻塞线程状态就会影响记计时的准确)。</p>
</li>
<li><p>通过单独线程来计时并触发定时(计时完毕后，添加到事件触发线程的事件队列中，等待 JS 引擎空闲后执行)，这个线程就是定时触发器线程，也叫定时器线程。</p>
</li>
<li><p>W3C 在 HTML 标准中规定，规定要求 setTimeout 中低于 4ms 的时间间隔算为 4ms。</p>
</li>
</ul>
<p>5，异步 http 请求线程：</p>
<ul>
<li><p>在 XMLHttpRequest 在连接后是通过浏览器新开一个线程请求。</p>
</li>
<li><p>将检测到状态变更时，如果设置有回调函数，异步线程就产生状态变更事件，将这个回调再放入事件队列中再由 JavaScript 引擎执行。</p>
</li>
<li><p>简单说就是当执行到一个 http 异步请求时，就把异步请求事件添加到异步请求线程，等收到响应(准确来说应该是 http 状态变化)，再把回调函数添加到事件队列，等待 JS 引擎线程来执行。</p>
</li>
</ul>
<h4 id="从输入-url-到页面展示的过程"><a href="#从输入-url-到页面展示的过程" class="headerlink" title="从输入 url 到页面展示的过程"></a>从输入 url 到页面展示的过程</h4><p>1，首先需要经过 DNS 解析，获取到 IP 地址，之后经过 TCP 三次握手建立连接之后发送请求，然后服务器响应请求返回请求的文件，得到文件后，浏览器就开始渲染页面，其中遇到 html 标签就调用 html 引擎解析成 DOM 树，遇到 css 就调用 css 引擎解析成样式树，遇到 js 代码就调用 js 引擎解析 js 代码。之后将 DOM 树和样式树进行合并形成一个渲染树，之后根据渲染树来计算出各元素在页面中的布局，然后给各个节点绘制颜色，最后断开 TCP 链接。</p>
<h4 id="同源策略"><a href="#同源策略" class="headerlink" title="同源策略"></a>同源策略</h4><p>1，协议、域名、端口号相同的即为同源，如果这三个任何一个不一样就是非同源，访问非同源时就会出现跨域的情况。</p>
<h4 id="如何解决跨域问题"><a href="#如何解决跨域问题" class="headerlink" title="如何解决跨域问题"></a>如何解决跨域问题</h4><p>1，使用 jsonp 实现跨域，原理为：</p>
<ul>
<li>借用 script 标签没有跨域限制的漏洞实现的一种跨域方法，只支持 get 请求。安全问题会受到威胁。</li>
</ul>
<p>2，使用 CORS 实现跨域，原理为：</p>
<ul>
<li>通过后端服务器实现，Access-Control-Allow-Origin。</li>
</ul>
<p>3，使用 postMessage 实现跨域，postMessage 是 window 的一个属性方法。</p>
<p>4，使用 websocket 实现跨域。</p>
<p>5，使用 nginx 反向代理实现跨域。</p>
<p>6，使用 iframe 实现跨域。</p>
<p>7，使用 webpack proxy 实现跨域，原理为：</p>
<ul>
<li>webpack proxy 配置在 webpack 的 devServer 属性中。在 webpack 中的 devServer 配置后，打包阶段在本地临时生成了一个 node 服务器，浏览器请求服务器相当于请求本地服务。</li>
</ul>
<blockquote>
<p>注意：webpack proxy 跨域只能用作与开发阶段，临时解决本地请求服务器产生的跨域问题，并不适合线上环境。</p>
</blockquote>
<h4 id="http-与-https"><a href="#http-与-https" class="headerlink" title="http 与 https"></a>http 与 https</h4><p>1，http 为超文本传输协议，采用请求响应的模式，用于服务器与浏览器之间传输数据。</p>
<p>2，http 是无状态的，而且信息是明文传输的。</p>
<ul>
<li>解决明文传输可以使用 https，https 协议是由 http 和 ssl 协议构建的可进行机密传输和身份认证的网络协议。https 需要有证书，且需要进行加解密。</li>
</ul>
<p>3，http 的缺陷：</p>
<ul>
<li><p>无法复用链接，完成即断开，重新启动慢，存在对头阻塞的情况，会导致请求之间相互影响。</p>
</li>
<li><p>在 http 1.1 之后支持长连接，但需要使用 keep-alive 开启。</p>
</li>
</ul>
<p>3，http 2.0 的特点：</p>
<ul>
<li>http 2.0 相比之前的版本，它提升了访问速度，允许多路复用，就是同时发送多个请求及响应信息、支持二进制分帧（将所有传输信息分割为更小的信息或者帧，然后对它们进行二进制编码）、首部压缩、还能支持服务端推送。</li>
</ul>
<h4 id="http-状态码"><a href="#http-状态码" class="headerlink" title="http 状态码"></a>http 状态码</h4><p>1，200 系列表示请求成功。 其中 202 表示请求已被接收但还未处理，206 表示请求接受了，但还没处理完成。</p>
<p>2，300 系列表示重定向。其中 301 表示永久重定向，302 表示临时重定向。</p>
<p>3，400 系列表示客户端错误，其中 400 表示语义错误或者参数错误，401 表示请求需要用户验证，403 表示拒绝访问，404 表示访问的网页不存在。</p>
<p>5，500 系列则是表示服务端错误。</p>
<h4 id="XSS-攻击"><a href="#XSS-攻击" class="headerlink" title="XSS 攻击"></a>XSS 攻击</h4><p>1，XSS 称为跨站脚本攻击，攻击者通过注入非法的 html 标签或者 js 代码实现。</p>
<p>2，XSS 主要分为三类：反射型 XSS、存储型 XSS 和 DOMXSS。</p>
<ul>
<li><p>反射型又称为非持久型 XSS，其原理就是当用户将带有 XSS 攻击的非法代码发送到服务端后，经过服务端解析返回这段 XSS 代码，最后通过浏览器解析执行后就会造成 XSS 攻击。</p>
</li>
<li><p>存储型 XSS 又称为持久型 XSS 攻击，它将非法代码直接存储到服务器，这种方式相比反射型危害更大，也更隐蔽。</p>
</li>
<li><p>DOMXSS 是直接通过 DOM 解析然后达到 XSS 攻击的目的。</p>
</li>
</ul>
<p>3，XSS 的危害是：会对用户的信息造成危害，还能发送恶意的请求。</p>
<p>4，防御 XSS 的方式首先是对用户输入的<strong>内容进行验证</strong>，然后对一些特殊的<strong>标签进行转换</strong>。</p>
<h4 id="CSRF-攻击"><a href="#CSRF-攻击" class="headerlink" title="CSRF 攻击"></a>CSRF 攻击</h4><p>1，CSRF 攻击称为跨站请求伪造，就是冒充用户且在用户不知情的情况下发起请求，然后做一些违背用户医院的事情，比如：修改用户信息等。</p>
<ul>
<li>跨站脚本攻击通俗的来讲，就像有一个小偷去别人家偷东西，被这家的小孩看见了，这个小孩就问小偷，你是谁叫什么名字，小偷就说我叫逗你玩，然后小孩就对她妈妈说：有人在偷我们家东西，他妈妈就问谁啊，小孩就说是逗你玩，然后小偷就顺利的偷走了东西还没被抓住。</li>
</ul>
<p>2，CSRF 的危害主要有：利用以通过认证的用户权限更新设定信息，购买商品，或者进行恶意评论等等。</p>
<p>3，防止 CSRF 攻击可以通过<strong>验证码技术</strong>、<strong>请求来源限制</strong>、而最稳妥的还是使用 <strong>token</strong> 进行验证。</p>
<ul>
<li>token 的原理就是在后端随机生成一个 token，并且把这个 token 保存到 session 中，同时把这个 token 发送到前端页面，之后浏览器提交请求时，把 token 加入到请求头中传输到服务器，服务器验证前端传来的 token 是否与 session 中的一致，如果一致就说明时合法的，否则就是不合法。</li>
</ul>
<h4 id="SQL-注入"><a href="#SQL-注入" class="headerlink" title="SQL 注入"></a>SQL 注入</h4><p>1，SQL 注入就是在 url 中输入带有逻辑判断的代码，使用户的密码失效，从而达到攻击的目的。</p>
<h3 id="JS-笔试相关"><a href="#JS-笔试相关" class="headerlink" title="JS 笔试相关"></a>JS 笔试相关</h3><h4 id="如何实现一个-new-的伪代码"><a href="#如何实现一个-new-的伪代码" class="headerlink" title="如何实现一个 new 的伪代码"></a>如何实现一个 new 的伪代码</h4><p>1，创建一个新的对象。</p>
<p>2，把 obj 的 <code>__proto__</code> 指向 fn 的 <code>prototype</code>，实现继承。</p>
<p>3，改变 this 的指向，执行构造函数、传递参数，fn.apply() 或者 fn.call()。</p>
<p>4，返回新的对象 obj。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dog</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.say = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;name = &quot;</span> + <span class="built_in">this</span>.name);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Cat</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.say = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;name = &quot;</span> + <span class="built_in">this</span>.name);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_new</span>(<span class="params">fn, ...arg</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> obj = &#123;&#125;; <span class="comment">//创建一个新的对象</span></span><br><span class="line">  obj.__proto__ = fn.prototype; <span class="comment">//把obj的__proto__指向fn的prototype,实现继承</span></span><br><span class="line">  fn.apply(obj, arg); <span class="comment">//改变this的指向</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">&quot;[object Object]&quot;</span> ? obj : &#123;&#125;; <span class="comment">//返回新的对象obj</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试1</span></span><br><span class="line"><span class="keyword">var</span> dog = _new(Dog, <span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">dog.say(); <span class="comment">//&#x27;name = aaa&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(dog <span class="keyword">instanceof</span> Dog); <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(dog <span class="keyword">instanceof</span> Cat); <span class="comment">//false</span></span><br><span class="line"><span class="comment">//测试2</span></span><br><span class="line"><span class="keyword">var</span> cat = _new(Cat, <span class="string">&quot;bbb&quot;</span>);</span><br><span class="line">cat.say(); <span class="comment">//&#x27;name = bbb&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(cat <span class="keyword">instanceof</span> Cat); <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(cat <span class="keyword">instanceof</span> Dog); <span class="comment">//false</span></span><br></pre></td></tr></table></figure>
<h4 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h4><h5 id="继承的原理"><a href="#继承的原理" class="headerlink" title="继承的原理"></a>继承的原理</h5><p>1，复制父类的属性和方法来重写子类的原型对象。</p>
<h5 id="继承的分类"><a href="#继承的分类" class="headerlink" title="继承的分类"></a>继承的分类</h5><p>1，原型链继承：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">  <span class="built_in">this</span>.hobby = [<span class="string">&quot;唱歌&quot;</span>, <span class="string">&quot;coding&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Child</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="comment">//关键代码</span></span><br><span class="line">Child.prototype = <span class="keyword">new</span> Person();</span><br><span class="line">Child.prototype.constructor = Child;</span><br><span class="line"><span class="keyword">var</span> child = <span class="keyword">new</span> Child();</span><br><span class="line">child.hobby.push(<span class="string">&quot;睡觉&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> child2 = <span class="keyword">new</span> Child();</span><br><span class="line"><span class="built_in">console</span>.log(child2.hobby); <span class="comment">//[&#x27;唱歌&#x27;,&#x27;coding&#x27;,&#x27;睡觉&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>2，原型继承的缺点：</p>
<ul>
<li><p>不能传递参数。</p>
</li>
<li><p>如果父类的属性是引用类型，子类实列修改了该属性，其他的子类实列会共享该属性。</p>
</li>
</ul>
<h5 id="构造函数继承"><a href="#构造函数继承" class="headerlink" title="构造函数继承"></a>构造函数继承</h5><p>1，借用构造函数实现继承，也就是通过 call 或者 apply 方法调用父类构造函数，以实现继承。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 父类</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.hobby = [<span class="string">&quot;唱歌&quot;</span>, <span class="string">&quot;踢球&quot;</span>, <span class="string">&quot;跑步&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.eat = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;好吃&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//子类</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Child</span>(<span class="params">age, name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line">  Person.call(<span class="built_in">this</span>, name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//实列</span></span><br><span class="line"><span class="keyword">var</span> child1 = <span class="keyword">new</span> Child(<span class="string">&quot;11&quot;</span>, <span class="string">&quot;dnhyxc&quot;</span>);</span><br><span class="line">child1.hobby.push(<span class="string">&quot;学习&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(child1.hobby); <span class="comment">// [&#x27;唱歌&#x27;,&#x27;踢球&#x27;,&#x27;跑步&#x27;,&#x27;学习&#x27;]</span></span><br><span class="line"><span class="keyword">var</span> child2 = <span class="keyword">new</span> Child(<span class="string">&quot;11&quot;</span>, <span class="string">&quot;dnhyxc&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(child2.hobby); <span class="comment">// [&#x27;唱歌&#x27;,&#x27;踢球&#x27;,&#x27;跑步&#x27;]</span></span><br><span class="line"><span class="built_in">console</span>.log(child2.name); <span class="comment">// dnhyxc</span></span><br><span class="line"><span class="built_in">console</span>.log(child1.eat); <span class="comment">// undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(child2.eat); <span class="comment">// undefined</span></span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person();</span><br><span class="line"><span class="built_in">console</span>.log(person.eat); <span class="comment">// function</span></span><br></pre></td></tr></table></figure>
<p>2，借用构造函数有缺点：</p>
<ul>
<li><p>子类无法继承父类在原型链上的属性和方法。</p>
</li>
<li><p>每个实例都拷贝一份，占用内存大，尤其是方法过多的时候（函数复用又无从谈起了，本来我们用 prototype 就是解决复用问题的）。</p>
</li>
</ul>
<p>3，优点：</p>
<ul>
<li>解决了通过原型链继承子类对于父类引用类型属性的修改，导致其他子类实列共享了修改的问题。</li>
</ul>
<h5 id="组合继承"><a href="#组合继承" class="headerlink" title="组合继承"></a>组合继承</h5><p>1，组合继承（原型链继承+借用构造函数继承）由于这两种继承方式都存在各自的优缺点，从而将他们优点结合起来，通过原型继承父类原型上的属性和方法，通过构造函数的方法继承父类的属性。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 父类</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.hobby = [<span class="string">&quot;唱歌&quot;</span>, <span class="string">&quot;踢球&quot;</span>, <span class="string">&quot;跑步&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.eat = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value, <span class="string">&quot;好吃&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//子类</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Child</span>(<span class="params">age, name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line">  Person.call(<span class="built_in">this</span>, name); <span class="comment">//借用构造函数</span></span><br><span class="line">&#125;</span><br><span class="line">Child.prototype = <span class="keyword">new</span> Person(); <span class="comment">// 原型链</span></span><br><span class="line">Child.prototype.constructor = Child;</span><br><span class="line"><span class="keyword">var</span> child = <span class="keyword">new</span> Child(<span class="number">18</span>, <span class="string">&quot;dnhyxc&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(child.name); <span class="comment">// dnhyxc</span></span><br><span class="line"><span class="built_in">console</span>.log(child.hobby); <span class="comment">// [&quot;唱歌&quot;, &quot;踢球&quot;, &quot;跑步&quot;]</span></span><br><span class="line"><span class="built_in">console</span>.log(child.age); <span class="comment">// 18</span></span><br><span class="line">child.eat(<span class="string">&quot;雪糕&quot;</span>); <span class="comment">// 雪糕 好吃</span></span><br></pre></td></tr></table></figure>
<p>2，组合继承缺点：</p>
<ul>
<li>组合继承是 js 最常用的继承模式，组合继承最大的问题就是无论在什么情况下，都会调用两次构造函数：一次是在创建子类型原型时，另一次是在子类构造函数内部。</li>
</ul>
<h5 id="寄生组合继承"><a href="#寄生组合继承" class="headerlink" title="寄生组合继承"></a>寄生组合继承</h5><p>1，寄生组合继承就是避免两次调用父类构造函数，通过赋值直接继承父类的原型。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.hobby = [<span class="string">&quot;唱歌&quot;</span>, <span class="string">&quot;踢球&quot;</span>, <span class="string">&quot;跑步&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.eat = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;好吃&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//子类</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Child</span>(<span class="params">age, name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line">  Person.call(<span class="built_in">this</span>, name); <span class="comment">//借用构造函数</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> proObj = <span class="built_in">Object</span>.create(Person.prototype);</span><br><span class="line">proObj.constructor = Child;</span><br><span class="line">Child.prototype = proObj;</span><br><span class="line"><span class="keyword">var</span> child = <span class="keyword">new</span> Child(<span class="number">18</span>, <span class="string">&quot;dnhyxc&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(child.name); <span class="comment">// dnhyxc</span></span><br><span class="line"><span class="built_in">console</span>.log(child.hobby); <span class="comment">// [&quot;唱歌&quot;, &quot;踢球&quot;, &quot;跑步&quot;]</span></span><br><span class="line"><span class="built_in">console</span>.log(child.age); <span class="comment">// 18</span></span><br><span class="line">child.eat(<span class="string">&quot;雪糕&quot;</span>); <span class="comment">// 雪糕 好吃</span></span><br></pre></td></tr></table></figure>
<p>2，Object.create() 做了什么？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Object</span>._create = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>) </span>&#123;&#125; <span class="comment">// 创建了一个新的构造函数F</span></span><br><span class="line">  F.prototype = obj; <span class="comment">// 然后将构造函数F的原型指向了参数对象obj</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> F(); <span class="comment">// 返回构造函数F的实例对象，从而实现了该实例继承obj的属性。</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="深浅拷贝"><a href="#深浅拷贝" class="headerlink" title="深浅拷贝"></a>深浅拷贝</h4><h5 id="浅拷贝"><a href="#浅拷贝" class="headerlink" title="浅拷贝"></a>浅拷贝</h5><p>1，通常需要拷贝的对象内部只有一层的这种对象。</p>
<p>2，常用方法：</p>
<ul>
<li><p>Object.assign() 方法来实现。</p>
</li>
<li><p>扩展运算符 …obj。</p>
</li>
<li><p>loadsh 里面的 _.clone。</p>
</li>
<li><p>Array.prototype.concat。</p>
</li>
<li><p>Array.prototype.slice。</p>
</li>
</ul>
<h5 id="深拷贝"><a href="#深拷贝" class="headerlink" title="深拷贝"></a>深拷贝</h5><p>1，通常是嵌套二层或以上的复杂对象。</p>
<p>2，常用方法：</p>
<ul>
<li><p>JSON.parse(JSON.stringfy(object)); 该方法忽略掉 undefined、忽略 Symbol、忽略 function。只适合简单深拷贝。</p>
</li>
<li><p>递归实现深拷贝。</p>
</li>
</ul>
<p>3，递归实现深拷贝方式一：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个深拷贝函数  接收目标target参数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 定义一个变量</span></span><br><span class="line">  <span class="keyword">let</span> result;</span><br><span class="line">  <span class="comment">// 如果当前需要深拷贝的是一个对象的话</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> target === <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果是一个数组的话</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(target)) &#123;</span><br><span class="line">      result = []; <span class="comment">// 将result赋值为一个数组，并且执行遍历</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> target) &#123;</span><br><span class="line">        <span class="comment">// 递归克隆数组中的每一项</span></span><br><span class="line">        result.push(deepClone(target[i]));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 判断如果当前的值是null的话；直接赋值为null</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (target === <span class="literal">null</span>) &#123;</span><br><span class="line">      result = <span class="literal">null</span>;</span><br><span class="line">      <span class="comment">// 判断如果当前的值是一个RegExp对象的话，直接赋值</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (target.constructor === <span class="built_in">RegExp</span>) &#123;</span><br><span class="line">      result = target;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 否则是普通对象，直接for in循环，递归赋值对象的所有值</span></span><br><span class="line">      result = &#123;&#125;;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> target) &#123;</span><br><span class="line">        result[i] = deepClone(target[i]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果不是对象的话，就是基本数据类型，那么直接赋值</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    result = target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 返回最终结果</span></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">let</span> obj1 = &#123;</span><br><span class="line">  a: &#123;</span><br><span class="line">    c: <span class="regexp">/a/</span>,</span><br><span class="line">    d: <span class="literal">undefined</span>,</span><br><span class="line">    b: <span class="literal">null</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  b: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.a);</span><br><span class="line">  &#125;,</span><br><span class="line">  c: [</span><br><span class="line">    &#123;</span><br><span class="line">      a: <span class="string">&quot;c&quot;</span>,</span><br><span class="line">      b: <span class="regexp">/b/</span>,</span><br><span class="line">      c: <span class="literal">undefined</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;a&quot;</span>,</span><br><span class="line">    <span class="number">3</span>,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj2 = deepClone(obj1);</span><br><span class="line"></span><br><span class="line">obj2.a.d = &#123;</span><br><span class="line">  aa: <span class="string">&quot;我改了&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj2.c = [</span><br><span class="line">  &#123;</span><br><span class="line">    a: <span class="string">&quot;c&quot;</span>,</span><br><span class="line">    b: <span class="string">&quot;我改了&quot;</span>,</span><br><span class="line">    c: <span class="literal">undefined</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;a&quot;</span>,</span><br><span class="line">  <span class="number">3</span>,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj1);</span><br><span class="line"><span class="built_in">console</span>.log(obj2);</span><br><span class="line"><span class="built_in">console</span>.log(obj1.a); <span class="comment">// &#123;c: /a/, d: undefined, b: null&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(obj2.a); <span class="comment">// &#123;c: /a/, d: &#123;…&#125;, b: null&#125;</span></span><br></pre></td></tr></table></figure>
<p>4，递归实现深拷贝方式二：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> cloneObj = <span class="keyword">new</span> obj.constructor();</span><br><span class="line">  <span class="keyword">if</span> (obj === <span class="literal">null</span>) <span class="keyword">return</span> obj;</span><br><span class="line">  <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="built_in">Date</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(obj);</span><br><span class="line">  <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="built_in">RegExp</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">RegExp</span>(obj);</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> obj !== <span class="string">&quot;object&quot;</span>) <span class="keyword">return</span> obj;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="keyword">if</span> (obj.hasOwnProperty(i)) &#123;</span><br><span class="line">      cloneObj[i] = deepClone(obj[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> cloneObj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明；之所以使用 new obj.constructor()创建对象，是因为这样能保证即可克隆一个对象本身，也能克隆这个对象的实例。因为不确定 obj 传入的是对象本身，还是它创建出来的实例，new obj.constructor()可以保证当你传入的是 obj 的实例时，克隆的就是 obj 的实例。即为了保证克隆的结果和克隆之前的对象保持相同的所属类。</p>
</blockquote>
<h5 id="深浅拷贝的区别"><a href="#深浅拷贝的区别" class="headerlink" title="深浅拷贝的区别"></a>深浅拷贝的区别</h5><p>1，深浅拷贝赋值不一样，在浅拷贝中，把一个对象赋值给新的变量时，赋的其实是该对象在栈中的地址，而不是堆中的数据，也就是两个对象指向的是同一个存储空间，无论哪个对象发生改变，其实都是改变的存储空间的内容，因此，两个对象是联动的。</p>
<p>2，在浅拷贝中，重新在堆中创建内容，拷贝前后对象的<strong>基本数据类型互不影响</strong>，但拷贝引用类型时，因为共享同一内存空间，因此会相互影响。</p>
<p>3，在深拷贝中，从堆内存中开辟一个新的内存空间存放对象，对对象中的子对象进行递归拷贝，拷贝前后的两个对象互不影响。</p>
<h4 id="函数的节流和防抖"><a href="#函数的节流和防抖" class="headerlink" title="函数的节流和防抖"></a>函数的节流和防抖</h4><h5 id="防抖函数"><a href="#防抖函数" class="headerlink" title="防抖函数"></a>防抖函数</h5><p>1，防抖函数：将多次触发变成最后一次触发，即让触发的函数只执行最后一次。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">fn, wait</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> arg = <span class="built_in">arguments</span>;</span><br><span class="line">    <span class="keyword">if</span> (timer) &#123;</span><br><span class="line">      <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">      timer = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      fn.apply(<span class="built_in">this</span>, arg);</span><br><span class="line">    &#125;, wait);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clg</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;clg&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">&quot;resize&quot;</span>, debounce(clg, <span class="number">1000</span>));</span><br></pre></td></tr></table></figure>
<blockquote>
<p>为什么要在 fn.apply(this, arg) 中传入 arg？</p>
<ul>
<li>fun.apply(this, arg)的用意，就是想让 fn 中的 this 指向 debounce 中 return 的这个函数中的 this，return 回来的这个函数中的 this 也就是指向直接调用 return 函数那个对象。这里都是 window 来直接调用 return 回来的那个函数。所以这里的 this 其实没啥用，之所以这么写是因为 arguments 就是传入的参数数组，而且个数可以不确定的传回给 fn。</li>
</ul>
</blockquote>
<h5 id="节流函数"><a href="#节流函数" class="headerlink" title="节流函数"></a>节流函数</h5><p>1，将多次执行变成每隔一个时间节点去执行的函数，即限制函数每隔 delay 时间执行一次。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 方式一</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">fn, time</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> lastTime = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> nowTime = <span class="built_in">Date</span>.now();</span><br><span class="line">    <span class="keyword">if</span> (nowTime - lastTime &gt; time || !lastTime) &#123;</span><br><span class="line">      fn();</span><br><span class="line">      lastTime = nowTime;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHi</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;hi&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">setInterval</span>(throttle(sayHi, <span class="number">1000</span>), <span class="number">500</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式二</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">callback, delay</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> delayTimer;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!delayTimer) &#123;</span><br><span class="line">      delayTimer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        callback();</span><br><span class="line">        delayTimer = <span class="literal">null</span>;</span><br><span class="line">      &#125;, delay);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="call、apply、bind"><a href="#call、apply、bind" class="headerlink" title="call、apply、bind"></a>call、apply、bind</h4><h5 id="call、apply、bind-的区别"><a href="#call、apply、bind-的区别" class="headerlink" title="call、apply、bind 的区别"></a>call、apply、bind 的区别</h5><p>1，三者的相同点：都是重定向 this 指针的方法。</p>
<p>2，三者的不同点：</p>
<ul>
<li><p>call 和 apply 的第二个参数不相同，call 和 bind 是若干个参数的列表，apply 则是一个数组。</p>
</li>
<li><p>call 和 apply 都会立即执行，但 bind 不会立即执行。</p>
</li>
</ul>
<h5 id="手写-call"><a href="#手写-call" class="headerlink" title="手写 call"></a>手写 call</h5><p>1，call 方法的执行操作回顾：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> mock = &#123; <span class="attr">value</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mockNum</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;value&quot;</span>, <span class="built_in">this</span>.value);</span><br><span class="line">&#125;</span><br><span class="line">mockNum.call(mock); <span class="comment">// 改变了函数中this的指向，当前this指向了mock对象</span></span><br></pre></td></tr></table></figure>
<p>2，具体分析：</p>
<ul>
<li>将上述调用方式进行转换：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> mock = &#123;</span><br><span class="line">  value:<span class="number">1</span>;</span><br><span class="line">  mockNum:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">&#x27;value&#x27;</span>,<span class="built_in">this</span>.value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">mock.mockNum();</span><br></pre></td></tr></table></figure>
<ul>
<li><p>经过上面这个操作的演化即可得出如下结论：</p>
<ul>
<li><p>将函数设为一个对象的属性。</p>
</li>
<li><p>并将这个函数属性进行调用。</p>
</li>
<li><p>最后删除该函数。</p>
</li>
</ul>
</li>
</ul>
<p>3，具体实现代码如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.Mycall = <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">this</span> !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// 判断当前调用者是否为函数</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 保存传入的this指向，这里会出现没有传入this指向的问题，那么就默认指向window</span></span><br><span class="line">  <span class="keyword">let</span> obj = context || <span class="built_in">window</span>;</span><br><span class="line">  <span class="comment">// 为obj添加fn函数，并将其this指向当前函数，即为mockNum函数，此时fn函数就相当于是mockNum函数</span></span><br><span class="line">  obj.fn = <span class="built_in">this</span>;</span><br><span class="line">  <span class="comment">// 通过slice来截取传入的参数，即除去传入的第一个参数mock</span></span><br><span class="line">  <span class="keyword">let</span> args = [...arguments].slice(<span class="number">1</span>);</span><br><span class="line">  <span class="comment">// 调用fn函数</span></span><br><span class="line">  <span class="keyword">let</span> result = obj.fn(...args);</span><br><span class="line">  <span class="keyword">delete</span> obj.fn;</span><br><span class="line">  <span class="comment">// 如果mockNum函数有返回，result就是mockNum函数的返回值，否则就是undefined</span></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">let</span> mock = &#123;</span><br><span class="line">  value: <span class="number">1</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mockNum</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;value&quot;</span>, <span class="built_in">this</span>.value); <span class="comment">// value 1</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;a&quot;</span>, a); <span class="comment">// a 111</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;b&quot;</span>, b); <span class="comment">// b 222</span></span><br><span class="line">&#125;</span><br><span class="line">mockNum.Mycall(mock, <span class="number">111</span>, <span class="number">222</span>);</span><br></pre></td></tr></table></figure>
<h5 id="手写-apply"><a href="#手写-apply" class="headerlink" title="手写 apply"></a>手写 apply</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.myApply = <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">this</span> !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// 判断当前调用者是否为函数</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> obj = context || <span class="built_in">window</span>;</span><br><span class="line">  obj.fn = <span class="built_in">this</span>;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="built_in">arguments</span>[<span class="number">1</span>] ? obj.fn(<span class="built_in">arguments</span>[<span class="number">1</span>]) : obj.fn([]);</span><br><span class="line">  <span class="keyword">delete</span> obj.fn;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mock3 = &#123;</span><br><span class="line">  arr: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">arrx2</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.arr.concat(arr).map(<span class="function">(<span class="params">x</span>) =&gt;</span> x * <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;arrx2&quot;</span>, arrx2.myApply(mock3, [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]));</span><br></pre></td></tr></table></figure>
<h5 id="手写-bind"><a href="#手写-bind" class="headerlink" title="手写 bind"></a>手写 bind</h5><p>1，bind 方法具体说明：该方法会直接返回一个新的函数，需要手动去调用才能执行。其特点是：</p>
<ul>
<li><p>返回一个函数。</p>
</li>
<li><p>可以传入参数。</p>
</li>
<li><p>例如：</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> foo = &#123; <span class="attr">value</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;bindFoo&quot;</span>, <span class="built_in">this</span>.value);</span><br><span class="line">  <span class="comment">// return this.value // 考虑到函数可能有返回值</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> bindFoo = bar.bind(foo);</span><br><span class="line"><span class="comment">// 如果有返回值的情况下 bindFoo() === 1;</span></span><br><span class="line">bindFoo(); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p>3，bind 方法具体代码实现如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.Mybind = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">this</span> !== <span class="string">&quot;function&quot;</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;not a function&quot;</span>);</span><br><span class="line">  <span class="comment">// 当前this指向bar函数</span></span><br><span class="line">  <span class="keyword">let</span> self = <span class="built_in">this</span>;</span><br><span class="line">  <span class="keyword">let</span> args = [...arguments].slice(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span> <span class="keyword">instanceof</span> F) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> self(...args, ...arguments);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...arguments为传入F函数的参数</span></span><br><span class="line">    <span class="keyword">return</span> self.apply(obj, args.concat([...arguments]));</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> foo = &#123;</span><br><span class="line">  value: <span class="number">1</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;bindFoo&quot;</span>, <span class="built_in">this</span>.value); <span class="comment">// bindFoo 1</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> bindFoo = bar.Mybind(foo);</span><br><span class="line"><span class="built_in">console</span>.log(bindFoo()); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p>4，终极完整版实现如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype._bind = <span class="function"><span class="keyword">function</span> (<span class="params">thisObj</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 判断是否为函数调用</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    <span class="keyword">typeof</span> target !== <span class="string">&quot;function&quot;</span> ||</span><br><span class="line">    <span class="built_in">Object</span>.prototype.toString.call(target) !== <span class="string">&quot;[object Function]&quot;</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="built_in">this</span> + <span class="string">&quot; must be a function&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> self = <span class="built_in">this</span>;</span><br><span class="line">  <span class="keyword">const</span> args = [...arguments].slice(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> bound = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> finalArgs = [...args, ...arguments];</span><br><span class="line">    <span class="comment">// 考虑new调用的情况，new.target用来检测是否是被new调用</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">new</span>.target !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="comment">// 说明是用new来调用的</span></span><br><span class="line">      <span class="keyword">var</span> result = self.apply(<span class="built_in">this</span>, finalArgs);</span><br><span class="line">      <span class="keyword">if</span> (result <span class="keyword">instanceof</span> <span class="built_in">Object</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> self.apply(thisArg, finalArgs);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 保留函数原型，为了防止构造函数有prototype属性的时候出现问题</span></span><br><span class="line">  <span class="keyword">if</span> (self.prototype) &#123;</span><br><span class="line">    <span class="comment">// 为什么使用了Object.create?因为我们要防止，bound.prototype的修改而导致self.prototype被修改。</span></span><br><span class="line">    <span class="comment">// 不要写成bound.prototype = self.prototype，这样可能会导致原函数的原型被修改。</span></span><br><span class="line">    bound.prototype = <span class="built_in">Object</span>.create(self.prototype);</span><br><span class="line">    bound.prototype.constructor = self;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> bound;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="instanceof-原理"><a href="#instanceof-原理" class="headerlink" title="instanceof 原理"></a>instanceof 原理</h4><p>1，instanceOf 用来判断左边是否是右边的实例。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myInstanceof</span>(<span class="params">left, right</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 获得类型的原型</span></span><br><span class="line">  <span class="keyword">let</span> prototype = right.prototype;</span><br><span class="line">  <span class="comment">// 获得对象的原型</span></span><br><span class="line">  left = left.__proto__;</span><br><span class="line">  <span class="comment">// 判断对象的类型是否等于类型的原型</span></span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (left === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (prototype === left) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    left = left.__proto__;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Fun</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Fun.prototype.say = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;我叫&quot;</span> + <span class="built_in">this</span>.name + <span class="string">&quot;，今年&quot;</span> + <span class="built_in">this</span>.age + <span class="string">&quot;岁！&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fun = <span class="keyword">new</span> Fun(<span class="string">&quot;dnhyxc&quot;</span>, <span class="string">&quot;18&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(myInstanceof(fun, Fun)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(fun.name); <span class="comment">// dnhyxc</span></span><br><span class="line"><span class="built_in">console</span>.log(fun.age); <span class="comment">// 18</span></span><br><span class="line">fun.say(); <span class="comment">// 我叫dnhyxc，今年18岁！</span></span><br></pre></td></tr></table></figure>
<h4 id="实现-Event-event-bus"><a href="#实现-Event-event-bus" class="headerlink" title="实现 Event(event bus)"></a>实现 Event(event bus)</h4><p>1，event bus 既是 node 中各个模块的基石，又是前端组件通信的依赖手段之一，同时涉及了订阅-发布设计模式，是非常重要的基础。</p>
<p>2，简单版实现：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 简单版</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventEmeitter</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._events = <span class="built_in">this</span>._events || <span class="keyword">new</span> <span class="built_in">Map</span>(); <span class="comment">// 储存事件/回调键值对</span></span><br><span class="line">    <span class="built_in">this</span>._maxListeners = <span class="built_in">this</span>._maxListeners || <span class="number">10</span>; <span class="comment">// 设立监听上限</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听名为type的事件</span></span><br><span class="line">EventEmeitter.prototype.on = <span class="function"><span class="keyword">function</span> (<span class="params">type, fn</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 将type事件以及对应的fn函数放入this._events中储存</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">this</span>._events.get(type)) &#123;</span><br><span class="line">    <span class="built_in">this</span>._events.set(type, fn);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 触发名为type的事件</span></span><br><span class="line">EventEmeitter.prototype.emit = <span class="function"><span class="keyword">function</span> (<span class="params">type, ...args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> handler;</span><br><span class="line">  <span class="comment">// 从储存事件键值对的this._events中获取对应事件回调函数</span></span><br><span class="line">  handler = <span class="built_in">this</span>._events.get(type);</span><br><span class="line">  <span class="keyword">if</span> (args.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    handler.apply(<span class="built_in">this</span>, args);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    handler.call(<span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试用例</span></span><br><span class="line"><span class="keyword">let</span> eventBus = <span class="keyword">new</span> EventEmeitter();</span><br><span class="line"><span class="comment">// 注意：必须先调用addListener，再调用emit触发addListener，否则会报错</span></span><br><span class="line">eventBus.on(<span class="string">&quot;event1&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(params);</span><br><span class="line">&#125;);</span><br><span class="line">eventBus.emit(<span class="string">&quot;event1&quot;</span>, &#123;</span><br><span class="line">  name: <span class="string">&quot;dnhyxc&quot;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>3，深度版实现：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyEventBus</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._events = <span class="built_in">this</span>._events || <span class="keyword">new</span> <span class="built_in">Map</span>(); <span class="comment">// 储存事件/回调键值对</span></span><br><span class="line">    <span class="built_in">this</span>._maxListeners = <span class="built_in">this</span>._maxListeners || <span class="number">10</span>; <span class="comment">// 设立监听上限</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听名为type的事件</span></span><br><span class="line">MyEventBus.prototype.on = <span class="function"><span class="keyword">function</span> (<span class="params">type, fn</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 获取对应事件名称的函数清单</span></span><br><span class="line">  <span class="keyword">const</span> handler = <span class="built_in">this</span>._events.get(type);</span><br><span class="line">  <span class="keyword">if</span> (!handler) &#123;</span><br><span class="line">    <span class="comment">// 第一次监听type事件时，handler为undefined，说明_events中还没有监听者，需要设置type事件的监听者</span></span><br><span class="line">    <span class="built_in">this</span>._events.set(type, fn);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (handler &amp;&amp; <span class="keyword">typeof</span> handler === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果handler是函数说明已经有一个监听者了，此时我们需要用数组储存这两个监听者</span></span><br><span class="line">    <span class="built_in">this</span>._events.set(type, [handler, fn]);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 进入到这，说明已经有多个监听者了，那么直接往数组里push函数即可</span></span><br><span class="line">    handler.push(fn);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 触发名为type的事件</span></span><br><span class="line">MyEventBus.prototype.emit = <span class="function"><span class="keyword">function</span> (<span class="params">type, ...args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> handler;</span><br><span class="line">  handler = <span class="built_in">this</span>._events.get(type);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(handler)) &#123;</span><br><span class="line">    <span class="comment">// 如果是一个数组说明有多个监听者，需要依次此触发里面的函数</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; handler.length; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (args.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        handler[i].apply(<span class="built_in">this</span>, args);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        handler[i].call(<span class="built_in">this</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 单个函数的情况我们直接触发即可</span></span><br><span class="line">    <span class="keyword">if</span> (args.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      handler.apply(<span class="built_in">this</span>, args);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      handler.call(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">MyEventBus.prototype.removeListener = <span class="function"><span class="keyword">function</span> (<span class="params">type, fn</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 获取对应事件名称的函数清单</span></span><br><span class="line">  <span class="keyword">const</span> handler = <span class="built_in">this</span>._events.get(type);</span><br><span class="line">  <span class="comment">// 如果是函数,说明只被监听了一次</span></span><br><span class="line">  <span class="keyword">if</span> (handler &amp;&amp; <span class="keyword">typeof</span> handler === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>._events.delete(type, fn);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> postion;</span><br><span class="line">    <span class="comment">// 如果handler是数组，说明被监听多次要找到对应的函数</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; handler.length; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (handler[i] === fn) &#123;</span><br><span class="line">        postion = i;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        postion = -<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果找到匹配的函数，从数组中清除</span></span><br><span class="line">    <span class="keyword">if</span> (postion !== -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">// 找到数组对应的位置，直接清除此回调</span></span><br><span class="line">      handler.splice(postion, <span class="number">1</span>);</span><br><span class="line">      <span class="comment">// 如果清除后只有一个函数，那么取消数组，以函数形式保存</span></span><br><span class="line">      <span class="keyword">if</span> (handler.length === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>._events.set(type, handler[<span class="number">0</span>]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试用例</span></span><br><span class="line"><span class="keyword">let</span> deepEventBus = <span class="keyword">new</span> MyEventBus();</span><br><span class="line"><span class="comment">// 注意：必须先调用addListener，再调用emit触发addListener，否则会报错</span></span><br><span class="line">deepEventBus.on(<span class="string">&quot;event1&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(params, <span class="string">&quot;dnhyxc1&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">deepEventBus.on(<span class="string">&quot;event1&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(params, <span class="string">&quot;dnhyxc2&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">deepEventBus.on(<span class="string">&quot;event1&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(params, <span class="string">&quot;dnhyxc3&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">deepEventBus.emit(<span class="string">&quot;event1&quot;</span>, &#123;</span><br><span class="line">  name: <span class="string">&quot;dnhyxc&quot;</span>,</span><br><span class="line">  age: <span class="string">&quot;18&quot;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="模拟-Object-create"><a href="#模拟-Object-create" class="headerlink" title="模拟 Object.create()"></a>模拟 Object.create()</h4><p>1，Object.create()方法说明：Object.create()方法创建一个新对象，使用现有的对象来提供新创建的对象的__proto__。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 模拟 Object.create()</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">create</span>(<span class="params">proto</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">  F.prototype = proto;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> F();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="实现-JOSN-parse"><a href="#实现-JOSN-parse" class="headerlink" title="实现 JOSN.parse"></a>实现 JOSN.parse</h4><p>1，深度实现方式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseValue</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (str[i] === <span class="string">&quot;&#123;&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> parseObject();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (str[i] === <span class="string">&quot;[&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> parseArray();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (str[i] === <span class="string">&quot;n&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> parseNull();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (str[i] === <span class="string">&quot;t&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> parseTrue();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (str[i] === <span class="string">&quot;f&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> parseFalse();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (str[i] === <span class="string">&#x27;&quot;&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> parseString();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//如果不考虑出错的话，不是以上所有的情况即</span></span><br><span class="line">    <span class="keyword">return</span> parseNumber();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 所有的函数都是从i位置开始解析出一个对应类型的值，同时把i移动到解析完成后的下一个位置</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  i++; <span class="comment">// 开始解析之前，i是指向字符开始的双引号的，但字符的内容是不包含这个双引号的</span></span><br><span class="line">  <span class="keyword">while</span> (str[i] != <span class="string">&#x27;&quot;&#x27;</span>) &#123;</span><br><span class="line">    result += str[i++];</span><br><span class="line">  &#125;</span><br><span class="line">  i++; <span class="comment">// 移动i到解析完成后的下一个位置</span></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseNull</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 简单粗暴，直接往后读出一个长度为4的个字符串出来，如果不是null，则直接报错</span></span><br><span class="line">  <span class="keyword">var</span> content = str.substr(i, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (content === <span class="string">&quot;null&quot;</span>) &#123;</span><br><span class="line">    i += <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;Unexpected char at pos: &quot;</span> + i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseFalse</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 基本同上</span></span><br><span class="line">  <span class="keyword">var</span> content = str.substr(i, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (content === <span class="string">&quot;false&quot;</span>) &#123;</span><br><span class="line">    i += <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;Unexpected char at pos: &quot;</span> + i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseTrue</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 基本同上</span></span><br><span class="line">  <span class="keyword">var</span> content = str.substr(i, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (content === <span class="string">&quot;true&quot;</span>) &#123;</span><br><span class="line">    i += <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;Unexpected char at pos: &quot;</span> + i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseNumber</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 本函数的实现并没有考虑内容格式的问题，实际上JSON中的数值需要满足一个格式</span></span><br><span class="line">  <span class="comment">// 并且由于最后调用了parseFloat，所以如果格式不对，还是会报错的</span></span><br><span class="line">  <span class="keyword">var</span> numStr = <span class="string">&quot;&quot;</span>; <span class="comment">//-2e+8</span></span><br><span class="line">  <span class="comment">// 此处只要判断i位置还是数字字符，就继续读</span></span><br><span class="line">  <span class="comment">// 为了方便，写了另一个helper函数</span></span><br><span class="line">  <span class="keyword">while</span> (isNumberChar(str[i])) &#123;</span><br><span class="line">    numStr += str[i++];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">parseFloat</span>(numStr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断字符c是否为组成JSON中数值的符号</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isNumberChar</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> chars = &#123;</span><br><span class="line">    <span class="string">&quot;-&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;+&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    e: <span class="literal">true</span>,</span><br><span class="line">    E: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;.&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">if</span> (chars[c]) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (c &gt;= <span class="string">&quot;0&quot;</span> &amp;&amp; c &lt;= <span class="string">&quot;9&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析数组</span></span><br><span class="line"><span class="comment">// 掐头去尾，然后一个值一个逗号，如果解析完一个值后没遇到逗号，说明解析完了</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseArray</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  i++;</span><br><span class="line">  <span class="keyword">var</span> result = []; <span class="comment">// [1234,&quot;lsdf&quot;,true,false]</span></span><br><span class="line">  <span class="keyword">while</span> (str[i] !== <span class="string">&quot;]&quot;</span>) &#123;</span><br><span class="line">    result.push(parseValue());</span><br><span class="line">    <span class="keyword">if</span> (str[i] === <span class="string">&quot;,&quot;</span>) &#123;</span><br><span class="line">      i++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  i++;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 解析对象：</span></span><br><span class="line"><span class="comment"> * 掐头去尾，然后一个key，是字符串，一个冒号，一个值，可能是任意类型，所以调用parseValue</span></span><br><span class="line"><span class="comment"> * 最后，如果解析完一组键值对对，遇到了逗号，则解析下一组，没遇到逗号，则解析完毕</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseObject</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  i++;</span><br><span class="line">  <span class="keyword">var</span> result = &#123;&#125;; <span class="comment">//&#123;&quot;a&quot;:1,&quot;b&quot;:2&#125;</span></span><br><span class="line">  <span class="keyword">while</span> (str[i] !== <span class="string">&quot;&#125;&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> key = parseString();</span><br><span class="line">    i++; <span class="comment">//由于只考虑合法且无多余空白的JSON，所以这里就不判断是不是逗号了，正常应该是发现不是逗号就报错的</span></span><br><span class="line">    <span class="keyword">var</span> value = parseValue();</span><br><span class="line">    result[key] = value;</span><br><span class="line">    <span class="keyword">if</span> (str[i] === <span class="string">&quot;,&quot;</span>) &#123;</span><br><span class="line">      i++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  i++;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parse</span>(<span class="params">json</span>) </span>&#123;</span><br><span class="line">  i = <span class="number">0</span>;</span><br><span class="line">  str = json;</span><br><span class="line">  <span class="keyword">return</span> parseValue();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;&#123;&quot;a&quot;:1,&quot;b&quot;:true,&quot;c&quot;:false,&quot;foo&quot;:null,&quot;bar&quot;:[1,2,3]&#125;&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(parse(str)); <span class="comment">// &#123;a: 1, b: true, c: false, foo: null, bar: Array(3)&#125;</span></span><br></pre></td></tr></table></figure>
<p>2，骚操作实现方式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;&#123;&quot;a&quot;:1,&quot;b&quot;:true,&quot;c&quot;:false,&quot;foo&quot;:null,&quot;bar&quot;:[1,2,3]&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> obj = <span class="built_in">eval</span>(<span class="string">&quot;(&quot;</span> + str + <span class="string">&quot;)&quot;</span>); <span class="comment">// &#123;a: 1, b: true, c: false, foo: null, bar: Array(3)&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>此方法属于骚操作，极易容易被 xss 攻击，慎用。</p>
</blockquote>
<h4 id="实现-Promise"><a href="#实现-Promise" class="headerlink" title="实现 Promise"></a>实现 Promise</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> PromisePolyfill = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 和reject不同的是resolve需要尝试展开thenable对象</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">tryToResolve</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span> === value) &#123;</span><br><span class="line">      <span class="comment">// 主要是防止下面这种情况</span></span><br><span class="line">      <span class="comment">// let y = new Promise(res =&gt; setTimeout(res(y)))</span></span><br><span class="line">      <span class="keyword">throw</span> <span class="built_in">TypeError</span>(<span class="string">&quot;Chaining cycle detected for promise!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据规范2.32以及2.33 对对象或者函数尝试展开</span></span><br><span class="line">    <span class="comment">// 保证S6之前的 polyfill 也能和ES6的原生promise混用</span></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      value !== <span class="literal">null</span> &amp;&amp;</span><br><span class="line">      (<span class="keyword">typeof</span> value === <span class="string">&quot;object&quot;</span> || <span class="keyword">typeof</span> value === <span class="string">&quot;function&quot;</span>)</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 这里记录这次then的值同时要被try包裹</span></span><br><span class="line">        <span class="comment">// 主要原因是 then 可能是一个getter, 也就是说:</span></span><br><span class="line">        <span class="comment">// 1. value.then可能报错</span></span><br><span class="line">        <span class="comment">// 2. value.then可能产生副作用(例如多次执行可能结果不同)</span></span><br><span class="line">        <span class="keyword">var</span> then = value.then;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 另一方面, 由于无法保证 then 确实会像预期的那样只调用一个onFullfilled / onRejected</span></span><br><span class="line">        <span class="comment">// 所以增加了一个flag来防止resolveOrReject被多次调用</span></span><br><span class="line">        <span class="keyword">var</span> thenAlreadyCalledOrThrow = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">          <span class="comment">// 是thenable 那么尝试展开</span></span><br><span class="line">          <span class="comment">// 并且在该thenable状态改变之前this对象的状态不变</span></span><br><span class="line">          then.bind(value)(</span><br><span class="line">            <span class="comment">// onFullfilled</span></span><br><span class="line">            <span class="function"><span class="keyword">function</span> (<span class="params">value2</span>) </span>&#123;</span><br><span class="line">              <span class="keyword">if</span> (thenAlreadyCalledOrThrow) <span class="keyword">return</span>;</span><br><span class="line">              thenAlreadyCalledOrThrow = <span class="literal">true</span>;</span><br><span class="line">              tryToResolve.bind(<span class="built_in">this</span>, value2)();</span><br><span class="line">            &#125;.bind(<span class="built_in">this</span>),</span><br><span class="line"></span><br><span class="line">            <span class="comment">// onRejected</span></span><br><span class="line">            <span class="function"><span class="keyword">function</span> (<span class="params">reason2</span>) </span>&#123;</span><br><span class="line">              <span class="keyword">if</span> (thenAlreadyCalledOrThrow) <span class="keyword">return</span>;</span><br><span class="line">              thenAlreadyCalledOrThrow = <span class="literal">true</span>;</span><br><span class="line">              resolveOrReject.bind(<span class="built_in">this</span>, <span class="string">&quot;rejected&quot;</span>, reason2)();</span><br><span class="line">            &#125;.bind(<span class="built_in">this</span>)</span><br><span class="line">          );</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// 拥有then 但是then不是一个函数 所以也不是thenable</span></span><br><span class="line">          resolveOrReject.bind(<span class="built_in">this</span>, <span class="string">&quot;resolved&quot;</span>, value)();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">if</span> (thenAlreadyCalledOrThrow) <span class="keyword">return</span>;</span><br><span class="line">        thenAlreadyCalledOrThrow = <span class="literal">true</span>;</span><br><span class="line">        resolveOrReject.bind(<span class="built_in">this</span>, <span class="string">&quot;rejected&quot;</span>, e)();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 基本类型 直接返回</span></span><br><span class="line">      resolveOrReject.bind(<span class="built_in">this</span>, <span class="string">&quot;resolved&quot;</span>, value)();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolveOrReject</span>(<span class="params">status, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.status !== <span class="string">&quot;pending&quot;</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">this</span>.status = status;</span><br><span class="line">    <span class="built_in">this</span>.data = data;</span><br><span class="line">    <span class="keyword">if</span> (status === <span class="string">&quot;resolved&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.resolveList.length; ++i) &#123;</span><br><span class="line">        <span class="built_in">this</span>.resolveList[i]();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.rejectList.length; ++i) &#123;</span><br><span class="line">        <span class="built_in">this</span>.rejectList[i]();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Promise</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!(<span class="built_in">this</span> <span class="keyword">instanceof</span> <span class="built_in">Promise</span>)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">&quot;Promise can not be called without new !&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> executor !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">// 非标准 但与Chrome谷歌保持一致</span></span><br><span class="line">      <span class="keyword">throw</span> <span class="built_in">TypeError</span>(<span class="string">&quot;Promise resolver &quot;</span> + executor + <span class="string">&quot; is not a function&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.status = <span class="string">&quot;pending&quot;</span>;</span><br><span class="line">    <span class="built_in">this</span>.resolveList = [];</span><br><span class="line">    <span class="built_in">this</span>.rejectList = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      executor(tryToResolve.bind(<span class="built_in">this</span>), resolveOrReject.bind(<span class="built_in">this</span>, <span class="string">&quot;rejected&quot;</span>));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      resolveOrReject.bind(<span class="built_in">this</span>, <span class="string">&quot;rejected&quot;</span>, e)();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Promise</span>.prototype.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFullfilled, onRejected</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 返回值穿透以及错误穿透, 注意错误穿透用的是throw而不是return，否则的话</span></span><br><span class="line">    <span class="comment">// 这个then返回的promise状态将变成resolved即接下来的then中的onFullfilled</span></span><br><span class="line">    <span class="comment">// 会被调用, 然而我们想要调用的是onRejected</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> onFullfilled !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">      onFullfilled = <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> onRejected !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">      onRejected = <span class="function"><span class="keyword">function</span> (<span class="params">reason</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> reason;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> executor = <span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(</span><br><span class="line">        <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 拿到对应的handle函数处理this.data</span></span><br><span class="line">            <span class="comment">// 并以此为依据解析这个新的Promise</span></span><br><span class="line">            <span class="keyword">var</span> value =</span><br><span class="line">              <span class="built_in">this</span>.status === <span class="string">&quot;resolved&quot;</span></span><br><span class="line">                ? onFullfilled(<span class="built_in">this</span>.data)</span><br><span class="line">                : onRejected(<span class="built_in">this</span>.data);</span><br><span class="line">            resolve(value);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            reject(e);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;.bind(<span class="built_in">this</span>)</span><br><span class="line">      );</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// then 接受两个函数返回一个新的Promise</span></span><br><span class="line">    <span class="comment">// then 自身的执行永远异步与onFullfilled/onRejected的执行</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.status !== <span class="string">&quot;pending&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(executor.bind(<span class="built_in">this</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// pending</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(</span><br><span class="line">        <span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">          <span class="built_in">this</span>.resolveList.push(executor.bind(<span class="built_in">this</span>, resolve, reject));</span><br><span class="line">          <span class="built_in">this</span>.rejectList.push(executor.bind(<span class="built_in">this</span>, resolve, reject));</span><br><span class="line">        &#125;.bind(<span class="built_in">this</span>)</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// for prmise A+ test</span></span><br><span class="line">  <span class="built_in">Promise</span>.deferred = <span class="built_in">Promise</span>.defer = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dfd = &#123;&#125;;</span><br><span class="line">    dfd.promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">      dfd.resolve = resolve;</span><br><span class="line">      dfd.reject = reject;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> dfd;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// for prmise A+ test</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">module</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">module</span>.exports = <span class="built_in">Promise</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">PromisePolyfill.all = <span class="function"><span class="keyword">function</span> (<span class="params">promises</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = [];</span><br><span class="line">    <span class="keyword">let</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; promises.length; ++i) &#123;</span><br><span class="line">      promises[i].then(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">        cnt++;</span><br><span class="line">        result[i] = value;</span><br><span class="line">        <span class="keyword">if</span> (cnt === promises.length) resolve(result);</span><br><span class="line">      &#125;, reject);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">PromisePolyfill.race = <span class="function"><span class="keyword">function</span> (<span class="params">promises</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; promises.length; ++i) &#123;</span><br><span class="line">      promises[i].then(resolve, reject);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="解析-URL-Params-为对象"><a href="#解析-URL-Params-为对象" class="headerlink" title="解析 URL Params 为对象"></a>解析 URL Params 为对象</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseParam</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 将 ? 后面的字符串取出来</span></span><br><span class="line">  <span class="keyword">const</span> paramsStr = <span class="regexp">/.+\?(.+)$/</span>.exec(url)[<span class="number">1</span>];</span><br><span class="line">  <span class="comment">// 将字符串以 &amp; 分割后存到数组中</span></span><br><span class="line">  <span class="keyword">const</span> paramsArr = paramsStr.split(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">  <span class="keyword">let</span> paramsObj = &#123;&#125;;</span><br><span class="line">  <span class="comment">// 将 params 存到对象中</span></span><br><span class="line">  paramsArr.forEach(<span class="function">(<span class="params">param</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/=/</span>.test(param)) &#123;</span><br><span class="line">      <span class="comment">// 处理有 value 的参数</span></span><br><span class="line">      <span class="keyword">let</span> [key, val] = param.split(<span class="string">&quot;=&quot;</span>); <span class="comment">// 分割 key 和 value</span></span><br><span class="line">      val = <span class="built_in">decodeURIComponent</span>(val); <span class="comment">// 解码</span></span><br><span class="line">      val = <span class="regexp">/^\d+$/</span>.test(val) ? <span class="built_in">parseFloat</span>(val) : val; <span class="comment">// 判断是否转为数字</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (paramsObj.hasOwnProperty(key)) &#123;</span><br><span class="line">        <span class="comment">// 如果对象有 key，则添加一个值</span></span><br><span class="line">        paramsObj[key] = [].concat(paramsObj[key], val);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 如果对象没有这个 key，创建 key 并设置值</span></span><br><span class="line">        paramsObj[key] = val;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 处理没有 value 的参数</span></span><br><span class="line">      paramsObj[param] = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> paramsObj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">let</span> url =</span><br><span class="line">  <span class="string">&quot;http://dnhyxc.github.io/?user=dnhyxc&amp;id=123&amp;id=456&amp;city=%E5%8C%97%E4%BA%AC&amp;enabled&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(parseParam(url)); <span class="comment">// &#123;user: &quot;dnhyxc&quot;, id: [123, 456], city: &quot;北京&quot;, enabled: true&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="转化为驼峰命名"><a href="#转化为驼峰命名" class="headerlink" title="转化为驼峰命名"></a>转化为驼峰命名</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> f = <span class="function"><span class="keyword">function</span> (<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// /\-\w|_\w|\.\w/g：正则匹配&#x27;-&#x27;、&#x27;_&#x27;、&#x27;.&#x27;</span></span><br><span class="line">  <span class="keyword">return</span> s.replace(<span class="regexp">/\-\w|_\w|\.\w/g</span>, <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x.slice(<span class="number">1</span>).toUpperCase();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">&quot;get.element_by-id&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(f(str)); <span class="comment">// getElementById</span></span><br></pre></td></tr></table></figure>
<h4 id="查找字符串中出现最多的字符和个数"><a href="#查找字符串中出现最多的字符和个数" class="headerlink" title="查找字符串中出现最多的字符和个数"></a>查找字符串中出现最多的字符和个数</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">&quot;abcabcabcbbccccc&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> num = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> char = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使其按照一定的次序排列</span></span><br><span class="line">str = str.split(<span class="string">&quot;&quot;</span>).sort().join(<span class="string">&quot;&quot;</span>); <span class="comment">// &quot;aaabbbbbcccccccc&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义正则表达式</span></span><br><span class="line"><span class="keyword">let</span> re = <span class="regexp">/(\w)\1+/g</span>;</span><br><span class="line"></span><br><span class="line">str.replace(re, <span class="function">(<span class="params">$<span class="number">1</span>, $<span class="number">2</span>, $<span class="number">3</span>, $<span class="number">4</span>, $<span class="number">5</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (num &lt; $<span class="number">1.</span>length) &#123;</span><br><span class="line">    num = $<span class="number">1.</span>length;</span><br><span class="line">    char = $<span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`字符最多的是<span class="subst">$&#123;char&#125;</span>，出现了<span class="subst">$&#123;num&#125;</span>次`</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上述$1，$2参数说明：</span></span><br><span class="line">str.replace(re, <span class="function">(<span class="params">$<span class="number">1</span>, $<span class="number">2</span>, $<span class="number">3</span>, $<span class="number">4</span>, $<span class="number">5</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log($<span class="number">1</span>, $<span class="number">2</span>, $<span class="number">3</span>, $<span class="number">4</span>, $<span class="number">5</span>);</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    aaa a 0 aaabbbbbcccccccc undefined</span></span><br><span class="line"><span class="comment">    bbbbb b 3 aaabbbbbcccccccc undefined</span></span><br><span class="line"><span class="comment">    cccccccc c 8 aaabbbbbcccccccc undefined</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="字符串查找"><a href="#字符串查找" class="headerlink" title="字符串查找"></a>字符串查找</h4><p>1，具体应用场景：用最基本的遍历来实现判断字符串 a 是否被包含在字符串 b 中，并返回第一次出现的位置（找不到返回 -1）。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isContain</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> b) &#123;</span><br><span class="line">    <span class="keyword">if</span> (a[<span class="number">0</span>] === b[i]) &#123;</span><br><span class="line">      <span class="keyword">let</span> tmp = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j <span class="keyword">in</span> a) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[j] !== b[~~i + ~~j]) &#123;</span><br><span class="line">          tmp = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (tmp) &#123;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a = <span class="string">&quot;34&quot;</span>;</span><br><span class="line">b = <span class="string">&quot;1234567&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(isContain(a, b)); <span class="comment">// 返回 2</span></span><br><span class="line">a = <span class="string">&quot;35&quot;</span>;</span><br><span class="line">b = <span class="string">&quot;1234567&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(isContain(a, b)); <span class="comment">// 返回 -1</span></span><br><span class="line">a = <span class="string">&quot;355&quot;</span>;</span><br><span class="line">b = <span class="string">&quot;123554355&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(isContain(a, b)); <span class="comment">// 返回 2</span></span><br></pre></td></tr></table></figure>
<h4 id="判断一个变量是对象还是数组"><a href="#判断一个变量是对象还是数组" class="headerlink" title="判断一个变量是对象还是数组"></a>判断一个变量是对象还是数组</h4><p>1，判断数组和对象分别都有好几种方法，其中用 prototype.toString.call() 兼容性最好。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isObjArr</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.toString.call(value) === <span class="string">&quot;[object Array]&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;value是数组&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.toString.call(value) === <span class="string">&quot;[object Object]&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">//这个方法兼容性好一点</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;value是对象&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;value不是数组也不是对象&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="实现千位分隔符"><a href="#实现千位分隔符" class="headerlink" title="实现千位分隔符"></a>实现千位分隔符</h4><h5 id="实现方式一"><a href="#实现方式一" class="headerlink" title="实现方式一"></a>实现方式一</h5><p>1，首先将数字转为字符串数组，在循环整个数组，每三位添加一个分隔逗号，最后再合并成字符串。</p>
<p>2，由于分隔符在顺序上是从后往前添加的：比如 1234567 添加后是 1,234,567 而不是 123,456,7，所以方便起见可以先把数组倒序排列，添加完之后再将顺序倒回来，就是正常顺序了。</p>
<p>3，<strong>注意</strong>：如果数字带小数的话，要把小数部分分开处理。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">numFormat</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 保留三位小数并将其转为字符串以&quot;.&quot;进行小数点分割</span></span><br><span class="line">  num = <span class="built_in">parseFloat</span>(num.toFixed(<span class="number">3</span>)).toString().split(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  <span class="comment">// 转换成字符数组并且倒序排列</span></span><br><span class="line">  <span class="keyword">var</span> arr = num[<span class="number">0</span>].split(<span class="string">&quot;&quot;</span>).reverse();</span><br><span class="line">  <span class="keyword">var</span> res = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    <span class="comment">// 如果能被3整除，就往数组中添加&quot;,&quot;分隔符</span></span><br><span class="line">    <span class="keyword">if</span> (i % <span class="number">3</span> === <span class="number">0</span> &amp;&amp; i !== <span class="number">0</span>) &#123;</span><br><span class="line">      res.push(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 注意：添加分割符必须写在添加数字之前，因为后面需要将其进行反转回来</span></span><br><span class="line">    res.push(arr[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 再次倒序成为正确的顺序</span></span><br><span class="line">  res.reverse();</span><br><span class="line">  <span class="comment">// 如果有小数的话添加小数部分</span></span><br><span class="line">  <span class="keyword">if</span> (num[<span class="number">1</span>]) &#123;</span><br><span class="line">    res = res.join(<span class="string">&quot;&quot;</span>).concat(<span class="string">&quot;.&quot;</span> + num[<span class="number">1</span>]);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res = res.join(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1234567894532</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="number">673439.4542</span>;</span><br><span class="line"><span class="keyword">var</span> c = <span class="number">673439.8629</span>;</span><br><span class="line"><span class="built_in">console</span>.log(numFormat(a)); <span class="comment">// &quot;1,234,567,894,532&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(numFormat(b)); <span class="comment">// &quot;673,439.4542&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(numFormat(c)); <span class="comment">// &quot;673,439.863&quot;</span></span><br></pre></td></tr></table></figure>
<h5 id="实现方式二"><a href="#实现方式二" class="headerlink" title="实现方式二"></a>实现方式二</h5><p>1，使用 JS 自带的 API <code>toLocaleString()</code>。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">numObj.toLocaleString(locales, options);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>locales：缩写语言代码（BCP 47 language tag，例如：cmn-Hans-CN）的字符串或者这些字符串组成的数组。<br>options：包含一些或所有的下面属性的类。<code>decimal =&gt; 用于纯数字格式</code>，<code>currency =&gt; 用于货币格式</code>，<code>percent =&gt; 用于百分比格式</code>，<code>unit =&gt; 用于单位格式</code>。<br>说明：该方法返回这个数字在特定语言环境下的表示字符串。</p>
</blockquote>
<p>2，<strong>注意</strong>：该方法在没有指定区域时，返回时用默认的语言环境和默认选项格式化的字符串，所以不同地区数字格式可能会有一定的差异，因此最好确保使用 locales 参数指定了使用的语言。</p>
<p>3，实现数字插入千位符代码如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="number">1234567894532</span>;</span><br><span class="line"><span class="keyword">const</span> b = <span class="number">673439.4542</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a.toLocaleString()); <span class="comment">// &quot;1,234,567,894,532&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(b.toLocaleString()); <span class="comment">// &quot;673,439.454&quot;  （小数部分四舍五入了）</span></span><br></pre></td></tr></table></figure>
<h5 id="实现方式三"><a href="#实现方式三" class="headerlink" title="实现方式三"></a>实现方式三</h5><p>1，使用 <code>RegExp 和 replace()</code> 方法。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">numFormat</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 先提取整数部分</span></span><br><span class="line">  <span class="keyword">var</span> res = num.toString().replace(<span class="regexp">/\d+/</span>, <span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n.replace(<span class="regexp">/(\d)(?=(\d&#123;3&#125;)+$)/g</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$<span class="number">1</span></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $<span class="number">1</span> + <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1234567894532</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="number">673439.4542</span>;</span><br><span class="line"><span class="built_in">console</span>.log(numFormat(a)); <span class="comment">// &quot;1,234,567,894,532&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(numFormat(b)); <span class="comment">// &quot;673,439.4542&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="数组去重"><a href="#数组去重" class="headerlink" title="数组去重"></a>数组去重</h4><h5 id="使用双重循环实现"><a href="#使用双重循环实现" class="headerlink" title="使用双重循环实现"></a>使用双重循环实现</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.unique = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> newArray = [];</span><br><span class="line">  <span class="keyword">let</span> isRepeat;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.length; i++) &#123;</span><br><span class="line">    isRepeat = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; newArray.length; j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>[i] === newArray[j]) &#123;</span><br><span class="line">        isRepeat = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!isRepeat) &#123;</span><br><span class="line">      newArray.push(<span class="built_in">this</span>[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newArray;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> testArr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;22&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> arr = [];</span><br><span class="line"><span class="comment">// 生成[0, 100000]之间的随机数</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">  arr.push(<span class="number">0</span> + <span class="built_in">Math</span>.floor((<span class="number">100000</span> - <span class="number">0</span> + <span class="number">1</span>) * <span class="built_in">Math</span>.random()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">arr.unique();</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">&quot;test&quot;</span>); <span class="comment">// test: 1645.865966796875 ms</span></span><br><span class="line"><span class="built_in">console</span>.log(testArr.unique()); <span class="comment">// [1, 2, 3, 4, 5, 6, 7, 8, 9, &quot;11&quot;, &quot;22&quot;]</span></span><br></pre></td></tr></table></figure>
<h5 id="使用-Array-prototype-indexOf-实现"><a href="#使用-Array-prototype-indexOf-实现" class="headerlink" title="使用 Array.prototype.indexOf() 实现"></a>使用 Array.prototype.indexOf() 实现</h5><p>1，基本思路：如果索引不是第一个索引，说明是重复值。</p>
<ul>
<li>Array.prototype.indexOf()返回的是第一个索引值。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 写法一</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.unique = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.filter(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.indexOf(item) === index;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> testArr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;22&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> arr = [];</span><br><span class="line"><span class="comment">// 生成[0, 100000]之间的随机数</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">  arr.push(<span class="number">0</span> + <span class="built_in">Math</span>.floor((<span class="number">100000</span> - <span class="number">0</span> + <span class="number">1</span>) * <span class="built_in">Math</span>.random()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">arr.unique();</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">&quot;test&quot;</span>); <span class="comment">// test: 4436.455810546875 ms</span></span><br><span class="line"><span class="built_in">console</span>.log(testArr.unique()); <span class="comment">// [1, 2, 3, 4, 5, 6, 7, 8, 9, &quot;11&quot;, &quot;22&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 写法二</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.unique = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> newArray = [];</span><br><span class="line">  <span class="built_in">this</span>.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (newArray.indexOf(item) === -<span class="number">1</span>) &#123;</span><br><span class="line">      newArray.push(item);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> newArray;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> testArr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;22&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> arr = [];</span><br><span class="line"><span class="comment">// 生成[0, 100000]之间的随机数</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">  arr.push(<span class="number">0</span> + <span class="built_in">Math</span>.floor((<span class="number">100000</span> - <span class="number">0</span> + <span class="number">1</span>) * <span class="built_in">Math</span>.random()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">arr.unique();</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">&quot;test&quot;</span>); <span class="comment">// test: 3468.3388671875 ms</span></span><br><span class="line"><span class="built_in">console</span>.log(testArr.unique()); <span class="comment">// [1, 2, 3, 4, 5, 6, 7, 8, 9, &quot;11&quot;, &quot;22&quot;]</span></span><br></pre></td></tr></table></figure>
<h5 id="使用-Array-prototype-sort-实现"><a href="#使用-Array-prototype-sort-实现" class="headerlink" title="使用 Array.prototype.sort() 实现"></a>使用 Array.prototype.sort() 实现</h5><p>1，基本思路：先对原数组进行排序，然后再进行元素比较。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 写法一</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.unique3 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> newArray = [];</span><br><span class="line">  <span class="built_in">this</span>.sort();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>[i] !== <span class="built_in">this</span>[i + <span class="number">1</span>]) &#123;</span><br><span class="line">      newArray.push(<span class="built_in">this</span>[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newArray;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> testArr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;22&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> arr = [];</span><br><span class="line"><span class="comment">// 生成[0, 100000]之间的随机数</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">  arr.push(<span class="number">0</span> + <span class="built_in">Math</span>.floor((<span class="number">100000</span> - <span class="number">0</span> + <span class="number">1</span>) * <span class="built_in">Math</span>.random()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">arr.unique();</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">&quot;test&quot;</span>); <span class="comment">// test: 37.299072265625 ms</span></span><br><span class="line"><span class="built_in">console</span>.log(testArr.unique()); <span class="comment">// [1, &quot;11&quot;, 2, &quot;22&quot;, 3, 4, 5, 6, 7, 8, 9]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 写法二</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.unique = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> newArray = [];</span><br><span class="line">  <span class="built_in">this</span>.sort();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>[i] !== newArray[newArray.length - <span class="number">1</span>]) &#123;</span><br><span class="line">      newArray.push(<span class="built_in">this</span>[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newArray;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> testArr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;22&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> arr = [];</span><br><span class="line"><span class="comment">// 生成[0, 100000]之间的随机数</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">  arr.push(<span class="number">0</span> + <span class="built_in">Math</span>.floor((<span class="number">100000</span> - <span class="number">0</span> + <span class="number">1</span>) * <span class="built_in">Math</span>.random()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">arr.unique();</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">&quot;test&quot;</span>); <span class="comment">// test: 37.14990234375 ms</span></span><br><span class="line"><span class="built_in">console</span>.log(testArr.unique()); <span class="comment">// [1, &quot;11&quot;, 2, &quot;22&quot;, 3, 4, 5, 6, 7, 8, 9]</span></span><br></pre></td></tr></table></figure>
<h5 id="使用-Array-prototype-includes-实现"><a href="#使用-Array-prototype-includes-实现" class="headerlink" title="使用 Array.prototype.includes() 实现"></a>使用 Array.prototype.includes() 实现</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.unique = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> newArray = [];</span><br><span class="line">  <span class="built_in">this</span>.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!newArray.includes(item)) &#123;</span><br><span class="line">      newArray.push(item);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> newArray;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> testArr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;22&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> arr = [];</span><br><span class="line"><span class="comment">// 生成[0, 100000]之间的随机数</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">  arr.push(<span class="number">0</span> + <span class="built_in">Math</span>.floor((<span class="number">100000</span> - <span class="number">0</span> + <span class="number">1</span>) * <span class="built_in">Math</span>.random()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">arr.unique();</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">&quot;test&quot;</span>); <span class="comment">// test: 3066.06201171875 ms</span></span><br><span class="line"><span class="built_in">console</span>.log(testArr.unique()); <span class="comment">// [1, 2, 3, 4, 5, 6, 7, 8, 9, &quot;11&quot;, &quot;22&quot;]</span></span><br></pre></td></tr></table></figure>
<h5 id="使用-和-结合-forEach-实现"><a href="#使用-和-结合-forEach-实现" class="headerlink" title="使用 {} 和 [] 结合 forEach() 实现"></a>使用 {} 和 [] 结合 forEach() 实现</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unique</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!arr <span class="keyword">instanceof</span> <span class="built_in">Array</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">&quot;当前传入的不是数组&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> list = [];</span><br><span class="line">  <span class="keyword">let</span> obj = &#123;&#125;;</span><br><span class="line">  arr.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!obj[item]) &#123;</span><br><span class="line">      list.push(item);</span><br><span class="line">      obj[item] = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> testArr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;22&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> arr = [];</span><br><span class="line"><span class="comment">// 生成[0, 100000]之间的随机数</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">  arr.push(<span class="number">0</span> + <span class="built_in">Math</span>.floor((<span class="number">100000</span> - <span class="number">0</span> + <span class="number">1</span>) * <span class="built_in">Math</span>.random()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">unique(arr);</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">&quot;test&quot;</span>); <span class="comment">// test: 8.662109375 ms</span></span><br><span class="line"><span class="built_in">console</span>.log(unique(testArr)); <span class="comment">// [1, 2, 3, 4, 5, 6, 7, 8, 9, &quot;11&quot;, &quot;22&quot;]</span></span><br></pre></td></tr></table></figure>
<h5 id="使用-Array-prototype-reduce-实现"><a href="#使用-Array-prototype-reduce-实现" class="headerlink" title="使用 Array.prototype.reduce() 实现"></a>使用 Array.prototype.reduce() 实现</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.unique = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.sort().reduce(<span class="function">(<span class="params">init, current</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (init.length === <span class="number">0</span> || init[init.length - <span class="number">1</span>] !== current) &#123;</span><br><span class="line">      init.push(current);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> init;</span><br><span class="line">  &#125;, []);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> testArr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;22&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> arr = [];</span><br><span class="line"><span class="comment">// 生成[0, 100000]之间的随机数</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">  arr.push(<span class="number">0</span> + <span class="built_in">Math</span>.floor((<span class="number">100000</span> - <span class="number">0</span> + <span class="number">1</span>) * <span class="built_in">Math</span>.random()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">arr.unique();</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">&quot;test&quot;</span>); <span class="comment">// test: 38.675048828125 ms</span></span><br><span class="line"><span class="built_in">console</span>.log(testArr.unique()); <span class="comment">// [1, &quot;11&quot;, 2, &quot;22&quot;, 3, 4, 5, 6, 7, 8, 9]</span></span><br></pre></td></tr></table></figure>
<h5 id="使用-Map-实现"><a href="#使用-Map-实现" class="headerlink" title="使用 Map 实现"></a>使用 Map 实现</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 写法一</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.unique = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> newArray = [];</span><br><span class="line">  <span class="keyword">const</span> tmp = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!tmp.get(<span class="built_in">this</span>[i])) &#123;</span><br><span class="line">      tmp.set(<span class="built_in">this</span>[i], <span class="number">1</span>);</span><br><span class="line">      newArray.push(<span class="built_in">this</span>[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newArray;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> testArr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;22&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> arr = [];</span><br><span class="line"><span class="comment">// 生成[0, 100000]之间的随机数</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">  arr.push(<span class="number">0</span> + <span class="built_in">Math</span>.floor((<span class="number">100000</span> - <span class="number">0</span> + <span class="number">1</span>) * <span class="built_in">Math</span>.random()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">arr.unique();</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">&quot;test&quot;</span>); <span class="comment">// test: 11.30712890625 ms</span></span><br><span class="line"><span class="built_in">console</span>.log(testArr.unique()); <span class="comment">// [1, 2, 3, 4, 5, 6, 7, 8, 9, &quot;11&quot;, &quot;22&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 写法二</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.unique = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> tmp = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.filter(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> !tmp.has(item) &amp;&amp; tmp.set(item, <span class="number">1</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> testArr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;22&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> arr = [];</span><br><span class="line"><span class="comment">// 生成[0, 100000]之间的随机数</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">  arr.push(<span class="number">0</span> + <span class="built_in">Math</span>.floor((<span class="number">100000</span> - <span class="number">0</span> + <span class="number">1</span>) * <span class="built_in">Math</span>.random()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">arr.unique();</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">&quot;test&quot;</span>); <span class="comment">// test: 8.900146484375 ms</span></span><br><span class="line"><span class="built_in">console</span>.log(testArr.unique()); <span class="comment">// [1, 2, 3, 4, 5, 6, 7, 8, 9, &quot;11&quot;, &quot;22&quot;]</span></span><br></pre></td></tr></table></figure>
<h5 id="使用-Set-实现"><a href="#使用-Set-实现" class="headerlink" title="使用 Set 实现"></a>使用 Set 实现</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 写法一</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.unique = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>(<span class="built_in">this</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Array</span>.from(set);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> testArr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;22&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> arr = [];</span><br><span class="line"><span class="comment">// 生成[0, 100000]之间的随机数</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">  arr.push(<span class="number">0</span> + <span class="built_in">Math</span>.floor((<span class="number">100000</span> - <span class="number">0</span> + <span class="number">1</span>) * <span class="built_in">Math</span>.random()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">arr.unique();</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">&quot;test&quot;</span>); <span class="comment">// test: 5.614013671875 ms</span></span><br><span class="line"><span class="built_in">console</span>.log(testArr.unique()); <span class="comment">// [1, 2, 3, 4, 5, 6, 7, 8, 9, &quot;11&quot;, &quot;22&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 写法二</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.unique = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [...new <span class="built_in">Set</span>(<span class="built_in">this</span>)];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> testArr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;22&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> arr = [];</span><br><span class="line"><span class="comment">// 生成[0, 100000]之间的随机数</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">  arr.push(<span class="number">0</span> + <span class="built_in">Math</span>.floor((<span class="number">100000</span> - <span class="number">0</span> + <span class="number">1</span>) * <span class="built_in">Math</span>.random()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">arr.unique();</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">&quot;test&quot;</span>); <span class="comment">// test: 5.591796875 ms</span></span><br><span class="line"><span class="built_in">console</span>.log(testArr.unique()); <span class="comment">// [1, 2, 3, 4, 5, 6, 7, 8, 9, &quot;11&quot;, &quot;22&quot;]</span></span><br></pre></td></tr></table></figure>
<h4 id="字符串反转"><a href="#字符串反转" class="headerlink" title="字符串反转"></a>字符串反转</h4><p>1，基本思路：先将字符串转成一个数组，然后用数组的 reverse()+join() 方法实现。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">&quot;hello word&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> b = [...str].reverse().join(<span class="string">&quot;&quot;</span>); <span class="comment">//drow olleh</span></span><br></pre></td></tr></table></figure>
<h4 id="实现链式调用"><a href="#实现链式调用" class="headerlink" title="实现链式调用"></a>实现链式调用</h4><p>1，基本思路：在调用完的方法之后将自身实例返回。</p>
<p>2，实现示例：</p>
<ul>
<li>示例一：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Class1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;初始化&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">Class1.prototype.method = <span class="function"><span class="keyword">function</span> (<span class="params">param</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(param);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> cl = <span class="keyword">new</span> Class1();</span><br><span class="line"><span class="comment">//由于new 在实例化的时候this会指向创建的对象，所以this.method这个方法会在原型链中找到。</span></span><br><span class="line">cl.method(<span class="string">&quot;第一次调用&quot;</span>).method(<span class="string">&quot;第二次链式调用&quot;</span>).method(<span class="string">&quot;第三次链式调用&quot;</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>示例二：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  a: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  b: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">obj.a().b(); <span class="comment">// a b</span></span><br></pre></td></tr></table></figure>
<ul>
<li>示例三：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">fn1</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> args = [...arguments];</span><br><span class="line">    <span class="keyword">const</span> res = args.reduce(<span class="function">(<span class="params">prev, current</span>) =&gt;</span> prev + current, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(res); <span class="comment">// 疯狂coding88</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">fn2</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> args = [...arguments];</span><br><span class="line">    <span class="keyword">const</span> res = args.reduce(<span class="function">(<span class="params">prev, current</span>) =&gt;</span> prev + current * <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(res); <span class="comment">// 24</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">fn3</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value * <span class="number">3</span>); <span class="comment">// 18</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">fn4</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value * <span class="number">4</span>); <span class="comment">// 36</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> person = <span class="keyword">new</span> Person();</span><br><span class="line">person.fn1(<span class="string">&quot;疯狂coding&quot;</span>, <span class="number">88</span>).fn2(<span class="number">3</span>, <span class="number">9</span>).fn3(<span class="number">6</span>).fn4(<span class="number">9</span>);</span><br></pre></td></tr></table></figure>
<h3 id="react-相关"><a href="#react-相关" class="headerlink" title="react 相关"></a>react 相关</h3><h4 id="hooks-是什么"><a href="#hooks-是什么" class="headerlink" title="hooks 是什么"></a>hooks 是什么</h4><p>1，hooks 是 react16.8 出来的新特性，它能让我们在不使用 class 组件的情况下使用 state，以及其它的 react 特性。</p>
<h4 id="class-组件的不足"><a href="#class-组件的不足" class="headerlink" title="class 组件的不足"></a>class 组件的不足</h4><p>1，状态逻辑难复用：</p>
<ul>
<li>在组件之间复用状态逻辑很难，可能要用到 render props （渲染属性）或者 HOC（高阶组件），但无论是渲染属性，还是高阶组件，都会在原先的组件外包裹一层父容器（一般都是 div 元素），导致层级冗余。</li>
</ul>
<p>2，趋向复杂难以维护：</p>
<ul>
<li><p>在生命周期函数中混杂不相干的逻辑（如：在 componentDidMount 中注册事件以及其他的逻辑，在 componentWillUnmount 中卸载事件，这样分散不集中的写法，很容易写出 bug ）。</p>
</li>
<li><p>类组件中到处都是对状态的访问和处理，导致组件难以拆分成更小的组件。</p>
</li>
</ul>
<p>3，this 指向问题：</p>
<ul>
<li>父组件给子组件传递函数时，必须绑定 this。</li>
</ul>
<h4 id="相比-class-hooks-的优势"><a href="#相比-class-hooks-的优势" class="headerlink" title="相比 class hooks 的优势"></a>相比 class hooks 的优势</h4><p>1，能优化类组件的三大问题。</p>
<p>2，能在无需修改组件结构的情况下复用状态逻辑（自定义 Hooks ）。</p>
<p>3，能将组件中相互关联的部分拆分成更小的函数（比如设置订阅或请求数据）。</p>
<p>4，副作用的关注点分离。</p>
<ul>
<li>副作用指那些没有发生在数据向视图转换过程中的逻辑，如 ajax 请求、访问原生 dom 元素、本地持久化缓存、绑定/解绑事件、添加订阅、设置定时器、记录日志等。以往这些副作用都是写在类组件生命周期函数中的。而 useEffect 在全部渲染完毕后才会执行，useLayoutEffect 会在浏览器 layout 之后，painting 之前执行。</li>
</ul>
<h4 id="useState"><a href="#useState" class="headerlink" title="useState"></a>useState</h4><h5 id="useState-概述"><a href="#useState-概述" class="headerlink" title="useState 概述"></a>useState 概述</h5><p>1，useState 会返回一个数组：一个 state，一个用于更新 state 的函数，如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> [state, setState] = useState(initialState);</span><br></pre></td></tr></table></figure>
<p>2，在初始化渲染期间，返回的状态 state 与传入的第一个参数 initialState 的值是相同的。</p>
<p>3，我们可以在事件处理函数中或其他一些地方调用这个函数。它类似 class 组件的 this.setState，但是<strong>它不会把新的 state 和旧的 state 进行合并，而是直接替换</strong>。</p>
<h5 id="深入-useState"><a href="#深入-useState" class="headerlink" title="深入 useState"></a>深入 useState</h5><p>1，<strong>useState 中每次渲染都是独立的闭包</strong>：</p>
<ul>
<li><p>每一次渲染都有它自己的 Props 和 State。</p>
</li>
<li><p>每一次渲染都有它自己的事件处理函数。</p>
</li>
<li><p>当点击更新状态的时候，函数组件都会重新被调用，那么每次渲染都是独立的，取到的值不会受后面操作的影响。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> [number, setNumber] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">alertNumber</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// alert 只能获取到点击按钮时的那个状态</span></span><br><span class="line">      alert(number);</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;p&gt;&#123;number&#125;&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;<span class="function">() =&gt;</span> setNumber(number + <span class="number">1</span>)&#125;&gt;+&lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;alertNumber&#125;&gt;alertNumber&lt;/button&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2，<strong>函数式更新</strong>：</p>
<ul>
<li>如果新的 state 需要通过使用先前的 state 计算得出，那么可以将回调函数当做参数传递给 setState。该回调函数将接收先前的 state，并返回一个更新后的值。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> [number, setNumber] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">lazy</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// setNumber(number+1);</span></span><br><span class="line">      <span class="comment">// 这样每次执行时都会去获取一遍 state，而不是使用点击触发时的那个 state</span></span><br><span class="line">      setNumber(<span class="function">(<span class="params">number</span>) =&gt;</span> number + <span class="number">1</span>);</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;p&gt;&#123;number&#125;&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;<span class="function">() =&gt;</span> setNumber(number + <span class="number">1</span>)&#125;&gt;+&lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;lazy&#125;&gt;lazy&lt;/button&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3， <strong>惰性初始化 state</strong>：</p>
<ul>
<li><p>initialState 参数只会在组件的初始化渲染中起作用，后续渲染时会被忽略。</p>
</li>
<li><p>如果初始 state 需要通过复杂计算获得，则可以传入一个函数，在函数中计算并返回初始的 state，此函数只在初始渲染时被调用。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter5</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;Counter5 render&quot;</span>);</span><br><span class="line">  <span class="comment">// 这个函数只在初始渲染时执行一次，后续更新状态重新渲染组件时，该函数就不会再被调用</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getInitState</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">number</span>: props.number &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> [counter, setCounter] = useState(getInitState);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;p&gt;&#123;counter.number&#125;&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;<span class="function">() =&gt;</span> setCounter(&#123; <span class="attr">number</span>: counter.number + <span class="number">1</span> &#125;)&#125;&gt;</span><br><span class="line">        +</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;<span class="function">() =&gt;</span> setCounter(counter)&#125;&gt;setCounter&lt;/button&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="useState-性能优化"><a href="#useState-性能优化" class="headerlink" title="useState 性能优化"></a>useState 性能优化</h5><p>1，Object.is （浅比较）：</p>
<ul>
<li><p>Hook 内部使用 Object.is 来比较新/旧 state 是否相等。</p>
</li>
<li><p>与 class 组件中的 setState 方法不同，如果你修改状态的时候，传的状态值没有变化，则不重新渲染。</p>
</li>
<li><p>与 class 组件中的 setState 方法不同，useState 不会自动合并更新对象。你可以用函数式的 setState 结合展开运算符来达到合并更新对象的效果。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [counter, setCounter] = useState(&#123; <span class="attr">name</span>: <span class="string">&quot;计数器&quot;</span>, <span class="attr">number</span>: <span class="number">0</span> &#125;);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;render Counter&quot;</span>);</span><br><span class="line">  <span class="comment">// 如果你修改状态的时候，传的状态值没有变化，则不重新渲染</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;p&gt;</span><br><span class="line">        &#123;counter.name&#125;:&#123;counter.number&#125;</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">      &lt;button</span><br><span class="line">        onClick=&#123;<span class="function">() =&gt;</span> setCounter(&#123; ...counter, <span class="attr">number</span>: counter.number + <span class="number">1</span> &#125;)&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        +</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;<span class="function">() =&gt;</span> setCounter(counter)&#125;&gt;++&lt;/button&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2，减少渲染次数：</p>
<ul>
<li><p>默认情况，只要父组件状态变了（不管子组件依不依赖该状态），子组件也会重新渲染。</p>
</li>
<li><p>一般的优化如下：</p>
<ul>
<li><p>类组件：可以使用 pureComponent。</p>
</li>
<li><p>函数组件：使用 React.memo ，将函数组件传递给 memo 之后，就会返回一个新的组件，新组件的功能：如果接受到的属性不变，则不重新渲染函数。</p>
</li>
</ul>
</li>
</ul>
<h4 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a>useEffect</h4><h4 id="react-生命周期"><a href="#react-生命周期" class="headerlink" title="react 生命周期"></a>react 生命周期</h4><p>1，react 生命周期分为：实例化阶段、更新阶段、卸载阶段。</p>
<ul>
<li><p>实例化阶段主要有：</p>
<ul>
<li><p>constructor：可以在这里对 state、props 进行初始化等操作。</p>
</li>
<li><p>getDerivedStateFromProps：根据父组件传递过来的 props 来按需更新自身的 state。</p>
</li>
<li><p>render：初始化时，生成 Fiber 节点，形成虚拟 DOM。</p>
</li>
<li><p>commonentDidMount：此时组件已经挂载完成，可以在这个生命周期中进行数据请求。</p>
</li>
</ul>
</li>
<li><p>更新阶段主要有：</p>
<ul>
<li><p>getDerivedStateFromProps：根据父组件传递过来的 props 来按需更新自身的 state。</p>
</li>
<li><p>shouldComopnentUpdate：可以通过这个生命周期判断状态是否改变，组件是否需要更新，可以用来优化性能。</p>
</li>
<li><p>render：将更新 Fiber 节点，生成新的虚拟 DOM。</p>
</li>
<li><p>getSnapshotBeforeUpdate：会在组件即将更新时调用，用来获取快照，返回值将作为 componentDidUpdate 这个生命周期的第三个参数。</p>
</li>
<li><p>componentDidUpdate：到此生命周期时组件已经更新完毕。</p>
</li>
</ul>
</li>
<li><p>卸载阶段主要有：</p>
<ul>
<li>componentWillUnmount：这个钩子主要用来做一些收尾工作，比如清除定时器、取消订阅等。</li>
</ul>
</li>
</ul>
<p>3，react 捕获异常的生命周期：</p>
<ul>
<li>componentDidCatch(error, info)：该声明周期专门用来捕获异常。</li>
</ul>
<p><img src="/2021/03/18/writtenTest/reactlive.png" alt="reactlive"></p>
<h3 id="微前端相关"><a href="#微前端相关" class="headerlink" title="微前端相关"></a>微前端相关</h3><h4 id="什么是微前端"><a href="#什么是微前端" class="headerlink" title="什么是微前端"></a>什么是微前端</h4><p>1，微前端（Micro-Frontends）是一种类似于微服务的架构，它将微服务的理念应用于浏览器端，即将 Web 应用由单一的单体应用转变为多个小型前端应用聚合为一的应用。同时各个前端应用还可以独立运行、独立开发、独立部署。</p>
<h4 id="为什么会有微前端"><a href="#为什么会有微前端" class="headerlink" title="为什么会有微前端"></a>为什么会有微前端</h4><p>1，<strong>项目需要拆分和细化</strong>：</p>
<ul>
<li>当下前端领域，单页面应用（SPA）是非常流行的项目形态之一，而随着时间的推移以及应用功能的丰富，单页应用变得不再单一而是越来越庞大也越来越难以维护，往往是改一处而动全身，由此带来的发版成本也越来越高。微前端的意义就是将这些庞大应用进行拆分，并随之解耦，每个部分可以单独进行维护和部署，提升效率。</li>
</ul>
<p>2，<strong>项目需要整合历史系统</strong>：</p>
<ul>
<li>在不少的业务中，或多或少会存在一些历史项目，这些项目大多以采用老框架类似（Backbone.js，Angular.js 1）的 B 端管理系统为主，介于日常运营，这些系统需要结合到新框架中来使用还不能抛弃，对此我们也没有理由浪费时间和精力重写旧的逻辑。而微前端可以将这些系统进行整合，在基本不修改原来逻辑的同时还能兼容新老两套系统并行运行。</li>
</ul>
<h4 id="实现微前端的方案之qiankun"><a href="#实现微前端的方案之qiankun" class="headerlink" title="实现微前端的方案之qiankun"></a>实现微前端的方案之qiankun</h4><p>1，qiankun 概述：</p>
<ul>
<li>qiankun 是一个基于 single-spa 进行封装的微前端解决方案。本质上还是<strong>路由分发式</strong>的服务框架。</li>
</ul>
<p>2，qiankun 的特点：</p>
<ul>
<li><p>与技术无关。</p>
<ul>
<li>主框架不限制接入应用的技术栈，微应用具备完全自主权。</li>
</ul>
</li>
<li><p>各个子应用可以独立开发独立部署。</p>
<ul>
<li>微应用仓库独立，前后端可独立开发，部署完成后主框架自动完成同步更新。</li>
</ul>
</li>
<li><p>增量升级。</p>
<ul>
<li>在面对各种复杂场景时，我们通常很难对一个已经存在的系统做全量的技术栈升级或重构，而微前端是一种非常好的实施渐进式重构的手段和策略。</li>
</ul>
</li>
<li><p>独立运行时。</p>
<ul>
<li>每个微应用之间状态隔离，运行时状态不共享。</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>interview</tag>
      </tags>
  </entry>
  <entry>
    <title>UploadFile</title>
    <url>/2020/06/13/uploadFile/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>本文主要概括了以下几种文件上传方式：</p>
<ul>
<li><p>基于 formData 实现文件上传。</p>
</li>
<li><p>基于 base64 实现文件上传。</p>
</li>
<li><p>上传时生成唯一 fileName 传给后端。</p>
</li>
<li><p>文件上传并生成进度条。</p>
</li>
<li><p>多文件上传。</p>
</li>
<li><p>拖拽上传。</p>
</li>
<li><p>大文件上传(切片上传)。</p>
</li>
<li><p>canvas 压缩上传图片。</p>
</li>
</ul>
<a id="more"></a>

<h4 id="基于-formData-上传"><a href="#基于-formData-上传" class="headerlink" title="基于 formData 上传"></a>基于 formData 上传</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 基于formData实现文件上传</span></span><br><span class="line"><span class="keyword">const</span> upload = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#upload1&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_inp = upload.querySelector(<span class="string">&quot;.upload_inp&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_button_select = upload.querySelector(<span class="string">&quot;.upload_button.select&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_button_upload = upload.querySelector(<span class="string">&quot;.upload_button.upload&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_tip = upload.querySelector(<span class="string">&quot;.upload_tip&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_list = upload.querySelector(<span class="string">&quot;.upload_list&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> _file = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clearHandle = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  upload_tip.style.display = <span class="string">&quot;block&quot;</span>;</span><br><span class="line">  upload_list.style.display = <span class="string">&quot;none&quot;</span>;</span><br><span class="line">  upload_list.innerHTML = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  _file = <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 移除操作逻辑</span></span><br><span class="line">upload_list.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">ev</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> target = ev.target;</span><br><span class="line">  <span class="keyword">if</span> (target.tagName === <span class="string">&quot;EM&quot;</span>) &#123;</span><br><span class="line">    clearHandle();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听用户选择文件的操作</span></span><br><span class="line">upload_inp.addEventListener(<span class="string">&quot;change&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 获取用户选择的文件</span></span><br><span class="line">  <span class="keyword">let</span> file = upload_inp.files[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">if</span> (!file) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 限制文件上传的格式</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/(PNG|JPG|JPEG)/i</span>.test(file.type)) &#123;</span><br><span class="line">    alert(<span class="string">&quot;只能上传PNG|JPG|JPEG格式的文件&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 限制文件上传的大小</span></span><br><span class="line">  <span class="keyword">if</span> (file.size &gt; <span class="number">2</span> * <span class="number">1024</span> * <span class="number">1024</span>) &#123;</span><br><span class="line">    alert(<span class="string">&quot;上传的文件不能超过2MB&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  _file = file;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 显示上传的文件</span></span><br><span class="line">  upload_tip.style.display = <span class="string">&quot;none&quot;</span>;</span><br><span class="line">  upload_list.style.display = <span class="string">&quot;block&quot;</span>;</span><br><span class="line">  upload_list.innerHTML = <span class="string">`&lt;li&gt;</span></span><br><span class="line"><span class="string">      &lt;span&gt;文件：<span class="subst">$&#123;file.name&#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">      &lt;span&gt;&lt;em&gt;移除&lt;/em&gt;&lt;/span&gt;</span></span><br><span class="line"><span class="string">    &lt;/li&gt;`</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 点击选择文件按钮，触发上传文件input框选择文件的行为</span></span><br><span class="line">upload_button_select.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    upload_button_select.classList.contains(<span class="string">&quot;disable&quot;</span>) ||</span><br><span class="line">    upload_button_select.classList.contains(<span class="string">&quot;loading&quot;</span>)</span><br><span class="line">  )</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  upload_inp.click();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handleDisable = <span class="function">(<span class="params">flag</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">    upload_button_select.classList.add(<span class="string">&quot;disable&quot;</span>);</span><br><span class="line">    upload_button_upload.classList.add(<span class="string">&quot;loading&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  upload_button_select.classList.remove(<span class="string">&quot;disable&quot;</span>);</span><br><span class="line">  upload_button_upload.classList.remove(<span class="string">&quot;loading&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上传到服务器</span></span><br><span class="line">upload_button_upload.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(_file);</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    upload_button_upload.classList.contains(<span class="string">&quot;disable&quot;</span>) ||</span><br><span class="line">    upload_button_upload.classList.contains(<span class="string">&quot;loading&quot;</span>)</span><br><span class="line">  )</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span> (!_file) &#123;</span><br><span class="line">    alert(<span class="string">&quot;请选择文件&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleDisable(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 传递文件给服务器</span></span><br><span class="line">  <span class="keyword">let</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">  formData.append(<span class="string">&quot;file&quot;</span>, _file);</span><br><span class="line">  formData.append(<span class="string">&quot;filename&quot;</span>, _file.name);</span><br><span class="line">  instance</span><br><span class="line">    .post(<span class="string">&quot;/upload_single&quot;</span>, formData)</span><br><span class="line">    .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.code === <span class="number">0</span>) &#123;</span><br><span class="line">        alert(<span class="string">`文件上传成功<span class="subst">$&#123;data.servicePath&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(data.codeText);</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">reson</span>) =&gt;</span> &#123;</span><br><span class="line">      alert(<span class="string">&quot;上传失败&quot;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .finally(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      handleDisable(<span class="literal">false</span>);</span><br><span class="line">      clearHandle();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="基于-base64-上传"><a href="#基于-base64-上传" class="headerlink" title="基于 base64 上传"></a>基于 base64 上传</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> upload = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#upload2&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_inp = upload.querySelector(<span class="string">&quot;.upload_inp&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_button_select = upload.querySelector(<span class="string">&quot;.upload_button.select&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检测按钮是否可点击</span></span><br><span class="line"><span class="keyword">const</span> checkDisable = <span class="function">(<span class="params">element</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> classList = element.classList;</span><br><span class="line">  <span class="keyword">return</span> classList.contains(<span class="string">&quot;disable&quot;</span>) || classList.contains(<span class="string">&quot;loading&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将选择的文件转为base64格式</span></span><br><span class="line"><span class="keyword">const</span> changeBase64 = <span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> fileReader = <span class="keyword">new</span> FileReader();</span><br><span class="line">    fileReader.readAsDataURL(file);</span><br><span class="line">    fileReader.onload = <span class="function">(<span class="params">ev</span>) =&gt;</span> &#123;</span><br><span class="line">      resolve(ev.target.result);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听用户选择文件的操作</span></span><br><span class="line">upload_inp.addEventListener(<span class="string">&quot;change&quot;</span>, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 获取用户选择的文件</span></span><br><span class="line">  <span class="keyword">let</span> file = upload_inp.files[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">let</span> BASE64;</span><br><span class="line">  <span class="keyword">if</span> (!file) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 限制文件上传的格式</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/(PNG|JPG|JPEG)/i</span>.test(file.type)) &#123;</span><br><span class="line">    alert(<span class="string">&quot;只能上传PNG|JPG|JPEG格式的文件&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 限制文件上传的大小</span></span><br><span class="line">  <span class="keyword">if</span> (file.size &gt; <span class="number">2</span> * <span class="number">1024</span> * <span class="number">1024</span>) &#123;</span><br><span class="line">    alert(<span class="string">&quot;上传的文件不能超过2MB&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  upload_button_select.classList.add(<span class="string">&quot;loading&quot;</span>);</span><br><span class="line">  BASE64 = <span class="keyword">await</span> changeBase64(file);</span><br><span class="line">  <span class="built_in">console</span>.log(BASE64, <span class="string">&quot;base64&quot;</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> instance.post(</span><br><span class="line">      <span class="string">&quot;/upload_single_base64&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        file: <span class="built_in">encodeURIComponent</span>(BASE64),</span><br><span class="line">        filename: file.name,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        headers: &#123;</span><br><span class="line">          <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (data.code == <span class="number">0</span>) &#123;</span><br><span class="line">      alert(<span class="string">`上传成功<span class="subst">$&#123;data.servicePath&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">throw</span> data.codeText;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    alert(<span class="string">&quot;上传失败&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    upload_button_select.classList.remove(<span class="string">&quot;loading&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 点击选择文件按钮，触发上传文件input框选择文件的行为</span></span><br><span class="line">upload_button_select.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (checkDisable(upload_button_select)) <span class="keyword">return</span>;</span><br><span class="line">  upload_inp.click();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="上传时生成唯一-fileName-传给后端"><a href="#上传时生成唯一-fileName-传给后端" class="headerlink" title="上传时生成唯一 fileName 传给后端"></a>上传时生成唯一 fileName 传给后端</h4><p>1、如果服务端不将传入的文件名处理成唯一的前提就需要前端自己生成唯一的 filename，之后传给服务端。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> upload = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#upload3&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_inp = upload.querySelector(<span class="string">&quot;.upload_inp&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_button_select = upload.querySelector(<span class="string">&quot;.upload_button.select&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_button_upload = upload.querySelector(<span class="string">&quot;.upload_button.upload&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_abbre = upload.querySelector(<span class="string">&quot;.upload_abbre&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_abbre_img = upload_abbre.querySelector(<span class="string">&quot;img&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> _file = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检测按钮是否可点击</span></span><br><span class="line"><span class="keyword">const</span> checkDisable = <span class="function">(<span class="params">element</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> classList = element.classList;</span><br><span class="line">  <span class="keyword">return</span> classList.contains(<span class="string">&quot;disable&quot;</span>) || classList.contains(<span class="string">&quot;loading&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将选择的文件转为base64格式</span></span><br><span class="line"><span class="keyword">const</span> changeBase64 = <span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> fileReader = <span class="keyword">new</span> FileReader();</span><br><span class="line">    fileReader.readAsDataURL(file);</span><br><span class="line">    fileReader.onload = <span class="function">(<span class="params">ev</span>) =&gt;</span> &#123;</span><br><span class="line">      resolve(ev.target.result);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将为文件转为Buffer</span></span><br><span class="line"><span class="keyword">const</span> changeBuffer = <span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> fileReader = <span class="keyword">new</span> FileReader();</span><br><span class="line">    fileReader.readAsArrayBuffer(file);</span><br><span class="line">    fileReader.onload = <span class="function">(<span class="params">ev</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> buffer = ev.target.result;</span><br><span class="line">      <span class="built_in">console</span>.log(buffer, <span class="string">&quot;buffer&quot;</span>);</span><br><span class="line">      <span class="keyword">let</span> spark = <span class="keyword">new</span> SparkMD5.ArrayBuffer();</span><br><span class="line">      spark.append(buffer);</span><br><span class="line">      <span class="keyword">let</span> HASH = spark.end();</span><br><span class="line">      <span class="built_in">console</span>.log(HASH, <span class="string">&quot;HASH&quot;</span>);</span><br><span class="line">      <span class="keyword">let</span> suffix = <span class="regexp">/\.([a-zA-Z0-9]+)$/</span>.exec(file.name)[<span class="number">1</span>];</span><br><span class="line">      <span class="built_in">console</span>.log(suffix, <span class="string">&quot;HASH&quot;</span>);</span><br><span class="line">      resolve(&#123;</span><br><span class="line">        buffer,</span><br><span class="line">        HASH,</span><br><span class="line">        suffix,</span><br><span class="line">        filename: <span class="string">`<span class="subst">$&#123;HASH&#125;</span>.<span class="subst">$&#123;suffix&#125;</span>`</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听用户选择文件的操作，并实现文件预览</span></span><br><span class="line">upload_inp.addEventListener(<span class="string">&quot;change&quot;</span>, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 获取用户选择的文件</span></span><br><span class="line">  <span class="keyword">let</span> file = upload_inp.files[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">let</span> BASE64;</span><br><span class="line">  <span class="keyword">if</span> (!file) <span class="keyword">return</span>;</span><br><span class="line">  _file = file;</span><br><span class="line">  <span class="comment">// 限制文件上传的格式</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/(PNG|JPG|JPEG)/i</span>.test(file.type)) &#123;</span><br><span class="line">    alert(<span class="string">&quot;只能上传PNG|JPG|JPEG格式的文件&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 限制文件上传的大小</span></span><br><span class="line">  <span class="keyword">if</span> (file.size &gt; <span class="number">2</span> * <span class="number">1024</span> * <span class="number">1024</span>) &#123;</span><br><span class="line">    alert(<span class="string">&quot;上传的文件不能超过2MB&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 读取之前让上传按钮禁用</span></span><br><span class="line">  upload_button_select.classList.add(<span class="string">&quot;disable&quot;</span>);</span><br><span class="line">  <span class="comment">// 文件预览，就是把文件对象转换为BASE64，赋值给图片的src熟悉感即可</span></span><br><span class="line">  BASE64 = <span class="keyword">await</span> changeBase64(file);</span><br><span class="line">  upload_abbre.style.display = <span class="string">&quot;block&quot;</span>;</span><br><span class="line">  upload_abbre_img.src = BASE64;</span><br><span class="line">  upload_button_select.classList.remove(<span class="string">&quot;disable&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 点击选择文件按钮，触发上传文件input框选择文件的行为</span></span><br><span class="line">upload_button_select.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (checkDisable(upload_button_select)) <span class="keyword">return</span>;</span><br><span class="line">  upload_inp.click();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> changeDisable = <span class="function">(<span class="params">flag</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">    upload_button_select.classList.add(<span class="string">&quot;disable&quot;</span>);</span><br><span class="line">    upload_button_upload.classList.add(<span class="string">&quot;loading&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  upload_button_select.classList.remove(<span class="string">&quot;disable&quot;</span>);</span><br><span class="line">  upload_button_upload.classList.remove(<span class="string">&quot;loading&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上传到服务器</span></span><br><span class="line">upload_button_upload.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (checkDisable(<span class="built_in">this</span>)) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span> (!_file) &#123;</span><br><span class="line">    alert(<span class="string">&quot;请选择文件&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  changeDisable(<span class="literal">true</span>);</span><br><span class="line">  <span class="comment">// 生成文件的HASH名字</span></span><br><span class="line">  <span class="keyword">const</span> &#123; filename &#125; = <span class="keyword">await</span> changeBuffer(_file);</span><br><span class="line">  <span class="built_in">console</span>.log(filename, <span class="string">&quot;filename&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 传递文件给服务器</span></span><br><span class="line">  <span class="keyword">let</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">  formData.append(<span class="string">&quot;file&quot;</span>, _file);</span><br><span class="line">  <span class="comment">// 将自己生成的文件名传给服务端</span></span><br><span class="line">  formData.append(<span class="string">&quot;filename&quot;</span>, filename);</span><br><span class="line">  instance</span><br><span class="line">    .post(<span class="string">&quot;/upload_single&quot;</span>, formData)</span><br><span class="line">    .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.code === <span class="number">0</span>) &#123;</span><br><span class="line">        alert(<span class="string">`文件上传成功<span class="subst">$&#123;data.servicePath&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(data.codeText);</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">reson</span>) =&gt;</span> &#123;</span><br><span class="line">      alert(<span class="string">&quot;上传失败&quot;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .finally(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      changeDisable(<span class="literal">false</span>);</span><br><span class="line">      upload_abbre.style.display = <span class="string">&quot;none&quot;</span>;</span><br><span class="line">      upload_abbre_img.src = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      _file = <span class="literal">null</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="文件上传并生成进度条"><a href="#文件上传并生成进度条" class="headerlink" title="文件上传并生成进度条"></a>文件上传并生成进度条</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> upload = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#upload4&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_inp = upload.querySelector(<span class="string">&quot;.upload_inp&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_button_select = upload.querySelector(<span class="string">&quot;.upload_button.select&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_progress = upload.querySelector(<span class="string">&quot;.upload_progress&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_progress_value = upload_progress.querySelector(<span class="string">&quot;.value&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 延迟函数</span></span><br><span class="line"><span class="keyword">const</span> delay = <span class="function"><span class="keyword">function</span> <span class="title">delay</span>(<span class="params">interval</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">typeof</span> interval !== <span class="string">&quot;number&quot;</span> ? (interval = <span class="number">1000</span>) : <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, interval);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检测按钮是否可点击</span></span><br><span class="line"><span class="keyword">const</span> checkDisable = <span class="function">(<span class="params">element</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> classList = element.classList;</span><br><span class="line">  <span class="keyword">return</span> classList.contains(<span class="string">&quot;disable&quot;</span>) || classList.contains(<span class="string">&quot;loading&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听用户选择文件的操作，并实现文件预览</span></span><br><span class="line">upload_inp.addEventListener(<span class="string">&quot;change&quot;</span>, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 获取用户选择的文件</span></span><br><span class="line">  <span class="keyword">let</span> file = upload_inp.files[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!file) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 限制文件上传的格式</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/(PNG|JPG|JPEG)/i</span>.test(file.type)) &#123;</span><br><span class="line">    alert(<span class="string">&quot;只能上传PNG|JPG|JPEG格式的文件&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 限制文件上传的大小</span></span><br><span class="line">  <span class="keyword">if</span> (file.size &gt; <span class="number">2</span> * <span class="number">1024</span> * <span class="number">1024</span>) &#123;</span><br><span class="line">    alert(<span class="string">&quot;上传的文件不能超过2MB&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 读取之前让上传按钮禁用</span></span><br><span class="line">  upload_button_select.classList.add(<span class="string">&quot;loading&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">    formData.append(<span class="string">&quot;file&quot;</span>, file);</span><br><span class="line">    formData.append(<span class="string">&quot;filename&quot;</span>, file.name);</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> instance.post(<span class="string">&quot;/upload_single&quot;</span>, formData, &#123;</span><br><span class="line">      <span class="comment">// 文件上传中的回调函数 xhr.upload.onprogress</span></span><br><span class="line">      <span class="function"><span class="title">onUploadProgress</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> &#123; loaded, total &#125; = ev;</span><br><span class="line">        upload_progress.style.display = <span class="string">&quot;block&quot;</span>;</span><br><span class="line">        upload_progress_value.style.width = <span class="string">`<span class="subst">$&#123;(loaded / total) * <span class="number">100</span>&#125;</span>%`</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (data.code === <span class="number">0</span>) &#123;</span><br><span class="line">      upload_progress_value.width = <span class="string">&quot;100%&quot;</span>;</span><br><span class="line">      <span class="comment">// 延迟3ms，防止alert阻止页面渲染，阻止进度条进度加载</span></span><br><span class="line">      <span class="keyword">await</span> delay(<span class="number">300</span>);</span><br><span class="line">      alert(<span class="string">`上传成功 =&gt; <span class="subst">$&#123;data.servicePath&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> data.codeText;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    alert(<span class="string">&quot;上传失败&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    upload_button_select.classList.remove(<span class="string">&quot;loading&quot;</span>);</span><br><span class="line">    upload_progress.style.display = <span class="string">&quot;none&quot;</span>;</span><br><span class="line">    upload_progress_value.width = <span class="string">&quot;0&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">upload_button_select.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (checkDisable(upload_button_select)) <span class="keyword">return</span>;</span><br><span class="line">  upload_inp.click();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="多文件上传"><a href="#多文件上传" class="headerlink" title="多文件上传"></a>多文件上传</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> upload = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#upload5&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_inp = upload.querySelector(<span class="string">&quot;.upload_inp&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_button_select = upload.querySelector(<span class="string">&quot;.upload_button.select&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_button_upload = upload.querySelector(<span class="string">&quot;.upload_button.upload&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_list = upload.querySelector(<span class="string">&quot;.upload_list&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> _files = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检测按钮是否可点击</span></span><br><span class="line"><span class="keyword">const</span> checkDisable = <span class="function">(<span class="params">element</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> classList = element.classList;</span><br><span class="line">  <span class="keyword">return</span> classList.contains(<span class="string">&quot;disable&quot;</span>) || classList.contains(<span class="string">&quot;loading&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> changeDisable = <span class="function">(<span class="params">flag</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">    upload_button_select.classList.add(<span class="string">&quot;disable&quot;</span>);</span><br><span class="line">    upload_button_upload.classList.add(<span class="string">&quot;loading&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  upload_button_select.classList.remove(<span class="string">&quot;disable&quot;</span>);</span><br><span class="line">  upload_button_upload.classList.remove(<span class="string">&quot;loading&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> createRandom = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> ran = <span class="built_in">Math</span>.random() * <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  <span class="keyword">return</span> ran.toString(<span class="number">16</span>).replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基于事件委托实现移除操作</span></span><br><span class="line">upload_list.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">ev</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> target = ev.target;</span><br><span class="line">  <span class="keyword">let</span> curLi = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">let</span> key;</span><br><span class="line">  <span class="keyword">if</span> (target.tagName === <span class="string">&quot;EM&quot;</span>) &#123;</span><br><span class="line">    curLi = target.parentNode.parentNode;</span><br><span class="line">    <span class="keyword">if</span> (!curLi) <span class="keyword">return</span>;</span><br><span class="line">    upload_list.removeChild(curLi);</span><br><span class="line">    key = curLi.getAttribute(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    _files = _files.filter(<span class="function">(<span class="params">item</span>) =&gt;</span> item.key !== key);</span><br><span class="line">    <span class="keyword">if</span> (_files.length === <span class="number">0</span>) &#123;</span><br><span class="line">      upload_list.style.display = <span class="string">&quot;none&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听用户选择文件的操作，并实现文件预览</span></span><br><span class="line">upload_inp.addEventListener(<span class="string">&quot;change&quot;</span>, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 获取用户选择的文件</span></span><br><span class="line">  _files = <span class="built_in">Array</span>.from(upload_inp.files);</span><br><span class="line">  <span class="built_in">console</span>.log(_files, <span class="string">&quot;_files&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (_files.length === <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 给每一项设置一个位置值，作为自定义属性存储到元素上，后期点击删除按钮的时候，可以基于这个自定义属性获取唯一值，再到集合中根据这个唯一值，删除集合中这一项。</span></span><br><span class="line">  _files = _files.map(<span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      file,</span><br><span class="line">      filename: file.name,</span><br><span class="line">      key: createRandom(),</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">let</span> str = <span class="string">``</span>;</span><br><span class="line">  _files.forEach(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">    str += <span class="string">`&lt;li key=<span class="subst">$&#123;item.key&#125;</span>&gt;</span></span><br><span class="line"><span class="string">        &lt;span&gt;文件<span class="subst">$&#123;index + <span class="number">1</span>&#125;</span>：<span class="subst">$&#123;item.filename&#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">        &lt;span&gt;&lt;em&gt;移除&lt;/em&gt;&lt;/span&gt;</span></span><br><span class="line"><span class="string">      &lt;/li&gt;`</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  upload_list.innerHTML = str;</span><br><span class="line">  upload_list.style.display = <span class="string">&quot;block&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 点击选择文件按钮，触发上传文件input框选择文件的行为</span></span><br><span class="line">upload_button_select.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (checkDisable(upload_button_select)) <span class="keyword">return</span>;</span><br><span class="line">  upload_inp.click();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上传到服务器</span></span><br><span class="line">upload_button_upload.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (checkDisable(<span class="built_in">this</span>)) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span> (!_files.length === <span class="number">0</span>) &#123;</span><br><span class="line">    alert(<span class="string">&quot;请选择文件&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  changeDisable(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 循环发送请求</span></span><br><span class="line">  <span class="keyword">let</span> upload_list_arr = <span class="built_in">Array</span>.from(upload_list.querySelectorAll(<span class="string">&quot;li&quot;</span>));</span><br><span class="line">  _files = _files.map(<span class="function">(<span class="params">i</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> fm = <span class="keyword">new</span> FormData();</span><br><span class="line">    <span class="keyword">let</span> curLi = upload_list_arr.find(</span><br><span class="line">      (liBox) =&gt; liBox.getAttribute(<span class="string">&quot;key&quot;</span>) === i.key</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">let</span> curSpan = curLi ? curLi.querySelector(<span class="string">&quot;span:nth-last-child(1)&quot;</span>) : <span class="literal">null</span>;</span><br><span class="line">    fm.append(<span class="string">&quot;file&quot;</span>, i.file);</span><br><span class="line">    fm.append(<span class="string">&quot;filename&quot;</span>, i.filename);</span><br><span class="line">    <span class="keyword">return</span> instance</span><br><span class="line">      .post(<span class="string">&quot;/upload_single&quot;</span>, fm, &#123;</span><br><span class="line">        <span class="function"><span class="title">onUploadProgress</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (curSpan) &#123;</span><br><span class="line">            curSpan.innerHTML = <span class="string">`<span class="subst">$&#123;((ev.loaded / ev.total) * <span class="number">100</span>).toFixed(<span class="number">2</span>)&#125;</span>%`</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">      .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (data.code === <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (curSpan) &#123;</span><br><span class="line">            curSpan.innerHTML = <span class="string">&quot;100%&quot;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject();</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Promise</span>.all(_files)</span><br><span class="line">    .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      alert(<span class="string">&quot;全部上传成功&quot;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      alert(<span class="string">&quot;某一个文件导致了上传失败&quot;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .finally(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      changeDisable(<span class="literal">false</span>);</span><br><span class="line">      _files = [];</span><br><span class="line">      upload_list.innerHTML = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      upload_list.style.display = <span class="string">&quot;none&quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="拖拽上传"><a href="#拖拽上传" class="headerlink" title="拖拽上传"></a>拖拽上传</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> upload = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#upload6&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_inp = upload.querySelector(<span class="string">&quot;.upload_inp&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_submit = upload.querySelector(<span class="string">&quot;.upload_submit&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_mark = upload.querySelector(<span class="string">&quot;.upload_mark&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> isRun = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">// 实现文件上传</span></span><br><span class="line"><span class="keyword">const</span> uploadFile = <span class="keyword">async</span> (file) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (isRun) <span class="keyword">return</span>;</span><br><span class="line">  isRun = <span class="literal">true</span>;</span><br><span class="line">  upload_mark.style.display = <span class="string">&quot;flex&quot;</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> fm = <span class="keyword">new</span> FormData();</span><br><span class="line">    fm.append(<span class="string">&quot;file&quot;</span>, file);</span><br><span class="line">    fm.append(<span class="string">&quot;filenamchangchuanshibaie&quot;</span>, file.name);</span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">await</span> instance.post(<span class="string">&quot;/upload_single&quot;</span>, fm);</span><br><span class="line">    <span class="keyword">if</span> (data.code === <span class="number">0</span>) &#123;</span><br><span class="line">      alert(<span class="string">&quot;上传成功&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> data.codeText;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    alert(<span class="string">&quot;上传失败&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    upload_mark.style.display = <span class="string">&quot;none&quot;</span>;</span><br><span class="line">    isRun = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 拖拽获取 dragenter dragleave dragover drop</span></span><br><span class="line"><span class="comment">  upload.addEventListener(&quot;dragenter&quot;, function () &#123;</span></span><br><span class="line"><span class="comment">    console.log(&quot;进入&quot;); // 进入时触发</span></span><br><span class="line"><span class="comment">  &#125;);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  upload.addEventListener(&quot;dragleave&quot;, function () &#123;</span></span><br><span class="line"><span class="comment">    console.log(&quot;离开&quot;); // 离开时触发</span></span><br><span class="line"><span class="comment">  &#125;);</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"></span><br><span class="line">upload.addEventListener(<span class="string">&quot;dragover&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">ev</span>) </span>&#123;</span><br><span class="line">  ev.preventDefault();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;在区域中移动&quot;</span>); <span class="comment">// 在区域中移动时触发</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">upload.addEventListener(<span class="string">&quot;drop&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">ev</span>) </span>&#123;</span><br><span class="line">  ev.preventDefault();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;放置到容器中&quot;</span>); <span class="comment">// 放置到容器中时触发</span></span><br><span class="line">  <span class="keyword">let</span> file = ev.dataTransfer.files[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">if</span> (!file) <span class="keyword">return</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(file, <span class="string">&quot;file&quot;</span>);</span><br><span class="line">  uploadFile(file);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 手动选择</span></span><br><span class="line">upload_inp.addEventListener(<span class="string">&quot;change&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> file = upload_inp.files[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">if</span> (!file) <span class="keyword">return</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(file, <span class="string">&quot;-----&quot;</span>);</span><br><span class="line">  uploadFile(file);</span><br><span class="line">&#125;);</span><br><span class="line">upload_submit.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  upload_inp.click();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="大文件上传-切片上传"><a href="#大文件上传-切片上传" class="headerlink" title="大文件上传(切片上传)"></a>大文件上传(切片上传)</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> upload = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#upload7&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_inp = upload.querySelector(<span class="string">&quot;.upload_inp&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_button_select = upload.querySelector(<span class="string">&quot;.upload_button.select&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_progress = upload.querySelector(<span class="string">&quot;.upload_progress&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> upload_progress_value = upload_progress.querySelector(<span class="string">&quot;.value&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检测按钮是否可点击</span></span><br><span class="line"><span class="keyword">const</span> checkDisable = <span class="function">(<span class="params">element</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> classList = element.classList;</span><br><span class="line">  <span class="keyword">return</span> classList.contains(<span class="string">&quot;disable&quot;</span>) || classList.contains(<span class="string">&quot;loading&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将为文件转为Buffer</span></span><br><span class="line"><span class="keyword">const</span> changeBuffer = <span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> fileReader = <span class="keyword">new</span> FileReader();</span><br><span class="line">    fileReader.readAsArrayBuffer(file);</span><br><span class="line">    fileReader.onload = <span class="function">(<span class="params">ev</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> buffer = ev.target.result;</span><br><span class="line">      <span class="built_in">console</span>.log(buffer, <span class="string">&quot;buffer&quot;</span>);</span><br><span class="line">      <span class="keyword">let</span> spark = <span class="keyword">new</span> SparkMD5.ArrayBuffer();</span><br><span class="line">      spark.append(buffer);</span><br><span class="line">      <span class="keyword">let</span> HASH = spark.end();</span><br><span class="line">      <span class="built_in">console</span>.log(HASH, <span class="string">&quot;HASH&quot;</span>);</span><br><span class="line">      <span class="keyword">let</span> suffix = <span class="regexp">/\.([a-zA-Z0-9]+)$/</span>.exec(file.name)[<span class="number">1</span>];</span><br><span class="line">      <span class="built_in">console</span>.log(suffix, <span class="string">&quot;HASH&quot;</span>);</span><br><span class="line">      resolve(&#123;</span><br><span class="line">        buffer,</span><br><span class="line">        HASH,</span><br><span class="line">        suffix,</span><br><span class="line">        filename: <span class="string">`<span class="subst">$&#123;HASH&#125;</span>.<span class="subst">$&#123;suffix&#125;</span>`</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听用户选择文件的操作，并实现文件预览</span></span><br><span class="line">upload_inp.addEventListener(<span class="string">&quot;change&quot;</span>, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 获取用户选择的文件</span></span><br><span class="line">  <span class="keyword">let</span> file = upload_inp.files[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!file) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 限制文件上传的格式</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/(PNG|JPG|JPEG)/i</span>.test(file.type)) &#123;</span><br><span class="line">    alert(<span class="string">&quot;只能上传PNG|JPG|JPEG格式的文件&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 限制文件上传的大小</span></span><br><span class="line">  <span class="keyword">if</span> (file.size &gt; <span class="number">2</span> * <span class="number">1024</span> * <span class="number">1024</span>) &#123;</span><br><span class="line">    alert(<span class="string">&quot;上传的文件不能超过2MB&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 读取之前让上传按钮禁用</span></span><br><span class="line">  upload_button_select.classList.add(<span class="string">&quot;loading&quot;</span>);</span><br><span class="line">  upload_progress.style.display = <span class="string">&quot;block&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> already = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取文件HASH，suffix后缀名</span></span><br><span class="line">  <span class="keyword">let</span> &#123; HASH, suffix &#125; = <span class="keyword">await</span> changeBuffer(file);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取已经上传的切片信息</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> instance.get(<span class="string">&quot;/upload_already&quot;</span>, &#123;</span><br><span class="line">      params: &#123;</span><br><span class="line">        HASH,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (data.code === <span class="number">0</span>) &#123;</span><br><span class="line">      already = data.fileList;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 实现文件的切片处理的方式：固定数量 &amp; 固定大小</span></span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> chunks = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> max = <span class="number">1024</span> * <span class="number">100</span>;</span><br><span class="line">  <span class="keyword">let</span> count = <span class="built_in">Math</span>.ceil(file.size / max);</span><br><span class="line">  <span class="keyword">if</span> (count &gt; <span class="number">100</span>) &#123;</span><br><span class="line">    max = file.size / <span class="number">100</span>;</span><br><span class="line">    count = <span class="number">100</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (index &lt; count) &#123;</span><br><span class="line">    chunks.push(&#123;</span><br><span class="line">      file: file.slice(index * max, (index + <span class="number">1</span>) * max),</span><br><span class="line">      filename: <span class="string">`<span class="subst">$&#123;HASH&#125;</span>_<span class="subst">$&#123;index + <span class="number">1</span>&#125;</span>.<span class="subst">$&#123;suffix&#125;</span>`</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    index++;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> clear = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    upload_button_select.classList.remove(<span class="string">&quot;loading&quot;</span>);</span><br><span class="line">    upload_progress.style.display = <span class="string">&quot;block&quot;</span>;</span><br><span class="line">    upload_progress_value.style.width = <span class="string">&quot;0&quot;</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 上传成功处理</span></span><br><span class="line">  index = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> complate = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 进度条处理</span></span><br><span class="line">    index++;</span><br><span class="line">    upload_progress_value.style.width = <span class="string">`<span class="subst">$&#123;(index / count) * <span class="number">100</span>&#125;</span>%`</span>;</span><br><span class="line">    <span class="comment">// 当所有切片都上传成功时，进行切片的合并处理</span></span><br><span class="line">    <span class="keyword">if</span> (index &lt; count) <span class="keyword">return</span>;</span><br><span class="line">    upload_progress_value.style.width = <span class="string">&quot;100%&quot;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">await</span> instance.post(</span><br><span class="line">        <span class="string">&quot;/upload_merge&quot;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          HASH,</span><br><span class="line">          count,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          headers: &#123;</span><br><span class="line">            <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (data.code === <span class="number">0</span>) &#123;</span><br><span class="line">        alert(<span class="string">&quot;文件上传成功&quot;</span>);</span><br><span class="line">        clear();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">throw</span> data.codeText;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      alert(<span class="string">&quot;切片合并失败&quot;</span>);</span><br><span class="line">      clear();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 把没每一个切片上传到服务器</span></span><br><span class="line">  chunks.forEach(<span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 已经上传到额切片不需要再重新上传</span></span><br><span class="line">    <span class="keyword">if</span> (already.length &gt; <span class="number">0</span> &amp;&amp; already.includes(chunk.filename)) &#123;</span><br><span class="line">      complate();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> fm = <span class="keyword">new</span> FormData();</span><br><span class="line">    fm.append(<span class="string">&quot;file&quot;</span>, chunk.file);</span><br><span class="line">    fm.append(<span class="string">&quot;filename&quot;</span>, chunk.filename);</span><br><span class="line">    instance.post(<span class="string">&quot;/upload_chunk&quot;</span>, fm),</span><br><span class="line">      then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (da6a.code === <span class="number">0</span>) &#123;</span><br><span class="line">          complate();</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(data.codeText);</span><br><span class="line">      &#125;).catch(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        alert(<span class="string">&quot;切片上传失败&quot;</span>);</span><br><span class="line">        clear();</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">upload_button_select.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (checkDisable(<span class="built_in">this</span>)) <span class="keyword">return</span>;</span><br><span class="line">  upload_inp.click();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="index-html-内容"><a href="#index-html-内容" class="headerlink" title="index.html 内容"></a>index.html 内容</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>切片上传<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/qs/6.10.1/qs.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/axios/0.21.1/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/spark-md5/3.0.0/spark-md5.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">      .upload_inp &#123;</span><br><span class="line"><span class="css">        <span class="attribute">display</span>: none;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .upload_list &#123;</span><br><span class="line"><span class="css">        <span class="attribute">display</span>: none;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .disable &#123;</span><br><span class="line"><span class="css">        <span class="attribute">background-color</span>: <span class="number">#ccc</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .loading &#123;</span><br><span class="line"><span class="css">        <span class="attribute">background-color</span>: <span class="number">#ccc</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .upload_abbre &#123;</span><br><span class="line"><span class="css">        <span class="attribute">display</span>: none;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .upload_progress &#123;</span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">500px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">background-color</span>: <span class="number">#eee</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">margin-top</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">display</span>: none;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .value &#123;</span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">background-color</span>: skyblue;</span></span><br><span class="line"><span class="css">        <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">transition</span>: all <span class="number">0.3s</span> ease;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">      <span class="selector-tag">em</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="css">        <span class="attribute">color</span>: red;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .upload_box &#123;</span><br><span class="line"><span class="css">        <span class="attribute">position</span>: relative;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .upload_drag &#123;</span><br><span class="line"><span class="css">        <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">        <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">        <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">500px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">150px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">border</span>: <span class="number">1px</span> dotted <span class="number">#ccc</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .upload_mark &#123;</span><br><span class="line"><span class="css">        <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">        <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">        <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="css">        <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="css">        <span class="attribute">top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">left</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">500px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">150px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">background-color</span>: <span class="number">#ccc</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">display</span>: none;</span></span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>单一文件上传「FORM-DATA」<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;upload_box&quot;</span> <span class="attr">id</span>=<span class="string">&quot;upload1&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">class</span>=<span class="string">&quot;upload_inp&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;.png,.jpg,.jpeg&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;upload_button_box&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;upload_button select&quot;</span>&gt;</span>选择文件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;upload_button upload&quot;</span>&gt;</span>上传到服务器<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;upload_tip&quot;</span>&gt;</span></span><br><span class="line">            只能上传 PNG/JPG/JPEG 格式图片，且大小不能超过2MB</span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;upload_list&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span>文件：...<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>移除<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>单一文件上传[BASE64]，只适合图片<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;upload_box&quot;</span> <span class="attr">id</span>=<span class="string">&quot;upload2&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">class</span>=<span class="string">&quot;upload_inp&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;upload_button_box&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;upload_button select&quot;</span>&gt;</span>上传图片<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;upload_tip&quot;</span>&gt;</span></span><br><span class="line">            只能上传jpg/png格式图片，且大小不能超过2mb</span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>单一文件上传[缩略图处理]<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;upload_box&quot;</span> <span class="attr">id</span>=<span class="string">&quot;upload3&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">class</span>=<span class="string">&quot;upload_inp&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;.png,.jpg,.jpeg&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;upload_button_box&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;upload_button select&quot;</span>&gt;</span>选择文件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;upload_button upload&quot;</span>&gt;</span>上传到服务器<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;upload_abbre&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>单一文件上传[进度条处理]<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;upload_box&quot;</span> <span class="attr">id</span>=<span class="string">&quot;upload4&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">class</span>=<span class="string">&quot;upload_inp&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;.png,.jpg,.jpeg&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;upload_button_box&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;upload_button select&quot;</span>&gt;</span>上传文件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;upload_progress&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;value&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>多文件上传<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;upload_box&quot;</span> <span class="attr">id</span>=<span class="string">&quot;upload5&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- multiple可允许同时上传多个文件 --&gt;</span></span><br><span class="line">          &lt;input</span><br><span class="line">            type=&quot;file&quot;</span><br><span class="line">            class=&quot;upload_inp&quot;</span><br><span class="line">            multiple</span><br><span class="line">            accept=&quot;.png,.jpg,.jpeg&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;upload_button_box&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;upload_button select&quot;</span>&gt;</span>上传文件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;upload_button upload&quot;</span>&gt;</span>上传到服务器<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;upload_list&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span>文件：...<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>移除<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>拖拽上传<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;upload_box&quot;</span> <span class="attr">id</span>=<span class="string">&quot;upload6&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">class</span>=<span class="string">&quot;upload_inp&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;.png,.jpg,.jpeg&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;upload_drag&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span>&gt;</span>拖到此处上传<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">              将文件拖到此处，或</span><br><span class="line">              <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;upload_submit&quot;</span>&gt;</span>点击上传<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;upload_mark&quot;</span>&gt;</span>正在上传中，请稍等...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>大文件上传<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;upload_box&quot;</span> <span class="attr">id</span>=<span class="string">&quot;upload7&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">class</span>=<span class="string">&quot;upload_inp&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;upload_button_box&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;upload_button select&quot;</span>&gt;</span>上传文件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;upload_progress&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;value&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./instance.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./upload.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="canvas-压缩上传图片"><a href="#canvas-压缩上传图片" class="headerlink" title="canvas 压缩上传图片"></a>canvas 压缩上传图片</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>canvas 压缩上传<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;upload&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> upload = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#upload&quot;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> ACCEPT = [<span class="string">&quot;image/jpg&quot;</span>, <span class="string">&quot;image/png&quot;</span>, <span class="string">&quot;image/jpeg&quot;</span>];</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> MAXSIZE = <span class="number">5</span> * <span class="number">1024</span> * <span class="number">1024</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> MAXSIZE_STR = <span class="string">&quot;5MB&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">convertImageToBase64</span>(<span class="params">file, callback</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> render = <span class="keyword">new</span> FileReader();</span></span><br><span class="line"><span class="javascript">        render.addEventListener(<span class="string">&quot;load&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> base64Image = e.target.result;</span></span><br><span class="line">          callback &amp;&amp; callback(base64Image);</span><br><span class="line"><span class="javascript">          render = <span class="literal">null</span>;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        render.readAsDataURL(file);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 使用canvas压缩图片</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">compress</span>(<span class="params">base64Image, callback</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> maxW = <span class="number">1024</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> maxH = <span class="number">1024</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> image = <span class="keyword">new</span> Image();</span></span><br><span class="line"><span class="javascript">        image.addEventListener(<span class="string">&quot;load&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 压缩比例</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">let</span> ratio;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 是否需要压缩</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">let</span> needCompress = <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 最大宽度小于传入图片宽度，则需要压缩</span></span></span><br><span class="line">          if (maxW &lt; image.naturalWidth) &#123;</span><br><span class="line"><span class="javascript">            needCompress = <span class="literal">true</span>;</span></span><br><span class="line">            ratio = image.naturalWidth / maxW;</span><br><span class="line">            maxH = image.naturalHeight / ratio;</span><br><span class="line">          &#125;</span><br><span class="line"><span class="javascript">          <span class="comment">// 最大高度小于传入图片高度，则需要压缩</span></span></span><br><span class="line">          if (maxW &lt; image.naturalHeight) &#123;</span><br><span class="line"><span class="javascript">            needCompress = <span class="literal">true</span>;</span></span><br><span class="line">            ratio = image.naturalHeight / maxH;</span><br><span class="line">            maxW = image.naturalWidth / ratio;</span><br><span class="line">          &#125;</span><br><span class="line"><span class="javascript">          <span class="comment">// 不需要压缩</span></span></span><br><span class="line">          if (!needCompress) &#123;</span><br><span class="line">            maxW = image.naturalWidth;</span><br><span class="line">            maxH = image.naturalHeight;</span><br><span class="line">          &#125;</span><br><span class="line"><span class="javascript">          <span class="comment">// 创建canvas</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">&quot;canvas&quot;</span>);</span></span><br><span class="line"><span class="javascript">          canvas.setAttribute(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;__compress__&quot;</span>);</span></span><br><span class="line">          canvas.width = maxW;</span><br><span class="line">          canvas.height = maxH;</span><br><span class="line"><span class="javascript">          canvas.style.visibility = <span class="string">&quot;visible&quot;</span>;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">document</span>.body.appendChild(canvas);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> ctx = canvas.getContext(<span class="string">&quot;2d&quot;</span>);</span></span><br><span class="line">          ctx.clearRect(0, 0, maxW, maxH);</span><br><span class="line">          ctx.drawImage(image, 0, 0, maxW, maxH);</span><br><span class="line"><span class="javascript">          <span class="comment">// 使用toDataURL方法将图片压缩到0.9倍</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> compressImage = canvas.toDataURL(<span class="string">&quot;image/jpeg&quot;</span>, <span class="number">0.9</span>);</span></span><br><span class="line">          callback &amp;&amp; callback(compressImage);</span><br><span class="line"></span><br><span class="line"><span class="javascript">          <span class="comment">// 开始，正常一下代码可以省略，这里是为了显示压缩前后对比</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> _image = <span class="keyword">new</span> Image();</span></span><br><span class="line">          _image.src = compressImage;</span><br><span class="line"><span class="javascript">          <span class="built_in">document</span>.body.append(_image);</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="string">`图片压缩比是：<span class="subst">$&#123;image.src.length / _image.src.length&#125;</span>`</span>);</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 结束，正常一下代码可以省略，这里是为了显示压缩前后对比</span></span></span><br><span class="line"></span><br><span class="line">          canvas.remove();</span><br><span class="line">        &#125;);</span><br><span class="line">        image.src = base64Image;</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">// 开始，正常一下代码可以省略，这里是为了显示压缩前后对比</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.body.appendChild(image);</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 结束，正常一下代码可以省略，这里是为了显示压缩前后对比</span></span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 上传至服务器</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">uploadToServer</span>(<span class="params">compressImage</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;compressImage....uoload to Server&quot;</span>, compressImage);</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      upload.addEventListener(<span class="string">&quot;change&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> [file] = e.target.files;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (!file) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> &#123; <span class="attr">type</span>: fileType, <span class="attr">size</span>: fileSize &#125; = file;</span></span><br><span class="line">        if (!ACCEPT.includes(fileType)) &#123;</span><br><span class="line">          alert(</span><br><span class="line"><span class="javascript">            <span class="string">`只允许上传jpg、png、jpeg格式的图片，不支持<span class="subst">$&#123;fileType&#125;</span>格式的图片`</span></span></span><br><span class="line">          );</span><br><span class="line"><span class="javascript">          upload.value = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line">        if (fileSize &gt; MAXSIZE) &#123;</span><br><span class="line"><span class="javascript">          alert(<span class="string">`文件超出<span class="subst">$&#123;MAXSIZE_STR&#125;</span>`</span>);</span></span><br><span class="line"><span class="javascript">          upload.value = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="comment">// 使用canvas压缩图片</span></span></span><br><span class="line"><span class="javascript">        convertImageToBase64(file, <span class="function">(<span class="params">base64Image</span>) =&gt;</span></span></span><br><span class="line">          compress(base64Image, uploadToServer)</span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>文件上传</category>
      </categories>
      <tags>
        <tag>canvas</tag>
        <tag>JavaScript</tag>
        <tag>File</tag>
      </tags>
  </entry>
</search>
